<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">ADO.Net SqlConnection类</h1><div style="width:100%;float:left;" class="article-content">   
 <p><code>SqlConnection</code>类用于建立到SQL Server数据库的开放连接。这是一个封闭的类，所以不能被继承。连接到Microsoft SQL Server数据库时，<code>SqlConnection</code>类与<code>SqlDataAdapter</code>和<code>SqlCommand</code>类一起使用来提高性能。</p> 
 <p>即使连接超出范围，连接也不会明确关闭。 因此，在代码中必须通过调用<code>Close()</code>方法显式关闭连接。</p> 
 <p><strong>SqlConnection类签名</strong></p> 
 <pre><code class="lang-csharp">public sealed class SqlConnection : System.Data.Common.DbConnection, ICloneable, IDisposable
</code></pre> 
 <p><strong>SqlConnection类构造函数</strong></p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>构造函数</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>SqlConnection()</code></td> 
    <td>它用于初始化<code>SqlConnection</code>类的新实例。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>SqlConnection(String)</code></td> 
    <td>它用于初始化<code>SqlConnection</code>类的新实例，并将连接字符串作为参数。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>SqlConnection(String, SqlCredential)</code></td> 
    <td>它用于初始化一个带有两个参数的<code>SqlConnection</code>类的新实例。首先是连接字符串，其次是SQL凭据。</td> 
   </tr> 
  </tbody> 
 </table> 
 <p><strong>SqlConnection类的方法</strong></p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>方法</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>BeginTransaction()</code></td> 
    <td>它用于启动数据库事务。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>ChangeDatabase(String)</code></td> 
    <td>它用于更改当前数据库以打开<code>SqlConnection</code>。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>ChangePassword(String, String)</code></td> 
    <td>它会更改连接字符串中指示的用户的SQL Server密码。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>Close()</code></td> 
    <td>它用于关闭与数据库的连接。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>CreateCommand()</code></td> 
    <td>它作为分布式事务在指定的事务中使用。</td> 
   </tr> 
   <tr> 
    <td>6</td> 
    <td><code>GetSchema()</code></td> 
    <td>它返回这个<code>SqlConnection</code>的数据源的模式信息。</td> 
   </tr> 
   <tr> 
    <td>7</td> 
    <td><code>Open()</code></td> 
    <td>它用来打开数据库连接。</td> 
   </tr> 
   <tr> 
    <td>8</td> 
    <td><code>ResetStatistics()</code></td> 
    <td>如果启用统计信息收集，它会重置所有值。</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 id="h2-sqlconnection-"><a name="SqlConnection示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>SqlConnection示例</h2>
 <p>现在，下面来创建一个与SQL Server建立连接的例子。前面一节的教程中，已经创建了一个名称：<em>student</em> 的数据库，这里将演示如何连接到这个数据库。参考下面的 <em>C#</em> 代码。</p> 
 <pre><code class="lang-csharp">using (SqlConnection connection = new SqlConnection(connectionString))    
{    
  connection.Open();         
}
</code></pre> 
 <p>代码中的<code>using</code>块可以自动关闭连接。所以不需要明确地调用<code>close()</code>方法来关闭数据库的连接，<code>using</code>块代码会在代码退出时隐式执行。</p> 
 <p>为了方便演示，这里创建一个名称为：<em>SqlConnectionApp</em> 的 C# 控制台项目。如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201711/2011/931151103_22773.png" alt=""></p> 
 <p>参考以下示例代码(<em>TestConnection.cs</em>) - </p> 
 <pre><code class="lang-csharp">using System;
using System.Data.SqlClient;

namespace SqlConnectionApp
{
    class TestConnection
    {
        static void Main(string[] args)
        {
            new TestConnection().Connecting();
        }
        public void Connecting()
        {
            using (
                     // Creating Connection  
                     SqlConnection con = new SqlConnection("data source=.; database=student; integrated security=SSPI")
                 )
            {
                con.Open();
                Console.WriteLine("建立与SQL Server数据库的连接成功~！");
            }
        }
    }
}
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201711/2011/528151107_14582.png" alt=""></p> 
 <p>下面，演示如何不使用<code>using</code>块。</p> 
 <p>如果不使用<code>using</code>块来创建连接，必须明确地关闭连接。在下面的例子中，我们使用<code>try</code>块而不是使用<code>using</code>块。参考以下代码实现(<em>TestConnection2.cs</em>) - </p>   
 <pre><code class="lang-csharp">using System;
using System.Data.SqlClient;

namespace SqlConnectionApp
{

    class TestConnection2
    {
        static void Main(string[] args)
        {
            new TestConnection2().Connecting();
        }
        public void Connecting()
        {
            SqlConnection con = null;
            try
            {
                // Creating Connection  
                con = new SqlConnection("data source=.; database=student; integrated security=SSPI");
                con.Open();
                Console.WriteLine("建立与SQL Server数据库的连接成功~！");

                // 查询SQL Server 数据库的版本
                SqlCommand cm = new SqlCommand("Select @@version as version", con);
                // Executing the SQL query  
                SqlDataReader sdr = cm.ExecuteReader();
                // Iterating Data  
                while (sdr.Read())
                {
                    Console.WriteLine("SQL Server 数据库的版本是： " + sdr["version"]); // Displaying Record  
                }
            }
            catch (Exception e)
            {
                Console.WriteLine("程序出错了，不知道发生了什么~！\n" + e);
            }
            finally
            {   // Closing the connection  
                con.Close();
            }
        }
    }
}
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201711/2011/691151116_82882.png" alt=""></p>
 <br>      
</div></body></html>
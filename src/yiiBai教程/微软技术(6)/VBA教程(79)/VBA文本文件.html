<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">VBA文本文件</h1><div style="width:100%;float:left;" class="article-content">   
 <p>还可以读取Excel文件，并使用VBA将单元格的内容写入文本文件。VBA允许用户使用两种方法处理文本文件 -</p> 
 <ul> 
  <li>文件系统对象(<code>FSO</code>)</li>
  <li>使用<code>Write</code>命令</li>
 </ul> 
 <h2 id="h2--fso-"><a name="文件系统对象(FSO)" class="reference-link"></a><span class="header-link octicon octicon-link"></span>文件系统对象(FSO)</h2>
 <p>顾名思义，<code>FSO</code>对象帮助开发人员使用驱动器，文件夹和文件。 在本节中，我们将讨论如何使用<code>FSO</code>。</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>对象类型</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>Drive</code></td> 
    <td><code>Drive</code>是一个对象。 包含收集有关连接到系统的驱动器的信息的方法和属性。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>Drives</code></td> 
    <td><code>Drives</code>是一个集合。 它提供了连接到系统的驱动器的物理或逻辑列表。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>File</code></td> 
    <td><code>File</code>是一个对象。 它包含允许开发人员创建，删除或移动文件的方法和属性。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>Files</code></td> 
    <td><code>Files</code>是一个集合。 它提供了一个文件夹中包含的所有文件的列表。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>Folder</code></td> 
    <td><code>Folder</code>是一个对象。 它提供了允许开发人员创建，删除或移动文件夹的方法和属性。</td> 
   </tr> 
   <tr> 
    <td>6</td> 
    <td><code>Folders</code></td> 
    <td><code>Folders</code>是一个集合。 它提供了一个文件夹内所有文件夹的列表。</td> 
   </tr> 
   <tr> 
    <td>7</td> 
    <td><code>TextStream</code></td> 
    <td><code>TextStream</code>是一个对象。 它使开发人员能够读写文本文件。</td> 
   </tr> 
  </tbody> 
 </table> 
 <h4 id="h4-drive"><a name="Drive" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Drive</h4>
 <p><code>Drive</code> 是一个对象，它提供对特定磁盘驱动器或网络共享的属性的访问。 <code>Drive</code>对象支持以下属性 -</p> 
 <ul> 
  <li><code>AvailableSpace</code></li>
  <li><code>DriveLetter</code></li>
  <li><code>DriveType</code></li>
  <li><code>FileSystem</code></li>
  <li><code>FreeSpace</code></li>
  <li><code>IsReady</code></li>
  <li><code>Path</code></li>
  <li><code>RootFolder</code></li>
  <li><code>SerialNumber</code></li>
  <li><code>ShareName</code></li>
  <li><code>TotalSize</code></li>
  <li><code>VolumeName</code></li>
 </ul> 
 <h4 id="h4-u793Au4F8B"><a name="示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>示例</h4>
 <p><strong>第1步</strong> - 在使用<code>FSO</code>进行脚本编写之前，应该启用Microsoft脚本运行时。请导航到<em>工具</em>-&gt;<em>引用</em>，如以下屏幕截图所示。<br><img src="http://www.yiibai.com/uploads/images/201711/2611/148091102_64349.png" alt=""></p> 
 <p><strong>第2步</strong> - 添加“Microsoft脚本运行时间”，然后单击确定。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201711/2611/666091102_67139.png" alt=""></p> 
 <p><strong>第3步</strong> - 添加想要写入文本文件中的数据，这里添加一个命令按钮。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201711/2611/359091131_73629.png" alt=""></p> 
 <p><strong>第4步</strong> - 现在运行脚本。</p> 
 <pre><code class="lang-vb">Sub CommandButton1_Click()
   Const ForReading = 1, ForWriting = 2, ForAppending = 3
   Dim FilePath As String
   Dim CellData As String
   Dim LastCol As Long
   Dim LastRow As Long
   LastCol = ActiveSheet.UsedRange.Columns.Count
   LastRow = ActiveSheet.UsedRange.Rows.Count

    ' Create a TextStream.
   Set fso = CreateObject("Scripting.FileSystemObject")
   Set stream = fso.OpenTextFile("F:\worksp\vba\Support.log", ForWriting, True)

   CellData = ""
   ' LastRow = 3
   LastCol = 3
   For i = 1 To LastRow
      For j = 1 To LastCol
         CellData = Trim(ActiveCell(i, j).Value)
         stream.WriteLine "The Value at location (" &amp; i &amp; "," &amp; j &amp; ")" &amp; CellData
      Next j
   Next i

   stream.Close
   MsgBox ("Job Done")

End Sub
</code></pre> 
 <p>执行脚本时，请确保将光标放在工作表的第一个单元格中。 <code>Support.log</code>文件的创建方式如下面<em>“F:\worksp\vba”</em>的目录，如下的截图所示。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201711/2611/864091132_94644.png" alt=""></p> 
 <p>该文件的内容，如以下屏幕截图中所示 - </p>   
 <pre><code class="lang-txt">The Value at location (1,1)姓名
The Value at location (1,2)性别
The Value at location (1,3)城市
The Value at location (2,1)张三
The Value at location (2,2)男
The Value at location (2,3)北京
The Value at location (3,1)李四
The Value at location (3,2)男
The Value at location (3,3)北京
The Value at location (4,1)王五
The Value at location (4,2)男
The Value at location (4,3)上海
The Value at location (5,1)李小丽
The Value at location (5,2)女
The Value at location (5,3)深圳
The Value at location (6,1)Linsa
The Value at location (6,2)女
The Value at location (6,3)深圳
</code></pre> 
 <h2 id="h2-write-"><a name="Write命令" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Write命令</h2>
 <p>与FSO不同，不需要添加任何引用，但是，我们将无法使用驱动器，文件和文件夹。也能够将流添加到文本文件。</p> 
 <p><strong>示例</strong></p> 
 <pre><code class="lang-vb">Sub CommandButton1_Click()
   Const ForReading = 1, ForWriting = 2, ForAppending = 3
   Dim FilePath As String
   Dim CellData As String
   Dim LastCol As Long
   Dim LastRow As Long

   LastCol = ActiveSheet.UsedRange.Columns.Count
   LastRow = ActiveSheet.UsedRange.Rows.Count

   FilePath = "F:\worksp\vba\write.txt"
   Open FilePath For Output As #2

   CellData = ""
   LastCol = 3
   For i = 1 To LastRow
      For j = 1 To LastCol
         CellData = "The Value at location (" &amp; i &amp; "," &amp; j &amp; ")" &amp; Trim(ActiveCell(i, j).Value)
         Write #2, CellData
      Next j
   Next i

   Close #2
   MsgBox ("Job Done")

End Sub
</code></pre> 
 <p>执行该脚本时，将在<em>“F:\worksp\vba”</em>位置创建<em>“write.txt”</em>文件，如以下屏幕截图所示。<br><img src="http://www.yiibai.com/uploads/images/201711/2611/346091135_64935.png" alt=""></p> 
 <p>该文件的内容显示如以下屏幕截图 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201711/2611/293091136_47677.png" alt=""></p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">ASP.Net MVC数据模型</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在本章中，我们将讨论和学习在ASP.NET MVC Framework应用程序中构建模型。模型存储数据，并根据来自控制器中的命令检索出来，最终在视图中显示这些数据。</p> 
 <p><code>Model</code>是一个类的集合，应用程序中可使用这些数据来编写业务逻辑。 因此，基本上模型是业务领域特定的容器。它用于与数据库进行交互。也可以用来操纵数据来实现业务逻辑。</p> 
 <p>下面通过创建一个新的ASP.NET MVC项目，来演示如何应用模型的简单例子。<br>打开Visual Studio，然后单击菜单：<em>文件</em> -&gt; <em>新建</em> -&gt; <em>项目</em> 选项。创建一个名称为：<em>MVCSimpleApp</em> 的MVC项目。</p> 
 <p>详细创建过程请参考：<a target="_blank" href="http://www.yiibai.com/asp.net_mvc/asp.net_mvc_getting_started.html">http://www.yiibai.com/asp.net_mvc/asp.net_mvc_getting_started.html</a></p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1512/193151221_46115.png" alt=""></p> 
 <p>通过在<em>解决方案资源管理器</em> 中右键单击 <em>Controllers</em> 文件夹来添加一个控件器：<em>HomeController</em>。在弹出菜单项中选择：<em>添加</em> -&gt; <em>控制器</em> 。<br>选择<em>包含读/写操作的MVC 5控制器</em> 选项，这个模板将为控制器创建一个具有默认操作的<code>Index</code>方法。这也将列出其他方法，如：<em>Edit/Delete/Create</em> 。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1512/923151231_96357.png" alt=""></p> 
 <p><strong>第1步</strong> - 创建控制器</p> 
 <p>在<em>Controllers</em>文件夹中看到一个新的 C# 文件 - <code>EmployeeController.cs</code>，在Visual Studio中打开并进行编辑。修改更新<code>EmployeeController.cs</code>文件中的代码，其中包含一些默认的动作方法，如下面的代码所示 - </p> 
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Linq;

using System.Web;
using System.Web.Mvc;

namespace MVCSimpleApp.Controllers {
   public class EmployeeController : Controller{
      // GET: Employee
      public ActionResult Index(){
         return View();
      }

      // GET: Employee/Details/5
      public ActionResult Details(int id){
         return View();
      }

      // GET: Employee/Create
      public ActionResult Create(){
         return View();
      }

      // POST: Employee/Create
      [HttpPost]
      public ActionResult Create(FormCollection collection){
         try{
            // TODO: Add insert logic here
            return RedirectToAction("Index");
         }catch{
            return View();
         }
      }

      // GET: Employee/Edit/5
      public ActionResult Edit(int id){
         return View();
      }

      // POST: Employee/Edit/5
      [HttpPost]
      public ActionResult Edit(int id, FormCollection collection){
         try{
            // TODO: Add update logic here
            return RedirectToAction("Index");
         }catch{
            return View();
         }
      }

      // GET: Employee/Delete/5
      public ActionResult Delete(int id){
         return View();
      }

      // POST: Employee/Delete/5
      [HttpPost]
      public ActionResult Delete(int id, FormCollection collection){
         try{
            // TODO: Add delete logic here
            return RedirectToAction("Index");
         }catch{
            return View();
         }
      }
   }
}
</code></pre> 
 <p><strong>第2步</strong> - 添加模型</p> 
 <p>右键单击<em>解决方案资源管理器</em> 中的<em>Models</em> 文件夹，然后在弹出菜单项中选择：<em>添加</em> -&gt; <em>类</em> ， 将看到添加新项目对话框，填写模型名称为：<em>Employee.cs</em> ，如下图所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1512/548151236_66967.png" alt=""></p> 
 <p><strong>第3步</strong> - 使用下面的代码将一些属性添加到<code>Employee</code>类。</p> 
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

namespace MVCSimpleApp.Models {
   public class Employee{
      public int ID { get; set; }
      public string Name { get; set; }
      public DateTime JoiningDate { get; set; }
      public int Age { get; set; }
   }
}
</code></pre> 
 <p>通过添加一个方法来更新<code>EmployeeController.cs</code>文件，该方法将返回员工列表。</p> 
 <pre><code class="lang-csharp">[NonAction]
public List&lt;Employee&gt; GetEmployeeList(){
   return new List&lt;Employee&gt;{
      new Employee{
         ID = 1,
         Name = "Allan",
         JoiningDate = DateTime.Parse(DateTime.Today.ToString()),
         Age = 23
      },

      new Employee{
         ID = 2,
         Name = "Carson",
         JoiningDate = DateTime.Parse(DateTime.Today.ToString()),
         Age = 45
      },

      new Employee{
         ID = 3,
         Name = "Carson",
         JoiningDate = DateTime.Parse(DateTime.Today.ToString()),
         Age = 37
      },

      new Employee{
         ID = 4,
         Name = "Laura",
         JoiningDate = DateTime.Parse(DateTime.Today.ToString()),
         Age = 26
      },
   };
}
</code></pre> 
 <p><strong>第4步</strong> - 更新索引操作方法，如下面的代码所示。</p>   
 <pre><code class="lang-csharp">        // GET: Employee
        public ActionResult Index()
        {
            var employees = from e in GetEmployeeList()
                            orderby e.ID
                            select e;
            return View(employees);
        }
</code></pre> 
 <p><strong>第5步</strong> - 运行这个应用程序，打开浏览器访问URL：<code>http://localhost:64466/employee</code>，将看到以下输出。<br><img src="http://www.yiibai.com/uploads/images/201712/1512/898161240_41602.png" alt=""></p> 
 <p>正如在上面的截图所看到的，有一个错误，这个错误实际上是相当具有描述性的，告诉我们它找不到索引视图。</p> 
 <p><strong>第6步</strong> - 因此，要添加一个视图，右键单击<code>Index</code>动作方法，并选择<em>添加视图</em>。它将显示<em>“添加视图”</em>对话框，并将添加默认名称。参考下图 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1512/308161243_12548.png" alt=""></p> 
 <p><strong>第7步</strong> - 从模板下拉列表中选择列表，在模型类下拉列表中选择<em>Employee</em>，并取消选中<em>“使用布局页面”</em>复选框，然后单击<em>“添加”</em> 按钮。</p> 
 <p>它会在这个视图中自动添加一些默认的代码。如下所示 - </p> 
 <pre><code class="lang-html">@model IEnumerable&lt;MVCSimpleApp.Models.Employee&gt;

@{
    Layout = null;
}

&lt;!DOCTYPE html&gt;

&lt;html&gt;
&lt;head&gt;
    &lt;meta name="viewport" content="width=device-width" /&gt;
    &lt;title&gt;Index&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;
        @Html.ActionLink("Create New", "Create")
    &lt;/p&gt;
    &lt;table class="table"&gt;
        &lt;tr&gt;
            &lt;th&gt;
                @Html.DisplayNameFor(model =&gt; model.Name)
            &lt;/th&gt;
            &lt;th&gt;
                @Html.DisplayNameFor(model =&gt; model.JoiningDate)
            &lt;/th&gt;
            &lt;th&gt;
                @Html.DisplayNameFor(model =&gt; model.Age)
            &lt;/th&gt;
            &lt;th&gt;&lt;/th&gt;
        &lt;/tr&gt;

    @foreach (var item in Model) {
        &lt;tr&gt;
            &lt;td&gt;
                @Html.DisplayFor(modelItem =&gt; item.Name)
            &lt;/td&gt;
            &lt;td&gt;
                @Html.DisplayFor(modelItem =&gt; item.JoiningDate)
            &lt;/td&gt;
            &lt;td&gt;
                @Html.DisplayFor(modelItem =&gt; item.Age)
            &lt;/td&gt;
            &lt;td&gt;
                @Html.ActionLink("Edit", "Edit", new { id=item.ID }) |
                @Html.ActionLink("Details", "Details", new { id=item.ID }) |
                @Html.ActionLink("Delete", "Delete", new { id=item.ID })
            &lt;/td&gt;
        &lt;/tr&gt;
    }

    &lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p><strong>第8步</strong> - 运行这个应用程序，将看到以下输出。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1512/926161247_98781.png" alt=""></p>
 <br>      
</div></body></html>
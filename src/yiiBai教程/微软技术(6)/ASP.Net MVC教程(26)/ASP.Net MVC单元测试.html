<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">ASP.Net MVC单元测试</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在计算机编程中，单元测试是一种软件测试方法，通过这种方法对各个源代码单元进行测试，以确定它们是否适合使用。 换句话说，这是一个软件开发过程，在这个过程中，应用程序中最小的可测试部分(称为单元)被单独和独立地审查以便正确执行和操作。</p> 
 <p>在程序编程中，一个单元可以是一个完整的模块，但更常见的是一个单独的功能或过程。 在面向对象编程中，一个单元通常是一个完整的接口，比如一个类，但可能是一个单独的方法。</p> 
 <p>单元测试通常是自动的，但也可以手动完成。</p> 
 <h2 id="h2-u5355u5143u6D4Bu8BD5u7684u76EEu6807"><a name="单元测试的目标" class="reference-link"></a><span class="header-link octicon octicon-link"></span>单元测试的目标</h2>
 <p>单元测试的主要目标是在应用程序中使用最小的可测试软件，并确定其行为是否与期望的完全一致。每个单元在将它们集成到模块之前分别进行测试，以测试模块之间的接口。</p> 
 <p>我们来看一个单元测试的简单例子，在这个例子中使用<em>单元测试</em>选项来创建一个新的ASP.NET MVC应用程序。</p> 
 <p><strong>第1步</strong> - 打开Visual Studio，然后单击：<em>文件</em> -&gt; <em>新建</em> -&gt; <em>项目</em> 菜单选项。一个新的项目对话框打开。<br><strong>第2步</strong> - 在左侧窗格中，选择：<em>模板</em> -&gt; <em>Visual C# </em> -&gt; <em>Web</em> 。<br><strong>第3步</strong> - 在中间窗格中，选择：<em>ASP.NET Web应用程序</em>。<br><img src="http://www.yiibai.com/uploads/images/201712/1912/922081257_19013.png" alt=""></p> 
 <p><strong>第4步</strong> - 在名称字段中输入项目名称为：<em>MVCUnitTesting</em>，然后单击<em>确定</em> 继续。<br>然后将看到下面的对话框，要求设置ASP.NET项目的初始内容。</p> 
 <p><strong>第5步</strong> - 选择MVC作为模板，不要忘记选中对话框底部的添加单元测试复选框。也可以更改测试项目名称，但在此示例中，我们将其保持原样，因为它是默认名称。<br><img src="http://www.yiibai.com/uploads/images/201712/1912/975081259_44091.png" alt=""></p> 
 <p>项目由Visual Studio创建后，将在“解决方案资源管理器”窗口中看到许多文件和文件夹。</p> 
 <p><strong>第6步</strong> - 可以看到在解决方案资源管理器中有两个项目。 一个是ASP.NET Web项目，另一个是单元测试项目。<br><img src="http://www.yiibai.com/uploads/images/201712/1912/341091204_16623.png" alt=""></p> 
 <p><strong>第7步</strong> - 运行这个应用程序，会看到下面的输出。<br><img src="http://www.yiibai.com/uploads/images/201712/1912/947091208_80167.png" alt=""></p> 
 <p>如上图所示，导航栏上有“首页”，“关于”和“联系人”按钮。这里点击“关于”链接，会看到下面的视图。<br><img src="http://www.yiibai.com/uploads/images/201712/1912/746091209_82110.png" alt=""></p> 
 <p>现在展开<em>MVCUnitTestingDemo</em> 项目，将看到 <em>Controllers</em> 文件夹下的<em>HomeController.cs</em> 文件。<br><img src="http://www.yiibai.com/uploads/images/201712/1912/570091211_29624.png" alt=""></p> 
 <p><em>HomeController</em> 包含三个操作方法，如下面的代码所示。</p> 
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;

namespace MVCUnitTesting.Controllers
{
    public class HomeController : Controller
    {
        public ActionResult Index()
        {
            return View();
        }

        public ActionResult About()
        {
            ViewBag.Message = "Your application description page.";

            return View();
        }

        public ActionResult Contact()
        {
            ViewBag.Message = "Your contact page.";

            return View();
        }
    }
}
</code></pre> 
 <p>展开<em>MVCUnitTestingDemo.Tests</em> 项目，<em>Controllers</em>文件夹下的<em>HomeControllerTest.cs</em>文件。<br><img src="http://www.yiibai.com/uploads/images/201712/1912/784091213_52317.png" alt=""></p> 
 <p>在这个<code>HomeControllerTest</code>类中有三个方法，如下面的代码所示。</p> 
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Web.Mvc;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using MVCUnitTesting;
using MVCUnitTesting.Controllers;

namespace MVCUnitTesting.Tests.Controllers
{
    [TestClass]
    public class HomeControllerTest
    {
        [TestMethod]
        public void Index()
        {
            // Arrange
            HomeController controller = new HomeController();

            // Act
            ViewResult result = controller.Index() as ViewResult;

            // Assert
            Assert.IsNotNull(result);
        }

        [TestMethod]
        public void About()
        {
            // Arrange
            HomeController controller = new HomeController();

            // Act
            ViewResult result = controller.About() as ViewResult;

            // Assert
            Assert.AreEqual("Your application description page.", result.ViewBag.Message);
        }

        [TestMethod]
        public void Contact()
        {
            // Arrange
            HomeController controller = new HomeController();

            // Act
            ViewResult result = controller.Contact() as ViewResult;

            // Assert
            Assert.IsNotNull(result);
        }
    }
}
</code></pre> 
 <p>这三个方法将测试<code>Index</code>，<code>About</code>和<code>Contact</code>操作方法是否正常工作。要测试这三个操作方法，请转到<em>测试</em> 菜单。选择：<em>运行</em> -&gt; <em>所有测试</em> 项来测试这些操作方法。<br><img src="http://www.yiibai.com/uploads/images/201712/1912/155091233_11314.png" alt=""></p> 
 <p>现在会看到左边的<em>测试资源管理器</em>，可以看到所有的测试都通过了。再添加一个动作方法，它用于列出所有的员工。首先，需要在<em>Models</em> 文件夹中添加一个<code>Employee</code>类。<br>以下是<code>Employee</code>类的实现 - </p> 
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

namespace MVCUnitTesting.Models
{
    public class Employee
    {
        public int ID { get; set; }
        public string Name { get; set; }
        public DateTime JoiningDate { get; set; }
        public int Age { get; set; }
    }
}
</code></pre> 
 <p>添加<em>EmployeeController</em> 。 右键单击<em>解决方案资源管理器</em> 中的<em>Controllers</em> 文件夹，然后选择：<em>添加</em> -&gt; <em>控制器</em> ，它将显示“添加基架”对话框。选择：<em>MVC 5控制器 - 空</em> 选项，然后点击<em>“添加”</em> 按钮，如下图所示 -<br><img src="http://www.yiibai.com/uploads/images/201712/1912/196091220_30186.png" alt=""></p> 
 <p>添加控制器对话框将出现。将名称设置为：<em>EmployeeController</em>，然后单击“添加”按钮。<br><img src="http://www.yiibai.com/uploads/images/201712/1912/994091221_13112.png" alt=""></p> 
 <p>在<em>Controllers</em> 文件夹中看到一个新的 C# 文件 - <code>EmployeeController.cs</code>，该文件夹在Visual Studio中打开并进行编辑。这里使用下面的代码更新 <code>EmployeeController</code> 。</p> 
 <pre><code class="lang-csharp">using MVCUnitTesting.Models;
using System;
using System.Collections.Generic;
using System.Linq;

using System.Web;
using System.Web.Mvc;

namespace MVCUnitTesting.Controllers
{
    public class EmployeeController : Controller
    {
        [NonAction]

        public List&lt;Employee&gt; GetEmployeeList()
        {
            return new List&lt;Employee&gt;{
            new Employee{
               ID = 1,
               Name = "Maxsu",
               JoiningDate = DateTime.Parse(DateTime.Today.ToString()),
               Age = 23
            },

            new Employee{
               ID = 2,
               Name = "Carson",
               JoiningDate = DateTime.Parse(DateTime.Today.ToString()),
               Age = 45
            },

            new Employee{
               ID = 3,
               Name = "Kobe Bryant",
               JoiningDate = DateTime.Parse(DateTime.Today.ToString()),
               Age = 37
            },

            new Employee{
               ID = 4,
               Name = "Laura",
               JoiningDate = DateTime.Parse(DateTime.Today.ToString()),
               Age = 26
            },
         };
        }

        // GET: Employee
        public ActionResult Index()
        {
            return View();
        }

        public ActionResult Employees()
        {
            var employees = from e in GetEmployeeList()
                            orderby e.ID
                            select e;
            return View(employees);
        }
    }
}
</code></pre> 
 <p>要为<code>Employee</code>操作方法添加视图，请右键单击<code>Employees</code>方法并选择：<em>添加视图…</em><br><img src="http://www.yiibai.com/uploads/images/201712/1912/790091227_24883.png" alt=""></p> 
 <p>您将看到视图的默认名称。从“模板”下拉列表中选择“List”，从“模型类”下拉列表中选择“Employee”，然后单击“确定”。</p> 
 <p>现在需要添加一个链接到<code>Employees</code>列表，打开<em>Views/Shared</em> 文件夹下的<em>_layout.cshtml</em> 文件，并在<em>联系人</em> 链接下面添加<em>员工列表</em> 链接。</p>   
 <pre><code class="lang-html">&lt;li&gt;@Html.ActionLink("员工列表", "Employees", "Employee")&lt;/li&gt;
</code></pre> 
 <p>以下是<em>_layout.cshtml</em> 的完整实现 - </p> 
 <pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/&gt;
    &lt;meta charset="utf-8" /&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;@ViewBag.Title - 我的 ASP.NET 应用程序&lt;/title&gt;
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="navbar navbar-inverse navbar-fixed-top"&gt;
        &lt;div class="container"&gt;
            &lt;div class="navbar-header"&gt;
                &lt;button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"&gt;
                    &lt;span class="icon-bar"&gt;&lt;/span&gt;
                    &lt;span class="icon-bar"&gt;&lt;/span&gt;
                    &lt;span class="icon-bar"&gt;&lt;/span&gt;
                &lt;/button&gt;
                @Html.ActionLink("应用程序名称", "Index", "Home", new { area = "" }, new { @class = "navbar-brand" })
            &lt;/div&gt;
            &lt;div class="navbar-collapse collapse"&gt;
                &lt;ul class="nav navbar-nav"&gt;
                    &lt;li&gt;@Html.ActionLink("主页", "Index", "Home")&lt;/li&gt;
                    &lt;li&gt;@Html.ActionLink("关于", "About", "Home")&lt;/li&gt;
                    &lt;li&gt;@Html.ActionLink("联系方式", "Contact", "Home")&lt;/li&gt;
                    &lt;li&gt;@Html.ActionLink("员工列表", "Employees", "Employee")&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="container body-content"&gt;
        @RenderBody()
        &lt;hr /&gt;
        &lt;footer&gt;
            &lt;p&gt;© @DateTime.Now.Year - 我的 ASP.NET 应用程序&lt;/p&gt;
        &lt;/footer&gt;
    &lt;/div&gt;

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>要从<code>Employee</code>控制器测试<code>Employees</code>动作方法，需要在单元测试项目中添加另一个测试方法。在<code>HomeControllerTest.cs</code>文件中的<code>EmployeeControllerTest</code>类代码之后，如下所示 -</p> 
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Web.Mvc;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using MVCUnitTesting;
using MVCUnitTesting.Controllers;

namespace MVCUnitTesting.Tests.Controllers
{
    [TestClass]
    public class HomeControllerTest
    {
        [TestMethod]
        public void Index()
        {
            // Arrange
            HomeController controller = new HomeController();

            // Act
            ViewResult result = controller.Index() as ViewResult;

            // Assert
            Assert.IsNotNull(result);
        }

        [TestMethod]
        public void About()
        {
            // Arrange
            HomeController controller = new HomeController();

            // Act
            ViewResult result = controller.About() as ViewResult;

            // Assert
            Assert.AreEqual("Your application description page.", result.ViewBag.Message);
        }

        [TestMethod]
        public void Contact()
        {
            // Arrange
            HomeController controller = new HomeController();

            // Act
            ViewResult result = controller.Contact() as ViewResult;

            // Assert
            Assert.IsNotNull(result);
        }
    }

    [TestClass]
    public class EmployeeControllerTest
    {
        [TestMethod]
        public void Employees()
        {
            // Arrange
            EmployeeController controller = new EmployeeController();

            // Act
            ViewResult result = controller.Index() as ViewResult;

            // Assert
            Assert.IsNotNull(result);
        }
    }
}
</code></pre> 
 <p>从<em>测试</em> 菜单中选择：<em>运行</em> -&gt; <em>所有测试</em> 项来测试这些操作方法。<br><img src="http://www.yiibai.com/uploads/images/201712/1912/977091243_16828.png" alt=""></p> 
 <p>可以看到<code>Employees</code>测试方法现在也通过了。运行应用程序时将看到以下输出。<br><img src="http://www.yiibai.com/uploads/images/201712/1912/334091244_12724.png" alt=""></p> 
 <p>点击导航栏中的“员工列表”选项，将看到员工列表信息，如下图所示 -<br><img src="http://www.yiibai.com/uploads/images/201712/1912/230091245_24122.png" alt=""></p>
 <br>      
</div></body></html>
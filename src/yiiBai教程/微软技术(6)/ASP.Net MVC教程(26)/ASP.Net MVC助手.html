<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">ASP.Net MVC助手</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在ASP.Net Web表单中，开发人员正在使用工具箱来在任何特定的页面上添加控件。 但是，在ASP.NET MVC应用程序中，没有工具箱可用于在视图上拖放HTML控件。 在ASP.NET MVC应用程序中，如果想创建一个视图，它应该包含HTML代码。 所以那些刚接触MVC的开发者，特别是在网页表单的背景下，发现这个有点难。</p> 
 <p>为了克服这个问题，ASP.NET MVC提供了HtmlHelper类，它包含不同的方法来帮助你编程创建HTML控件。 所有的HtmlHelper方法都会生成HTML并以字符串形式返回结果。 最终的HTML是由这些函数在运行时生成的。 HtmlHelper类用于生成UI，不应该在控制器或模型中使用。</p> 
 <p>有不同类型的帮手方法。</p> 
 <ul> 
  <li><em>Createinputs</em> - 为文本框和按钮创建输入。</li>
  <li><em>Createlinks</em> - 创建基于来自路由表的信息的链接。</li>
  <li><em>Createforms</em> - 创建表单标签，可以回发到动作，或回发到另一个控制器上的操作。</li>
 </ul> 
 <p>如果有看过前面视图教程文章中(项目：<em>MVCSimpleApp</em>) <code>EmployeeController</code>控制器的<code>Index</code>动作生成的视图，将看到以Html开始的操作符前缀，如<code>Html.ActionLink</code>和<code>Html.DisplayNameFor</code>等，如下面的代码所示。</p> 
 <pre><code class="lang-html">@model IEnumerable&lt;MVCSimpleApp.Models.Employee&gt;
@{
   Layout = null;
} 

&lt;!DOCTYPE html&gt;
&lt;html&gt;
   &lt;head&gt;
      &lt;meta name = "viewport" content = "width = device-width" /&gt;
      &lt;title&gt;Index&lt;/title&gt;
   &lt;/head&gt;

   &lt;body&gt;
      &lt;p&gt;
         @Html.ActionLink("Create New", "Create")
      &lt;/p&gt;

      &lt;table class = "table"&gt;
         &lt;tr&gt;
            &lt;th&gt;
               @Html.DisplayNameFor(model =&gt; model.Name)
            &lt;/th&gt;

            &lt;th&gt;
               @Html.DisplayNameFor(model =&gt; model.JoiningDate)
            &lt;/th&gt;

            &lt;th&gt;
               @Html.DisplayNameFor(model =&gt; model.Age)
            &lt;/th&gt;

            &lt;th&gt;&lt;/th&gt;
         &lt;/tr&gt;

         @foreach (var item in Model) {
            &lt;tr&gt;
               &lt;td&gt;
                  @Html.DisplayFor(modelItem =&gt; item.Name)
               &lt;/td&gt;

               &lt;td&gt;
                  @Html.DisplayFor(modelItem =&gt; item.JoiningDate)
               &lt;/td&gt;

               &lt;td&gt;
                  @Html.DisplayFor(modelItem =&gt; item.Age)
               &lt;/td&gt;

               &lt;td&gt;
                  @Html.ActionLink("Edit", "Edit", new { id = item.ID }) |
                  @Html.ActionLink("Details", "Details", new { id = item.ID }) |
                  @Html.ActionLink("Delete", "Delete", new { id = item.ID })
               &lt;/td&gt;
            &lt;/tr&gt;
         }

      &lt;/table&gt;
   &lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>这个HTML是从<code>ViewPage</code>基类继承的一个属性。所以，它在所有的视图中都可用，并返回一个名为<code>HTMLHelper</code>的实例。</p> 
 <p>我们来看看一个简单的例子，让用户可以编辑员工信息。 因此，此编辑操作将使用大量不同的HTML助手。</p> 
 <p>如果看上面的代码，会在最后部分看到下面的HTML Helper方法 - </p> 
 <pre><code class="lang-html">@Html.ActionLink("Edit", "Edit", new { id = item.ID })
</code></pre> 
 <p>在<code>ActionLink</code>助手中，第一个参数是<code>“Edit”</code>链接，第二个参数是控制器中的动作方法，也是<code>“Edit”</code>，第三个参数ID是要编辑的员工编号。</p> 
 <p>我们通过添加静态列表来更改<code>EmployeeController</code>类，并使用以下代码更改索引操作。</p> 
 <pre><code class="lang-csharp">public static List&lt;Employee&gt; empList = new List&lt;Employee&gt;{
   new Employee{
      ID = 1,
      Name = "Allan",
      JoiningDate = DateTime.Parse(DateTime.Today.ToString()),
      Age = 23
   },

   new Employee{
      ID = 2,
      Name = "Carson",
      JoiningDate = DateTime.Parse(DateTime.Today.ToString()),
      Age = 45
   },

   new Employee{
      ID = 3,
      Name = "Carson",
      JoiningDate = DateTime.Parse(DateTime.Today.ToString()),
      Age = 37
   },

   new Employee{
      ID = 4,
      Name = "Laura",
      JoiningDate = DateTime.Parse(DateTime.Today.ToString()),
      Age = 26
   },

};

public ActionResult Index(){
   var employees = from e in empList
   orderby e.ID
   select e;
   return View(employees);
}
</code></pre> 
 <p>下面来更新编辑操作。您将看到两个编辑操作，一个用于<code>GET</code>，一个用于<code>POST</code>。这里更新<code>GET</code>的编辑操作，其中只有参数中的<code>Id</code>，如下面的代码所示。</p> 
 <pre><code class="lang-csharp">// GET: Employee/Edit/5
public ActionResult Edit(int id){
   List&lt;Employee&gt; empList = GetEmployeeList();
   var employee = empList.Single(m =&gt; m.ID == id);
   return View(employee);
}
</code></pre> 
 <p>现在，我们知道有编辑的动作，但是没有任何对应此动作的视图。 所以还需要添加一个视图(View)。 为此，请右键单击<code>Edit</code>操作，然后选择<em>添加视图</em>。从“模板”下拉列表中选择<code>Edit</code>，从“模型”下拉列表中选择<em>“Employee”</em> - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1512/799111203_24448.png" alt=""></p> 
 <p>以下是<code>Edit</code>视图中的默认实现。参考以下示例代码 - </p> 
 <pre><code class="lang-html">@model MVCSimpleApp.Models.Employee

@{
    Layout = null;
}

&lt;!DOCTYPE html&gt;

&lt;html&gt;
&lt;head&gt;
    &lt;meta name="viewport" content="width=device-width" /&gt;
    &lt;title&gt;Edit&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()

        &lt;div class="form-horizontal"&gt;
            &lt;h4&gt;Employee&lt;/h4&gt;
            &lt;hr /&gt;
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            @Html.HiddenFor(model =&gt; model.ID)

            &lt;div class="form-group"&gt;
                @Html.LabelFor(model =&gt; model.Name, htmlAttributes: new { @class = "control-label col-md-2" })
                &lt;div class="col-md-10"&gt;
                    @Html.EditorFor(model =&gt; model.Name, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model =&gt; model.Name, "", new { @class = "text-danger" })
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;div class="form-group"&gt;
                @Html.LabelFor(model =&gt; model.JoiningDate, htmlAttributes: new { @class = "control-label col-md-2" })
                &lt;div class="col-md-10"&gt;
                    @Html.EditorFor(model =&gt; model.JoiningDate, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model =&gt; model.JoiningDate, "", new { @class = "text-danger" })
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;div class="form-group"&gt;
                @Html.LabelFor(model =&gt; model.Age, htmlAttributes: new { @class = "control-label col-md-2" })
                &lt;div class="col-md-10"&gt;
                    @Html.EditorFor(model =&gt; model.Age, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model =&gt; model.Age, "", new { @class = "text-danger" })
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;div class="form-group"&gt;
                &lt;div class="col-md-offset-2 col-md-10"&gt;
                    &lt;input type="submit" value="Save" class="btn btn-default" /&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    }

    &lt;div&gt;
        @Html.ActionLink("Back to List", "Index")
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p><code>Html.BeginForm</code>非常有用，因为它使您能够更改URL，更改方法等。</p> 
 <p>在上面的代码中，看到另一个HTML助手:<code>@ HTML.HiddenFor</code>，它用于生成隐藏的字段。</p> 
 <p>MVC框架足够聪明地发现这个ID字段在模型类中，因此它需要防止被编辑编修改，这就是为什么它被标记为隐藏字段的原因。</p> 
 <p>Html.LabelFor HTML助手在屏幕上创建标签。如果在进行更改时错误地输入了任何内容，则<code>Html.ValidationMessageFor</code>助手将显示正确的错误消息。</p> 
 <p>还需要更改<code>POST</code>的编辑操作，需要更新员工信息时，它就会调用这个动作。参考以下代码 - </p>   
 <pre><code class="lang-csharp">        // POST: Employee/Edit/5
        [HttpPost]
        public ActionResult Edit(int id, FormCollection collection)
        {
            try
            {
                // TODO: Add update logic here
                List&lt;Employee&gt; empList = GetEmployeeList();
                var employee = empList.Single(m =&gt; m.ID == id);
                if (TryUpdateModel(employee))
                {
                    //To Do:- database code
                    return RedirectToAction("Index");
                }
                return View(employee);
            }
            catch
            {
                return View();
            }
        }
</code></pre> 
 <p>让我们运行这个应用程序，并请求以下URL：<code>http://localhost:64466/Employee</code>员工。将会看到以下输出。<br><img src="http://www.yiibai.com/uploads/images/201712/1512/436111216_51934.png" alt=""></p> 
 <p>点击任何特定员工的编辑链接，以点击员工编号为<code>1</code>编辑链接为示例，您将看到以下视图显示结果。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1512/942111218_52988.png" alt=""></p> 
 <p>将年龄从<code>23</code>岁改为<code>29</code>岁，然后点击<em>“保存”</em>按钮，然后会在<code>Index</code>视图中看到更新的年龄。</p>
 <br>      
</div></body></html>
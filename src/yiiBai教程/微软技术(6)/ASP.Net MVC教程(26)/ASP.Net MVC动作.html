<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">ASP.Net MVC动作</h1><div style="width:100%;float:left;" class="article-content">   
 <p>ASP.NET MVC操作方法负责执行请求并生成响应。默认情况下，它以<code>ActionResult</code>的形式生成响应。操作通常具有与用户交互的一对一映射。</p> 
 <p>例如，在浏览器中输入一个URL，点击任何特定的链接，提交表单等。这些用户交互中的每一个都会导致请求被发送到服务器。 在每种情况下，请求的URL都包含MVC框架用来调用操作方法的信息。动作方法的一个限制是它们必须是实例方法，所以它们不能是静态方法。也没有返回值的限制。 所以可以返回字符串，整数等。</p> 
 <h2 id="h2-u8BF7u6C42u5904u7406"><a name="请求处理" class="reference-link"></a><span class="header-link octicon octicon-link"></span>请求处理</h2>
 <p>动作是MVC应用程序中的最终请求目标，它使用控制器基类。我们来看看请求处理。</p> 
 <ul> 
  <li><p>当URL到达时，如<code>/Home/index</code>，这是一个<code>UrlRoutingModule</code>，它检查并理解路由表中配置的内容并知道如何处理该URL。<br><img src="http://www.yiibai.com/uploads/images/201712/1412/119091216_56130.jpg" alt=""></p> </li>
  <li><p><code>UrlRoutingModule</code>将在路由表中配置的信息放在一起，并将控制交给MVC路由处理程序。</p> </li>
  <li>MVC路由处理程序将控制器传递给作为HTTP处理程序的<code>MvcHandler</code>。</li>
  <li><code>MvcHandler</code>使用一个控制器工厂实例化控制器，它知道实例化哪个控制器，因为它在该控制器值的<code>RouteData</code>中查找。</li>
  <li>当<code>MvcHandler</code>有一个控制器，<code>MvcHandler</code>唯一知道的就是<code>IController</code>接口，所以它只是告诉控制器执行。</li>
  <li>当它告诉控制器执行时，这是从MVC的控制器基类派生的。 <code>Execute</code>方法创建一个动作调用者，并告诉动作调用者去找到一个方法来调用，找到一个调用的动作。</li>
  <li>动作调用者再次在<code>RouteData</code>中查找并找到从路由引擎传递的动作参数。</li>
 </ul> 
 <h2 id="h2-u52A8u4F5Cu7C7Bu578B"><a name="动作类型" class="reference-link"></a><span class="header-link octicon octicon-link"></span>动作类型</h2>
 <p>动作基本上返回不同类型的动作结果。<code>ActionResult</code>类是所有操作结果的基础。 以下是不同种类的行为结果及其行为的列表。</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>名称</th> 
    <th>行为</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>ContentResult</code></td> 
    <td>返回一个字符串</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>FileContentResult</code></td> 
    <td>返回文件内容</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>FilePathResult</code></td> 
    <td>返回文件内容</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>FileStreamResult</code></td> 
    <td>返回文件内容</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>EmptyResult</code></td> 
    <td>什么都不返回</td> 
   </tr> 
   <tr> 
    <td>6</td> 
    <td><code>JavaScriptResult</code></td> 
    <td>返回脚本执行</td> 
   </tr> 
   <tr> 
    <td>7</td> 
    <td><code>JsonResult</code></td> 
    <td>返回JSON格式的数据</td> 
   </tr> 
   <tr> 
    <td>8</td> 
    <td><code>RedirectToResult</code></td> 
    <td>重定向到指定的网址</td> 
   </tr> 
   <tr> 
    <td>9</td> 
    <td><code>HttpUnauthorizedResult</code></td> 
    <td>返回403 HTTP状态码</td> 
   </tr> 
   <tr> 
    <td>10</td> 
    <td><code>RedirectToRouteResult</code></td> 
    <td>重定向到不同的动作/不同的控制器动作</td> 
   </tr> 
   <tr> 
    <td>11</td> 
    <td><code>ViewResult</code></td> 
    <td>作为视图引擎的响应收到</td> 
   </tr> 
   <tr> 
    <td>12</td> 
    <td><code>PartialViewResult</code></td> 
    <td>作为视图引擎的响应收到</td> 
   </tr> 
  </tbody> 
 </table> 
 <p>我们来看看前一章(<em>ASP.Net MVC控件器</em>的<em>MVCControllerDemo</em>项目)中创建<code>EmployeeController</code>的一个简单示例。参考以下示例代码 - </p> 
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Linq;

using System.Web;
using System.Web.Mvc;

namespace MVCControllerDemo.Controllers {
   public class EmployeeController : Controller{
      // GET: Employee
      public ActionResult Search(string name){
         var input = Server.HtmlEncode(name);
         return Content(input);
      }
   }
}
</code></pre> 
 <p>当请求以下URL：<code>http://localhost:51066/Employee/Maxsu</code> 时，将收到操作的输出如下 -<br><img src="http://www.yiibai.com/uploads/images/201712/1412/363091212_79492.png" alt=""></p> 
 <h2 id="h2-u6DFBu52A0u63A7u5236u5668"><a name="添加控制器" class="reference-link"></a><span class="header-link octicon octicon-link"></span>添加控制器</h2>
 <p>现在，在项目上再添加另一个控制器。</p> 
 <p><strong>第1步</strong> - 通过在<em>解决方案资源管理器</em> 中右键单击 <code>Controllers</code> 文件夹来添加一个：控制器：<code>CustomerController</code>。选择：<em>添加</em> -&gt; <em>控制器</em> 。如下所示 -<br><img src="http://www.yiibai.com/uploads/images/201712/1412/721091202_34203.png" alt=""></p> 
 <p>它将显示<em>“添加基架”</em> 对话框。如下所示 -<br><img src="http://www.yiibai.com/uploads/images/201712/1412/151091202_94458.png" alt=""></p> 
 <p><strong>第2步</strong> - 选择<em>MVC 5控制器 - 空</em> 选项，然后单击<em>“添加” </em> 按钮。添加控制器对话框将出现。<br><strong>第3步</strong> - 将名称设置为：<code>CustomerController</code> ，然后单击<em>“添加” </em>按钮。</p> 
 <p>现在，已经在<em>Controllers</em>文件夹中看到一个新的 C# 文件<em>“CustomerController.cs”</em> ，在Visual Studio中打开并进行编辑，如下所示 -<br><img src="http://www.yiibai.com/uploads/images/201712/1412/515101209_81672.png" alt=""></p> 
 <p>同样，再添加一个名为<em>HomeController</em>的控制器。 以下是<em>HomeController.cs</em>类的实现。参考代码 - </p>   
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;

namespace MVCControllerDemo.Controllers
{
    public class HomeController : Controller
    {
        // GET: Home
        public string Index()
        {
            return "This is Home MVCControllerDemo.HomeController.Index() Action.";
        }
    }
}
</code></pre> 
 <p><strong>第4步</strong> - 运行此应用程序，将收到以下输出 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1412/551101213_32544.png" alt=""></p> 
 <p><strong>第5步</strong> - 在上面创建的<em>CustomerController.cs</em>类中添加一个方法，如以下代码 - </p> 
 <pre><code class="lang-csharp">public string GetAllCustomers(){
   return @"&lt;ul&gt;
      &lt;li&gt;Max Su&lt;/li&gt;
      &lt;li&gt;Mark Jasper&lt;/li&gt;
      &lt;li&gt;Allan Java&lt;/li&gt;
      &lt;li&gt;Ruby Jerry&lt;/li&gt;
   &lt;/ul&gt;";
}
</code></pre> 
 <p><strong>第6步</strong> - 运行该应用程序并请求URL: <code>http://localhost:51066/Customer/GetAllCustomers</code> ，将看到以下输出 -<br><img src="http://www.yiibai.com/uploads/images/201712/1412/106101218_51637.png" alt=""></p> 
 <p>也可以重定向到同一控制器的操作，甚至是不同的控制器。以下是一个简单的例子，将通过使用以下代码更改<code>HomeController</code>中的代码，从<code>HomeController</code>重定向到<code>CustomerController</code>。</p> 
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;

namespace MVCControllerDemo.Controllers
{
    public class HomeController : Controller
    {
        // GET: Home
        public ActionResult Index()
        {
            return RedirectToAction("GetAllCustomers", "Customer");
        }
    }
}
</code></pre> 
 <p>上面代码中，使用了<code>RedirectToAction()</code>方法，它有两个参数：操作名称和控制器名称。</p> 
 <p>当运行这个应用程序时，会看到默认路由将重定向到<code>/Customer/GetAllCustomers</code><br><img src="http://www.yiibai.com/uploads/images/201712/1412/106101218_51637.png" alt=""></p>
 <br>      
</div></body></html>
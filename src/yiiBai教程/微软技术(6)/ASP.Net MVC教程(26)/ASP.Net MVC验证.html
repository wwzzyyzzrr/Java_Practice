<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">ASP.Net MVC验证</h1><div style="width:100%;float:left;" class="article-content">   
 <p>验证是ASP.NET MVC应用程序中的一个重要方面。 它用于检查用户输入是否有效。 ASP.NET MVC提供了一组易于使用的验证，同时也是检查错误并在必要时向用户显示消息的强大方法。</p> 
 <h2 id="h2-dry"><a name="DRY" class="reference-link"></a><span class="header-link octicon octicon-link"></span>DRY</h2>
 <p><strong>DRY</strong>代表(<em>Don’t Repeat Yourself </em>)不要重复自己，是ASP.NET MVC的核心设计原则之一。从开发的角度来看，鼓励只在一个地方指定功能或行为，然后在整个应用程序中使用它。<br>这样可以减少编写的代码量，使代码编写起来更容易，更容易维护。</p> 
 <h2 id="h2-u4E3Au6A21u578Bu6DFBu52A0u9A8Cu8BC1"><a name="为模型添加验证" class="reference-link"></a><span class="header-link octicon octicon-link"></span>为模型添加验证</h2>
 <p>下面来看看，如何为上一章项目添加员工时验证的一个简单例子。 在这个例子中，我们将数据注释添加到模型类，它提供了一些内置的验证属性集，可以直接在应用程序中应用到任何模型类或属性，例如：<code>Required</code>，<code>StringLength</code>，<code>RegularExpression</code>和<code>Range</code>验证属性。</p> 
 <p>它还包含格式化属性，如<code>DataType</code>帮助格式化，不提供任何验证。 验证属性指定要对其应用的模型属性强制执行的行为。</p> 
 <p><code>Required</code>和<code>MinimumLength</code>属性指示属性必须具有值; 但是没有任何东西阻止用户输入空白格来满足这个验证。<code>RegularExpression</code>属性用于限制可输入的字符。</p> 
 <p>可以通过添加不同的注释属性来更新 <code>Employee</code> 类，如以下代码所示 - </p> 
 <pre><code class="lang-csharp">

</code></pre> 
 <p>还需要对数据库设置限制。 但是，SQL Server对象资源管理器中的数据库显示<code>name</code>属性被设置为<code>NVARCHAR(MAX)</code>，如以下截图所示 - </p> 
 <p>现在我们还需要对数据库设置限制。 但是，SQL Server对象资源管理器中的数据库显示<code>name</code>属性被设置为<code>NVARCHAR(MAX)</code>，如以下屏幕截图所示 - </p> 
 <p>为了在数据库上设置这个限制，我们将使用迁移来更新模式。</p> 
 <p>从 <em>工具</em> -&gt; <em>NuGet程序包管理器</em> -&gt; <em>程序包管理器控制台</em> 打开程序包管理器控制台窗口。<br><img src="http://www.yiibai.com/uploads/images/201712/1712/421091237_64766.png" alt=""></p> 
 <p>在软件包管理器控制台窗口中逐个输入以下命令。</p>   
 <pre><code class="lang-shell">Enable-Migrations
add-migration DataAnnotations
update-database
</code></pre> 
 <p>以下是在 <em>程序包管理器控制台</em> 窗口中执行这些命令后的日志。<br><img src="http://www.yiibai.com/uploads/images/201712/1712/419091245_79646.png" alt=""></p> 
 <p>Visual Studio也将打开从<code>DbMIgration</code>类派生的类，可以在其中看到更新<code>Up</code>方法中的模式约束的代码 - </p> 
 <pre><code class="lang-csharp">namespace MVCSimpleApp.Migrations {
   using System;
   using System.Data.Entity.Migrations;

   public partial class DataAnnotations : DbMigration{
      public override void Up(){
         AlterColumn("dbo.Employees", "Name", c =&gt; c.String(maxLength: 60));
      }

      public override void Down(){
         AlterColumn("dbo.Employees", "Name", c =&gt; c.String());
      }
   }
}
</code></pre> 
 <p><code>name</code>字段的最大长度为<code>60</code>，这是数据库中新的长度限制，如以下快照中所示 -<br><img src="http://www.yiibai.com/uploads/images/201712/1712/567091256_35580.png" alt=""></p> 
 <p>运行此应用程序并通过指定以下URL转到创建视图：<code>http://localhost:63004/Employee/Create</code> -<br><img src="http://www.yiibai.com/uploads/images/201712/1712/443101204_62601.png" alt=""></p> 
 <p>在这些字段中输入一些无效的数据，然后点击 <em>创建</em> 按钮，如下图所示 -<br><img src="http://www.yiibai.com/uploads/images/201712/1712/556101205_50109.png" alt=""></p> 
 <p>看到jQuery客户端验证检测到错误，并且还显示错误消息。</p>
 <br>      
</div></body></html>
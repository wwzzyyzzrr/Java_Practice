<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">ASP.Net MVC手脚架</h1><div style="width:100%;float:left;" class="article-content">   
 <p>ASP.NET脚手架是ASP.NET Web应用程序的代码生成框架。 Visual Studio 2013包含用于MVC和Web API项目的预安装代码生成器。当想快速添加与数据模型交互的代码时，可以将脚手架添加到项目中。使用脚手架可以减少在项目中开发标准数据操作的时间。</p> 
 <p>正如在前面章节教程中所看到的，我们已经为<code>Index</code>，<code>Create</code>，<code>Edit</code>操作创建了视图，并且还需要更新操作方法。但ASP.Net MVC提供了一种使用脚手架创建所有这些视图和操作方法的更简单的方法。</p> 
 <p>我们来看一个简单的例子。它创建一个包含模型类 - <code>Employee</code>的相同示例，但是这次将使用脚手架。</p> 
 <p><strong>第1步</strong> - 打开Visual Studio，然后单击：<em>文件</em> -&gt; <em>新建</em> -&gt; <em>项目</em> 菜单选项。一个新的项目对话框打开。<br><strong>第2步</strong> - 在左侧窗格中，选择：<em>模板</em> -&gt; <em>Visual C# </em> -&gt; <em>Web</em> 。<br><strong>第3步</strong> - 在中间窗格中，选择<em>“ASP.NET Web应用程序”</em>。<br><strong>第4步</strong> - 在名称字段中输入项目名称：<em>MVCScaffolding</em> ，然后单击<em>确定</em> 继续。<br><img src="http://www.yiibai.com/uploads/images/201712/1812/901111254_94689.png" alt=""></p> 
 <p>将看到下面的对话框，要求设置ASP.NET项目的初始内容。</p> 
 <p><strong>第5步 </strong>- 为了简单起见，选择：<em>空</em> 选项，并在<em>为以下项添加文件夹和核心引用’</em> 中选中<em>MVC</em> 复选框，然后单击<em>确定</em>。<br><img src="http://www.yiibai.com/uploads/images/201712/1812/970111257_43756.png" alt=""></p> 
 <p>它将使用最少的预定义内容创建一个基本的MVC项目。</p> 
 <p>项目由Visual Studio创建后，将在<em>“解决方案资源管理器”</em> 窗口中看到许多文件和文件夹。<br><img src="http://www.yiibai.com/uploads/images/201712/1812/828111258_29805.png" alt=""></p> 
 <h2 id="h2--entity-framework-"><a name="添加 Entity Framework 支持" class="reference-link"></a><span class="header-link octicon octicon-link"></span>添加 Entity Framework 支持</h2>
 <p>第一步是安装实体框架(<em>Entity Framework</em>)。右键单击该项目，然后选择：<em>管理NuGet程序包</em> ，打开<em>NuGet软件包管理器</em> 。它将打开“NuGet包管理器”，在搜索框中搜索<em>Entity Framework</em>。如下所示 -<br><img src="http://www.yiibai.com/uploads/images/201712/1812/543121201_44589.png" alt=""></p> 
 <p>选择实体框架(<em>Entity Framework</em>)，然后点击<em>“安装(Install)”</em> 按钮。 它将打开预览对话框。<br><img src="http://www.yiibai.com/uploads/images/201712/1812/769121204_62659.png" alt=""></p> 
 <p>点击<strong>确定</strong> 继续下一步 -<br><img src="http://www.yiibai.com/uploads/images/201712/1812/944121205_88790.png" alt=""></p> 
 <p>点击<em>“我接受”</em>按钮开始安装，完成后如下 -<br><img src="http://www.yiibai.com/uploads/images/201712/1812/428121208_65483.png" alt=""></p> 
 <p>当实体框架安装成功后，可看到如上面的截图所示的出窗口的消息。</p> 
 <h2 id="h2-u6DFBu52A0u6A21u578B"><a name="添加模型" class="reference-link"></a><span class="header-link octicon octicon-link"></span>添加模型</h2>
 <p>要添加模型，请右键单击<em>解决方案资源管理器</em> 中的<em>Models</em> 文件夹，然后选择：<em>添加</em> -&gt; <em>类</em> ，会看到<em>添加新项目</em> 对话框。</p> 
 <p>在中间平移中选择：<em>类</em>，并在名称字段中输入：<em>Employee.cs</em>。如下图所示 -<br><img src="http://www.yiibai.com/uploads/images/201712/1912/507141256_73822.png" alt=""></p> 
 <p>使用以下代码将一些属性添加到<code>Employee</code>类。</p> 
 <pre><code class="lang-csharp">using System;

namespace MVCScaffolding.Models {
   public class Employee{
      public int ID { get; set; }
      public string Name { get; set; }
      public DateTime JoiningDate { get; set; }
      public int Age { get; set; }
   }
}
</code></pre> 
 <h4 id="h4--dbcontext"><a name="添加DBContext" class="reference-link"></a><span class="header-link octicon octicon-link"></span>添加DBContext</h4>
 <p>经过上一步，我们已经创建了一个<code>Employee</code>模型，现在需要在这个模型类上添加另一个类，它将与实体框架(<em>Entity Framework</em>)进行通信来检索和保存数据。 以下是<code>Employee.cs</code>文件中的完整代码。</p> 
 <pre><code class="lang-csharp">using System;
using System.Data.Entity;

namespace MVCScaffolding.Models{
   public class Employee{
      public int ID { get; set; }
      public string Name { get; set; }
      public DateTime JoiningDate { get; set; }
      public int Age { get; set; }
   }

   public class EmpDBContext : DbContext{
      public DbSet&lt;Employee&gt; Employees { get; set; }
   }
}
</code></pre> 
 <p>如上面所看到的<code>EmpDBContext</code>是从一个名为<code>DbContext</code>的<code>EF</code>类派生的。 在这个类中，有一个名为<code>DbSet</code>的属性，它基本上代表了要查询和保存的实体。</p> 
 <h2 id="h2-u6DFBu52A0u811Au624Bu67B6u9879u76EE"><a name="添加脚手架项目" class="reference-link"></a><span class="header-link octicon octicon-link"></span>添加脚手架项目</h2>
 <p>要添加脚手架，请右键单击<em>解决方案管理器</em>中的<code>Controllers</code>文件夹，然后选择:<em>添加</em> -&gt; <em>新建搭建基架项目</em> ，如下图所示 -<br><img src="http://www.yiibai.com/uploads/images/201712/1912/271151201_23163.png" alt=""></p> 
 <p>它将显示“添加脚手架”对话框 -<br><img src="http://www.yiibai.com/uploads/images/201712/1912/583151202_70285.png" alt=""></p> 
 <p>选择：<em>包含视图MVC 5控制器(使用Entity Framework)</em> 项，然后单击<em>“添加”</em> 按钮，这将显示添加控制器对话框。<br><img src="http://www.yiibai.com/uploads/images/201712/1912/810151205_42834.png" alt=""></p> 
 <p>从<em>模型类</em> 下拉列表中选择：<code>Employee</code>，并从<em>数据上下文类</em> 下拉列表中选择<em>EmpDBContext</em>。还将看到默认情况下选择了控制器名称。</p> 
 <p>单击“添加”按钮继续，在由Visual Studio使用脚手架创建的<code>EmployeesController</code>中看到以下代码。</p> 
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Data;
using System.Data.Entity;
using System.Linq;
using System.Net;
using System.Web;
using System.Web.Mvc;
using MVCScaffolding.Models;

namespace MVCScaffolding.Controllers
{
    public class EmployeesController : Controller
    {
        private EmpDBContext db = new EmpDBContext();

        // GET: Employees
        public ActionResult Index()
        {
            return View(db.Employees.ToList());
        }

        // GET: Employees/Details/5
        public ActionResult Details(int? id)
        {
            if (id == null)
            {
                return new HttpStatusCodeResult(HttpStatusCode.BadRequest);
            }
            Employee employee = db.Employees.Find(id);
            if (employee == null)
            {
                return HttpNotFound();
            }
            return View(employee);
        }

        // GET: Employees/Create
        public ActionResult Create()
        {
            return View();
        }

        // POST: Employees/Create
        // 为了防止“过多发布”攻击，请启用要绑定到的特定属性，有关 
        // 详细信息，请参阅 http://go.microsoft.com/fwlink/?LinkId=317598。
        [HttpPost]
        [ValidateAntiForgeryToken]
        public ActionResult Create([Bind(Include = "ID,Name,JoiningDate,Age")] Employee employee)
        {
            if (ModelState.IsValid)
            {
                db.Employees.Add(employee);
                db.SaveChanges();
                return RedirectToAction("Index");
            }

            return View(employee);
        }

        // GET: Employees/Edit/5
        public ActionResult Edit(int? id)
        {
            if (id == null)
            {
                return new HttpStatusCodeResult(HttpStatusCode.BadRequest);
            }
            Employee employee = db.Employees.Find(id);
            if (employee == null)
            {
                return HttpNotFound();
            }
            return View(employee);
        }

        // POST: Employees/Edit/5
        // 为了防止“过多发布”攻击，请启用要绑定到的特定属性，有关 
        // 详细信息，请参阅 http://go.microsoft.com/fwlink/?LinkId=317598。
        [HttpPost]
        [ValidateAntiForgeryToken]
        public ActionResult Edit([Bind(Include = "ID,Name,JoiningDate,Age")] Employee employee)
        {
            if (ModelState.IsValid)
            {
                db.Entry(employee).State = EntityState.Modified;
                db.SaveChanges();
                return RedirectToAction("Index");
            }
            return View(employee);
        }

        // GET: Employees/Delete/5
        public ActionResult Delete(int? id)
        {
            if (id == null)
            {
                return new HttpStatusCodeResult(HttpStatusCode.BadRequest);
            }
            Employee employee = db.Employees.Find(id);
            if (employee == null)
            {
                return HttpNotFound();
            }
            return View(employee);
        }

        // POST: Employees/Delete/5
        [HttpPost, ActionName("Delete")]
        [ValidateAntiForgeryToken]
        public ActionResult DeleteConfirmed(int id)
        {
            Employee employee = db.Employees.Find(id);
            db.Employees.Remove(employee);
            db.SaveChanges();
            return RedirectToAction("Index");
        }

        protected override void Dispose(bool disposing)
        {
            if (disposing)
            {
                db.Dispose();
            }
            base.Dispose(disposing);
        }
    }
}
</code></pre> 
 <p>运行应用程序并使用浏览器打开URL： <code>http://localhost:59083/Employees</code> ，将看到以下输出结果 -<br><img src="http://www.yiibai.com/uploads/images/201712/1912/243151210_70551.png" alt=""></p> 
 <p>可以看到视图中并没有数据，因为我们还没有向 <em>Visual Studio</em> 创建的数据库添加任何记录。</p> 
 <p>下面点击添加(<em>Create New</em>)链接来一个记录，它将显示创建视图，填入相关信息 -<br><img src="http://www.yiibai.com/uploads/images/201712/1912/226151211_32082.png" alt=""></p> 
 <p>点击“创建”按钮，它将更新<em>Index</em> 视图，看到有一条记录。如下所示-<br><img src="http://www.yiibai.com/uploads/images/201712/1912/221151212_63159.png" alt=""></p> 
 <p>也可以看到新记录也被添加到数据库中。</p> 
 <p>通过上面所看实现步骤可以看到，我们已经通过使用脚手架实现了一个简单的例子，这是一个用来创建模型类，视图和动作方法的更容易方式。</p>
 <br>      
</div></body></html>
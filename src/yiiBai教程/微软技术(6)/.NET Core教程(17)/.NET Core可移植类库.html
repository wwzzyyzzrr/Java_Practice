<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">.NET Core可移植类库</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在本章中，我们将讨论什么是PCL(可移植类库)，以及为什么我们需要PCL。 为了理解这个概念，让我们打开在前面章创建的类库项目文件夹。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1212/606121227_63769.jpg" alt=""></p> 
 <p>在这个文件夹中，除了<code>project.json</code>和CS文件之外，还可以看到<code>*.xproj</code>文件，这是因为Visual Studio安装.NET Core项目类型为<code>* .xproj</code>而不是<code>*.csproj</code>。</p> 
 <p>正如微软所提到的，<code>*.xproj</code>将会消失，但它仍然在预览工具中。UWP应用程序使用<code>*.csproj</code>。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1212/849121227_89770.jpg" alt=""></p> 
 <p>现在把<code>* .csproj</code>引用和<code>* .xproj</code>实际上是不可行的，而且这个功能不会被执行，因为<code>* .xproj</code>将会移出。</p> 
 <p>相反，我们需要一个可以在控制台应用程序和UWP应用程序之间共享的类库，这就是PCL。</p> 
 <h2 id="h2--pcl"><a name="什么是PCL" class="reference-link"></a><span class="header-link octicon octicon-link"></span>什么是PCL</h2>
 <p>下面来了解PCL是什么 -</p> 
 <ul> 
  <li>可移植类库项目使我们能够编写和构建在多个.NET Framework平台上工作的受管程序集。</li>
  <li>可以创建包含希望在多个项目(如共享业务逻辑)中共享的代码的类，然后引用来自不同类型项目的类。</li>
  <li>它还可以帮助您快速轻松地为Microsoft平台构建跨平台的应用程序和库。</li>
  <li>可移植类库可以帮助您减少开发和测试代码的时间和成本。</li>
  <li>使用此项目类型来编写和构建可移植的.NET Framework程序集，然后从以Windows和Windows Phone等多个平台为目标的应用程序中引用这些程序集。</li>
 </ul> 
 <p>要从<em>解决方案资源管理器</em>创建类库，这里以前面创建的项目：<em>FirstApp</em> 为基础，首先点击<em>解决方案</em> 添加一个新的项目。在左窗格中选择<em>Visual C#</em> -&gt; <em>Windows 通用</em> 模板，然后在中间窗格中选择<em>“类库(通用Windows)”</em> ，如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1312/707161224_47836.png" alt=""></p> 
 <p>在项目名称字段中输入：<em>StringLibrary</em> ，然后单击<em>确定</em> 以创建此项目。现在需要选择目标框架来引用。选择Windows通用和ASP.NET核心片刻，然后重新定位它。点击【<em>确定</em>】。如下图所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1312/177161229_42711.png" alt=""></p> 
 <p>可以看到它已经创建了一个PCF格式的新项目。右键单击解决方案资源管理器中的<em>StringLibrary</em>项目并选择属性。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1312/149161232_62222.png" alt=""></p> 
 <p>现在添加一个新的类; 需要在解决方案资源管理器中右键单击项目，然后选择：<em>添加</em> -&gt; <em>类…</em> ，输入类文件的名称：<em>MyStringLib.cs</em> ，如下所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1312/244161235_64785.png" alt=""></p> 
 <p>类：<em>MyStringLib.cs</em> -</p> 
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace StringLibrary
{
    public static class MyStringLib
    {
        public static bool StartsWithUpper(this String str)
        {
            if (String.IsNullOrWhiteSpace(str))
                return false;
            Char ch = str[0];
            return Char.IsUpper(ch);
        }
        public static bool StartsWithLower(this String str)
        {
            if (String.IsNullOrWhiteSpace(str))
                return false;
            Char ch = str[0];
            return Char.IsLower(ch);
        }
        public static bool StartsWithNumber(this String str)
        {
            if (String.IsNullOrWhiteSpace(str))
                return false;
            Char ch = str[0];
            return Char.IsNumber(ch);
        }
    }
}
</code></pre> 
 <p>下面来构建这个可移植的类库项目，并且应该编译没有错误。需要在控制台项目中添加这个可移植类库的引用。 因此，展开<em>FirstApp</em>并右键单击 <em>添加</em>-&gt; <em>引用</em>，并选择 <em>引用…</em></p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1312/525161240_90655.png" alt=""></p> 
 <p>在“引用管理器”对话框中，选择可移植类库项目：<em>StringLibrary</em> ，然后单击【<em>确定</em>】。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1312/939161244_39759.png" alt=""></p> 
 <p>可以看到<em>StringLibrary</em>引用已添加到控制台项目中，也可以在<em>Assenblyinfo.json</em> 文件中看到。现在修改文件：<em>Program.cs</em> ，如下所示 - </p>   
 <pre><code class="lang-csharp">using System;
using StringLibrary;

namespace FirstApp
{
    public class Program
    {
        public static void Main(string[] args)
        {
            int rows = Console.WindowHeight;
            Console.Clear();
            do
            {
                if (Console.CursorTop &gt;= rows || Console.CursorTop == 0)
                {
                    Console.Clear();
                    Console.WriteLine("\nPress &lt;Enter&gt; only to exit; otherwise, enter a string and press &lt;Enter&gt;:\n");
                }
                string input = Console.ReadLine();

                if (String.IsNullOrEmpty(input)) break;
                Console.WriteLine("Input: {0} {1,30}: {2}\n", input, "Begins with uppercase? ",
                input.StartsWithUpper() ? "Yes" : "No");
            } while (true);
        }
    }
}
</code></pre> 
 <p>再次运行该应用程序，将看到相同的输出。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/1312/931161249_49722.png" alt=""></p> 
 <p>现在，在项目中使用可移植类库的其他扩展方法。UWP应用程序也将使用相同的可移植库。</p>
 <br>      
</div></body></html>
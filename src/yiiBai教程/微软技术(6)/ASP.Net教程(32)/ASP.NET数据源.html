<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">ASP.NET数据源</h1><div style="width:100%;float:left;" class="article-content">   
 <p>数据源控件与数据绑定控件交互并隐藏复杂的数据绑定过程。这些工具为数据绑定控件提供数据，并支持插入，删除，排序和更新等操作的执行。</p> 
 <p>每个数据源控件包装一个特定的数据提供程序 - 关系数据库，XML文档或自定义类，并帮助我们：</p> 
 <ul> 
  <li>管理连接</li>
  <li>选择数据</li>
  <li>管理分页，缓存等表示方面</li>
  <li>操纵数据</li>
 </ul> 
 <p>在ASP.NET中有许多数据源控件可用于从SQL Server，ODBC或OLE DB服务器，XML文件和业务对象访问数据。</p> 
 <p>根据数据的类型，这些控件可以分为两大类：</p> 
 <ul> 
  <li>分层数据源控件</li>
  <li>基于表的数据源控件</li>
 </ul> 
 <p>用于分层数据的数据源控件是：</p> 
 <ul> 
  <li><em>XMLDataSource</em> - 它允许绑定到具有或不具有模式信息的XML文件和字符串。</li>
  <li><em>SiteMapDataSource</em> - 它允许绑定到提供站点地图信息的提供者。</li>
 </ul> 
 <p>用于表格数据的数据源控件是：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>数据源控件</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>SqlDataSource</code></td> 
    <td>它表示与返回SQL数据的<a target="_blank" href="http://www.yiibai.com/ado.net/" title="ADO.NET">ADO.NET</a>数据提供者的连接，包括可通过<code>OLEDB</code>和<code>ODBC</code>访问的数据源。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>ObjectDataSource</code></td> 
    <td>它允许绑定到返回数据的自定义.Net业务对象。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>LinqdataSource</code></td> 
    <td>它允许绑定到<code>Linq-to-SQL</code>查询的结果(仅由ASP.NET 3.5支持)。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>AccessDataSource</code></td> 
    <td>它表示与<em>Microsoft Access</em> 数据库的连接。</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 id="h2-u6570u636Eu6E90u89C6u56FE"><a name="数据源视图" class="reference-link"></a><span class="header-link octicon octicon-link"></span>数据源视图</h2>
 <p>数据源视图是<code>DataSourceView</code>类的对象。它代表不同数据操作(如排序，过滤等)的数据定制视图。</p> 
 <p><code>DataSourceView</code>类用作所有数据源视图类的基类，这些类定义了数据源控件的功能。</p> 
 <p>下表提供了<code>DataSourceView</code>类的属性：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>属性</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>CanDelete</code></td> 
    <td>指示是否允许在基础数据源上进行删除。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>CanInsert</code></td> 
    <td>指示是否允许在基础数据源上插入。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>CanPage</code></td> 
    <td>指示是否允许在基础数据源上进行分页。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>CanRetrieveTotalRowCount</code></td> 
    <td>指示总行数信息是否可用。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>CanSort</code></td> 
    <td>指示是否可以对数据进行排序。</td> 
   </tr> 
   <tr> 
    <td>6</td> 
    <td><code>CanUpdate</code></td> 
    <td>指示是否允许在基础数据源上进行更新。</td> 
   </tr> 
   <tr> 
    <td>7</td> 
    <td><code>Events</code></td> 
    <td>获取数据源视图的事件处理程序委托的列表。</td> 
   </tr> 
   <tr> 
    <td>8</td> 
    <td><code>Name</code></td> 
    <td>视图的名称。</td> 
   </tr> 
  </tbody> 
 </table> 
 <p>下表提供了<code>DataSourceView</code>类的方法：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>方法</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>CanExecute</code></td> 
    <td>确定是否可以执行指定的命令。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>ExecuteCommand</code></td> 
    <td>执行特定的命令。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>ExecuteDelete</code></td> 
    <td>对<code>DataSourceView</code>对象所表示的数据列表执行删除操作。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>ExecuteInsert</code></td> 
    <td>对<code>DataSourceView</code>对象表示的数据列表执行插入操作。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>ExecuteSelect</code></td> 
    <td>获取底层数据存储的数据列表。</td> 
   </tr> 
   <tr> 
    <td>6</td> 
    <td><code>ExecuteUpdate</code></td> 
    <td>对<code>DataSourceView</code>对象表示的数据列表执行更新操作。</td> 
   </tr> 
   <tr> 
    <td>7</td> 
    <td><code>Delete</code></td> 
    <td>对与视图关联的数据执行删除操作。</td> 
   </tr> 
   <tr> 
    <td>8</td> 
    <td><code>Insert</code></td> 
    <td>对与视图关联的数据执行插入操作。</td> 
   </tr> 
   <tr> 
    <td>9</td> 
    <td><code>Select</code></td> 
    <td>返回查询的数据。</td> 
   </tr> 
   <tr> 
    <td>10</td> 
    <td><code>Update</code></td> 
    <td>对与视图关联的数据执行更新操作。</td> 
   </tr> 
   <tr> 
    <td>11</td> 
    <td><code>OnDataSourceViewChanged</code></td> 
    <td>引发<code>DataSourceViewChanged</code>事件。</td> 
   </tr> 
   <tr> 
    <td>12</td> 
    <td><code>RaiseUnsupportedCapabilitiesError</code></td> 
    <td>由<code>RaiseUnsupportedCapabilitiesError</code>方法调用，以将<code>ExecuteSelect</code>操作请求的功能与视图支持的功能进行比较。</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 id="h2-sqldatasource-"><a name="SqlDataSource控件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>SqlDataSource控件</h2>
 <p><code>SqlDataSource</code>控件表示与关系数据库(如SQL Server或<a target="_blank" href="http://www.oraok.com/" title="Oracle">Oracle</a>数据库)的连接，或可通过<code>OLEDB</code>或开放式数据库连接(ODBC)访问的数据。连接数据是通过两个重要的属性<code>ConnectionString</code>和<code>ProviderName</code>来完成的。</p> 
 <p>以下代码片段提供了该控件的基本语法：</p> 
 <pre><code class="lang-aspnet">&lt;asp:SqlDataSource runat="server" ID="MySqlSource"
   ProviderName='&lt;%$ ConnectionStrings:LocalNWind.ProviderName  %&gt;'
   ConnectionString='&lt;%$ ConnectionStrings:LocalNWind %&gt;'
   SelectionCommand= "SELECT * FROM EMPLOYEES" /&gt;

&lt;asp:GridView ID="GridView1" runat="server" DataSourceID="MySqlSource" /&gt;
</code></pre> 
 <p>在底层数据上配置各种数据操作取决于数据源控件的各种属性(属性组)。</p> 
 <p>下表提供了<code>SqlDataSource</code>控件的相关属性集，它提供了控件的编程接口：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>属性集/组</th> 
    <th></th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>DeleteCommand</code>,<code>DeleteParameters</code>,<code>DeleteCommandType</code></td> 
    <td>获取或设置用于删除基础数据中的行的SQL语句，参数和类型。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>FilterExpression</code>,<code>FilterParameters</code></td> 
    <td>获取或设置数据过滤字符串和参数。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>InsertCommand</code>,<code>InsertParameters</code>,<code>InsertCommandType</code></td> 
    <td>获取或设置用于在基础数据库中插入行的SQL语句，参数和类型。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>SelectCommand</code>,<code>SelectParameters</code>,<code>SelectCommandType</code></td> 
    <td>获取或设置从底层数据库检索行的SQL语句，参数和类型。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>SortParameterName</code></td> 
    <td>获取或设置命令的存储过程将用于排序数据的输入参数的名称。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>UpdateCommand</code>,<code>UpdateParameters</code>,<code>UpdateCommandType</code></td> 
    <td>获取或设置用于更新基础数据存储中的行的SQL语句，参数和类型。</td> 
   </tr> 
  </tbody> 
 </table> 
 <p>以下代码片段显示了为数据操作启用的数据源控件：</p> 
 <pre><code class="lang-aspnet">&lt;asp:SqlDataSource runat="server" ID= "MySqlSource"
   ProviderName='&lt;%$ ConnectionStrings:LocalNWind.ProviderName  %&gt;'
   ConnectionString=' &lt;%$ ConnectionStrings:LocalNWind %&gt;'
   SelectCommand= "SELECT * FROM EMPLOYEES"
   UpdateCommand= "UPDATE EMPLOYEES SET LASTNAME=@lame"
   DeleteCommand= "DELETE FROM EMPLOYEES WHERE EMPLOYEEID=@eid"
   FilterExpression= "EMPLOYEEID &gt; 10"&gt;
   .....
   .....
&lt;/asp:SqlDataSource&gt;
</code></pre> 
 <h2 id="h2-objectdatasource-"><a name="ObjectDataSource控件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>ObjectDataSource控件</h2>
 <p><code>ObjectDataSource</code>控件允许用户定义的类将其方法的输出关联到数据绑定控件。该类的编程接口与<code>SqlDataSource</code>控件几乎相同。</p> 
 <p>以下是绑定业务对象的两个重要方面：</p> 
 <ul> 
  <li>可绑定的类应该有一个默认的构造函数，它应该是无状态的，并且可以映射选择，更新，插入和删除语义的方法。</li>
  <li>对象一次只能更新一个项目，批处理操作不支持。</li>
 </ul> 
 <p>让我们直接看一个例子来处理这个控件。 <code>Student</code>类是与对象数据源一起使用的类。 这个类有三个属性：学生ID，姓名和城市。 它有一个默认的构造函数和一个<code>GetStudents</code>方法来检索数据。</p> 
 <p><code>Student</code>类代码如下：</p>   
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Web;

/// &lt;summary&gt;
/// Student 的摘要说明
/// &lt;/summary&gt;
public class Student
{
    public int StudentID { get; set; }
    public string Name { get; set; }
    public string City { get; set; }

    public Student()
    { }

    public DataSet GetStudents()
    {
        DataSet ds = new DataSet();
        DataTable dt = new DataTable("Students");

        dt.Columns.Add("学生编号", typeof(System.Int32));
        dt.Columns.Add("姓名", typeof(System.String));
        dt.Columns.Add("城市", typeof(System.String));
        dt.Rows.Add(new object[] { 1001, "何马", "海口" });
        dt.Rows.Add(new object[] { 1002, "李小静", "上海" });
        ds.Tables.Add(dt);

        return ds;
    }
}
</code></pre> 
 <p>执行以下步骤将对象与对象数据源绑定并检索数据：</p> 
 <ul> 
  <li>创建一个新的网站，名称为：<em>DataSourceDemo</em>。如下图 -<br><img src="http://www.yiibai.com/uploads/images/201712/0712/972161219_47868.png" alt=""></li>
  <li>通过右键单击解决方案资源管理器中的项目名称，添加一个类(名称为：<code>Students.cs</code>)，并将上面的代码放入其中。</li>
  <li>构建解决方案，以便应用程序可以使用该类的引用。</li>
  <li>将<code>ObjectDataSource</code>控件放置在Web窗体中。如下图所示 -<br><img src="http://www.yiibai.com/uploads/images/201712/0712/927161240_38797.png" alt=""></li>
  <li>通过点击上图中的 【<em>配置数据源…</em>】 链接来选择对象来配置数据源。参考下图 -<br><img src="http://www.yiibai.com/uploads/images/201712/0712/520161242_83331.png" alt=""></li>
  <li>为数据的不同操作选择一种数据方法。在这个例子中，只有一个方法。如下图所示 -<br><img src="http://www.yiibai.com/uploads/images/201712/0712/943161245_67270.png" alt=""></li>
  <li>在窗体页面上放置数据绑定控件(如：<code>GridView</code>)，并选择对象数据源作为其基础数据源。<br><img src="http://www.yiibai.com/uploads/images/201712/0712/457161247_81368.png" alt=""></li>
  <li>经过上面步骤后，设计视图应该如下所示：<br><img src="http://www.yiibai.com/uploads/images/201712/0712/345161251_13406.png" alt=""></li>
 </ul> 
 <p>文件 <em>Default.aspx</em> 中的代码如下所示 - </p> 
 <pre><code class="lang-aspnet">&lt;%@ Page Language="C#" AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="_Default" %&gt;

&lt;!DOCTYPE html&gt;

&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head runat="server"&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/&gt;
    &lt;title&gt;数据源示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form id="form1" runat="server"&gt;
        &lt;div&gt;
            &lt;asp:ObjectDataSource ID="ObjectDataSource1" runat="server" SelectMethod="GetStudents" TypeName="Student"&gt;&lt;/asp:ObjectDataSource&gt;
            &lt;br /&gt;
            &lt;asp:GridView ID="GridView1" runat="server" DataSourceID="ObjectDataSource1"&gt;
            &lt;/asp:GridView&gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>运行该项目，它从<code>Student</code>类中检索硬编码的元组，并显示其中的数据如下 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/0712/824161253_47192.png" alt=""></p> 
 <h2 id="h2-accessdatasource-"><a name="AccessDataSource控件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>AccessDataSource控件</h2>
 <p><code>AccessDataSource</code>控件表示到Access数据库的连接。它基于<code>SqlDataSource</code>控件，并提供更简单的编程接口。以下代码片段提供了数据源的基本语法：</p> 
 <pre><code class="lang-aspnet">&lt;asp:AccessDataSource ID="AccessDataSource1 runat="server" 
   DataFile="~/App_Data/ASPDotNetStepByStep.mdb" SelectCommand="SELECT * FROM  [DotNetReferences]"&gt;
&lt;/asp:AccessDataSource&gt;
</code></pre> 
 <p><code>AccessDataSource</code>控件以只读模式打开数据库。但是，它也可以用于执行插入，更新或删除操作。这是使用<a target="_blank" href="http://www.yiibai.com/ado.net/" title="ADO.NET">ADO.NET</a>命令和参数集合完成的。</p> 
 <p>从ASP.NET应用程序中更新<a target="_blank" href="http://www.yiibai.com/access/" title="Access">Access</a>数据库是有问题的，因为<code>Access</code>数据库是普通文件，ASP.NET应用程序的默认帐户可能没有写入数据库文件的权限。</p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">ASP.NET自定义控件</h1><div style="width:100%;float:left;" class="article-content">   
 <p>ASP.NET允许用户创建自己的控件。这些用户定义的控件分为：</p> 
 <ul> 
  <li>用户控件</li>
  <li>自定义控件</li>
 </ul> 
 <h2 id="h2-u7528u6237u63A7u4EF6"><a name="用户控件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>用户控件</h2>
 <p>用户控件的行为与微型ASP.NET页面或Web表单类似，可以被许多其他页面使用。这些是从<code>System.Web.UI.UserControl</code>类派生的。这些控件具有以下特征：</p> 
 <ul> 
  <li>它们有一个<code>.ascx</code>扩展名。</li>
  <li>它们可能不包含任何<code>&lt;html&gt;</code>，<code>&lt;body&gt;</code>或<code>&lt;form&gt;</code>标签。</li>
  <li>它们有一个控件指令，而不是一个<code>Page</code>指令。</li>
 </ul> 
 <p>为了理解这个概念，让我们创建一个简单的用户控件，它将作为页面的页脚。要创建和使用用户控件，请执行以下步骤：</p> 
 <ul> 
  <li>创建一个新的Web应用程序(ASP.NET网站项目：<em>UserControls</em> )。</li>
  <li>右键单击【<em>解决方案资源管理器</em>】上的项目文件夹，然后选择【<em>添加新项目</em>】。</li>
  <li>从【<em>添加新项目</em>】对话框中选择【<em>Web用户控件</em>】并将其命名为<code>footer.ascx</code>。 最初，<code>footer.ascx</code>只包含一个控件指令。<pre><code class="lang-aspnet">&lt;%@ Control Language="C#" AutoEventWireup="true" CodeBehind="footer.ascx.cs" 
 Inherits="customcontroldemo.footer" %&gt;
</code></pre> </li>
  <li><p>将下面的代码添加到文件中(上面代码保持不变，新增下面代码)：</p> <pre><code class="lang-aspnet">&lt;table&gt;
 &lt;tr&gt;
    &lt;td align="center"&gt; Copyright ©2012 - 2018 Yiibai Yiibai&lt;/td&gt;
 &lt;/tr&gt;

 &lt;tr&gt;
    &lt;td align="center"&gt; Location: Haikou &lt;/td&gt;
 &lt;/tr&gt;
&lt;/table&gt;
</code></pre> </li>
 </ul> 
 <p>要将用户控件添加到网页，要将<code>Register</code>指令和用户控件的一个实例添加到页面。<em>Default.aspx</em>文件中的代码如下：</p> 
 <pre><code class="lang-aspnet">&lt;%@ Page Language="C#" AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="_Default" %&gt;
&lt;%@ Register Src="~/footer.ascx" TagName="footer" TagPrefix="Tfooter" %&gt;
&lt;!DOCTYPE html&gt;

&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head runat="server"&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/&gt;
    &lt;title&gt;用户控件示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form id="form1" runat="server"&gt;
         &lt;div&gt;

            &lt;asp:Label ID="Label1" runat="server" Text="Welcome to ASP.Net Yiibai "&gt;&lt;/asp:Label&gt;


         &lt;/div&gt;
        &lt;hr /&gt;
         &lt;Tfooter:footer ID="footer1" runat="server" /&gt;

    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>需要注意以下几点：</p> 
 <ul> 
  <li><code>Register</code>指令为控件指定标签名称和标签前缀。<pre><code class="lang-aspnet">&lt;%@ Register Src="~/footer.ascx" TagName="footer" TagPrefix="Tfooter" %&gt;
</code></pre> </li>
  <li>在页面上添加用户控件时，应使用以下标记名称和前缀：<pre><code class="lang-aspnet">&lt;Tfooter:footer ID="footer1" runat="server" /&gt;
</code></pre> </li>
 </ul> 
 <p>运行上面项目，得到以下结果 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/0712/731091239_55849.png" alt=""></p> 
 <h2 id="h2-u81EAu5B9Au4E49u63A7u4EF6"><a name="自定义控件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>自定义控件</h2>
 <p>自定义控件作为单独的程序集部署。 它们被编译成动态链接库(DLL)，并用作其他ASP.NET服务器控件。它们可以通过以下任何一种方式创建：</p> 
 <ul> 
  <li>通过从现有控件派生自定义控件</li>
  <li>通过组成一个新的自定义控件组合两个或更多现有的控件。</li>
  <li>从基控制类派生。</li>
 </ul> 
 <p>为了理解这个概念，让我们创建一个自定义控件，它将简单地在浏览器上显示一条文本消息。 要创建此控件，请执行以下步骤：</p> 
 <ul> 
  <li><p>创建一个新的网站(ASP.NET网站项目：<em>CustomControls</em> )。右键单击【<em>解决方案资源管理器</em>】中树顶部的解决方案(不是项目)。</p> </li>
  <li><p>在<em>“新建项目”</em>对话框中，从项目模板中选择<em>“ASP.NET服务器控件”</em>(如果没有找到，请从左侧的<em>联机</em>中搜索安装)。</p> </li>
 </ul> 
 <p>上述步骤添加了一个新项目，并为该解决方案创建了一个完整的自定义控件，称为<code>ServerControl1</code>。要使用此控件，必须在将网页注册到网页之前将其添加为网站的引用。 要添加对现有项目的引用，请右键单击该项目名称(不是解决方案)，然后单击添加引用。</p> 
 <p>从添加引用对话框的项目选项卡中选择<code>CustomControls</code>项目。 解决方案资源管理器应显示参考如下图所示 - </p> 
 <p>要在页面上使用该控件，请在<code><a target="_blank" href="https://github.com/Page" title="@Page" class="at-link">@Page</a></code>指令下添加<code>Register</code>指令：</p>   
 <pre><code class="lang-aspnet">&lt;%@ Register Assembly="CustomControls"  Namespace="CustomControls"  TagPrefix="ccs" %&gt;
</code></pre> 
 <p>下面就可以使用该控件，与其他控件类似。</p> 
 <pre><code class="lang-aspnet">&lt;form id="form1" runat="server"&gt;
   &lt;div&gt;
      &lt;ccs:ServerControl1 runat="server" Text = "I am a Custom Server Control" /&gt;
   &lt;/div&gt; 
&lt;/form&gt;
</code></pre> 
 <p>在上面，我们设置了自定义控件的<code>Text</code>属性的值。ASP.NET在创建控件时默认添加了此属性。但还需要以下后端代码实现显示功能。<em>ServerControl1.cs</em> 的代码如下 - </p> 
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Text;

using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace CustomControls
{
   [DefaultProperty("Text")]
   [ToolboxData("&lt;{0}:ServerControl1 runat=server&gt;&lt;/{0}:ServerControl1 &gt;")]

   public class ServerControl1 : WebControl
   {
      [Bindable(true)]
      [Category("Appearance")]
      [DefaultValue("")]
      [Localizable(true)]

      public string Text
      {
         get
         {
            String s = (String)ViewState["Text"];
            return ((s == null) ? "[" + this.ID + "]" : s);
         }

         set
         {
            ViewState["Text"] = value;
         }
      }

      protected override void RenderContents(HtmlTextWriter output)
      {
         output.Write(Text);
      }
   }
}
</code></pre>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Kotlin使用Gradle</h1><div style="width:100%;float:left;" class="article-content">   
 <p>为了用 Gradle 构建 Kotlin，你应该<a target="_blank" href="#插件和版本">设置好 <em>kotlin-gradle</em> 插件</a>，<a target="_blank" href="#针对-jvm">将其应用</a>到你的项目中，并且<a target="_blank" href="#配置依赖">添加 <em>kotlin-stdlib</em> 依赖</a>。这些操作也可以在 IntelliJ IDEA 中通过调用 Project action 中的 Tools | Kotlin | Configure Kotlin 自动执行。</p> 
 <h2 id="h2-u63D2u4EF6u548Cu7248u672C"><a name="插件和版本" class="reference-link"></a><span class="header-link octicon octicon-link"></span>插件和版本</h2>
 <p>使用 <code>kotlin-gradle-plugin</code> 编译 Kotlin 源代码和模块.</p> 
 <p>要使用的 Kotlin 版本通常定义为 <code>kotlin_version</code> 属性：</p> 
 <pre><code class="lang-groovy">buildscript {
    ext.kotlin_version = '＜要使用的版本＞'

    repositories {
        mavenCentral()
    }

    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
    }
}
</code></pre> 
 <p>当通过 <a target="_blank" href="https://docs.gradle.org/current/userguide/plugins.html#sec:plugins_block">Gradle 插件 DSL</a> 使用 Kotlin Gradle 插件 1.1.1 及以上版本时，这不是必需的。</p> 
 <h2 id="h2--jvm"><a name="针对 JVM" class="reference-link"></a><span class="header-link octicon octicon-link"></span>针对 JVM</h2>
 <p>针对 JVM，需要应用 Kotlin 插件：</p> 
 <pre><code class="lang-groovy">apply plugin: "kotlin"
</code></pre> 
 <p>或者，从 Kotlin 1.1.1 起，可以使用 <a target="_blank" href="https://docs.gradle.org/current/userguide/plugins.html#sec:plugins_block">Gradle 插件 DSL</a> 来应用该插件：</p> 
 <pre><code class="lang-groovy">plugins {
    id "org.jetbrains.kotlin.jvm" version "＜要使用的版本＞"
}
</code></pre> 
 <p>在这个块中的 <code>version</code> 必须是字面值，并且不能从其他构建脚本中应用。</p> 
 <p>Kotlin 源代码可以与同一个文件夹或不同文件夹中的 Java 源代码混用。默认约定是使用不同的文件夹：</p> 
 <pre><code class="lang-groovy">project
    - src
        - main (root)
            - kotlin
            - java
</code></pre> 
 <p>如果不使用默认约定，那么应该更新相应的 <em>sourceSets</em> 属性</p> 
 <pre><code class="lang-groovy">sourceSets {
    main.kotlin.srcDirs += 'src/main/myKotlin'
    main.java.srcDirs += 'src/main/myJava'
}
</code></pre> 
 <h2 id="h2--javascript"><a name="针对 JavaScript" class="reference-link"></a><span class="header-link octicon octicon-link"></span>针对 JavaScript</h2>
 <p>当针对 JavaScript 时，须应用不同的插件：</p> 
 <pre><code class="lang-groovy">apply plugin: "kotlin2js"
</code></pre> 
 <p>这个插件只适用于 Kotlin 文件，因此建议将 Kotlin 和 Java 文件分开(如果是同一项目包含 Java 文件的情况)。与<br>针对 JVM 一样，如果不使用默认约定，我们需要使用 <em>sourceSets</em> 来指定源代码文件夹。</p> 
 <pre><code class="lang-groovy">sourceSets {
    main.kotlin.srcDirs += 'src/main/myKotlin'
}
</code></pre> 
 <p>除了输出的 JavaScript 文件，该插件默认会创建一个带二进制描述符的额外 JS 文件。<br>如果你是构建其他 Kotlin 模块可以依赖的可重用库，那么该文件是必需的，并且应该与转换结果一起分发。<br>其生成由 <code>kotlinOptions.metaInfo</code> 选项控制：</p> 
 <pre><code class="lang-groovy">compileKotlin2Js {
    kotlinOptions.metaInfo = true
}
</code></pre> 
 <h2 id="h2--android"><a name="针对 Android" class="reference-link"></a><span class="header-link octicon octicon-link"></span>针对 Android</h2>
 <p>Android 的 Gradle 模型与普通 Gradle 有点不同，所以如果我们要构建一个用 Kotlin 编写的 Android 项目，我们需要<br>用 <em>kotlin-android</em> 插件取代 <em>kotlin</em> 插件：</p> 
 <pre><code class="lang-groovy">buildscript {
    ext.kotlin_version = '＜要使用的版本＞'

    ……

    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
    }
}
apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'
</code></pre> 
 <p>不要忘记配置<a target="_blank" href="#配置依赖">标准库依赖关系</a>。</p> 
 <h3 id="h3-android-studio"><a name="Android Studio" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Android Studio</h3>
 <p>如果使用 Android Studio，那么需要在 android 下添加以下内容：</p> 
 <pre><code class="lang-groovy">android {
  ……

  sourceSets {
    main.java.srcDirs += 'src/main/kotlin'
  }
}
</code></pre> 
 <p>这让 Android Studio 知道该 kotlin 目录是源代码根目录，所以当项目模型加载到 IDE 中时，它会被正确识别。或者，你可以将 Kotlin 类放在 Java 源代码目录中，该目录通常位于 <code>src/main/java</code>。</p> 
 <h2 id="h2-u914Du7F6Eu4F9Du8D56"><a name="配置依赖" class="reference-link"></a><span class="header-link octicon octicon-link"></span>配置依赖</h2>
 <p>除了上面显示的 <code>kotlin-gradle-plugin</code> 依赖之外，还需要添加 Kotlin 标准库的依赖：</p> 
 <pre><code class="lang-groovy">repositories {
    mavenCentral()
}

dependencies {
    compile "org.jetbrains.kotlin:kotlin-stdlib"
}
</code></pre> 
 <p>如果针对 JavaScript，请使用 <code>compile "org.jetbrains.kotlin:kotlin-stdlib-js"</code> 替代之。</p> 
 <p>如果是针对 JDK 7 或 JDK 8，那么可以使用扩展版本的 Kotlin 标准库，其中包含<br>为新版 JDK 增加的额外的扩展函数。使用以下依赖之一来取代 <code>kotlin-stdlib</code><br>：</p> 
 <pre><code class="lang-groovy">compile "org.jetbrains.kotlin:kotlin-stdlib-jre7"
compile "org.jetbrains.kotlin:kotlin-stdlib-jre8"
</code></pre> 
 <p>如果你的项目中使用 <a target="_blank" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.reflect.full/index.html">Kotlin 反射</a>或者测试设施，你也需要添加相应的依赖：</p> 
 <pre><code class="lang-groovy">compile "org.jetbrains.kotlin:kotlin-reflect"
testCompile "org.jetbrains.kotlin:kotlin-test"
testCompile "org.jetbrains.kotlin:kotlin-test-junit"
</code></pre> 
 <p>从 Kotlin 1.1.2 起，使用 <code>org.jetbrains.kotlin</code> group 的依赖项默认使用<br>从已应用的插件获得的版本来解析。你可以用完整的依赖关系符号<br>(如 <code>compile "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"</code>)手动提供其版本。</p> 
 <h2 id="h2-u6CE8u89E3u5904u7406"><a name="注解处理" class="reference-link"></a><span class="header-link octicon octicon-link"></span>注解处理</h2>
 <p>请参见 <a target="_blank" href="kapt.html">Kotlin 注解处理工具</a>(<code>kapt</code>)的描述。</p> 
 <h2 id="h2-u589Eu91CFu7F16u8BD1"><a name="增量编译" class="reference-link"></a><span class="header-link octicon octicon-link"></span>增量编译</h2>
 <p>Kotlin 支持 Gradle 中可选的增量编译。<br>增量编译跟踪构建之间源文件的改动，因此只有受这些改动影响的文件才会被编译。</p> 
 <p>从 Kotlin 1.1.1 起，默认启用增量编译。</p> 
 <p>有几种方法来覆盖默认设置：</p> 
 <ol> 
  <li><p>将 <code>kotlin.incremental=true</code> 或者 <code>kotlin.incremental=false</code> 行添加到一个 <code>gradle.properties</code> 或者一个 <code>local.properties</code> 文件中；</p> </li>
  <li><p>将 <code>-Pkotlin.incremental=true</code> 或 <code>-Pkotlin.incremental=false</code> 添加到 gradle 命令行参数。请注意，这样用法中，该参数必须添加到后续每个子构建，并且任何具有禁用增量编译的构建将使增量缓存失效。</p> </li>
 </ol> 
 <p>启用增量编译时，应该会在构建日志中看到以下警告消息：</p> 
 <pre><code>Using kotlin incremental compilation
</code></pre>
 <p>请注意，第一次构建不会是增量的。</p> 
 <h2 id="h2-u534Fu7A0Bu652Fu6301"><a name="协程支持" class="reference-link"></a><span class="header-link octicon octicon-link"></span>协程支持</h2>
 <p><a target="_blank" href="coroutines.html">协程</a>支持是 Kotlin 1.1 中的一个实验性的功能，所以当你在项目中使用协程时，Kotlin 编译器会报告一个警告。<br>如果要关闭该警告，可以将以下块添加到你的 <code>build.gradle</code> 文件中：</p> 
 <pre><code class="lang-groovy">kotlin {
    experimental {
        coroutines 'enable'
    }
}
</code></pre> 
 <h2 id="h2-u7F16u8BD1u5668u9009u9879"><a name="编译器选项" class="reference-link"></a><span class="header-link octicon octicon-link"></span>编译器选项</h2>
 <p>要指定附加的编译选项，请使用 Kotlin 编译任务的 <code>kotlinOptions</code> 属性。</p> 
 <p>当针对 JVM 时，对于生产代码这些任务称为 <code>compileKotlin</code> 而对于<br>测试代码称为 <code>compileTestKotlin</code>。对于自定义源文件集(source set)这些任务称呼取决于 <code>compile＜Name＞Kotlin</code> 模式。</p> 
 <p>当针对 JavaScript 时，这些任务分别称为 <code>compileKotlin2Js</code> 与 <code>compileTestKotlin2Js</code>，以及对于自定义源文件集称为 <code>compile＜Name＞Kotlin2Js</code>。</p> 
 <p>示例：</p>   
 <pre><code class="lang-groovy">compileKotlin {
    kotlinOptions.suppressWarnings = true
}

compileKotlin {
    kotlinOptions {
        suppressWarnings = true
    }
}
</code></pre> 
 <p>对于 Gradle 任务的完整选项列表如下：</p> 
 <h3 id="h3-jvm-js-"><a name="JVM 和 JS 的公共属性" class="reference-link"></a><span class="header-link octicon octicon-link"></span>JVM 和 JS 的公共属性</h3>
 <table> 
  <thead> 
   <tr> 
    <th>名称</th> 
    <th>描述</th> 
    <th>可能的值</th> 
    <th>默认值</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td><code>apiVersion</code></td> 
    <td>只允许使用来自捆绑库的指定版本中的声明</td> 
    <td>“1.0”、 “1.1”</td> 
    <td>“1.1”</td> 
   </tr> 
   <tr> 
    <td><code>languageVersion</code></td> 
    <td>提供与指定语言版本源代码兼容性</td> 
    <td>“1.0”、 “1.1”</td> 
    <td>“1.1”</td> 
   </tr> 
   <tr> 
    <td><code>suppressWarnings</code></td> 
    <td>不生成警告</td> 
    <td></td> 
    <td>false</td> 
   </tr> 
   <tr> 
    <td><code>verbose</code></td> 
    <td>启用详细日志输出</td> 
    <td></td> 
    <td>false</td> 
   </tr> 
   <tr> 
    <td><code>freeCompilerArgs</code></td> 
    <td>附加编译器参数的列表</td> 
    <td></td> 
    <td>[]</td> 
   </tr> 
  </tbody> 
 </table> 
 <h3 id="h3-jvm-"><a name="JVM 特有的属性" class="reference-link"></a><span class="header-link octicon octicon-link"></span>JVM 特有的属性</h3>
 <table> 
  <thead> 
   <tr> 
    <th>名称</th> 
    <th>描述</th> 
    <th>可能的值</th> 
    <th>默认值</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td><code>javaParameters</code></td> 
    <td>为方法参数生成 Java 1.8 反射的元数据</td> 
    <td></td> 
    <td>false</td> 
   </tr> 
   <tr> 
    <td><code>jdkHome</code></td> 
    <td>要包含到 classpath 中的 JDK 主目录路径，如果与默认 JAVA_HOME 不同的话</td> 
    <td></td> 
    <td></td> 
   </tr> 
   <tr> 
    <td><code>jvmTarget</code></td> 
    <td>生成的 JVM 字节码的目标版本(1.6 或 1.8)，默认为 1.6</td> 
    <td>“1.6”、 “1.8”</td> 
    <td>“1.6”</td> 
   </tr> 
   <tr> 
    <td><code>noJdk</code></td> 
    <td>不要在 classpath 中包含 Java 运行时</td> 
    <td></td> 
    <td>false</td> 
   </tr> 
   <tr> 
    <td><code>noReflect</code></td> 
    <td>不要在 classpath 中包含 Kotlin 反射实现</td> 
    <td></td> 
    <td>true</td> 
   </tr> 
   <tr> 
    <td><code>noStdlib</code></td> 
    <td>不要在 classpath 中包含 Kotlin 运行时</td> 
    <td></td> 
    <td>true</td> 
   </tr> 
  </tbody> 
 </table> 
 <h3 id="h3-js-"><a name="JS 特有的属性" class="reference-link"></a><span class="header-link octicon octicon-link"></span>JS 特有的属性</h3>
 <table> 
  <thead> 
   <tr> 
    <th>名称</th> 
    <th>描述</th> 
    <th>可能的值</th> 
    <th>默认值</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td><code>main</code></td> 
    <td>是否要调用 main 函数</td> 
    <td>“call”、 “noCall”</td> 
    <td>“call”</td> 
   </tr> 
   <tr> 
    <td><code>metaInfo</code></td> 
    <td>使用元数据生成 .meta.js 与 .kjsm 文件。用于创建库</td> 
    <td></td> 
    <td>true</td> 
   </tr> 
   <tr> 
    <td><code>moduleKind</code></td> 
    <td>编译器生成的模块类型</td> 
    <td>“plain”、 “amd”、 “commonjs”、 “umd”</td> 
    <td>“plain”</td> 
   </tr> 
   <tr> 
    <td><code>noStdlib</code></td> 
    <td>不使用捆绑的 Kotlin stdlib</td> 
    <td></td> 
    <td>true</td> 
   </tr> 
   <tr> 
    <td><code>outputFile</code></td> 
    <td>输出文件路径</td> 
    <td></td> 
    <td></td> 
   </tr> 
   <tr> 
    <td><code>sourceMap</code></td> 
    <td>生成源代码映射(source map)</td> 
    <td></td> 
    <td>false</td> 
   </tr> 
   <tr> 
    <td><code>target</code></td> 
    <td>生成指定 ECMA 版本的 JS 文件</td> 
    <td>“v5”</td> 
    <td>“v5”</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 id="h2-u751Fu6210u6587u6863"><a name="生成文档" class="reference-link"></a><span class="header-link octicon octicon-link"></span>生成文档</h2>
 <p>要生成 Kotlin 项目的文档，请使用 <a target="_blank" href="https://github.com/Kotlin/dokka">Dokka</a>；<br>相关配置说明请参见 <a target="_blank" href="https://github.com/Kotlin/dokka/blob/master/README.md#using-the-maven-plugin">Dokka README</a><br>。Dokka 支持混合语言项目，并且可以生成多种格式的输出<br>，包括标准 JavaDoc。</p> 
 <h2 id="h2-osgi"><a name="OSGi" class="reference-link"></a><span class="header-link octicon octicon-link"></span>OSGi</h2>
 <p>关于 OSGi 支持请参见 <a target="_blank" href="kotlin-osgi.html">Kotlin OSGi 页</a>。</p> 
 <h2 id="h2-u793Au4F8B"><a name="示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>示例</h2>
 <p>以下示例显示了配置 Gradle 插件的不同可能性：</p> 
 <ul> 
  <li><a target="_blank" href="https://github.com/JetBrains/kotlin-examples/tree/master/gradle/hello-world">Kotlin</a></li>
  <li><a target="_blank" href="https://github.com/JetBrains/kotlin-examples/tree/master/gradle/mixed-java-kotlin-hello-world">混用 Java 与 Kotlin</a></li>
  <li><a target="_blank" href="https://github.com/JetBrains/kotlin-examples/tree/master/gradle/android-mixed-java-kotlin-project">Android</a></li>
  <li><a target="_blank" href="https://github.com/JetBrains/kotlin/tree/master/libraries/tools/kotlin-gradle-plugin-integration-tests/src/test/resources/testProject/kotlin2JsProject">JavaScript</a></li>
 </ul>
 <br>      
</div></body></html>
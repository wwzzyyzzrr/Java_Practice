<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Kotlin使用Maven</h1><div style="width:100%;float:left;" class="article-content">   
 <h2 id="h2-u63D2u4EF6u4E0Eu7248u672C"><a name="插件与版本" class="reference-link"></a><span class="header-link octicon octicon-link"></span>插件与版本</h2>
 <p><em>kotlin-maven-plugin</em> 用于编译 Kotlin 源代码与模块，目前只支持 Marven V3。</p> 
 <p>通过 <em>kotlin.version</em> 属性定义要使用的 Kotlin 版本：</p> 
 <pre><code class="lang-xml">&lt;properties&gt;
    &lt;kotlin.version&gt;{{ site.data.releases.latest.version }}&lt;/kotlin.version&gt;
&lt;/properties&gt;
</code></pre> 
 <h2 id="h2-u4F9Du8D56"><a name="依赖" class="reference-link"></a><span class="header-link octicon octicon-link"></span>依赖</h2>
 <p>Kotlin 有一个广泛的标准库可用于应用程序。在 pom 文件中配置以下依赖关系</p> 
 <pre><code class="lang-xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
        &lt;artifactId&gt;kotlin-stdlib&lt;/artifactId&gt;
        &lt;version&gt;${kotlin.version}&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre> 
 <p>如果你是针对 JDK 7 或 JDK 8，那么可以使用扩展版本的 Kotlin 标准库，<br>其中包含为新版 JDK 所增 API 而加的额外的扩展函数。使用 <code>kotlin-stdlib-jre7</code><br>或 <code>kotlin-stdlib-jre8</code> 取代 <code>kotlin-stdlib</code>，这取决于你的 JDK 版本。</p> 
 <p>如果你的项目使用 <a target="_blank" href="/api/latest/jvm/stdlib/kotlin.reflect.full/index.html">Kotlin 反射</a> 或者测试设施，那么你还需要添加相应的依赖项。<br>其构件 ID 对于反射库是 <code>kotlin-reflect</code>，对于测试库是 <code>kotlin-test</code> 与 <code>kotlin-test-junit</code><br>。</p> 
 <h2 id="h2--kotlin-"><a name="编译只有 Kotlin 的源代码" class="reference-link"></a><span class="header-link octicon octicon-link"></span>编译只有 Kotlin 的源代码</h2>
 <p>要编译源代码，请在 <code>&lt;build&gt;</code> 标签中指定源代码目录：</p> 
 <pre><code class="lang-xml">&lt;build&gt;
    &lt;sourceDirectory&gt;${project.basedir}/src/main/kotlin&lt;/sourceDirectory&gt;
    &lt;testSourceDirectory&gt;${project.basedir}/src/test/kotlin&lt;/testSourceDirectory&gt;
&lt;/build&gt;
</code></pre> 
 <p>需要引用 Kotlin Maven 插件来编译源代码：</p> 
 <pre><code class="lang-xml">&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;artifactId&gt;kotlin-maven-plugin&lt;/artifactId&gt;
            &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
            &lt;version&gt;${kotlin.version}&lt;/version&gt;

            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;id&gt;compile&lt;/id&gt;
                    &lt;goals&gt; &lt;goal&gt;compile&lt;/goal&gt; &lt;/goals&gt;
                &lt;/execution&gt;

                &lt;execution&gt;
                    &lt;id&gt;test-compile&lt;/id&gt;
                    &lt;goals&gt; &lt;goal&gt;test-compile&lt;/goal&gt; &lt;/goals&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</code></pre> 
 <h2 id="h2--kotlin-java-"><a name="同时编译 Kotlin 与 Java 源代码" class="reference-link"></a><span class="header-link octicon octicon-link"></span>同时编译 Kotlin 与 Java 源代码</h2>
 <p>要编译混合代码应用程序，必须在 Java 编译器之前调用 Kotlin 编译器。<br>按照 maven 的方式，这意味着应该使用以下方法在 maven-compiler-plugin 之前运行 kotlin-maven-plugin，确保 pom.xml 文件中的 kotlin 插件位于 maven-compiler-plugin 上面。</p> 
 <pre><code class="lang-xml">&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;artifactId&gt;kotlin-maven-plugin&lt;/artifactId&gt;
            &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
            &lt;version&gt;${kotlin.version}&lt;/version&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;id&gt;compile&lt;/id&gt;
                    &lt;goals&gt; &lt;goal&gt;compile&lt;/goal&gt; &lt;/goals&gt;
                    &lt;configuration&gt;
                        &lt;sourceDirs&gt;
                            &lt;sourceDir&gt;${project.basedir}/src/main/kotlin&lt;/sourceDir&gt;
                            &lt;sourceDir&gt;${project.basedir}/src/main/java&lt;/sourceDir&gt;
                        &lt;/sourceDirs&gt;
                    &lt;/configuration&gt;
                &lt;/execution&gt;
                &lt;execution&gt;
                    &lt;id&gt;test-compile&lt;/id&gt;
                    &lt;goals&gt; &lt;goal&gt;test-compile&lt;/goal&gt; &lt;/goals&gt;
                    &lt;configuration&gt;
                        &lt;sourceDirs&gt;
                            &lt;sourceDir&gt;${project.basedir}/src/test/kotlin&lt;/sourceDir&gt;
                            &lt;sourceDir&gt;${project.basedir}/src/test/java&lt;/sourceDir&gt;
                        &lt;/sourceDirs&gt;
                    &lt;/configuration&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
            &lt;version&gt;3.5.1&lt;/version&gt;
            &lt;executions&gt;
                &lt;!-- 替换会被 maven 特别处理的 default-compile --&gt;
                &lt;execution&gt;
                    &lt;id&gt;default-compile&lt;/id&gt;
                    &lt;phase&gt;none&lt;/phase&gt;
                &lt;/execution&gt;
                &lt;!-- 替换会被 maven 特别处理的 default-testCompile --&gt;
                &lt;execution&gt;
                    &lt;id&gt;default-testCompile&lt;/id&gt;
                    &lt;phase&gt;none&lt;/phase&gt;
                &lt;/execution&gt;
                &lt;execution&gt;
                    &lt;id&gt;java-compile&lt;/id&gt;
                    &lt;phase&gt;compile&lt;/phase&gt;
                    &lt;goals&gt; &lt;goal&gt;compile&lt;/goal&gt; &lt;/goals&gt;
                &lt;/execution&gt;
                &lt;execution&gt;
                    &lt;id&gt;java-test-compile&lt;/id&gt;
                    &lt;phase&gt;test-compile&lt;/phase&gt;
                    &lt;goals&gt; &lt;goal&gt;testCompile&lt;/goal&gt; &lt;/goals&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</code></pre> 
 <h2 id="h2-u589Eu91CFu7F16u8BD1"><a name="增量编译" class="reference-link"></a><span class="header-link octicon octicon-link"></span>增量编译</h2>
 <p>为了使构建更快，可以为 Maven 启用增量编译(从 Kotlin 1.1.2 起支持)。<br>为了做到这一点，需要定义 <code>kotlin.compiler.incremental</code> 属性：</p> 
 <pre><code class="lang-xml">&lt;properties&gt;
    &lt;kotlin.compiler.incremental&gt;true&lt;/kotlin.compiler.incremental&gt;
&lt;/properties&gt;
</code></pre> 
 <p>或者，使用 <code>-Dkotlin.compiler.incremental=true</code> 选项运行构建。</p> 
 <h2 id="h2-u6CE8u89E3u5904u7406"><a name="注解处理" class="reference-link"></a><span class="header-link octicon octicon-link"></span>注解处理</h2>
 <p>请参见 <a target="_blank" href="kapt.html">Kotlin 注解处理工具</a>(<code>kapt</code>)的描述。</p> 
 <h2 id="h2-jar-"><a name="Jar 文件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Jar 文件</h2>
 <p>要创建一个仅包含模块代码的小型 Jar 文件，请在 Maven pom.xml 文件中的 <code>build-&gt;plugins</code> 下面包含以下内容，<br>其中 <code>main.class</code> 定义为一个属性，并指向主 Kotlin 或 Java 类。</p> 
 <pre><code class="lang-xml">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.6&lt;/version&gt;
    &lt;configuration&gt;
        &lt;archive&gt;
            &lt;manifest&gt;
                &lt;addClasspath&gt;true&lt;/addClasspath&gt;
                &lt;mainClass&gt;${main.class}&lt;/mainClass&gt;
            &lt;/manifest&gt;
        &lt;/archive&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre> 
 <h2 id="h2--jar-"><a name="独立的 Jar 文件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>独立的 Jar 文件</h2>
 <p>要创建一个独立的(self-contained)Jar 文件，包含模块中的代码及其依赖项，请在 Maven pom.xml 文件中的 <code>build-&gt;plugins</code> 下面包含以下内容<br>其中 <code>main.class</code> 定义为一个属性，并指向主 Kotlin 或 Java 类。</p> 
 <pre><code class="lang-xml">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.6&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;make-assembly&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt; &lt;goal&gt;single&lt;/goal&gt; &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;archive&gt;
                    &lt;manifest&gt;
                        &lt;mainClass&gt;${main.class}&lt;/mainClass&gt;
                    &lt;/manifest&gt;
                &lt;/archive&gt;
                &lt;descriptorRefs&gt;
                    &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;
                &lt;/descriptorRefs&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre> 
 <p>这个独立的 jar 文件可以直接传给 JRE 来运行应用程序：</p> 
 <pre><code class="lang-bash">java -jar target/mymodule-0.0.1-SNAPSHOT-jar-with-dependencies.jar
</code></pre> 
 <h2 id="h2--javascript"><a name="针对 JavaScript" class="reference-link"></a><span class="header-link octicon octicon-link"></span>针对 JavaScript</h2>
 <p>为了编译 JavaScript 代码，需要使用 <code>js</code> 和 <code>test-js</code> 目标来执行 <code>compile</code>：</p>   
 <pre><code class="lang-xml">&lt;plugin&gt;
    &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
    &lt;artifactId&gt;kotlin-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;${kotlin.version}&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;compile&lt;/id&gt;
            &lt;phase&gt;compile&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;js&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
        &lt;execution&gt;
            &lt;id&gt;test-compile&lt;/id&gt;
            &lt;phase&gt;test-compile&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;test-js&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre> 
 <p>你还需要更改标准库依赖：</p> 
 <pre><code class="lang-xml">&lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
&lt;artifactId&gt;kotlin-stdlib-js&lt;/artifactId&gt;
&lt;version&gt;${kotlin.version}&lt;/version&gt;
</code></pre> 
 <p>对于单元测试支持，你还需要添加对 <code>kotlin-test-js</code> 构件的依赖。</p> 
 <p>更多信息请参阅<a target="_blank" href="/docs/tutorials/javascript/getting-started-maven/getting-started-with-maven.html">以 Maven 入门使用 Kotlin 与 JavaScript</a><br>教程。</p> 
 <h2 id="h2-u6307u5B9Au7F16u8BD1u5668u9009u9879"><a name="指定编译器选项" class="reference-link"></a><span class="header-link octicon octicon-link"></span>指定编译器选项</h2>
 <p>可以将额外的编译器选项指定为 Maven 插件节点的 <code>&lt;configuration&gt;</code> 元素下的标签<br>：</p> 
 <pre><code class="lang-xml">&lt;plugin&gt;
    &lt;artifactId&gt;kotlin-maven-plugin&lt;/artifactId&gt;
    &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
    &lt;version&gt;${kotlin.version}&lt;/version&gt;
    &lt;executions&gt;……&lt;/executions&gt;
    &lt;configuration&gt;
        &lt;nowarn&gt;true&lt;/nowarn&gt;  &lt;!-- 禁用警告 --&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre> 
 <p>许多选项还可以通过属性来配置：</p> 
 <pre><code class="lang-xml">&lt;project ……&gt;
    &lt;properties&gt;
        &lt;kotlin.compiler.languageVersion&gt;1.0&lt;/kotlin.compiler.languageVersion&gt;
    &lt;/properties&gt;
&lt;/project&gt;
</code></pre> 
 <p>支持以下属性：</p> 
 <h3 id="h3-jvm-js-"><a name="JVM 和 JS 的公共属性" class="reference-link"></a><span class="header-link octicon octicon-link"></span>JVM 和 JS 的公共属性</h3>
 <table> 
  <thead> 
   <tr> 
    <th>名称</th> 
    <th>属性名</th> 
    <th>描述</th> 
    <th>可能的值</th> 
    <th>默认值</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>nowarn</td> 
    <td></td> 
    <td>不生成警告</td> 
    <td>true, false</td> 
    <td>false</td> 
   </tr> 
   <tr> 
    <td>languageVersion</td> 
    <td>kotlin.compiler.languageVersion</td> 
    <td>提供与指定语言版本源代码兼容性</td> 
    <td>“1.0”, “1.1”</td> 
    <td>“1.1”</td> 
   </tr> 
   <tr> 
    <td>apiVersion</td> 
    <td>kotlin.compiler.apiVersion</td> 
    <td>只允许使用来自捆绑库的指定版本中的声明</td> 
    <td>“1.0”, “1.1”</td> 
    <td>“1.1”</td> 
   </tr> 
   <tr> 
    <td>sourceDirs</td> 
    <td></td> 
    <td>包含要编译源文件的目录</td> 
    <td></td> 
    <td>该项目源代码根目录</td> 
   </tr> 
   <tr> 
    <td>compilerPlugins</td> 
    <td></td> 
    <td>启用<a target="_blank" href="compiler-plugins.html">编译器插件</a></td> 
    <td></td> 
    <td>[]</td> 
   </tr> 
   <tr> 
    <td>pluginOptions</td> 
    <td></td> 
    <td>编译器插件的选项</td> 
    <td></td> 
    <td>[]</td> 
   </tr> 
   <tr> 
    <td>args</td> 
    <td></td> 
    <td>额外的编译器参数</td> 
    <td></td> 
    <td>[]</td> 
   </tr> 
  </tbody> 
 </table> 
 <h3 id="h3-jvm-"><a name="JVM 特有的属性" class="reference-link"></a><span class="header-link octicon octicon-link"></span>JVM 特有的属性</h3>
 <table> 
  <thead> 
   <tr> 
    <th>名称</th> 
    <th>属性名</th> 
    <th>描述</th> 
    <th>可能的值</th> 
    <th>默认值</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>jvmTarget</td> 
    <td>kotlin.compiler.jvmTarget</td> 
    <td>生成的 JVM 字节码的目标版本</td> 
    <td>“1.6”, “1.8”</td> 
    <td>“1.6”</td> 
   </tr> 
   <tr> 
    <td>jdkHome</td> 
    <td>kotlin.compiler.jdkHome</td> 
    <td>要包含到 classpath 中的 JDK 主目录路径，如果与默认 JAVA_HOME 不同的话</td> 
    <td></td> 
    <td>&nbsp;</td> 
   </tr> 
  </tbody> 
 </table> 
 <h3 id="h3-js-"><a name="JS 特有的属性" class="reference-link"></a><span class="header-link octicon octicon-link"></span>JS 特有的属性</h3>
 <table> 
  <thead> 
   <tr> 
    <th>名称</th> 
    <th>属性名</th> 
    <th>描述</th> 
    <th>可能的值</th> 
    <th>默认值</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>outputFile</td> 
    <td></td> 
    <td>输出文件路径</td> 
    <td></td> 
    <td></td> 
   </tr> 
   <tr> 
    <td>metaInfo</td> 
    <td></td> 
    <td>使用元数据生成 .meta.js 与 .kjsm 文件。用于创建库</td> 
    <td>true, false</td> 
    <td>true</td> 
   </tr> 
   <tr> 
    <td>sourceMap</td> 
    <td></td> 
    <td>生成源代码映射(source map)</td> 
    <td>true, false</td> 
    <td>false</td> 
   </tr> 
   <tr> 
    <td>moduleKind</td> 
    <td></td> 
    <td>编译器生成的模块类型</td> 
    <td>“plain”, “amd”, “commonjs”, “umd”</td> 
    <td>“plain”</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 id="h2-u751Fu6210u6587u6863"><a name="生成文档" class="reference-link"></a><span class="header-link octicon octicon-link"></span>生成文档</h2>
 <p>标准的 JavaDoc 生成插件(<code>maven-javadoc-plugin</code>)不支持 Kotlin 代码。<br>要生成 Kotlin 项目的文档，请使用 <a target="_blank" href="https://github.com/Kotlin/dokka">Dokka</a>；<br>相关配置说明请参见 <a target="_blank" href="https://github.com/Kotlin/dokka/blob/master/README.md#using-the-maven-plugin">Dokka README</a><br>。Dokka 支持混合语言项目，并且可以生成多种格式的输出<br>，包括标准 JavaDoc。</p> 
 <h2 id="h2-osgi"><a name="OSGi" class="reference-link"></a><span class="header-link octicon octicon-link"></span>OSGi</h2>
 <p>对于 OSGi 支持，请参见 <a target="_blank" href="kotlin-osgi.html">Kotlin OSGi 页</a>。</p> 
 <h2 id="h2-u793Au4F8B"><a name="示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>示例</h2>
 <p>一个示例 Maven 项目可以<a target="_blank" href="https://github.com/JetBrains/kotlin-examples/archive/master/maven.zip">从 Github 版本库直接下载</a></p>
 <br>      
</div></body></html>
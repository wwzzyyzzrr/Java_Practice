<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Kotlin使用Ant</h1><div style="width:100%;float:left;" class="article-content">   
 <h2 id="h2--ant-"><a name="获取 Ant 任务" class="reference-link"></a><span class="header-link octicon octicon-link"></span>获取 Ant 任务</h2>
 <p>Kotlin 为 Ant 提供了三个任务：</p> 
 <ul> 
  <li>kotlinc: 针对 JVM 的 Kotlin 编译器</li>
  <li>kotlin2js: 针对 JavaScript 的 Kotlin 编译器</li>
  <li>withKotlin: 使用标准 <em>javac</em> Ant 任务时编译 Kotlin 文件的任务</li>
 </ul> 
 <p>这仨任务在 <em>kotlin-ant.jar</em> 库中定义，该库位于 <a target="_blank" href="{{site.data.releases.latest.url}}">Kotlin 编译器</a>的 <em>lib</em> 文件夹中</p> 
 <h2 id="h2--jvm-kotlin-"><a name="针对 JVM 只用 Kotlin 源代码" class="reference-link"></a><span class="header-link octicon octicon-link"></span>针对 JVM 只用 Kotlin 源代码</h2>
 <p>当项目由 Kotlin 专用源代码组成时，编译项目的最简单方法是使用 <em>kotlinc</em> 任务</p> 
 <pre><code class="lang-xml">&lt;project name="Ant Task Test" default="build"&gt;
    &lt;typedef resource="org/jetbrains/kotlin/ant/antlib.xml" classpath="${kotlin.lib}/kotlin-ant.jar"/&gt;

    &lt;target name="build"&gt;
        &lt;kotlinc src="hello.kt" output="hello.jar"/&gt;
    &lt;/target&gt;
&lt;/project&gt;
</code></pre> 
 <p>其中 ${kotlin.lib} 指向解压缩 Kotlin 独立编译器所在文件夹。</p> 
 <h2 id="h2--jvm-kotlin-"><a name="针对 JVM 只用 Kotlin 源代码且多根" class="reference-link"></a><span class="header-link octicon octicon-link"></span>针对 JVM 只用 Kotlin 源代码且多根</h2>
 <p>如果项目由多个源代码根组成，那么使用 <em>src</em> 作为元素来定义路径</p> 
 <pre><code class="lang-xml">&lt;project name="Ant Task Test" default="build"&gt;
    &lt;typedef resource="org/jetbrains/kotlin/ant/antlib.xml" classpath="${kotlin.lib}/kotlin-ant.jar"/&gt;

    &lt;target name="build"&gt;
        &lt;kotlinc output="hello.jar"&gt;
            &lt;src path="root1"/&gt;
            &lt;src path="root2"/&gt;
        &lt;/kotlinc&gt;
    &lt;/target&gt;
&lt;/project&gt;
</code></pre> 
 <h2 id="h2--jvm-kotlin-java-"><a name="针对 JVM 使用 Kotlin 和 Java 源代码" class="reference-link"></a><span class="header-link octicon octicon-link"></span>针对 JVM 使用 Kotlin 和 Java 源代码</h2>
 <p>如果项目由 Kotlin 和 Java 源代码组成，虽然可以使用 <em>kotlinc</em> 来避免任务参数的重复，但是<br>建议使用 <em>withKotlin</em> 任务</p> 
 <pre><code class="lang-xml">&lt;project name="Ant Task Test" default="build"&gt;
    &lt;typedef resource="org/jetbrains/kotlin/ant/antlib.xml" classpath="${kotlin.lib}/kotlin-ant.jar"/&gt;

    &lt;target name="build"&gt;
        &lt;delete dir="classes" failonerror="false"/&gt;
        &lt;mkdir dir="classes"/&gt;
        &lt;javac destdir="classes" includeAntRuntime="false" srcdir="src"&gt;
            &lt;withKotlin/&gt;
        &lt;/javac&gt;
        &lt;jar destfile="hello.jar"&gt;
            &lt;fileset dir="classes"/&gt;
        &lt;/jar&gt;
    &lt;/target&gt;
&lt;/project&gt;
</code></pre> 
 <p>要为 <code>&lt;withKotlin&gt;</code> 指定额外的命令行参数，可以使用嵌套的 <code>&lt;compilerArg&gt;</code> 参数。<br>当运行 <code>kotlinc -help</code> 时，会显示可以使用的参数的完整列表。<br>还可以将正在编译的模块的名称指定为 <code>moduleName</code> 属性：</p> 
 <pre><code class="lang-xml">&lt;withKotlin moduleName="myModule"&gt;
    &lt;compilerarg value="-no-stdlib"/&gt;
&lt;/withKotlin&gt;
</code></pre> 
 <h2 id="h2--javascript-"><a name="针对 JavaScript 用单个源文件夹" class="reference-link"></a><span class="header-link octicon octicon-link"></span>针对 JavaScript 用单个源文件夹</h2>
 <pre><code class="lang-xml">&lt;project name="Ant Task Test" default="build"&gt;
    &lt;typedef resource="org/jetbrains/kotlin/ant/antlib.xml" classpath="${kotlin.lib}/kotlin-ant.jar"/&gt;

    &lt;target name="build"&gt;
        &lt;kotlin2js src="root1" output="out.js"/&gt;
    &lt;/target&gt;
&lt;/project&gt;
</code></pre> 
 <h2 id="h2--javascript-prefix-postfix-sourcemap-"><a name="针对 JavaScript 用 Prefix、 PostFix 以及 sourcemap 选项" class="reference-link"></a><span class="header-link octicon octicon-link"></span>针对 JavaScript 用 Prefix、 PostFix 以及 sourcemap 选项</h2>
 <pre><code class="lang-xml">&lt;project name="Ant Task Test" default="build"&gt;
    &lt;taskdef resource="org/jetbrains/kotlin/ant/antlib.xml" classpath="${kotlin.lib}/kotlin-ant.jar"/&gt;

    &lt;target name="build"&gt;
        &lt;kotlin2js src="root1" output="out.js" outputPrefix="prefix" outputPostfix="postfix" sourcemap="true"/&gt;
    &lt;/target&gt;
&lt;/project&gt;
</code></pre> 
 <h2 id="h2--javascript-metainfo-"><a name="针对 JavaScript 用单个源文件夹以及 metaInfo 选项" class="reference-link"></a><span class="header-link octicon octicon-link"></span>针对 JavaScript 用单个源文件夹以及 metaInfo 选项</h2>
 <p>如果要将翻译结果作为 Kotlin/JavaScript 库分发，那么 <code>metaInfo</code> 选项会很有用。<br>如果 <code>metaInfo</code> 设置为 <code>true</code>，则在编译期间将创建具有<br>二进制元数据的额外的 JS 文件。该文件应该与翻译<br>结果一起分发。</p>   
 <pre><code class="lang-xml">&lt;project name="Ant Task Test" default="build"&gt;
    &lt;typedef resource="org/jetbrains/kotlin/ant/antlib.xml" classpath="${kotlin.lib}/kotlin-ant.jar"/&gt;

    &lt;target name="build"&gt;
        &lt;!-- 会创建 out.meta.js，其中包含二进制元数据 --&gt;
        &lt;kotlin2js src="root1" output="out.js" metaInfo="true"/&gt;
    &lt;/target&gt;
&lt;/project&gt;
</code></pre> 
 <h2 id="h2-u53C2u8003"><a name="参考" class="reference-link"></a><span class="header-link octicon octicon-link"></span>参考</h2>
 <p>元素和属性的完整列表如下</p> 
 <h3 id="h3-kotlinc-kotlin2js-"><a name="kotlinc 和 kotlin2js 的公共属性" class="reference-link"></a><span class="header-link octicon octicon-link"></span>kotlinc 和 kotlin2js 的公共属性</h3>
 <table> 
  <thead> 
   <tr> 
    <th>名称</th> 
    <th>描述</th> 
    <th>必需</th> 
    <th>默认值</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td><code>src</code></td> 
    <td>要编译的 Kotlin 源文件或目录</td> 
    <td>是</td> 
    <td></td> 
   </tr> 
   <tr> 
    <td><code>nowarn</code></td> 
    <td>禁止所有编译警告</td> 
    <td>否</td> 
    <td>false</td> 
   </tr> 
   <tr> 
    <td><code>noStdlib</code></td> 
    <td>不要将 Kotlin 标准库包含进 classpath</td> 
    <td>否</td> 
    <td>false</td> 
   </tr> 
   <tr> 
    <td><code>failOnError</code></td> 
    <td>在编译期间检测到错误时，会导致构建失败</td> 
    <td>否</td> 
    <td>true</td> 
   </tr> 
  </tbody> 
 </table> 
 <h3 id="h3-kotlinc-"><a name="kotlinc 属性" class="reference-link"></a><span class="header-link octicon octicon-link"></span>kotlinc 属性</h3>
 <table> 
  <thead> 
   <tr> 
    <th>名称</th> 
    <th>描述</th> 
    <th>必需</th> 
    <th>默认值</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td><code>output</code></td> 
    <td>目标目录或 .jar 文件名</td> 
    <td>是</td> 
    <td></td> 
   </tr> 
   <tr> 
    <td><code>classpath</code></td> 
    <td>编译类路径</td> 
    <td>否</td> 
    <td></td> 
   </tr> 
   <tr> 
    <td><code>classpathref</code></td> 
    <td>编译类路径引用</td> 
    <td>否</td> 
    <td></td> 
   </tr> 
   <tr> 
    <td><code>includeRuntime</code></td> 
    <td>Kotlin 运行时库是否包含在 jar 中，如果 <code>output</code> 是 .jar 文件的话</td> 
    <td>否</td> 
    <td>true</td> 
   </tr> 
   <tr> 
    <td><code>moduleName</code></td> 
    <td>编译的模块的名称</td> 
    <td>否</td> 
    <td>目标(如果指定的话)或项目的名称</td> 
   </tr> 
  </tbody> 
 </table> 
 <h3 id="h3-kotlin2js-"><a name="kotlin2js 属性" class="reference-link"></a><span class="header-link octicon octicon-link"></span>kotlin2js 属性</h3>
 <table> 
  <thead> 
   <tr> 
    <th>名称</th> 
    <th>描述</th> 
    <th>必需</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td><code>output</code></td> 
    <td>目标文件</td> 
    <td>是</td> 
   </tr> 
   <tr> 
    <td><code>libraries</code></td> 
    <td>Kotlin 库的路径</td> 
    <td>否</td> 
   </tr> 
   <tr> 
    <td><code>outputPrefix</code></td> 
    <td>生成的 JavaScript 文件所用前缀</td> 
    <td>否</td> 
   </tr> 
   <tr> 
    <td><code>outputSuffix</code></td> 
    <td>生成的 JavaScript 文件所用后缀</td> 
    <td>否</td> 
   </tr> 
   <tr> 
    <td><code>sourcemap</code></td> 
    <td>是否要生成 sourcemap 文件</td> 
    <td>否</td> 
   </tr> 
   <tr> 
    <td><code>metaInfo</code></td> 
    <td>是否要生成具有二进制描述符的元数据文件</td> 
    <td>否</td> 
   </tr> 
   <tr> 
    <td><code>main</code></td> 
    <td>编译器是否生成调用 main 函数的代码</td> 
    <td>否</td> 
   </tr> 
  </tbody> 
 </table>
 <br>      
</div></body></html>
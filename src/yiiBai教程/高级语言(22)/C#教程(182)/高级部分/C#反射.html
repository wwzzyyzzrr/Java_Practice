<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">C#反射</h1><div style="width:100%;float:left;" class="article-content">   
 <p><code>Reflection</code>对象用于在运行时获取类型信息。可以访问正在运行的程序的元数据的类在<code>System.Reflection</code>命名空间中。</p> 
 <p><code>System.Reflection</code>命名空间包含允许获取有关应用程序的信息的类，并向应用程序动态添加类型，值和对象。</p> 
 <p>反射有以下应用：</p> 
 <ul> 
  <li>它允许在运行时查看属性信息。</li>
  <li>它允许检查装配中的各种类型并实例化这些类型。</li>
  <li>它允许后期绑定到方法和属性。</li>
  <li>它允许在运行时创建新的类型，可使用这些类型执行一些任务。</li>
 </ul> 
 <h2 id="h2-u67E5u770Bu5143u6570u636E"><a name="查看元数据" class="reference-link"></a><span class="header-link octicon octicon-link"></span>查看元数据</h2>
 <p>我们在上一章中提到使用反射可以查看属性信息。</p> 
 <p>需要初始化<code>System.Reflection</code>类的<code>MemberInfo</code>对象，以发现与类相关联的属性。可将目标类的对象定义为：</p> 
 <pre><code class="lang-csharp">System.Reflection.MemberInfo info = typeof(MyClass);
</code></pre> 
 <p>以下程序演示如下：</p> 
 <pre><code class="lang-csharp">using System;

[AttributeUsage(AttributeTargets.All)]
public class HelpAttribute : System.Attribute
{
   public readonly string Url;

   public string Topic   // Topic is a named parameter
   {
      get
      {
         return topic;
      }
      set
      {
         topic = value;
      }
   }

   public HelpAttribute(string url)   // url is a positional parameter
   {
      this.Url = url;
   }
   private string topic;
}

[HelpAttribute("Information on the class MyClass")]
class MyClass
{
}
namespace AttributeAppl
{
   class Program
   {
      static void Main(string[] args)
      {
         System.Reflection.MemberInfo info = typeof(MyClass);
         object[] attributes = info.GetCustomAttributes(true);
         for (int i = 0; i &lt; attributes.Length; i++)
         {
            System.Console.WriteLine(attributes[i]);
         }

         Console.ReadKey();
      }
   }
}
</code></pre> 
 <p>当它被编译并运行时，它显示附加到类<code>MyClass</code>的自定义属性的名称：</p> 
 <pre><code class="lang-shell">HelpAttribute
</code></pre> 
 <h2 id="h2-u4F8Bu5B50"><a name="例子" class="reference-link"></a><span class="header-link octicon octicon-link"></span>例子</h2>
 <p>在这个例子中，我们使用上一章创建的<code>DeBugInfo</code>属性，并使用反射来读取<code>Rectangle</code>类中的元数据。</p> 
 <pre><code class="lang-csharp">using System;
using System.Reflection;

namespace BugFixApplication
{
   //a custom attribute BugFix to be
   //assigned to a class and its members
   [AttributeUsage(AttributeTargets.Class |
   AttributeTargets.Constructor |
   AttributeTargets.Field |
   AttributeTargets.Method |
   AttributeTargets.Property,
   AllowMultiple = true)]

   public class DeBugInfo : System.Attribute
   {
      private int bugNo;
      private string developer;
      private string lastReview;
      public string message;

      public DeBugInfo(int bg, string dev, string d)
      {
         this.bugNo = bg;
         this.developer = dev;
         this.lastReview = d;
      }

      public int BugNo
      {
         get
         {
            return bugNo;
         }
      }

      public string Developer
      {
         get
         {
            return developer;
         }
      }

      public string LastReview
      {
         get
         {
            return lastReview;
         }
      }

      public string Message
      {
         get
         {
            return message;
         }
         set
         {
            message = value;
         }
      }
   }
   [DeBugInfo(45, "Sukida", "12/8/2017", Message = "Return type mismatch")]
   [DeBugInfo(49, "Maxsu", "10/10/2017", Message = "Unused variable")]

   class Rectangle
   {
      //member variables
      protected double length;
      protected double width;
      public Rectangle(double l, double w)
      {
         length = l;
         width = w;
      }
      [DeBugInfo(55, "Sukida", "19/10/2017", Message = "Return type mismatch")]
      public double GetArea()
      {
         return length * width;
      }
      [DeBugInfo(56, "Sukida", "19/10/2017")]
      public void Display()
      {
         Console.WriteLine("Length: {0}", length);
         Console.WriteLine("Width: {0}", width);
         Console.WriteLine("Area: {0}", GetArea());
      }
   }//end class Rectangle

   class ExecuteRectangle
   {
      static void Main(string[] args)
      {
         Rectangle r = new Rectangle(14.5, 17.5);
         r.Display();
         Type type = typeof(Rectangle);

         //iterating through the attribtues of the Rectangle class
         foreach (Object attributes in type.GetCustomAttributes(false))
         {
            DeBugInfo dbi = (DeBugInfo)attributes;
            if (null != dbi)
            {
               Console.WriteLine("Bug no: {0}", dbi.BugNo);
               Console.WriteLine("Developer: {0}", dbi.Developer);
               Console.WriteLine("Last Reviewed: {0}", dbi.LastReview);
               Console.WriteLine("Remarks: {0}", dbi.Message);
            }
         }

         //iterating through the method attribtues
         foreach (MethodInfo m in type.GetMethods())
         {
            foreach (Attribute a in m.GetCustomAttributes(true))
            {
               DeBugInfo dbi = (DeBugInfo)a;
               if (null != dbi)
               {
                  Console.WriteLine("Bug no: {0}, for Method: {1}", dbi.BugNo, m.Name);
                  Console.WriteLine("Developer: {0}", dbi.Developer);
                  Console.WriteLine("Last Reviewed: {0}", dbi.LastReview);
                  Console.WriteLine("Remarks: {0}", dbi.Message);
               }
            }
         }

         Console.ReadLine();
      }
   }
}
</code></pre> 
 <p>当上述代码被编译并执行时，它产生以下结果：</p>   
 <pre><code class="lang-shell">Length: 14.5
Width: 17.5
Area: 253.75
Bug no: 45
Developer: Sukida
Last Reviewed: 12/8/2017
Remarks: Return type mismatch
Bug no: 49
Developer: Maxsu
Last Reviewed: 10/10/2017
Remarks: Unused variable
Bug no: 55, for Method: GetArea
Developer: Sukida
Last Reviewed: 19/10/2017
Remarks: Return type mismatch
Bug no: 56, for Method: Display
Developer: Sukida
Last Reviewed: 19/10/2017
Remarks:
</code></pre>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Go超时（timeouts）实例</h1><div style="width:100%;float:left;" class="article-content">   
 <p>超时对于连接到外部资源或在不需要绑定执行时间的程序很重要。在Go编程中由于使用了通道和选择(select),实现超时是容易和优雅的。<br>在这个示例中，假设正在执行一个外部调用，<code>2</code>秒后在通道<code>c1</code>上返回其结果。</p> 
 <p>这里是 <code>select</code> 实现超时。 <code>res：= &lt;-c1</code>等待结果和<code>&lt;-Time</code>。等待在超时<code>1</code>秒后发送一个值。 由于选择继续准备好第一个接收，如果操作超过允许的<code>1</code>秒，则将按超时情况处理。</p> 
 <p>如果允许更长的超时，如：<code>3s</code>，那么从<code>c2</code>的接收将成功，这里将会打印结果。</p> 
 <p>运行此程序显示第一个操作超时和第二个操作超时。</p> 
 <p>使用此选择超时模式需要通过通道传达结果。这是一个好主意，因为其他重要的<code>Go</code>功能是基于渠道和<code>Select</code>。现在看看下面的两个例子：计时器和<code>ticker</code>。</p> 
 <blockquote> 
  <p>所有的示例代码，都放在 <code>F:\worksp\golang</code> 目录下。安装Go编程环境请参考：<a target="_blank" href="http://www.yiibai.com/go/go_environment.html">http://www.yiibai.com/go/go_environment.html</a> </p> 
 </blockquote> 
 <p><code>timeouts.go</code>的完整代码如下所示 -</p> 
 <pre><code class="lang-go">package main

import "time"
import "fmt"

func main() {

    // For our example, suppose we're executing an external
    // call that returns its result on a channel `c1`
    // after 2s.
    c1 := make(chan string, 1)
    go func() {
        time.Sleep(time.Second * 2)
        c1 &lt;- "result 1"
    }()

    // Here's the `select` implementing a timeout.
    // `res := &lt;-c1` awaits the result and `&lt;-Time.After`
    // awaits a value to be sent after the timeout of
    // 1s. Since `select` proceeds with the first
    // receive that's ready, we'll take the timeout case
    // if the operation takes more than the allowed 1s.
    select {
    case res := &lt;-c1:
        fmt.Println(res)
    case &lt;-time.After(time.Second * 1):
        fmt.Println("timeout 1")
    }

    // If we allow a longer timeout of 3s, then the receive
    // from `c2` will succeed and we'll print the result.
    c2 := make(chan string, 1)
    go func() {
        time.Sleep(time.Second * 2)
        c2 &lt;- "result 2"
    }()
    select {
    case res := &lt;-c2:
        fmt.Println(res)
    case &lt;-time.After(time.Second * 3):
        fmt.Println("timeout 2")
    }
}
</code></pre> 
 <p>执行上面代码，将得到以下输出结果 - </p>   
 <pre><code class="lang-go">F:\worksp\golang&gt;go run timeouts.go
timeout 1
result 2
</code></pre>
 <br>      
</div></body></html>
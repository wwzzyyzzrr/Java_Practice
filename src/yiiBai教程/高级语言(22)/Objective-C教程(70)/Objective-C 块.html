<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Objective-C 块</h1><div style="width:100%;float:left;" class="article-content">   
 <p> Objective-C类定义一个对象，结合相关的行为的数据。有时，它是有道理的，只是代表一个任务或单位的行为，而不是一个集合的方法。</p> 
 <p> 块是一个语言级功能补充到 <a target="_blank" href="http://www.yiibai.com/cprogramming">C</a>，Objective-C 和 C++，让你可以创建不同的代码段可以被传递到方法或函数就好像它们是值。块是Objective-C 对象，这意味着它们可以被添加到像NSArray 或NSDictionary中的集合。他们也有能力来捕获值从封闭范围，使他们关闭或其他编程语言中的lambda表达式类似</p> 
 <h2> 简单声明块语法</h2> 
 <pre class="prettyprint prettyprinted" style="font-size: 12px;">
<span class="pln" style="margin: 0px; padding: 0px;">returntype </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(^</span><span class="pln" style="margin: 0px; padding: 0px;">blockName</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">)(</span><span class="pln" style="margin: 0px; padding: 0px;">argumentType</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">);</span></pre> 
 <p> 简单的块的实现</p> 
 <pre class="prettyprint prettyprinted" style="font-size: 12px;">
<span class="pln" style="margin: 0px; padding: 0px;">returntype </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(^</span><span class="pln" style="margin: 0px; padding: 0px;">blockName</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">)(</span><span class="pln" style="margin: 0px; padding: 0px;">argumentType</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">)=</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">^{</span><span class="pln" style="margin: 0px; padding: 0px;">
</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">};</span></pre> 
 <h2> 下面是一个简单的例子</h2> 
 <pre class="prettyprint prettyprinted" style="font-size: 12px;">
<span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">void</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(^</span><span class="pln" style="margin: 0px; padding: 0px;">simpleBlock</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">)(</span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">void</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">)</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">=</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">^{</span><span class="pln" style="margin: 0px; padding: 0px;">
    </span><span class="typ" style="margin: 0px; padding: 0px; color: rgb(127, 0, 85);">NSLog</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(@</span><span class="str" style="margin: 0px; padding: 0px; color: rgb(0, 136, 0);">"This is a block"</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">);</span><span class="pln" style="margin: 0px; padding: 0px;">
</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">};</span></pre> 
 <h2> 我们可以调用块使用</h2> 
 <pre class="prettyprint prettyprinted" style="font-size: 12px;">
<span class="pln" style="margin: 0px; padding: 0px;">simpleBlock</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">();</span></pre> 
 <h2> 块带参数和返回值</h2> 
 <p> 块也就像方法和函数的参数和返回值。</p> 
 <p> 下面是一个简单的例子，实现和调用的参数和返回值的块。</p> 
 <pre class="prettyprint prettyprinted" style="font-size: 12px;">
<span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">double</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(^</span><span class="pln" style="margin: 0px; padding: 0px;">multiplyTwoValues</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">)(</span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">double</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">,</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">double</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">)</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">=</span><span class="pln" style="margin: 0px; padding: 0px;"> 
    </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">^(</span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">double</span><span class="pln" style="margin: 0px; padding: 0px;"> firstValue</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">,</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">double</span><span class="pln" style="margin: 0px; padding: 0px;"> secondValue</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">)</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">{</span><span class="pln" style="margin: 0px; padding: 0px;">
	    </span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">return</span><span class="pln" style="margin: 0px; padding: 0px;"> firstValue </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">*</span><span class="pln" style="margin: 0px; padding: 0px;"> secondValue</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">;</span><span class="pln" style="margin: 0px; padding: 0px;">
    </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">};</span><span class="pln" style="margin: 0px; padding: 0px;">
</span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">double</span><span class="pln" style="margin: 0px; padding: 0px;"> result </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">=</span><span class="pln" style="margin: 0px; padding: 0px;"> multiplyTwoValues</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(</span><span class="lit" style="margin: 0px; padding: 0px; color: rgb(0, 102, 102);">2</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">,</span><span class="lit" style="margin: 0px; padding: 0px; color: rgb(0, 102, 102);">4</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">);</span><span class="pln" style="margin: 0px; padding: 0px;"> 
</span><span class="typ" style="margin: 0px; padding: 0px; color: rgb(127, 0, 85);">NSLog</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(@</span><span class="str" style="margin: 0px; padding: 0px; color: rgb(0, 136, 0);">"The result is %f"</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">,</span><span class="pln" style="margin: 0px; padding: 0px;"> result</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">);</span></pre> 
 <h2> 使用类型定义块</h2> 
 <p> 下面是一个简单的例子，用typedef 在块中。</p> 
 <div style="float:left;margin-bottom: 10px;">  
 </div>
 <div style="float:left;margin-bottom: 10px;">  
 </div>
 <pre class="prettyprint prettyprinted" style="font-size: 12px;">
<span class="com" style="margin: 0px; padding: 0px; color: rgb(136, 0, 0);">#import &lt;Foundation/Foundation.h&gt;</span><span class="pln" style="margin: 0px; padding: 0px;">

</span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">typedef</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">void</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(^</span><span class="typ" style="margin: 0px; padding: 0px; color: rgb(127, 0, 85);">CompletionBlock</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">)();</span><span class="pln" style="margin: 0px; padding: 0px;">
</span><span class="lit" style="margin: 0px; padding: 0px; color: rgb(0, 102, 102);">@interface</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="typ" style="margin: 0px; padding: 0px; color: rgb(127, 0, 85);">SampleClass</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">:</span><span class="typ" style="margin: 0px; padding: 0px; color: rgb(127, 0, 85);">NSObject</span><span class="pln" style="margin: 0px; padding: 0px;">
</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">-</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(</span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">void</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">)</span><span class="pln" style="margin: 0px; padding: 0px;">performActionWithCompletion</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">:(</span><span class="typ" style="margin: 0px; padding: 0px; color: rgb(127, 0, 85);">CompletionBlock</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">)</span><span class="pln" style="margin: 0px; padding: 0px;">completionBlock</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">;</span><span class="pln" style="margin: 0px; padding: 0px;">
</span><span class="lit" style="margin: 0px; padding: 0px; color: rgb(0, 102, 102);">@end</span><span class="pln" style="margin: 0px; padding: 0px;">

</span><span class="lit" style="margin: 0px; padding: 0px; color: rgb(0, 102, 102);">@implementation</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="typ" style="margin: 0px; padding: 0px; color: rgb(127, 0, 85);">SampleClass</span><span class="pln" style="margin: 0px; padding: 0px;">

</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">-</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(</span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">void</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">)</span><span class="pln" style="margin: 0px; padding: 0px;">performActionWithCompletion</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">:(</span><span class="typ" style="margin: 0px; padding: 0px; color: rgb(127, 0, 85);">CompletionBlock</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">)</span><span class="pln" style="margin: 0px; padding: 0px;">completionBlock</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">{</span><span class="pln" style="margin: 0px; padding: 0px;">

    </span><span class="typ" style="margin: 0px; padding: 0px; color: rgb(127, 0, 85);">NSLog</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(@</span><span class="str" style="margin: 0px; padding: 0px; color: rgb(0, 136, 0);">"Action Performed"</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">);</span><span class="pln" style="margin: 0px; padding: 0px;">
    completionBlock</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">();</span><span class="pln" style="margin: 0px; padding: 0px;">
</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">}</span><span class="pln" style="margin: 0px; padding: 0px;">

</span><span class="lit" style="margin: 0px; padding: 0px; color: rgb(0, 102, 102);">@end</span><span class="pln" style="margin: 0px; padding: 0px;">

</span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">int</span><span class="pln" style="margin: 0px; padding: 0px;"> main</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">()</span><span class="pln" style="margin: 0px; padding: 0px;">
</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">{</span><span class="pln" style="margin: 0px; padding: 0px;">
    </span><span class="com" style="margin: 0px; padding: 0px; color: rgb(136, 0, 0);">/* my first program in Objective-C */</span><span class="pln" style="margin: 0px; padding: 0px;">
    </span><span class="typ" style="margin: 0px; padding: 0px; color: rgb(127, 0, 85);">SampleClass</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">*</span><span class="pln" style="margin: 0px; padding: 0px;">sampleClass </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">=</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">[[</span><span class="typ" style="margin: 0px; padding: 0px; color: rgb(127, 0, 85);">SampleClass</span><span class="pln" style="margin: 0px; padding: 0px;"> alloc</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">]</span><span class="pln" style="margin: 0px; padding: 0px;">init</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">];</span><span class="pln" style="margin: 0px; padding: 0px;">
    </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">[</span><span class="pln" style="margin: 0px; padding: 0px;">sampleClass performActionWithCompletion</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">:^{</span><span class="pln" style="margin: 0px; padding: 0px;">
        </span><span class="typ" style="margin: 0px; padding: 0px; color: rgb(127, 0, 85);">NSLog</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(@</span><span class="str" style="margin: 0px; padding: 0px; color: rgb(0, 136, 0);">"Completion is called to intimate action is performed."</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">);</span><span class="pln" style="margin: 0px; padding: 0px;">
    </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">}];</span><span class="pln" style="margin: 0px; padding: 0px;">
    
    </span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">return</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="lit" style="margin: 0px; padding: 0px; color: rgb(0, 102, 102);">0</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">;</span><span class="pln" style="margin: 0px; padding: 0px;">
</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">}</span></pre> 
 <p style="margin: 0.8em 0px 1em; padding: 0px; text-align: justify; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif;"> 让我们编译并执行它，它会产生以下结果：</p>   
 <pre class="result" style="margin-bottom: 0px; background-color: rgb(241, 241, 241); font-size: 12px;">
2013-09-10 08:13:57.155 demo[284:303] Action Performed
2013-09-10 08:13:57.157 demo[284:303] Completion is called to intimate action is performed.
</pre> 
 <p> 块用于多个应用程序在iOS和Mac OS X，因此，它更重要的是了解使用块。</p> 
 <br>      
</div></body></html>
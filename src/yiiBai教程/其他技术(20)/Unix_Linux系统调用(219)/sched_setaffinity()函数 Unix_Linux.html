<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">sched_setaffinity()函数 Unix/Linux</h1><div style="width:100%;float:left;" class="article-content">   
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">sched_setaffinity, sched_getaffinity, CPU_CLR, CPU_ISSET, CPU_SET, CPU_ZERO -&nbsp;</span>设置和获取一个进程的CPU关联掩码 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 内容简介</h1> 
 <table cellpadding="5" cellspacing="5" class="src" style="font-family: verdana, helvetica, arial, sans-serif;  border-color: rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse;  border-color: rgb(170, 170, 170);"> <pre style="font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 0px;">
int sched_setaffinity(pid_t pid, unsigned int cpusetsize, cpu_set_t *mask);

int sched_getaffinity(pid_t pid, unsigned int cpusetsize, cpu_set_t *mask);

void CPU_CLR(int cpu, cpu_set_t *set); int CPU_ISSET(int cpu, cpu_set_t *set); void CPU_SET(int cpu, cpu_set_t *set); void CPU_ZERO(cpu_set_t *set);
<b>#include &lt;sched.h&gt;</b> 
</pre> </td> 
   </tr> 
  </tbody> 
 </table> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 描述</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">A process’s CPU affinity mask determines the set of CPUs on which it is eligible to run. On a multiprocessor system, setting the CPU affinity mask can be used to obtain performance benefits. For example, by dedicating one CPU to a particular process (i.e., setting the affinity mask of that process to specify a single CPU, and setting the affinity mask of all other processes to exclude that CPU), it is possible to ensure maximum execution speed for that process. Restricting a process to run on a single CPU also prevents the performance cost caused by the cache invalidation that occurs when a process ceases to execute on one CPU and then recommences execution on a different CPU.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> A CPU affinity mask is represented by the&nbsp;<i>cpu_set_t</i>&nbsp;structure, a "CPU set", pointed to by&nbsp;<i>mask</i>. Four macros are provided to manipulate CPU sets.&nbsp;<b>CPU_ZERO</b>() clears a set.<b>CPU_SET</b>() and&nbsp;<b>CPU_CLR</b>() respectively add and remove a given CPU from a set.<b>CPU_ISSET</b>() tests to see if a CPU is part of the set; this is useful after<b>sched_getaffinity</b>() returns. The first available CPU on the system corresponds to a&nbsp;<i>cpu</i>value of 0, the next CPU corresponds to a&nbsp;<i>cpu</i>&nbsp;value of 1, and so on. The constant<b>CPU_SETSIZE</b>&nbsp;(1024) specifies a value one greater than the maximum CPU number that can be stored in a CPU set.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> <b>sched_setaffinity</b>() sets the CPU affinity mask of the process whose ID is&nbsp;<i>pid</i>&nbsp;to the value specified by&nbsp;<i>mask</i>. If&nbsp;<i>pid</i>&nbsp;is zero, then the calling process is used. The argument<i>cpusetsize</i>&nbsp;is the length (in bytes) of the data pointed to by&nbsp;<i>mask</i>. Normally this argument would be specified as&nbsp;<i>sizeof(cpu_set_t)</i>.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> If the process specified by&nbsp;<i>pid</i>&nbsp;is not currently running on one of the CPUs specified in<i>mask</i>, then that process is migrated to one of the CPUs specified in&nbsp;<i>mask</i>.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> <b>sched_getaffinity</b>() writes the affinity mask of the process whose ID is&nbsp;<i>pid</i>&nbsp;into the<i>cpu_set_t</i>&nbsp;structure pointed to by&nbsp;<i>mask</i>. The&nbsp;<i>cpusetsize</i>&nbsp;argument specifies the size (in bytes) of&nbsp;<i>mask</i>. If&nbsp;<i>pid</i>&nbsp;is zero, then the mask of the calling process is returned.</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 返回值</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">On success,&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">sched_setaffinity</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">() and&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">sched_getaffinity</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">() return 0. On error, -1 is returned, and&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">errno</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;is set appropriately.</span> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 错误</h1> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EFAULT</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> A supplied memory address was invalid.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EINVAL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> The affinity bitmask&nbsp;<i>mask</i>&nbsp;contains no processors that are physically on the system, or&nbsp;<i>cpusetsize</i>&nbsp;is smaller than the size of the affinity mask used by the kernel.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EPERM</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> The calling process does not have appropriate privileges. The process calling&nbsp;<b>sched_setaffinity</b>() needs an effective user ID equal to the user ID or effective user ID of the process identified by&nbsp;<i>pid</i>, or it must possess the&nbsp;<i>CAP_SYS_NICE</i>&nbsp;capability.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>ESRCH</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> The process whose ID is&nbsp;<i>pid</i>&nbsp;could not be found.</td> 
   </tr> 
  </tbody> 
 </table>   
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 遵循于</h1> 这些系统调用是Linux特有的。 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 注意</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">The affinity mask is actually a per-thread attribute that can be adjusted independently for each of the threads in a thread group. The value returned from a call to&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">gettid</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2) can be passed in the argument&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">pid</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> A child created via&nbsp;<b>fork</b>(2) inherits its parent’s CPU affinity mask. The affinity mask is preserved across an&nbsp;<b>execve</b>(2).</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> This manual page describes the glibc interface for the CPU affinity calls. The actual system call interface is slightly different, with the&nbsp;<i>mask</i>&nbsp;being typed as&nbsp;<i>unsigned long *</i>, reflecting that the fact that the underlying implementation of CPU sets is a simple bitmask. On success, the raw&nbsp;<b>sched_getaffinity</b>() system call returns the size (in bytes) of the&nbsp;<i>cpumask_t</i>&nbsp;data type that is used internally by the kernel to represent the CPU set bitmask.</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> HISTORY</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">The CPU affinity system calls were introduced in Linux kernel 2.5.8. The library interfaces were introduced in glibc 2.3. Initially, the glibc interfaces included a&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">cpusetsize</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;argument. In glibc 2.3.2, the&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">cpusetsize</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;argument was removed, but this argument was restored in glibc 2.3.4.</span> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 另请参阅</h1> 
 <ul style="font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/clone.html" style="color: rgb(144, 11, 9); background-color: transparent;">clone (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/getpriority.html" style="color: rgb(144, 11, 9); background-color: transparent;">getpriority (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/gettid.html" style="color: rgb(144, 11, 9); background-color: transparent;">gettid (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/nice.html" style="color: rgb(144, 11, 9); background-color: transparent;">nice (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/sched_get_priority_max.html" style="color: rgb(144, 11, 9); background-color: transparent;">sched_get_priority_max (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/sched_get_priority_min.html" style="color: rgb(144, 11, 9); background-color: transparent;">sched_get_priority_min (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/sched_getscheduler.html" style="color: rgb(144, 11, 9); background-color: transparent;">sched_getscheduler (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/sched_setscheduler.html" style="color: rgb(144, 11, 9); background-color: transparent;">sched_setscheduler (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/setpriority.html" style="color: rgb(144, 11, 9); background-color: transparent;">setpriority (2)</a></p> </li> 
 </ul> 
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">sched_setscheduler</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2) has a description of the Linux scheduling scheme.&nbsp;</span>
 <br>      
</div></body></html>
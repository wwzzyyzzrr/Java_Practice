<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">mremap()函数 Unix/Linux</h1><div style="width:100%;float:left;" class="article-content">   
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">mremap -&nbsp;</span>重新映射的虚拟内存地址 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 内容简介</h1> 
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">#define _GNU_SOURCE</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;</span>
 <br style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;"> 
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">#include &lt;unistd.h&gt;</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;</span>
 <br style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;"> 
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">#include &lt;sys/mman.h&gt;</b> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> <b>void * mremap(void *</b><i>old_address</i><b>, size_t&nbsp;</b><i>old_size</i>&nbsp;<b>, size_t&nbsp;</b><i>new_size</i><b>, int&nbsp;</b><i>flags</i><b>);</b></p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 描述</h1> 
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">mremap</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">()&nbsp;</span>扩大（或缩小）现有的内存映射，潜在的移动它在同一时间（由flags参数和可用的虚拟地址空间控制）。 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> <i>old_address</i>&nbsp;is the old address of the virtual memory block that you want to expand (or shrink). Note that&nbsp;<i>old_address</i>&nbsp;has to be page aligned.&nbsp;<i>old_size</i>&nbsp;is the old size of the virtual memory block.&nbsp;<i>new_size</i>&nbsp;is the requested size of the virtual memory block after the resize.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> In Linux the memory is divided into pages. A user process has (one or) several linear virtual memory segments. Each virtual memory segment has one or more mappings to real memory pages (in the page table). Each virtual memory segment has its own protection (access rights), which may cause a segmentation violation if the memory is accessed incorrectly (e.g., writing to a read-only segment). Accessing virtual memory outside of the segments will also cause a segmentation violation.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> <b>mremap</b>() uses the Linux page table scheme.&nbsp;<b>mremap</b>() changes the mapping between virtual addresses and memory pages. This can be used to implement a very efficient<b>realloc</b>().</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The&nbsp;<i>flags</i>&nbsp;bit-mask argument may be 0, or include the following flag:</p> 
 <div style="float:left;margin-bottom: 10px;">  
 </div>
 <div style="float:left;margin-bottom: 10px;">  
 </div>
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr valign="top"> 
    <td colspan="2" style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>MREMAP_MAYMOVE</b></td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="6%"> &nbsp;</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> By default, if there is not sufficient space to expand a mapping at its current location, then&nbsp;<b>mremap</b>() fails. If this flag is specified, then the kernel is permitted to relocate the mapping to a new virtual address, if necessary. If the mapping is relocated, then absolute yiibaiers into the old mapping location become invalid (offsets relative to the starting address of the mapping should be employed).</td> 
   </tr> 
   <tr valign="top"> 
    <td colspan="2" style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>MREMAP_FIXED</b>&nbsp;(since Linux 2.3.31)</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="6%"> &nbsp;</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> This flag serves a similar purpose to the&nbsp;<b>MAP_FIXED</b>&nbsp;flag of<b>mmap</b>(2). If this flag is specified, then&nbsp;<b>mremap</b>() accepts a fifth argument,&nbsp;<i>void *new_address</i>, which specifies a page-aligned address to which the mapping must be moved. Any previous mapping at the address range specified by&nbsp;<i>new_address</i>&nbsp;and<i>new_size</i>&nbsp;is unmapped. If&nbsp;<b>MREMAP_FIXED</b>&nbsp;is specified, then<b>MREMAP_MAYMOVE</b>&nbsp;must also be specified.</td> 
   </tr> 
  </tbody> 
 </table> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">If the memory segment specified by&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">old_address</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;and&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">old_size</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;is locked (using&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">mlock</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">() or similar), then this lock is maintained when the segment is resized and/or relocated. As a consequence, the amount of memory locked by the process may change.</span> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 返回值</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">On success&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">mremap</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">() returns a yiibaier to the new virtual memory area. On error, the value&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">MAP_FAILED</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;(that is, (void *) -1) is returned, and&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">errno</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;is set appropriately.</span> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 错误</h1> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EAGAIN</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> The caller tried to expand a memory segment that is locked, but this was not possible without exceeding the RLIMIT_MEMLOCK resource limit.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EFAULT</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> "Segmentation fault." Some address in the range&nbsp;<i>old_address</i>&nbsp;to<i>old_address</i>+<i>old_size</i>&nbsp;is an invalid virtual memory address for this process. You can also get EFAULT even if there exist mappings that cover the whole address space requested, but those mappings are of different types.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EINVAL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> An invalid argument was given. Possible causes are:&nbsp;<i>old_address</i>was not page aligned; a value other than&nbsp;<b>MREMAP_MAYMOVE</b>or&nbsp;<b>MREMAP_FIXED</b>&nbsp;was specified in&nbsp;<i>flags</i>;&nbsp;<i>new_size</i>&nbsp;was zero;<i>new_size</i>&nbsp;or&nbsp;<i>new_address</i>&nbsp;was invalid; or the new address range specified by&nbsp;<i>new_address</i>&nbsp;and&nbsp;<i>new_size</i>&nbsp;overlapped the old address range specified by&nbsp;<i>old_address</i>&nbsp;and&nbsp;<i>old_size</i>; or<b>MREMAP_FIXED</b>&nbsp;was specified without also specifying<b>MREMAP_MAYMOVE</b>.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>ENOMEM</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> The memory area cannot be expanded at the current virtual address, and the&nbsp;<b>MREMAP_MAYMOVE</b>&nbsp;flag is not set in&nbsp;<i>flags</i>. Or, there is not enough (virtual) memory available.</td> 
   </tr> 
  </tbody> 
 </table>   
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 注意</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">Prior to version 2.4, glibc did not expose the definition of&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">MREMAP_FIXED</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">, and the prototype for&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">mremap</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">() did not allow for the&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">new_address</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;argument.</span> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 遵循于</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">This call is Linux-specific, and should not be used in programs intended to be portable. 4.2BSD had a (never actually implemented)&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">mremap</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2) call with completely different semantics.</span> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 另请参阅</h1> 
 <ul style="font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/brk.html" style="color: rgb(144, 11, 9); background-color: transparent;">brk (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/getpagesize.html" style="color: rgb(144, 11, 9); background-color: transparent;">getpagesize (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/getrlimit.html" style="color: rgb(144, 11, 9); background-color: transparent;">getrlimit (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/mlock.html" style="color: rgb(144, 11, 9); background-color: transparent;">mlock (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/mmap.html" style="color: rgb(144, 11, 9); background-color: transparent;">mmap (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/sbrk.html" style="color: rgb(144, 11, 9); background-color: transparent;">sbrk (2)</a></p> </li> 
 </ul> 你最喜欢的操作系统课本上分页内存的详细信息。 （现代操作系统由Andrew S.坦南鲍姆，里面的Linux由兰道夫Bentson，UNIX操作系统的莫里斯J.巴赫的设计。）
 <br>      
</div></body></html>
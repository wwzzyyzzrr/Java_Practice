<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">clone()函数 Unix/Linux</h1><div style="width:100%;float:left;" class="article-content">   
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> clone, __clone2 - 创建一个子进程</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 内容简介</h1> 
 <pre style="font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 0px;">
#include 
  <sched.h>
    

int clone(int (*fn)(void *), void *child_stack, 
          int flags, void *arg, ...   
          /* pid_t *pid, struct user_desc *tls 
", pid_t *" ctid " */ );"



int __clone2(int (*fn)(void *),  void *child_stack_base, 
             size_t stack_size, int flags, void *arg, ... 
             /* pid_t *pid, struct user_desc *tls 
", pid_t *" ctid " */ );"

   <b>#include &lt;sched.h&gt;</b> 

  </sched.h></pre> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 描述</h1> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> <b>clone</b>() creates a new process, in a manner similar to&nbsp;<b>fork</b>(2). It is actually a library function layered on top of the underlying&nbsp;<b>clone</b>() system call, hereinafter referred to as<b>sys_clone</b>. A description of&nbsp;<b>sys_clone</b>&nbsp;is given towards the end of this page.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Unlike&nbsp;<b>fork</b>(2), these calls allow the child process to share parts of its execution context with the calling process, such as the memory space, the table of file descriptors, and the table of signal handlers. (Note that on this manual page, "calling process" normally corresponds to "parent process". But see the description of&nbsp;<b>CLONE_PARENT</b>&nbsp;below.)</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The main use of&nbsp;<b>clone</b>() is to implement threads: multiple threads of control in a program that run concurrently in a shared memory space.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> When the child process is created with&nbsp;<b>clone</b>(), it executes the function application<i>fn</i>(<i>arg</i>). (This differs from&nbsp;<b>fork</b>(2), where execution continues in the child from the point of the&nbsp;<b>fork</b>(2) call.) The&nbsp;<i>fn</i>&nbsp;argument is a pointer to a function that is called by the child process at the beginning of its execution. The&nbsp;<i>arg</i>&nbsp;argument is passed to the&nbsp;<i>fn</i>&nbsp;function.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> When the&nbsp;<i>fn</i>(<i>arg</i>) function application returns, the child process terminates. The integer returned by&nbsp;<i>fn</i>&nbsp;is the exit code for the child process. The child process may also terminate explicitly by calling&nbsp;<b>exit</b>(2) or after receiving a fatal signal.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The&nbsp;<i>child_stack</i>&nbsp;argument specifies the location of the stack used by the child process. Since the child and calling process may share memory, it is not possible for the child process to execute in the same stack as the calling process. The calling process must therefore set up memory space for the child stack and pass a pointer to this space to<b>clone</b>(). Stacks grow downwards on all processors that run Linux (except the HP PA processors), so&nbsp;<i>child_stack</i>&nbsp;usually points to the topmost address of the memory space set up for the child stack.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The low byte of&nbsp;<i>flags</i>&nbsp;contains the number of the&nbsp;<i>termination signal</i>&nbsp;sent to the parent when the child dies. If this signal is specified as anything other than&nbsp;<b>SIGCHLD</b>, then the parent process must specify the&nbsp;<b>__WALL</b>&nbsp;or&nbsp;<b>__WCLONE</b>&nbsp;options when waiting for the child with&nbsp;<b>wait</b>(2). If no signal is specified, then the parent process is not signaled when the child terminates.</p> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> <i>flags</i>&nbsp;may also be bitwise-or’ed with zero or more of the following constants, in order to specify what is shared between the calling process and the child process:</p> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_PARENT</b>&nbsp;(since Linux 2.3.12)</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> If&nbsp;<b>CLONE_PARENT</b>&nbsp;is set, then the parent of the new child (as returned by&nbsp;<b>getppid</b>(2)) will be the same as that of the calling process. <p style="text-align: justify;"> If&nbsp;<b>CLONE_PARENT</b>&nbsp;is not set, then (as with&nbsp;<b>fork</b>(2)) the child’s parent is the calling process.</p> <p style="text-align: justify;"> Note that it is the parent process, as returned by<b>getppid</b>(2), which is signaled when the child terminates, so that if&nbsp;<b>CLONE_PARENT</b>&nbsp;is set, then the parent of the calling process, rather than the calling process itself, will be signaled.</p> </td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_FS</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> If&nbsp;<b>CLONE_FS</b>&nbsp;is set, the caller and the child processes share the same file system information. This includes the root of the file system, the current working directory, and the umask. Any call to&nbsp;<b>chroot</b>(2),&nbsp;<b>chdir</b>(2), or&nbsp;<b>umask</b>(2) performed by the calling process or the child process also affects the other process. <p style="text-align: justify;"> If&nbsp;<b>CLONE_FS</b>&nbsp;is not set, the child process works on a copy of the file system information of the calling process at the time of the&nbsp;<b>clone</b>() call. Calls to&nbsp;<b>chroot</b>(2),<b>chdir</b>(2),&nbsp;<b>umask</b>(2) performed later by one of the processes do not affect the other process.</p> </td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_FILES</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> If&nbsp;<b>CLONE_FILES</b>&nbsp;is set, the calling process and the child processes share the same file descriptor table. Any file descriptor created by the calling process or by the child process is also valid in the other process. Similarly, if one of the processes closes a file descriptor, or changes its associated flags (using the&nbsp;<b>fcntl</b>(2)&nbsp;<b>F_SETFD</b>&nbsp;operation), the other process is also affected. <p style="text-align: justify;"> If&nbsp;<b>CLONE_FILES</b>&nbsp;is not set, the child process inherits a copy of all file descriptors opened in the calling process at the time of&nbsp;<b>clone</b>(). (The duplicated file descriptors in the child refer to the same open file descriptions (see<b>open</b>(2)) as the corresponding file descriptors in the calling process.) Subsequent operations that open or close file descriptors, or change file descriptor flags, performed by either the calling process or the child process do not affect the other process.</p> </td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_NEWNS</b>&nbsp;(since Linux 2.4.19)</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Start the child in a new namespace. <p style="text-align: justify;"> Every process lives in a namespace. The&nbsp;<i>namespace</i>&nbsp;of a process is the data (the set of mounts) describing the file hierarchy as seen by that process. After a&nbsp;<b>fork</b>(2) or<b>clone</b>(2) where the&nbsp;<b>CLONE_NEWNS</b>&nbsp;flag is not set, the child lives in the same namespace as the parent. The system calls&nbsp;<b>mount</b>(2) and&nbsp;<b>umount</b>(2) change the namespace of the calling process, and hence affect all processes that live in the same namespace, but do not affect processes in a different namespace.</p> <p style="text-align: justify;"> After a&nbsp;<b>clone</b>(2) where the&nbsp;<b>CLONE_NEWNS</b>&nbsp;flag is set, the cloned child is started in a new namespace, initialized with a copy of the namespace of the parent.</p> <p style="text-align: justify;"> Only a privileged process (one having the CAP_SYS_ADMIN capability) may specify the<b>CLONE_NEWNS</b>&nbsp;flag. It is not permitted to specify both<b>CLONE_NEWNS</b>&nbsp;and&nbsp;<b>CLONE_FS</b>&nbsp;in the same&nbsp;<b>clone</b>() call.</p> </td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_SIGHAND</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> If&nbsp;<b>CLONE_SIGHAND</b>&nbsp;is set, the calling process and the child processes share the same table of signal handlers. If the calling process or child process calls&nbsp;<b>sigaction</b>(2) to change the behavior associated with a signal, the behavior is changed in the other process as well. However, the calling process and child processes still have distinct signal masks and sets of pending signals. So, one of them may block or unblock some signals using<b>sigprocmask</b>(2) without affecting the other process. <p style="text-align: justify;"> If&nbsp;<b>CLONE_SIGHAND</b>&nbsp;is not set, the child process inherits a copy of the signal handlers of the calling process at the time&nbsp;<b>clone</b>() is called. Calls to&nbsp;<b>sigaction</b>(2) performed later by one of the processes have no effect on the other process.</p> <p style="text-align: justify;"> Since Linux 2.6.0-test6,&nbsp;<i>flags</i>&nbsp;must also include<b>CLONE_VM</b>&nbsp;if&nbsp;<b>CLONE_SIGHAND</b>&nbsp;is specified</p> </td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_PTRACE</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> If&nbsp;<b>CLONE_PTRACE</b>&nbsp;is specified, and the calling process is being traced, then trace the child also (see&nbsp;<b>ptrace</b>(2)).</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_UNTRACED</b>&nbsp;(since Linux 2.5.46)</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> If&nbsp;<b>CLONE_UNTRACED</b>&nbsp;is specified, then a tracing process cannot force&nbsp;<b>CLONE_PTRACE</b>&nbsp;on this child process.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_STOPPED</b>&nbsp;(since Linux 2.6.0-test2)</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> If&nbsp;<b>CLONE_STOPPED</b>&nbsp;is set, then the child is initially stopped (as though it was sent a&nbsp;<b>SIGSTOP</b>&nbsp;signal), and must be resumed by sending it a&nbsp;<b>SIGCONT</b>&nbsp;signal.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_VFORK</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> If&nbsp;<b>CLONE_VFORK</b>&nbsp;is set, the execution of the calling process is suspended until the child releases its virtual memory resources via a call to&nbsp;<b>execve</b>(2) or&nbsp;<b>_exit</b>(2) (as with&nbsp;<b>vfork</b>(2)). <p style="text-align: justify;"> If&nbsp;<b>CLONE_VFORK</b>&nbsp;is not set then both the calling process and the child are schedulable after the call, and an application should not rely on execution occurring in any particular order.</p> </td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_VM</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> If&nbsp;<b>CLONE_VM</b>&nbsp;is set, the calling process and the child processes run in the same memory space. In particular, memory writes performed by the calling process or by the child process are also visible in the other process. Moreover, any memory mapping or unmapping performed with&nbsp;<b>mmap</b>(2) or&nbsp;<b>munmap</b>(2) by the child or calling process also affects the other process. <p style="text-align: justify;"> If&nbsp;<b>CLONE_VM</b>&nbsp;is not set, the child process runs in a separate copy of the memory space of the calling process at the time of&nbsp;<b>clone</b>(). Memory writes or file mappings/unmappings performed by one of the processes do not affect the other, as with&nbsp;<b>fork</b>(2).</p> </td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_PID</b>&nbsp;(obsolete)</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> If&nbsp;<b>CLONE_PID</b>&nbsp;is set, the child process is created with the same process ID as the calling process. This is good for hacking the system, but otherwise of not much use. Since 2.3.21 this flag can be specified only by the system boot process (PID 0). It disappeared in Linux 2.5.16.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_THREAD</b>&nbsp;(since Linux 2.4.0-test8)</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> If&nbsp;<b>CLONE_THREAD</b>&nbsp;is set, the child is placed in the same thread group as the calling process. To make the remainder of the discussion of&nbsp;<b>CLONE_THREAD</b>&nbsp;more readable, the term "thread" is used to refer to the processes within a thread group. <p style="text-align: justify;"> Thread groups were a feature added in Linux 2.4 to support the POSIX threads notion of a set of threads that share a single PID. Internally, this shared PID is the so-called thread group identifier (TGID) for the thread group. Since Linux 2.4, calls to&nbsp;<b>getpid</b>(2) return the TGID of the caller.</p> <p style="text-align: justify;"> The threads within a group can be distinguished by their (system-wide) unique thread IDs (TID). A new thread’s TID is available as the function result returned to the caller of&nbsp;<b>clone</b>(), and a thread can obtain its own TID using&nbsp;<b>gettid</b>(2).</p> <p style="text-align: justify;"> When a call is made to&nbsp;<b>clone</b>() without specifying<b>CLONE_THREAD</b>, then the resulting thread is placed in a new thread group whose TGID is the same as the thread’s TID. This thread is the&nbsp;<i>leader</i>&nbsp;of the new thread group.</p> <p style="text-align: justify;"> A new thread created with&nbsp;<b>CLONE_THREAD</b>&nbsp;has the same parent process as the caller of&nbsp;<b>clone</b>() (i.e., like<b>CLONE_PARENT</b>), so that calls to&nbsp;<b>getppid</b>(2) return the same value for all of the threads in a thread group. When a&nbsp;<b>CLONE_THREAD</b>&nbsp;thread terminates, the thread that created it using&nbsp;<b>clone</b>() is not sent a&nbsp;<b>SIGCHLD</b>&nbsp;(or other termination) signal; nor can the status of such a thread be obtained using&nbsp;<b>wait</b>(2). (The thread is said to be&nbsp;<i>detached</i>.)</p> <p style="text-align: justify;"> After all of the threads in a thread group terminate the parent process of the thread group is sent a&nbsp;<b>SIGCHLD</b>(or other termination) signal.</p> <p style="text-align: justify;"> If any of the threads in a thread group performs an<b>execve</b>(2), then all threads other than the thread group leader are terminated, and the new program is executed in the thread group leader.</p> <p style="text-align: justify;"> If one of the threads in a thread group creates a child using&nbsp;<b>fork</b>(2), then any thread in the group can&nbsp;<b>wait</b>(2) for that child.</p> <p style="text-align: justify;"> Since Linux 2.5.35,&nbsp;<i>flags</i>&nbsp;must also include<b>CLONE_SIGHAND</b>&nbsp;if&nbsp;<b>CLONE_THREAD</b>&nbsp;is specified.</p> <p style="text-align: justify;"> Signals may be sent to a thread group as a whole (i.e., a TGID) using&nbsp;<b>kill</b>(2), or to a specific thread (i.e., TID) using<b>tgkill</b>(2).</p> <p style="text-align: justify;"> Signal dispositions and actions are process-wide: if an unhandled signal is delivered to a thread, then it will affect (terminate, stop, continue, be ignored in) all members of the thread group.</p> <p style="text-align: justify;"> Each thread has its own signal mask, as set by<b>sigprocmask</b>(2), but signals can be pending either: for the whole process (i.e., deliverable to any member of the thread group), when sent with&nbsp;<b>kill</b>(2); or for an individual thread, when sent with&nbsp;<b>tgkill</b>(2). A call to<b>sigpending</b>(2) returns a signal set that is the union of the signals pending for the whole process and the signals that are pending for the calling thread.</p> <p style="text-align: justify;"> If&nbsp;<b>kill</b>(2) is used to send a signal to a thread group, and the thread group has installed a handler for the signal, then the handler will be invoked in exactly one, arbitrarily selected member of the thread group that has not blocked the signal. If multiple threads in a group are waiting to accept the same signal using&nbsp;<b>sigwaitinfo</b>(2), the kernel will arbitrarily select one of these threads to receive a signal sent using&nbsp;<b>kill</b>(2).</p> </td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_SYSVSEM</b>&nbsp;(since Linux 2.5.10)</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> If&nbsp;<b>CLONE_SYSVSEM</b>&nbsp;is set, then the child and the calling process share a single list of System V semaphore undo values (see&nbsp;<b>semop</b>(2)). If this flag is not set, then the child has a separate undo list, which is initially empty.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_SETTLS</b>&nbsp;(since Linux 2.5.32)</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> The&nbsp;<i>newtls</i>&nbsp;parameter is the new TLS (Thread Local Storage) descriptor. (See&nbsp;<b>set_thread_area</b>(2).)</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_PARENT_SETTID</b>(since Linux 2.5.49)</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Store child thread ID at location&nbsp;<i>parent_tidptr</i>&nbsp;in parent and child memory. (In Linux 2.5.32-2.5.48 there was a flag CLONE_SETTID that did this.)</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_CHILD_SETTID</b>(since Linux 2.5.49)</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Store child thread ID at location&nbsp;<i>child_tidptr</i>&nbsp;in child memory.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>CLONE_CHILD_CLEARTID</b>(since Linux 2.5.49)</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Erase child thread ID at location&nbsp;<i>child_tidptr</i>&nbsp;in child memory when the child exits, and do a wakeup on the futex at that address. The address involved may be changed by the&nbsp;<b>set_tid_address</b>(2) system call. This is used by threading libraries.</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> <i>sys_clone</i></h2> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">The&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">sys_clone</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;system call corresponds more closely to&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">fork</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2) in that execution in the child continues from the point of the call. Thus,&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">sys_clone</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;only requires the&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">flags</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;and</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">child_stack</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;arguments, which have the same meaning as for&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">clone</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(). (Note that the order of these arguments differs from&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">clone</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">().)</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Another difference for&nbsp;<b>sys_clone</b>&nbsp;is that the&nbsp;<i>child_stack</i>&nbsp;argument may be zero, in which case copy-on-write semantics ensure that the child gets separate copies of stack pages when either process modifies the stack. In this case, for correct operation, the<b>CLONE_VM</b>&nbsp;option should not be specified.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Since Linux 2.5.49 the system call has five parameters. The two new parameters are<i>parent_tidptr</i>&nbsp;which points to the location (in parent and child memory) where the child thread ID will be written in case CLONE_PARENT_SETTID was specified, and&nbsp;<i>child_tidptr</i>which points to the location (in child memory) where the child thread ID will be written in case CLONE_CHILD_SETTID was specified.</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 返回值</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">On success, the thread ID of the child process is returned in the caller’s thread of execution. On failure, a -1 will be returned in the caller’s context, no child process will be created, and&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">errno</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;will be set appropriately.</span> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 错误</h1> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EAGAIN</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Too many processes are already running.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EINVAL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> <b>CLONE_SIGHAND</b>&nbsp;was specified, but&nbsp;<b>CLONE_VM</b>&nbsp;was not. (Since Linux 2.6.0-test6.)</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EINVAL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> <b>CLONE_THREAD</b>&nbsp;was specified, but&nbsp;<b>CLONE_SIGHAND</b>&nbsp;was not. (Since Linux 2.5.35.)</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EINVAL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Both&nbsp;<b>CLONE_FS</b>&nbsp;and&nbsp;<b>CLONE_NEWNS</b>&nbsp;were specified in&nbsp;<i>flags</i>.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EINVAL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Returned by&nbsp;<b>clone</b>() when a zero value is specified for<i>child_stack</i>.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>ENOMEM</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Cannot allocate sufficient memory to allocate a task structure for the child, or to copy those parts of the caller’s context that need to be copied.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EPERM</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> <b>CLONE_NEWNS</b>&nbsp;was specified by a non-root process (process without CAP_SYS_ADMIN).</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EPERM</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> <b>CLONE_PID</b>&nbsp;was specified by a process other than process 0.</td> 
   </tr> 
  </tbody> 
 </table> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> VERSIONS</h1> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> There is no entry for&nbsp;<b>clone</b>() in libc5. glibc2 provides&nbsp;<b>clone</b>() as described in this manual page.</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 遵循于</h1> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The&nbsp;<b>clone</b>() and&nbsp;<b>sys_clone</b>&nbsp;calls are Linux specific and should not be used in programs intended to be portable.</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 注意</h1> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> In the kernel 2.4.x series,&nbsp;<b>CLONE_THREAD</b>&nbsp;generally does not make the parent of the new thread the same as the parent of the calling process. However, for kernel versions 2.4.7 to 2.4.18 the&nbsp;<b>CLONE_THREAD</b>&nbsp;flag implied the&nbsp;<b>CLONE_PARENT</b>&nbsp;flag (as in kernel 2.6).</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> For a while there was&nbsp;<b>CLONE_DETACHED</b>&nbsp;(introduced in 2.5.32): parent wants no child-exit signal. In 2.6.2 the need to give this together with&nbsp;<b>CLONE_THREAD</b>disappeared. This flag is still defined, but has no effect. On x86,&nbsp;<b>clone</b>() should not be called through vsyscall, but directly through&nbsp;<i>int $0x80</i>. On IA-64, a different system call is used:</p>   
 <pre style="font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 0px;">
int __clone2(int (*fn)(void *),  void *child_stack_base, 
             size_t stack_size, int flags, void *arg, ... 
             /* pid_t *pid, struct user_desc *tls 
", pid_t *" ctid " */ );"
</pre> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The&nbsp;<b>__clone2</b>() system call operates in the same way as&nbsp;<b>clone</b>(), except that<i>child_stack_base</i>&nbsp;points to the lowest address of the child’s stack area, and&nbsp;<i>stack_size</i>specifies the size of the stack pointed to by&nbsp;<i>child_stack_base</i>.</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> BUGS</h1> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Versions of the GNU C library that include the NPTL threading library contain a wrapper function for&nbsp;<b>getpid</b>(2) that performs caching of PIDs. In programs linked against such libraries, calls to&nbsp;<b>getpid</b>(2) may return the same value, even when the threads were not created using&nbsp;<b>CLONE_THREAD</b>&nbsp;(and thus are not in the same thread group). To get the truth, it may be necessary to use code such as the following</p> 
 <pre style="font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 0px;">
#include &lt;syscall.h&gt;

pid_t mypid;

mypid = syscall(SYS_getpid);
</pre> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 另请参阅</h1> 
 <ul style="font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/fork.html" style="color: rgb(144, 11, 9); background-color: transparent;">fork (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/futex.html" style="color: rgb(144, 11, 9); background-color: transparent;">futex (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/getpid.html" style="color: rgb(144, 11, 9); background-color: transparent;">getpid (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/gettid.html" style="color: rgb(144, 11, 9); background-color: transparent;">gettid (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/set_thread_area.html" style="color: rgb(144, 11, 9); background-color: transparent;">set_thread_area (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/set_tid_address.html" style="color: rgb(144, 11, 9); background-color: transparent;">set_tid_address (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/tkill.html" style="color: rgb(144, 11, 9); background-color: transparent;">tkill (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/unshare.html" style="color: rgb(144, 11, 9); background-color: transparent;">unshare (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/wait.html" style="color: rgb(144, 11, 9); background-color: transparent;">wait (2)</a></p> </li> 
 </ul> 
 <br>      
</div></body></html>
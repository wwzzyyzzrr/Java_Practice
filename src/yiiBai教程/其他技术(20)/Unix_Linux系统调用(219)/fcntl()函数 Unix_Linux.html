<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">fcntl()函数 Unix/Linux</h1><div style="width:100%;float:left;" class="article-content">   
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> fcntl - 操作文件描述符</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 内容简介</h1> 
 <pre style="font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 0px;">
<b>#include &lt;unistd.h&gt;</b> 
<b>#include &lt;fcntl.h&gt;</b> 

<b>int fcntl(int </b><i>fd</i><b>, int </b><i>cmd</i><b>);</b> <b>int fcntl(int </b><i>fd</i><b>, int </b><i>cmd</i><b>, long </b><i>arg</i><b>);</b> <b>int fcntl(int </b><i>fd</i><b>, int </b><i>cmd</i><b>, struct flock *</b><i>lock</i><b>);</b></pre> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 描述</h1> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> <b>fcntl</b>()&nbsp;<span style="color: rgb(34, 34, 34); font-family: Arial, Verdana, sans-serif;">执行下述就开文件描述符fd的操作之一。该操作是由 cmd 确定。</span></p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 复制一个文件描述符</h2> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_DUPFD</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Find the lowest numbered available file descriptor greater than or equal to&nbsp;<i>arg</i>&nbsp;and make it be a copy of&nbsp;<i>fd</i>. This is different from<b>dup2</b>(2) which uses exactly the descriptor specified. <p style="text-align: justify;"> On success, the new descriptor is returned.</p> <p style="text-align: justify;"> See&nbsp;<b>dup</b>(2) for further details.</p> </td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 文件描述符标志</h2> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The following commands manipulate the flags associated with a file descriptor. Currently, only one such flag is defined:&nbsp;<b>FD_CLOEXEC</b>, the close-on-exec flag. If the<b>FD_CLOEXEC</b>&nbsp;bit is 0, the file descriptor will remain open across an&nbsp;<b>execve</b>(2), otherwise it will be closed.</p> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_GETFD</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Read the file descriptor flags.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_SETFD</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Set the file descriptor flags to the value specified by&nbsp;<i>arg</i>.</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 文件状态标志</h2> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Each open file description has certain associated status flags, initialized by&nbsp;<b>open</b>(2) and possibly modified by&nbsp;<b>fcntl</b>(2). Duplicated file descriptors (made with&nbsp;<b>dup</b>(),<b>fcntl</b>(F_DUPFD),&nbsp;<b>fork</b>(), etc.) refer to the same open file description, and thus share the same file status flags.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The file status flags and their semantics are described in&nbsp;<b>open</b>(2).</p> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_GETFL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Read the file status flags.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_SETFL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Set the file status flags to the value specified by&nbsp;<i>arg</i>. File access mode (<b>O_RDONLY</b>,&nbsp;<b>O_WRONLY</b>,&nbsp;<b>O_RDWR</b>) and file creation flags (i.e.,&nbsp;<b>O_CREAT</b>,&nbsp;<b>O_EXCL</b>,&nbsp;<b>O_NOCTTY</b>,&nbsp;<b>O_TRUNC</b>) in&nbsp;<i>arg</i>are ignored. On Linux this command can only change the<b>O_APPEND</b>,&nbsp;<b>O_ASYNC</b>,&nbsp;<b>O_DIRECT</b>,&nbsp;<b>O_NOATIME</b>, and<b>O_NONBLOCK</b>&nbsp;flags.</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 咨询锁</h2> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> <b>F_GETLK</b>,&nbsp;<b>F_SETLK</b>&nbsp;and&nbsp;<b>F_SETLKW</b>&nbsp;are used to acquire, release, and test for the existence of record locks (also known as file-segment or file-region locks). The third argument&nbsp;<i>lock</i>&nbsp;is a pointer to a structure that has at least the following fields (in unspecified order).</p> 
 <pre style="font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 0px;">
struct flock {
    ...
    short l_type;    /* Type of lock: F_RDLCK,
                        F_WRLCK, F_UNLCK */
    short l_whence;  /* How to interpret l_start:
                        SEEK_SET, SEEK_CUR, SEEK_END */
    off_t l_start;   /* Starting offset for lock */
    off_t l_len;     /* Number of bytes to lock */
    pid_t l_pid;     /* PID of process blocking our lock
                        (F_GETLK only) */
    ...
};
</pre> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The&nbsp;<i>l_whence</i>,&nbsp;<i>l_start</i>, and&nbsp;<i>l_len</i>&nbsp;fields of this structure specify the range of bytes we wish to lock.&nbsp;<i>l_start</i>&nbsp;is the starting offset for the lock, and is interpreted relative to either: the start of the file (if&nbsp;<i>l_whence</i>&nbsp;is&nbsp;<b>SEEK_SET</b>); the current file offset (if&nbsp;<i>l_whence</i>is&nbsp;<b>SEEK_CUR</b>); or the end of the file (if&nbsp;<i>l_whence</i>&nbsp;is&nbsp;<b>SEEK_END</b>). In the final two cases,<i>l_start</i>&nbsp;can be a negative number provided the offset does not lie before the start of the file.&nbsp;<i>l_len</i>&nbsp;is a non-negative integer (but see the NOTES below) specifying the number of bytes to be locked. Bytes past the end of the file may be locked, but not bytes before the start of the file. Specifying 0 for&nbsp;<i>l_len</i>&nbsp;has the special meaning: lock all bytes starting at the location specified by&nbsp;<i>l_whence</i>&nbsp;and&nbsp;<i>l_start</i>&nbsp;through to the end of file, no matter how large the file grows.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The&nbsp;<i>l_type</i>&nbsp;field can be used to place a read (<b>F_RDLCK</b>) or a write (<b>F_WRLCK</b>) lock on a file. Any number of processes may hold a read lock (shared lock) on a file region, but only one process may hold a write lock (exclusive lock). An exclusive lock excludes all other locks, both shared and exclusive. A single process can hold only one type of lock on a file region; if a new lock is applied to an already-locked region, then the existing lock is converted to the new lock type. (Such conversions may involve splitting, shrinking, or coalescing with an existing lock if the byte range specified by the new lock does not precisely coincide with the range of the existing lock.)</p> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_SETLK</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Acquire a lock (when&nbsp;<i>l_type</i>&nbsp;is&nbsp;<b>F_RDLCK</b>&nbsp;or&nbsp;<b>F_WRLCK</b>) or release a lock (when&nbsp;<i>l_type</i>&nbsp;is&nbsp;<b>F_UNLCK</b>) on the bytes specified by the&nbsp;<i>l_whence</i>,&nbsp;<i>l_start</i>, and&nbsp;<i>l_len</i>&nbsp;fields of&nbsp;<i>lock</i>. If a conflicting lock is held by another process, this call returns -1 and sets<i>errno</i>&nbsp;to&nbsp;<b>EACCES</b>&nbsp;or&nbsp;<b>EAGAIN</b>.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_SETLKW</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> As for&nbsp;<b>F_SETLK</b>, but if a conflicting lock is held on the file, then wait for that lock to be released. If a signal is caught while waiting, then the call is interrupted and (after the signal handler has returned) returns immediately (with return value -1 and<i>errno</i>&nbsp;set to&nbsp;<b>EINTR</b>).</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_GETLK</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> On input to this call,&nbsp;<i>lock</i>&nbsp;describes a lock we would like to place on the file. If the lock could be placed,&nbsp;<b>fcntl</b>() does not actually place it, but returns&nbsp;<b>F_UNLCK</b>&nbsp;in the&nbsp;<i>l_type</i>&nbsp;field of&nbsp;<i>lock</i>&nbsp;and leaves the other fields of the structure unchanged. If one or more incompatible locks would prevent this lock being placed, then&nbsp;<b>fcntl</b>() returns details about one of these locks in the<i>l_type</i>,&nbsp;<i>l_whence</i>,&nbsp;<i>l_start</i>, and&nbsp;<i>l_len</i>&nbsp;fields of&nbsp;<i>lock</i>&nbsp;and sets&nbsp;<i>l_pid</i>&nbsp;to be the PID of the process holding that lock.</td> 
   </tr> 
  </tbody> 
 </table> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> In order to place a read lock,&nbsp;<i>fd</i>&nbsp;must be open for reading. In order to place a write lock,<i>fd</i>&nbsp;must be open for writing. To place both types of lock, open a file read-write.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> As well as being removed by an explicit&nbsp;<b>F_UNLCK</b>, record locks are automatically released when the process terminates or if it closes&nbsp;<i>any</i>&nbsp;file descriptor referring to a file on which locks are held. This is bad: it means that a process can lose the locks on a file like&nbsp;<i>/etc/passwd</i>&nbsp;or&nbsp;<i>/etc/mtab</i>&nbsp;when for some reason a library function decides to open, read and close it.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Record locks are not inherited by a child created via&nbsp;<b>fork</b>(2), but are preserved across an&nbsp;<b>execve</b>(2).</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Because of the buffering performed by the&nbsp;<b>stdio</b>(3) library, the use of record locking with routines in that package should be avoided; use&nbsp;<b>read</b>(2) and&nbsp;<b>write</b>(2) instead.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 强制锁</h2> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(Non-POSIX.) The above record locks may be either advisory or mandatory, and are advisory by default.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Advisory locks are not enforced and are useful only between cooperating processes.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Mandatory locks are enforced for all processes. If a process tries to perform an incompatible access (e.g.,&nbsp;<b>read</b>(2) or&nbsp;<b>write</b>(2)) on a file region that has an incompatible mandatory lock, then the result depends upon whether the&nbsp;<b>O_NONBLOCK</b>&nbsp;flag is enabled for its open file description. If the&nbsp;<b>O_NONBLOCK</b>&nbsp;flag is not enabled, then system call is blocked until the lock is removed or converted to a mode that is compatible with the access. If the&nbsp;<b>O_NONBLOCK</b>&nbsp;flag is enabled, then the system call fails with the error&nbsp;<b>EAGAIN</b>&nbsp;or&nbsp;<b>EWOULDBLOCK.</b></p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> To make use of mandatory locks, mandatory locking must be enabled both on the file system that contains the file to be locked, and on the file itself. Mandatory locking is enabled on a file system using the "-o mand" option to&nbsp;<b>mount</b>(8), or the<b>MS_MANDLOCK</b>&nbsp;flag for&nbsp;<b>mount</b>(2). Mandatory locking is enabled on a file by disabling group execute permission on the file and enabling the set-group-ID permission bit (see<b>chmod</b>(1) and&nbsp;<b>chmod</b>(2)).</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 管理信号</h2> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> <b>F_GETOWN</b>,&nbsp;<b>F_SETOWN</b>,&nbsp;<b>F_GETSIG</b>&nbsp;and&nbsp;<b>F_SETSIG</b>&nbsp;are used to manage I/O availability signals:</p> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_GETOWN</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Get the process ID or process group currently receiving SIGIO and SIGURG signals for events on file descriptor&nbsp;<i>fd</i>. Process IDs are returned as positive values; process group IDs are returned as negative values (but see BUGS below).</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_SETOWN</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Set the process ID or process group ID that will receive SIGIO and SIGURG signals for events on file descriptor&nbsp;<i>fd</i>. A process ID is specified as a positive value; a process group ID is specified as a negative value. Most commonly, the calling process specifies itself as the owner (that is,&nbsp;<i>arg</i>&nbsp;is specified as<b>getpid</b>()). <p style="text-align: justify;"> If you set the&nbsp;<b>O_ASYNC</b>&nbsp;status flag on a file descriptor (either by providing this flag with the&nbsp;<b>open</b>(2) call, or by using the<b>F_SETFL</b>&nbsp;command of&nbsp;<b>fcntl</b>()), a SIGIO signal is sent whenever input or output becomes possible on that file descriptor.<b>F_SETSIG</b>&nbsp;can be used to obtain delivery of a signal other than SIGIO. If this permission check fails, then the signal is silently discarded.</p> <p style="text-align: justify;"> Sending a signal to the owner process (group) specified by<b>F_SETOWN</b>&nbsp;is subject to the same permissions checks as are described for&nbsp;<b>kill</b>(2), where the sending process is the one that employs&nbsp;<b>F_SETOWN</b>&nbsp;(but see BUGS below).</p> <p style="text-align: justify;"> If the file descriptor&nbsp;<i>fd</i>&nbsp;refers to a socket,&nbsp;<b>F_SETOWN</b>&nbsp;also selects the recipient of SIGURG signals that are delivered when out-of-band data arrives on that socket. (SIGURG is sent in any situation where&nbsp;<b>select</b>(2) would report the socket as having an "exceptional condition".)</p> <p style="text-align: justify;"> If a non-zero value is given to&nbsp;<b>F_SETSIG</b>&nbsp;in a multi-threaded process running with a threading library that supports thread groups (e.g., NPTL), then a positive value given to&nbsp;<b>F_SETOWN</b>has a different meaning: instead of being a process ID identifying a whole process, it is a thread ID identifying a specific thread within a process. Consequently, it may be necessary to pass&nbsp;<b>F_SETOWN</b>&nbsp;the result of&nbsp;<b>gettid</b>() instead of<b>getpid</b>() to get sensible results when&nbsp;<b>F_SETSIG</b>&nbsp;is used. (In current Linux threading implementations, a main thread’s thread ID is the same as its process ID. This means that a single-threaded program can equally use&nbsp;<b>gettid</b>() or&nbsp;<b>getpid</b>() in this scenario.) Note, however, that the statements in this paragraph do not apply to the SIGURG signal generated for out-of-band data on a socket: this signal is always sent to either a process or a process group, depending on the value given to<b>F_SETOWN</b>. Note also that Linux imposes a limit on the number of real-time signals that may be queued to a process (see<b>getrlimit</b>(2) and&nbsp;<b>signal</b>(7)) and if this limit is reached, then the kernel reverts to delivering SIGIO, and this signal is delivered to the entire process rather than to a specific thread.</p> </td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_GETSIG</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Get the signal sent when input or output becomes possible. A value of zero means SIGIO is sent. Any other value (including SIGIO) is the signal sent instead, and in this case additional info is available to the signal handler if installed with SA_SIGINFO.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_SETSIG</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Sets the signal sent when input or output becomes possible. A value of zero means to send the default SIGIO signal. Any other value (including SIGIO) is the signal to send instead, and in this case additional info is available to the signal handler if installed with SA_SIGINFO. <p style="text-align: justify;"> Additionally, passing a non-zero value to&nbsp;<b>F_SETSIG</b>&nbsp;changes the signal recipient from a whole process to a specific thread within a process. See the description of&nbsp;<b>F_SETOWN</b>&nbsp;for more details.</p> <p style="text-align: justify;"> By using&nbsp;<b>F_SETSIG</b>&nbsp;with a non-zero value, and setting SA_SIGINFO for the signal handler (see&nbsp;<b>sigaction</b>(2)), extra information about I/O events is passed to the handler in a<i>siginfo_t</i>&nbsp;structure. If the&nbsp;<i>si_code</i>&nbsp;field indicates the source is SI_SIGIO, the&nbsp;<i>si_fd</i>&nbsp;field gives the file descriptor associated with the event. Otherwise, there is no indication which file descriptors are pending, and you should use the usual mechanisms (<b>select</b>(2),&nbsp;<b>poll</b>(2),&nbsp;<b>read</b>(2) with&nbsp;<b>O_NONBLOCK</b>&nbsp;set etc.) to determine which file descriptors are available for I/O.</p> <p style="text-align: justify;"> By selecting a real time signal (value &gt;= SIGRTMIN), multiple I/O events may be queued using the same signal numbers. (Queuing is dependent on available memory). Extra information is available if SA_SIGINFO is set for the signal handler, as above.</p> </td> 
   </tr> 
  </tbody> 
 </table> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Using these mechanisms, a program can implement fully asynchronous I/O without using&nbsp;<b>select</b>(2) or&nbsp;<b>poll</b>(2) most of the time.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The use of&nbsp;<b>O_ASYNC</b>,&nbsp;<b>F_GETOWN</b>,&nbsp;<b>F_SETOWN</b>&nbsp;is specific to BSD and Linux.&nbsp;<b>F_GETSIG</b>and&nbsp;<b>F_SETSIG</b>&nbsp;are Linux-specific. POSIX has asynchronous I/O and the&nbsp;<i>aio_sigevent</i>structure to achieve similar things; these are also available in Linux as part of the GNU C Library (Glibc).</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 租约</h2> 
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">F_SETLEASE</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;and&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">F_GETLEASE</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;(Linux 2.4 onwards) are used (respectively) to establish and retrieve the current setting of the calling process’s lease on the file referred to by</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">fd</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">. A file lease provides a mechanism whereby the process holding the lease (the "lease holder") is notified (via delivery of a signal) when a process (the "lease breaker") tries to&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">open</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2) or&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">truncate</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2) that file.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_SETLEASE</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Set or remove a file lease according to which of the following values is specified in the integer&nbsp;<i>arg</i>: <p style="text-align: justify;"> &nbsp;</p> 
     <table border="1" cellpadding="5" cellspacing="0" class="src" style="border: 1px solid rgb(170, 170, 170); width: 401px; border-collapse: collapse; padding-left: 5px; vertical-align: top;"> 
      <tbody> 
       <tr> 
        <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
        <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
       </tr> 
       <tr> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_RDLCK</b></td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Take out a read lease. This will cause the calling process to be notified when the file is opened for writing or is truncated. A read lease can only be placed on a file descriptor that is opened read-only.</td> 
       </tr> 
       <tr> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_WRLCK</b></td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Take out a write lease. This will cause the caller to be notified when the file is opened for reading or writing or is truncated. A write lease may be placed on a file only if no other process currently has the file open.</td> 
       </tr> 
       <tr> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_UNLCK</b></td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Remove our lease from the file.</td> 
       </tr> 
      </tbody> 
     </table> </td> 
   </tr> 
   <tr> 
    <td colspan="2" style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> A process may hold only one type of lease on a file.</td> 
   </tr> 
   <tr> 
    <td colspan="2" style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Leases may only be taken out on regular files. An unprivileged process may only take out a lease on a file whose UID matches the file system UID of the process. A process with the&nbsp;<b>CAP_LEASE</b>&nbsp;capability may take out leases on arbitrary files.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_GETLEASE</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Indicates what type of lease we hold on the file referred to by&nbsp;<i>fd</i>by returning either&nbsp;<b>F_RDLCK</b>,&nbsp;<b>F_WRLCK</b>, or&nbsp;<b>F_UNLCK,</b>indicating, respectively, that the calling process holds a read, a write, or no lease on the file. (The third argument to&nbsp;<b>fcntl</b>() is omitted.)</td> 
   </tr> 
  </tbody> 
 </table> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> When a process (the "lease breaker") performs an&nbsp;<b>open</b>() or&nbsp;<b>truncate</b>() that conflicts with a lease established via&nbsp;<b>F_SETLEASE</b>, the system call is blocked by the kernel and the kernel notifies the lease holder by sending it a signal (SIGIO by default). The lease holder should respond to receipt of this signal by doing whatever cleanup is required in preparation for the file to be accessed by another process (e.g., flushing cached buffers) and then either remove or downgrade its lease. A lease is removed by performing an<b>F_SETLEASE</b>&nbsp;command specifying&nbsp;<i>arg</i>&nbsp;as&nbsp;<b>F_UNLCK</b>. If we currently hold a write lease on the file, and the lease breaker is opening the file for reading, then it is sufficient to downgrade the lease to a read lease. This is done by performing an&nbsp;<b>F_SETLEASE</b>command specifying&nbsp;<i>arg</i>&nbsp;as&nbsp;<b>F_RDLCK</b>.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> If the lease holder fails to downgrade or remove the lease within the number of seconds specified in&nbsp;<i>/proc/sys/fs/lease-break-time</i>&nbsp;then the kernel forcibly removes or downgrades the lease holder’s lease.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Once the lease has been voluntarily or forcibly removed or downgraded, and assuming the lease breaker has not unblocked its system call, the kernel permits the lease breaker’s system call to proceed.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> If the lease breaker’s blocked&nbsp;<b>open</b>() or&nbsp;<b>truncate</b>() is interrupted by a signal handler, then the system call fails with the error&nbsp;<b>EINTR</b>, but the other steps still occur as described above. If the lease breaker is killed by a signal while blocked in&nbsp;<b>open</b>() or<b>truncate</b>(), then the other steps still occur as described above. If the lease breaker specifies the&nbsp;<b>O_NONBLOCK</b>&nbsp;flag when calling&nbsp;<b>open</b>(), then the call immediately fails with the error&nbsp;<b>EWOULDBLOCK</b>, but the other steps still occur as described above.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The default signal used to notify the lease holder is SIGIO, but this can be changed using the&nbsp;<b>F_SETSIG</b>&nbsp;command to&nbsp;<b>fcntl</b>(). If a&nbsp;<b>F_SETSIG</b>&nbsp;command is performed (even one specifying SIGIO), and the signal handler is established using SA_SIGINFO, then the handler will receive a&nbsp;<i>siginfo_t</i>&nbsp;structure as its second argument, and the&nbsp;<i>si_fd</i>&nbsp;field of this argument will hold the descriptor of the leased file that has been accessed by another process. (This is useful if the caller holds leases against multiple files).</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 文件和目录更改通知</h2> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_NOTIFY</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> (Linux 2.4 onwards) Provide notification when the directory referred to by&nbsp;<i>fd</i>&nbsp;or any of the files that it contains is changed. The events to be notified are specified in&nbsp;<i>arg</i>, which is a bit mask specified by ORing together zero or more of the following bits: <p style="text-align: justify;"> &nbsp;</p> 
     <table border="1" cellpadding="5" cellspacing="0" class="src" style="border: 1px solid rgb(170, 170, 170); width: 401px; border-collapse: collapse; padding-left: 5px; vertical-align: top;"> 
      <tbody> 
       <tr valign="top"> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Bit</td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Description (event in directory)</td> 
       </tr> 
       <tr valign="top"> 
       </tr> 
       <tr valign="top"> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>DN_MODIFY</b></td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> A file was modified (write, pwrite,</td> 
       </tr> 
       <tr valign="top"> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>&nbsp;</b></td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> writev, truncate, ftruncate)</td> 
       </tr> 
       <tr valign="top"> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>DN_CREATE</b></td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> A file was created (open, creat, mknod,</td> 
       </tr> 
       <tr valign="top"> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>&nbsp;</b></td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> mkdir, link, symlink, rename)</td> 
       </tr> 
       <tr valign="top"> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>DN_DELETE</b></td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> A file was unlinked (unlink, rename to</td> 
       </tr> 
       <tr valign="top"> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>&nbsp;</b></td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> another directory, rmdir)</td> 
       </tr> 
       <tr valign="top"> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>DN_RENAME</b></td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> A file was renamed within this</td> 
       </tr> 
       <tr valign="top"> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>&nbsp;</b></td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> directory (rename)</td> 
       </tr> 
       <tr valign="top"> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>DN_ATTRIB</b></td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> The attributes of a file were changed</td> 
       </tr> 
       <tr valign="top"> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>&nbsp;</b></td> 
        <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> (chown, chmod, utime[s])</td> 
       </tr> 
      </tbody> 
     </table> <p style="text-align: justify;"> (In order to obtain these definitions, the _GNU_SOURCE feature test macro must be defined.)</p> <p style="text-align: justify;"> Directory notifications are normally "one-shot", and the application must re-register to receive further notifications. Alternatively, if&nbsp;<b>DN_MULTISHOT</b>&nbsp;is included in&nbsp;<i>arg</i>, then notification will remain in effect until explicitly removed.v</p> <p style="text-align: justify;"> A series of&nbsp;<b>F_NOTIFY</b>&nbsp;requests is cumulative, with the events in<i>arg</i>&nbsp;being added to the set already monitored. To disable notification of all events, make an&nbsp;<b>F_NOTIFY</b>&nbsp;call specifying&nbsp;<i>arg</i>as 0.</p> <p style="text-align: justify;"> Notification occurs via delivery of a signal. The default signal is SIGIO, but this can be changed using the&nbsp;<b>F_SETSIG</b>&nbsp;command to&nbsp;<b>fcntl</b>(). In the latter case, the signal handler receives a<i>siginfo_t</i>&nbsp;structure as its second argument (if the handler was established using SA_SIGINFO) and the&nbsp;<i>si_fd</i>&nbsp;field of this structure contains the file descriptor which generated the notification (useful when establishing notification on multiple directories).</p> <p style="text-align: justify;"> Especially when using&nbsp;<b>DN_MULTISHOT</b>, a real time signal should be used for notification, so that multiple notifications can be queued.</p> <p style="text-align: justify;"> <b>NOTE:</b>&nbsp;New applications should consider using the&nbsp;<i>inotify</i>interface (available since kernel 2.6.13), which provides a superior interface for obtaining notifications of file system events. See&nbsp;<b>inotify</b>(7).</p> </td> 
   </tr> 
  </tbody> 
 </table> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 返回值</h1> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> 对于一个成功的调用，返回值取决于操作：</p> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_DUPFD</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> The new descriptor.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_GETFD</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Value of flags.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_GETFL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Value of flags.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_GETOWN</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Value of descriptor owner.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>F_GETSIG</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Value of signal sent when read or write becomes possible, or zero for traditional SIGIO behaviour.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> All other commands</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="9%"> &nbsp;</td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Zero.</td> 
   </tr> 
  </tbody> 
 </table> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> On error, -1 is returned, and&nbsp;<i>errno</i>&nbsp;is set appropriately.</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 错误</h1> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EACCES</b>&nbsp;or&nbsp;<b>EAGAIN</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Operation is prohibited by locks held by other processes.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EAGAIN</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> The operation is prohibited because the file has been memory-mapped by another process.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EBADF</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> <i>fd</i>&nbsp;is not an open file descriptor, or the command was&nbsp;<b>F_SETLK</b>or&nbsp;<b>F_SETLKW</b>&nbsp;and the file descriptor open mode doesn’t match with the type of lock requested.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EDEADLK</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> It was detected that the specified&nbsp;<b>F_SETLKW</b>&nbsp;command would cause a deadlock.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EFAULT</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> <i>lock</i>&nbsp;is outside your accessible address space.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EINTR</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> For&nbsp;<b>F_SETLKW</b>, the command was interrupted by a signal. For<b>F_GETLK</b>&nbsp;and&nbsp;<b>F_SETLK</b>, the command was interrupted by a signal before the lock was checked or acquired. Most likely when locking a remote file (e.g. locking over NFS), but can sometimes happen locally.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EINVAL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> For&nbsp;<b>F_DUPFD</b>,&nbsp;<i>arg</i>&nbsp;is negative or is greater than the maximum allowable value. For&nbsp;<b>F_SETSIG</b>,&nbsp;<i>arg</i>&nbsp;is not an allowable signal number.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EMFILE</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> For&nbsp;<b>F_DUPFD</b>, the process already has the maximum number of file descriptors open.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>ENOLCK</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Too many segment locks open, lock table is full, or a remote locking protocol failed (e.g. locking over NFS).</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EPERM</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Attempted to clear the&nbsp;<b>O_APPEND</b>&nbsp;flag on a file that has the append-only attribute set.</td> 
   </tr> 
  </tbody> 
 </table> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 注意</h1> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The errors returned by&nbsp;<b>dup2</b>() are different from those returned by&nbsp;<b>F_DUPFD</b>.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Since kernel 2.0, there is no interaction between the types of lock placed by&nbsp;<b>flock</b>(2) and&nbsp;<b>fcntl</b>(2).</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> POSIX.1-2001 allows&nbsp;<i>l_len</i>&nbsp;to be negative. (And if it is, the interval described by the lock covers bytes&nbsp;<i>l_start</i>+<i>l_len</i>&nbsp;up to and including&nbsp;<i>l_start</i>-1.) This is supported by Linux since Linux 2.4.21 and 2.5.49.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Several systems have more fields in&nbsp;<i>struct flock</i>&nbsp;such as e.g.&nbsp;<i>l_sysid</i>. Clearly,&nbsp;<i>l_pid</i>&nbsp;alone is not going to be very useful if the process holding the lock may live on a different machine.</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> BUGS</h1> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> A limitation of the Linux system call conventions on some architectures (notably x86) means that if a (negative) process group ID to be returned by&nbsp;<b>F_GETOWN</b>&nbsp;falls in the range -1 to -4095, then the return value is wrongly interpreted by glibc as an error in the system call; that is, the return value of&nbsp;<b>fcntl</b>() will be -1, and&nbsp;<i>errno</i>&nbsp;will contain the (positive) process group ID.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> In Linux 2.4 and earlier, there is bug that can occur when an unprivileged process uses<b>F_SETOWN</b>&nbsp;to specify the owner of a socket file descriptor as a process (group) other than the caller. In this case,&nbsp;<b>fcntl</b>() can return -1 with&nbsp;<i>errno</i>&nbsp;set to&nbsp;<b>EPERM</b>, even when the owner process (group) is one that the caller has permission to send signals to. Despite this error return, the file descriptor owner is set, and signals will be sent to the owner.</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 遵循于</h1> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> SVr4, 4.3BSD, POSIX.1-2001. Only the operations F_DUPFD, F_GETFD, F_SETFD, F_GETFL, F_SETFL, F_GETLK, F_SETLK, F_SETLKW, F_GETOWN, and F_SETOWN are specified in POSIX.1-2001.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> F_GETSIG, F_SETSIG, F_NOTIFY, F_GETLEASE, and F_SETLEASE are Linux specific. (Define the _GNU_SOURCE macro to obtain these definitions.)</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 另请参阅</h1> 
 <ul style="font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/dup2.html" style="color: rgb(144, 11, 9); background-color: transparent;">dup2 (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/flock.html" style="color: rgb(144, 11, 9); background-color: transparent;">flock (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/open.html" style="color: rgb(144, 11, 9); background-color: transparent;">open (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/socket.html" style="color: rgb(144, 11, 9); background-color: transparent;">socket (2)</a></p> </li> 
 </ul> 
 <br>      
</div></body></html>
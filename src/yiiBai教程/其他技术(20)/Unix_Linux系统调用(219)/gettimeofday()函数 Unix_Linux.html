<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">gettimeofday()函数 Unix/Linux</h1><div style="width:100%;float:left;" class="article-content">   
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">gettimeofday, settimeofday -&nbsp;</span>获取/设置时间 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 内容简介</h1> 
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">#include &lt;sys/time.h&gt;</b> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> <b>int gettimeofday(struct timeval *</b><i>tv</i><b>, struct timezone *</b><i>tz</i><b>);</b>&nbsp;<br> <b>int settimeofday(const struct timeval *</b><i>tv</i>&nbsp;<b>, const struct timezone *</b><i>tz</i><b>);</b></p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 描述</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">The functions&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">gettimeofday</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">() and&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">settimeofday</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">() can get and set the time as well as a timezone. The&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">tv</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;argument is a&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">struct timeval</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;(as specified in&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&lt;sys/time.h&gt;</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">):</span> 
 <table cellpadding="5" cellspacing="5" class="src" style="font-family: verdana, helvetica, arial, sans-serif;  border-color: rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse;  border-color: rgb(170, 170, 170);"> <pre style="font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 0px;">
struct timeval {
    time_t      tv_sec;     /* seconds */
    suseconds_t tv_usec;    /* microseconds */
};
</pre> </td> 
   </tr> 
  </tbody> 
 </table> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> and gives the number of seconds and microseconds since the Epoch (see&nbsp;<b>time</b>(2)). The<i>tz</i>&nbsp;argument is a&nbsp;<i>struct timezone</i>:</p> 
 <table cellpadding="5" cellspacing="5" class="src" style="font-family: verdana, helvetica, arial, sans-serif;  border-color: rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse;  border-color: rgb(170, 170, 170);"> <pre style="font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 0px;">
struct timezone {
    int tz_minuteswest;     /* minutes west of Greenwich */
    int tz_dsttime;         /* type of DST correction */
};
</pre> </td> 
   </tr> 
  </tbody> 
 </table> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> If either&nbsp;<i>tv</i>&nbsp;or&nbsp;<i>tz</i>&nbsp;is NULL, the corresponding structure is not set or returned.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The use of the&nbsp;<i>timezone</i>&nbsp;structure is obsolete; the&nbsp;<i>tz</i>&nbsp;argument should normally be specified as NULL. The&nbsp;<i>tz_dsttime</i>&nbsp;field has never been used under Linux; it has not been and will not be supported by libc or glibc. Each and every occurrence of this field in the kernel source (other than the declaration) is a bug. Thus, the following is purely of historic interest.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The field&nbsp;<i>tz_dsttime</i>&nbsp;contains a symbolic constant (values are given below) that indicates in which part of the year Daylight Saving Time is in force. (Note: its value is constant throughout the year: it does not indicate that DST is in force, it just selects an algorithm.) The daylight saving time algorithms defined are as follows :</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> <b>DST_NONE</b>&nbsp;/* not on dst */&nbsp;<br> <b>DST_USA</b>&nbsp;/* USA style dst */&nbsp;<br> <b>DST_AUST</b>&nbsp;/* Australian style dst */&nbsp;<br> <b>DST_WET</b>&nbsp;/* Western European dst */&nbsp;<br> <b>DST_MET</b>&nbsp;/* Middle European dst */&nbsp;<br> <b>DST_EET</b>&nbsp;/* Eastern European dst */&nbsp;<br> <b>DST_CAN</b>&nbsp;/* Canada */&nbsp;<br> <b>DST_GB</b>&nbsp;/* Great Britain and Eire */&nbsp;<br> <b>DST_RUM</b>&nbsp;/* Rumania */&nbsp;<br> <b>DST_TUR</b>&nbsp;/* Turkey */&nbsp;<br> <b>DST_AUSTALT</b>&nbsp;/* Australian style with shift in 1986 */</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Of course it turned out that the period in which Daylight Saving Time is in force cannot be given by a simple algorithm, one per country; indeed, this period is determined by unpredictable political decisions. So this method of representing time zones has been abandoned. Under Linux, in a call to&nbsp;<b>settimeofday</b>() the&nbsp;<i>tz_dsttime</i>&nbsp;field should be zero.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Under Linux there is some peculiar ‘warp clock’ semantics associated to the<b>settimeofday</b>() system call if on the very first call (after booting) that has a non-NULL&nbsp;<i>tz</i>argument, the&nbsp;<i>tv</i>&nbsp;argument is NULL and the&nbsp;<i>tz_minuteswest</i>&nbsp;field is non-zero. In such a case it is assumed that the CMOS clock is on local time, and that it has to be incremented by this amount to get UTC system time. No doubt it is a bad idea to use this feature.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> 下面的宏定义在一个struct timeval操作：</p> 
 <table cellpadding="5" cellspacing="5" class="src" style="font-family: verdana, helvetica, arial, sans-serif;  border-color: rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse;  border-color: rgb(170, 170, 170);"> <pre style="font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 0px;">
#define timerisset(tvp)\
&nbsp; &nbsp;((tvp)-&gt;tv_sec || (tvp)-&gt;tv_usec)
#define timercmp(tvp, uvp, cmp)\

((tvp)-&gt;tv_sec cmp (uvp)-&gt;tv_sec ||\
(tvp)-&gt;tv_sec == (uvp)-&gt;tv_sec &amp;&amp;\
(tvp)-&gt;tv_usec cmp (uvp)-&gt;tv_usec)

#define timerclear(tvp)\
&nbsp; &nbsp;((tvp)-&gt;tv_sec = (tvp)-&gt;tv_usec = 0)
</pre> </td> 
   </tr> 
  </tbody> 
 </table> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 返回值</h1> 
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">gettimeofday</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">() and&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">settimeofday</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">() return 0 for success, or -1 for failure (in which case</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">errno</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;is set appropriately).</span> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 错误</h1> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EFAULT</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> One of&nbsp;<i>tv</i>&nbsp;or&nbsp;<i>tz</i>&nbsp;pointed outside the accessible address space.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EINVAL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Timezone (or something else) is invalid.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EPERM</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> The calling process has insufficient privilege to call<b>settimeofday</b>(); under Linux the&nbsp;<b>CAP_SYS_TIME</b>&nbsp;capability is required.</td> 
   </tr> 
  </tbody> 
 </table> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 注意</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">The prototype for&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">settimeofday</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">() and the defines for&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">timercmp</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">,&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">timerisset</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">,&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">timerclear</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">,</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">timeradd</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">,&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">timersub</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;are (since glibc2.2.2) only available if&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">_BSD_SOURCE</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;is defined.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Traditionally, the fields of&nbsp;<i>struct timeval</i>&nbsp;were longs.</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 遵循于</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">SVr4, 4.3BSD. POSIX.1-2001 describes&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">gettimeofday</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">() but not&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">settimeofday</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">().</span> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 另请参阅</h1> 
 <ul style="font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_commands/date.html" style="color: rgb(144, 11, 9); background-color: transparent;">date (1)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/adjtimex.html" style="color: rgb(144, 11, 9); background-color: transparent;">adjtimex (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/time.html" style="color: rgb(144, 11, 9); background-color: transparent;">time (2)</a></p> 
   <div>
     &nbsp;
   </div> </li> 
 </ul> 
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">accept()函数 Unix/Linux</h1><div style="width:100%;float:left;" class="article-content">   
 <h1> 名称</h1> 
 <p> accept - 接受连接套接字上</p> 
 <h1> 内容简介</h1> 
 <table cellpadding="5" class="src" style="font-family: verdana, helvetica, arial, sans-serif;  border-color: rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse;  border-color: rgb(170, 170, 170);"> <pre style="font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 0px;">
<b>#include &lt;sys/types.h&gt;</b>
<b>#include &lt;sys/socket.h&gt;</b> 
</pre> <p style="text-align: justify;"> <b>int accept(int </b><i>sockfd</i><b>, struct sockaddr *</b><i>addr</i><b>, socklen_t *</b><i>addrlen</i><b>);</b></p> </td> 
   </tr> 
  </tbody> 
 </table> 
 <h1> 描述说明</h1> 
 <p> accept()系统调用用于基于连接的套接字类型（SOCK_STREAM，SOCK_SEQPACKET）。提取完成连接队列中的第一个连接请求，创建一个新的连接套接字，并返回一个新的文件描述符，指该套接字。新创建的套接字处于监听状态。原始套接字 sockfd 不受此调用。</p> 
 <p> 参数 sockfd 是一个套接字绑定到本地地址&nbsp;bind(2)&nbsp;socket(2)，已创建侦听连接后&nbsp;listen(2)。&nbsp;</p> 
 <p> 参数addr是一个指向结构sockaddr。被填充在此结构的对等套接字的地址，作为已知的通信层。地址返回&nbsp;addr&nbsp;的确切格式由套接字的地址族（参见socket（2）及相应协议的手册页）。</p> 
 <p> addrlen 参数是一个值结果参数：最初它应该包含大小addr所指向的结构，在函数返回时将包含实际的长度（以字节为单位）返回的地址。当没有填写addr是NULL。</p> 
 <p> 如果没有挂起的连接队列，并没有被标记为非阻塞套接字，accept()&nbsp;将阻塞，直到建立连接。如果套接字被标记无阻塞，没有未完成连接队列上，accept()&nbsp;失败，并出现错误EAGAIN。</p> 
 <p> 为了通知传入连接在套接字上，那么可以使用select（2）或 orpoll（2）。当尝试一个新的连接，然后可以调用accept()&nbsp;获取套接字，连接一个可读事件将被传递。另外，您还可以设置套接字提供SIGIO活动发生在一个socket时，详情参见socket（7）。</p> 
 <p> 需要一个明确的确认，如 DECNET 对于某些协议，accept() 可以被看作是仅仅从队列中取出下一个连接请求，不意味着确认。确认可以正常的读或写上新的文件描述符，暗示和排斥反应，可通过关闭新的套接字暗示。目前只有DECNet有这样的Linux上的语义。</p> 
 <h1> 注意</h1> 
 <p> 可能并不总是等待一个连接后 SIGIO 交付&nbsp;select(2) 或&nbsp;poll(2)&nbsp;因为连接可能已被删除，被称为异步网络错误或另一个线程&nbsp;accept()&nbsp;返回一个可读性事件。如果发生这种情况，那么调用将阻塞等待下一个连接到达。</p> 
 <p> 为了确保&nbsp;accept()&nbsp;从未阻塞，通过套接字sockfd中需要有O_NONBLOCK标志设置（参见socket（7））。</p> 
 <h1> 返回值</h1> 
 <p> 如果成功，accept()返回一个非负的整数，这是一个接受套接字描述符。上的错误，则返回-1，errno设置为合适。</p> 
 <h1> 错误处理</h1> 
 <p> Linux 的&nbsp;accept()&nbsp;传递已经挂起的网络错误，在新的socket accept()&nbsp;错误代码。此行为不同于其他的BSD套接字实现。对于可靠运行的应用程序应该检测网络错误定义的协议后accept()&nbsp;，并把它们像EAGAIN重试。在这些情况下，TCP/ IP是ENETDOWN ENOPROTOOPT EPROTO，EHOSTDOWN，ENONET，EHOSTUNREACH，EOPNOTSUPP，和ENETUNREACH的。&nbsp;</p> 
 <h1> 错误</h1> 
 <p> accept()可能失败如下:</p> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EAGAIN</b>or<b>EWOULDBLOCK</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> The socket is marked non-blocking and no connections are present to be accepted.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EBADF</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> The descriptor is invalid.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>ECONNABORTED</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> A connection has been aborted.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EINTR</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> The system call was interrupted by a signal that was caught before a valid connection arrived.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EINVAL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Socket is not listening for connections, or&nbsp;<i>addrlen</i>&nbsp;is invalid (e.g., is negative).</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EMFILE</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> The per-process limit of open file descriptors has been reached.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>ENFILE</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> The system limit on the total number of open files has been reached.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>ENOTSOCK</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> The descriptor references a file, not a socket.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EOPNOTSUPP</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> The referenced socket is not of type<b>SOCK_STREAM</b>.</td> 
   </tr> 
  </tbody> 
 </table>   
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> <b>accept</b>() 可能会失败，如下:</p> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EFAULT</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> The&nbsp;<i>addr</i>&nbsp;argument is not in a writable part of the user address space.</td> 
   </tr> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>ENOBUFS, ENOMEM</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> Not enough free memory. This often means that the memory allocation is limited by the socket bufferlimits, not by the system memory.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EPROTO</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Protocol error.</td> 
   </tr> 
  </tbody> 
 </table> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Linux&nbsp;<b>accept</b>() 可能会失败，如下:</p> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EPERM</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> Firewall rules forbid connection.</td> 
   </tr> 
  </tbody> 
 </table> 
 <p> 此外，新的套接字的协议所定义的网络错误可能被返回。各种 Linux 内核可以返回其他错误，如ENOSR ESOCKTNOSUPPORT，EPROTONOSUPPORT ETIMEDOUT。在跟踪过程中，可能会出现值ERESTARTSYS。</p> 
 <h1> 遵循于</h1> 
 <p> SVr4, 4.4BSD (accept() first appeared in 4.2BSD).</p> 
 <h1> 注意</h1> 
 <p> 最初是作为一个'‘int *’'声明&nbsp;accept()的第三个参数（libc4和libc5和许多其他系统，如4.x的BSD，SunOS 4上，SGI）;下一个POSIX.1g标准草案希望改变它变成了'size_t*'，那是什么它是在SunOS5。后来POSIX汇票“socklen_t*”，这样做对单一Unix规范和glibc2。</p> 
 <h1> 另请参阅</h1> 
 <ul style="font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/bind.html" style="color: rgb(144, 11, 9); background-color: transparent;">bind (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/connect.html" style="color: rgb(144, 11, 9); background-color: transparent;">connect (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/listen.html" style="color: rgb(144, 11, 9); background-color: transparent;">listen (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/select.html" style="color: rgb(144, 11, 9); background-color: transparent;">select (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/socket.html" style="color: rgb(144, 11, 9); background-color: transparent;">socket (2)</a></p> </li> 
 </ul> 
 <br>      
</div></body></html>
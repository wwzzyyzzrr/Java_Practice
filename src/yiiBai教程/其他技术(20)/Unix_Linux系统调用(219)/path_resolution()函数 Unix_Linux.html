<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">path_resolution()函数 Unix/Linux</h1><div style="width:100%;float:left;" class="article-content">   Unix / Linux路径解析
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;-&nbsp;</span>查找一个文件名所指的文件 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 描述</h1> 一些Unix/ Linux的系统调用作为参数的一个或多个文件名。文件名（或路径）的解析方式如下。
 <br> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> <i>Step 1: </i>开始解析过程</h2> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">If the pathname starts with the ’/’ character, the starting lookup directory is the root directory of the current process. (A process inherits its root directory from its parent. Usually this will be the root directory of the file hierarchy. A process may get a different root directory by use of the&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">chroot</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2) system call. A process may get an entirely private namespace in case it — or one of its ancestors — was started by an invocation of the</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">clone</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2) system call that had the CLONE_NEWNS flag set.) This handles the ’/’ part of the pathname.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> If the pathname does not start with the ’/’ character, the starting lookup directory of the resolution process is the current working directory of the process. (This is also inherited from the parent. It can be changed by use of the&nbsp;<b>chdir</b>(2) system call.)</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Pathnames starting with a ’/’ character are called absolute pathnames. Pathnames not starting with a ’/’ are called relative pathnames.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> <i>Step 2:&nbsp;</i>沿着路径走</h2> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">Set the current lookup directory to the starting lookup directory. Now, for each non-final component of the pathname, where a component is a substring delimited by ’/’ characters, this component is looked up in the current lookup directory.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> If the process does not have search permission on the current lookup directory, an EACCES error is returned ("Permission denied").</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> If the component is not found, an ENOENT error is returned ("No such file or directory").</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> If the component is found, but is neither a directory nor a symbolic link, an ENOTDIR error is returned ("Not a directory").</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> If the component is found and is a directory, we set the current lookup directory to that directory, and go to the next component.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> If the component is found and is a symbolic link (symlink), we first resolve this symbolic link (with the current lookup directory as starting lookup directory). Upon error, that error is returned. If the result is not a directory, an ENOTDIR error is returned. If the resolution of the symlink is successful and returns a directory, we set the current lookup directory to that directory, and go to the next component. Note that the resolution process here involves recursion. In order to protect the kernel against stack overflow, and also to protect against denial of service, there are limits on the maximum recursion depth, and on the maximum number of symlinks followed. An ELOOP error is returned when the maximum is exceeded ("Too many levels of symbolic links").</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> <i>Step 3:&nbsp;</i>找到最后一项</h2> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">The lookup of the final component of the pathname goes just like that of all other components, as described in the previous step, with two differences: (i) the final component need not be a directory (at least as far as the path resolution process is concerned — it may have to be a directory, or a non-directory, because of the requirements of the specific system call), and (ii) it is not necessarily an error if the component is not found — maybe we are just creating it. The details on the treatment of the final entry are described in the manual pages of the specific system calls.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> <i>. and ..</i></h2> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">By convention, every directory has the entries "." and "..", which refer to the directory itself and to its parent directory, respectively.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The path resolution process will assume that these entries have their conventional meanings, regardless of whether they are actually present in the physical filesystem.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> One cannot walk down past the root: "/.." is the same as "/".</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 挂载点</h2> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">After a "mount dev path" command, the pathname "path" refers to the root of the filesystem hierarchy on the device "dev", and no longer to whatever it referred to earlier.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> One can walk out of a mounted filesystem: "path/.." refers to the parent directory of "path", outside of the filesystem hierarchy on "dev".</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 尾随斜线</h2> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">If a pathname ends in a ’/’, that forces resolution of the preceding component as in Step 2: it has to exist and resolve to a directory. Otherwise a trailing ’/’ is ignored. (Or, equivalently, a pathname with a trailing ’/’ is equivalent to the pathname obtained by appending ’.’ to it.)</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 最后的符号链接</h2> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">If the last component of a pathname is a symbolic link, then it depends on the system call whether the file referred to will be the symbolic link or the result of path resolution on its contents. For example, the system call&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">lstat</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2) will operate on the symlink, while</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">stat</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2) operates on the file pointed to by the symlink.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 长度限制</h2>   
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">There is a maximum length for pathnames. If the pathname (or some intermediate pathname obtained while resolving symbolic links) is too long, an ENAMETOOLONG error is returned ("File name too long").</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 空路径名</h2> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">In the original Unix, the empty pathname referred to the current directory. Nowadays POSIX decrees that an empty pathname must not be resolved successfully. Linux returns ENOENT in this case.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 权限</h2> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">The permission bits of a file consist of three groups of three bits, cf.&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">chmod</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(1) and</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">stat</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2). The first group of three is used when the effective user ID of the current process equals the owner ID of the file. The second group of three is used when the group ID of the file either equals the effective group ID of the current process, or is one of the supplementary group IDs of the current process (as set by&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">setgroups</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2)). When neither holds, the third group is used.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Of the three bits used, the first bit determines read permission, the second write permission, and the last execute permission in case of ordinary files, or search permission in case of directories.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Linux uses the fsuid instead of the effective user ID in permission checks. Ordinarily the fsuid will equal the effective user ID, but the fsuid can be changed by the system call<b>setfsuid</b>(2).</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> (Here "fsuid" stands for something like "file system user ID". The concept was required for the implementation of a user space NFS server at a time when processes could send a signal to a process with the same effective user ID. It is obsolete now. Nobody should use&nbsp;<b>setfsuid</b>(2).)</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Similarly, Linux uses the fsgid ("file system group ID") instead of the effective group ID. See&nbsp;<b>setfsgid</b>(2).</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h2 style="font-size: 16px; line-height: 1.5; font-family: Helvetica, Arial, 'Liberation Sans', FreeSans, sans-serif; margin-bottom: 10px; margin-top: 10px; color: rgb(0, 0, 0);"> 绕过权限检查：超级用户和功能</h2> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">On a traditional Unix system, the superuser (</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">root</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">, user ID 0) is all-powerful, and bypasses all permissions restrictions when accessing files.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> On Linux, superuser privileges are divided into capabilities (see&nbsp;<b>capabilities</b>(7)). Two capabilities are relevant for file permissions checks: CAP_DAC_OVERRIDE and CAP_DAC_READ_SEARCH. (A process has these capabilities if its fsuid is 0.)</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The CAP_DAC_OVERRIDE capability overrides all permission checking, but only grants execute permission when at least one of the file’s three execute permission bits is set.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The CAP_DAC_READ_SEARCH capability grants read and search permission on directories, and read permission on ordinary files.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 另请参阅</h1> 
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">getitimer()函数 Unix/Linux</h1><div style="width:100%;float:left;" class="article-content">   
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">getitimer, setitimer -&nbsp;</span>获取或设置一个间隔定时器的值 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 内容简介</h1> 
 <table cellpadding="5" cellspacing="5" class="src" style="font-family: verdana, helvetica, arial, sans-serif;  border-color: rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse;  border-color: rgb(170, 170, 170);"> <b>#include &lt;sys/time.h&gt;</b> <p style="text-align: justify;"> <b>int getitimer(int </b><i>which</i><b>, struct itimerval *</b><i>value</i><b>);</b><br> <b>int setitimer(int </b><i>which</i><b>, const struct itimerval *</b><i>value</i><b>,</b> <b> struct itimerval *</b><i>ovalue</i><b>);</b></p> </td> 
   </tr> 
  </tbody> 
 </table> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 描述</h1> 该系统为每个进程有三个间隔定时器，在不同的时间域的每个递减。当任何定时器到期时，一信号被发送到处理，定时器（可能）重新启动。
 <br> 
 <br> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>ITIMER_REAL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> decrements in real time, and delivers&nbsp;<b>SIGALRM</b>&nbsp;upon expiration.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>ITIMER_VIRTUAL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> decrements only when the process is executing, and delivers<b>SIGVTALRM</b>&nbsp;upon expiration.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>ITIMER_PROF</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> decrements both when the process executes and when the system is executing on behalf of the process. Coupled with<b>ITIMER_VIRTUAL</b>, this timer is usually used to profile the time spent by the application in user and kernel space.&nbsp;<b>SIGPROF</b>&nbsp;is delivered upon expiration.</td> 
   </tr> 
  </tbody> 
 </table> 
 <br> 计时器的值由以下结构定义：
 <br> 
 <br> 
 <pre style="font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 0px;">
struct itimerval {
    struct timeval it_interval; /* next value */
    struct timeval it_value;    /* current value */
};
struct timeval {
    long tv_sec;                /* seconds */
    long tv_usec;               /* microseconds */
};
</pre> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> The function&nbsp;<b>getitimer</b>() fills the structure indicated by&nbsp;<i>value</i>&nbsp;with the current setting for the timer indicated by&nbsp;<i>which</i>&nbsp;(one of&nbsp;<b>ITIMER_REAL</b>,&nbsp;<b>ITIMER_VIRTUAL</b>, or<b>ITIMER_PROF</b>). The element&nbsp;<i>it_value</i>&nbsp;is set to the amount of time remaining on the timer, or zero if the timer is disabled. Similarly,&nbsp;<i>it_interval</i>&nbsp;is set to the reset value. The function&nbsp;<b>setitimer</b>() sets the indicated timer to the value in&nbsp;<i>value</i>. If&nbsp;<i>ovalue</i>&nbsp;is non-zero, the old value of the timer is stored there.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Timers decrement from&nbsp;<i>it_value</i>&nbsp;to zero, generate a signal, and reset to&nbsp;<i>it_interval</i>. A timer which is set to zero (<i>it_value</i>&nbsp;is zero or the timer expires and&nbsp;<i>it_interval</i>&nbsp;is zero) stops.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Both&nbsp;<i>tv_sec</i>&nbsp;and&nbsp;<i>tv_usec</i>&nbsp;are significant in determining the duration of a timer.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> Timers will never expire before the requested time, but may expire some (short) time afterwards, which depends on the system timer resolution and on the system load. (But see BUGS below.) Upon expiration, a signal will be generated and the timer reset. If the timer expires while the process is active (always true for&nbsp;<b>ITIMER_VIRTUAL</b>) the signal will be delivered immediately when generated. Otherwise the delivery will be offset by a small time dependent on the system loading.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> &nbsp;</p> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 返回值</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">On success, zero is returned. On error, -1 is returned, and&nbsp;</span>
 <i style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">errno</i>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;is set appropriately.</span> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 错误</h1> 
 <table border="1" cellpadding="5" cellspacing="0" class="src" style="font-family: verdana, helvetica, arial, sans-serif; border: 1px solid rgb(170, 170, 170); width: 552px; background-color: rgb(241, 241, 241); border-collapse: collapse; padding-left: 5px; vertical-align: top; color: rgb(0, 0, 0);"> 
  <tbody> 
   <tr> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" width="25%"> 标签</th> 
    <th style="background-color: rgb(205, 205, 205); border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> 描述</th> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EFAULT</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> <i>value</i>&nbsp;or&nbsp;<i>ovalue</i>&nbsp;are not valid pointers.</td> 
   </tr> 
   <tr valign="top"> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);"> <b>EINVAL</b></td> 
    <td style="vertical-align: top; margin-bottom: 0px; border-collapse: collapse; border: 1px solid rgb(170, 170, 170);" valign="bottom"> <i>which</i>&nbsp;is not one of&nbsp;<b>ITIMER_REAL</b>,&nbsp;<b>ITIMER_VIRTUAL</b>, or<b>ITIMER_PROF</b>.</td> 
   </tr> 
  </tbody> 
 </table>   
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 注意</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">A child created via&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">fork</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2) does not inherit its parent’s interval timers. Interval timers are preserved across an&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">execve</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">(2).</span> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 遵循于</h1> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">POSIX.1-2001, SVr4, 4.4BSD (this call first appeared in 4.2BSD).</span> 
 <h1 class="manpages" style="font-weight: normal; font-size: 18px; line-height: 1.5; font-family: Calibri; margin-bottom: 0px; color: rgb(0, 0, 0);"> 另请参阅</h1> 
 <ul style="font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/gettimeofday.html" style="color: rgb(144, 11, 9); background-color: transparent;">gettimeofday (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/sigaction.html" style="color: rgb(144, 11, 9); background-color: transparent;">sigaction (2)</a></p> </li> 
  <li> <p style="text-align: justify;"> <a target="_blank" href="http://www.yiibai.com/unix_system_calls/signal.html" style="color: rgb(144, 11, 9); background-color: transparent;">signal (2)</a></p> </li> 
 </ul> 
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">The generation and delivery of a signal are distinct, and only one instance of each of the signals listed above may be pending for a process. Under very heavy loading, an&nbsp;</span>
 <b style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">ITIMER_REAL</b>
 <span style="color: rgb(0, 0, 0); font-family: verdana, helvetica, arial, sans-serif;">&nbsp;timer may expire before the signal from a previous expiration has been delivered. The second signal in such an event will be lost.</span> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> On Linux, timer values are represented in jiffies. If a request is made set a timer with a value whose jiffies representation exceeds MAX_SEC_IN_JIFFIES (defined in<i>include/linux/jiffies.h</i>), then the timer is silently truncated to this ceiling value. On Linux/x86 (where, since kernel 2.6.13, the default jiffy is 0.004 seconds), this means that the ceiling value for a timer is approximately 99.42 days.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> On certain systems (including x86), Linux kernels before version 2.6.12 have a bug which will produce premature timer expirations of up to one jiffy under some circumstances. This bug is fixed in kernel 2.6.12.</p> 
 <p style="text-align: justify; font-family: verdana, helvetica, arial, sans-serif; color: rgb(0, 0, 0);"> POSIX.1-2001 says that&nbsp;<b>setitimer</b>() should fail if a&nbsp;<i>tv_usec</i>&nbsp;value is specified that is outside of the range 0 to 999999. However, Linux does not give an error, but instead silently adjusts the corresponding seconds value for the timer. In the future (scheduled for March 2007), this non-conformance will be repaired: existing applications should be fixed now to ensure that they supply a properly formed&nbsp;<i>tv_usec</i>&nbsp;value.&nbsp;</p> 
 <br>      
</div></body></html>
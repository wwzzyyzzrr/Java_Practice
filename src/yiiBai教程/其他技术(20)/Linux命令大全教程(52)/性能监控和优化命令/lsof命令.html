<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">lsof命令</h1><div style="width:100%;float:left;" class="article-content">   
 <p>lsof(list open files)是一个列出当前系统打开文件的工具。在linux环境下，任何事物都以文件的形式存在，通过文件不仅仅可以访问常规数据，还可以访问网络连接和硬件。所以如传输控制协议 (TCP) 和用户数据报协议 (UDP) 套接字等，系统在后台都为该应用程序分配了一个文件描述符，无论这个文件的本质如何，该文件描述符为应用程序与基础操作系统之间的交互提供了通用接口。因为应用程序打开文件的描述符列表提供了大量关于这个应用程序本身的信息，因此通过<code>lsof</code>工具能够查看这个列表对系统监测以及排错将是很有帮助的。</p> 
 <blockquote> 
  <p>最新版本的 CentOS Linux 上默认可能没有安装 <code>lsof</code> 工具，可通过执行<code>yum install lsof</code> 命令来安装。</p> 
 </blockquote> 
 <h2 id="h2-1-"><a name="1．命令格式" class="reference-link"></a><span class="header-link octicon octicon-link"></span>1．命令格式</h2>
 <p>lsof [参数][文件]</p> 
 <h2 id="h2-2-"><a name="2．命令功能" class="reference-link"></a><span class="header-link octicon octicon-link"></span>2．命令功能</h2>
 <p>用于查看你进程开打的文件，打开文件的进程，进程打开的端口(TCP、UDP)。找回/恢复删除的文件。是十分方便的系统监视工具，因为 <code>lsof</code> 需要访问核心内存和各种文件，所以需要 <code>root</code> 用户执行。</p> 
 <p><code>lsof</code>打开的文件可以是：</p> 
 <ol> 
  <li>普通文件</li>
  <li>目录</li>
  <li>网络文件系统的文件</li>
  <li>字符或设备文件</li>
  <li>(函数)共享库</li>
  <li>管道，命名管道</li>
  <li>符号链接</li>
  <li>网络文件(例如：NFS file、网络socket，unix域名socket)</li>
  <li>还有其它类型的文件，等等</li>
 </ol> 
 <h2 id="h2-3-"><a name="3．命令参数" class="reference-link"></a><span class="header-link octicon octicon-link"></span>3．命令参数</h2>
 <ul> 
  <li><code>-a</code> 列出打开文件存在的进程</li>
  <li><code>-c</code>&lt;进程名&gt; 列出指定进程所打开的文件</li>
  <li><code>-g</code> 列出GID号进程详情</li>
  <li><code>-d</code>&lt;文件号&gt; 列出占用该文件号的进程</li>
  <li><code>+d</code>&lt;目录&gt; 列出目录下被打开的文件</li>
  <li><code>+D</code>&lt;目录&gt; 递归列出目录下被打开的文件</li>
  <li><code>-n</code>&lt;目录&gt; 列出使用NFS的文件</li>
  <li><code>-i</code>&lt;条件&gt; 列出符合条件的进程。(4、6、协议、:端口、 <a target="_blank" href="https://github.com/ip" title="@ip" class="at-link">@ip</a> )</li>
  <li><code>-p</code>&lt;进程号&gt; 列出指定进程号所打开的文件</li>
  <li><code>-u</code> 列出UID号进程详情</li>
  <li><code>-h</code> 显示帮助信息</li>
  <li><code>-v</code> 显示版本信息</li>
 </ul> 
 <h2 id="h2-4-"><a name="4．使用实例：" class="reference-link"></a><span class="header-link octicon octicon-link"></span>4．使用实例：</h2>
 <h3 id="h3--1-"><a name="实例1：无任何参数" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例1：无任何参数</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof
</code></pre> 
 <p>输出：</p> 
 <pre><code class="lang-shell">COMMAND    PID  TID    USER   FD      TYPE             DEVICE  SIZE/OFF       NODE NAME
systemd      1         root  cwd       DIR              253,0       224         64 /
systemd      1         root  rtd       DIR              253,0       224         64 /
systemd      1         root  txt       REG              253,0   1482128   67349141 /usr/lib/systemd/systemd
systemd      1         root  mem       REG              253,0     20040   33619254 /usr/lib64/libuuid.so.1.3.0
systemd      1         root  mem       REG              253,0    256960   33759239 /usr/lib64/libblkid.so.1.1.0
systemd      1         root  mem       REG              253,0     90664   33619237 /usr/lib64/libz.so.1.2.7
systemd      1         root  mem       REG              253,0    157424   33619240 /usr/lib64/liblzma.so.5.2.2
systemd      1         root  mem       REG              253,0     23968   33619292 /usr/lib64/libcap-ng.so.0.0.0
systemd      1         root  mem       REG              253,0     19888   33619306 /usr/lib64/libattr.so.1.1.0
systemd      1         root  mem       REG              253,0     19344   33826633 /usr/lib64/libdl-2.17.so
systemd      1         root  mem       REG              253,0    398264   33828533 /usr/lib64/libpcre.so.1.2.0
systemd      1         root  mem       REG              253,0   2116736   33826627 /usr/lib64/libc-2.17.so
systemd      1         root  mem       REG              253,0    143352   33826653 /usr/lib64/libpthread-2.17.so
systemd      1         root  mem       REG              253,0     88720   33554508 /usr/lib64/libgcc_s-4.8.5-20150702.so.1
systemd      1         root  mem       REG              253,0     43928   33828481 /usr/lib64/librt-2.17.so
systemd      1         root  mem       REG              253,0    265008   33772642 /usr/lib64/libmount.so.1.1.0
systemd      1         root  mem       REG              253,0     91792   33640184 /usr/lib64/libkmod.so.2.2.10
systemd      1         root  mem       REG              253,0    122936   33619295 /usr/lib64/libaudit.so.1.0.0
systemd      1         root  mem       REG              253,0     61672   33771917 /usr/lib64/libpam.so.0.83.1
systemd      1         root  mem       REG              253,0     20024   33619311 /usr/lib64/libcap.so.2.22
systemd      1         root  mem       REG              253,0    155744   33619233 /usr/lib64/libselinux.so.1
systemd      1         root  mem       REG              253,0    155064   33826620 /usr/lib64/ld-2.17.so
systemd      1         root  mem       REG              253,0     44725   67521139 /etc/selinux/targeted/contexts/files/file_contexts.homedirs.bin
systemd      1         root  mem       REG              253,0   1393914   67521137 /etc/selinux/targeted/contexts/files/file_contexts.bin
systemd      1         root    0u      CHR                1,3       0t0       5930 /dev/null
systemd      1         root    1u      CHR                1,3       0t0       5930 /dev/null
systemd      1         root    2u      CHR                1,3       0t0       5930 /dev/null
systemd      1         root    3u  a_inode                0,9         0       5926 [timerfd]
systemd      1         root    4u  a_inode                0,9         0       5926 [eventpoll]
... ... 大概有2000多行，此处省略。
</code></pre> 
 <p><strong>lsof输出各列信息的意义如下：</strong></p> 
 <ul> 
  <li>COMMAND：进程的名称</li>
  <li>PID：进程标识符</li>
  <li>PPID：父进程标识符(需要指定-R参数)</li>
  <li>USER：进程所有者</li>
  <li>PGID：进程所属组</li>
  <li><p>FD：文件描述符，应用程序通过文件描述符识别该文件。如cwd、txt等。</p> 
   <ul> 
    <li>(1)cwd：表示current work dirctory，即：应用程序的当前工作目录，这是该应用程序启动的目录，除非它本身对这个目录进行更改</li>
    <li>(2)txt ：该类型的文件是程序代码，如应用程序二进制文件本身或共享库，如上列表中显示的 <code>/sbin/init</code> 程序</li>
    <li>(3)lnn：library references (AIX);</li>
    <li>(4)er：FD information error (see NAME column);</li>
    <li>(5)jld：jail directory (FreeBSD);</li>
    <li>(6)ltx：shared library text (code and data);</li>
    <li>(7)mxx ：hex memory-mapped type number xx.</li>
    <li>(8)m86：DOS Merge mapped file;</li>
    <li>(9)mem：memory-mapped file;</li>
    <li>(10)mmap：memory-mapped device;</li>
    <li>(11)pd：parent directory;</li>
    <li>(12)rtd：root directory;</li>
    <li>(13)tr：kernel trace file (OpenBSD);</li>
    <li>(14)v86 VP/ix mapped file;</li>
    <li>(15)0：表示标准输出</li>
    <li>(16)1：表示标准输入</li>
    <li>(17)2：表示标准错误</li>
   </ul> </li>
  <li><p>一般在标准输出、标准错误、标准输入后还跟着文件状态模式：r、w、u等</p> 
   <ul> 
    <li>(1)u：表示该文件被打开并处于读取/写入模式</li>
    <li>(2)r：表示该文件被打开并处于只读模式</li>
    <li>(3)w：表示该文件被打开并处于</li>
    <li>(4)空格：表示该文件的状态模式为unknow，且没有锁定</li>
    <li>(5)-：表示该文件的状态模式为unknow，且被锁定</li>
   </ul> </li>
  <li>同时在文件状态模式后面，还跟着相关的锁
   <ul> 
    <li>(1)N：for a Solaris NFS lock of unknown type;</li>
    <li>(2)r：for read lock on part of the file;</li>
    <li>(3)R：for a read lock on the entire file;</li>
    <li>(4)w：for a write lock on part of the file;(文件的部分写锁)</li>
    <li>(5)W：for a write lock on the entire file;(整个文件的写锁)</li>
    <li>(6)u：for a read and write lock of any length;</li>
    <li>(7)U：for a lock of unknown type;</li>
    <li>(8)x：for an SCO OpenServer Xenix lock on part of the file;</li>
    <li>(9)X：for an SCO OpenServer Xenix lock on the entire file;</li>
    <li>(10)space：if there is no lock.</li>
   </ul> </li>
  <li>TYPE：文件类型，如DIR、REG等，常见的文件类型
   <ul> 
    <li>(1)DIR：表示目录</li>
    <li>(2)CHR：表示字符类型</li>
    <li>(3)BLK：块设备类型</li>
    <li>(4)UNIX： UNIX 域套接字</li>
    <li>(5)FIFO：先进先出 (FIFO) 队列</li>
    <li>(6)IPv4：网际协议 (IP) 套接字</li>
   </ul> </li>
  <li>DEVICE：指定磁盘的名称</li>
  <li>SIZE：文件的大小</li>
  <li>NODE：索引节点(文件在磁盘上的标识)</li>
  <li>NAME：打开文件的确切名称</li>
 </ul> 
 <h3 id="h3--2-"><a name="实例2：查看谁正在使用某个文件，也就是说查找某个文件相关的进程" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例2：查看谁正在使用某个文件，也就是说查找某个文件相关的进程</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof /bin/bash
</code></pre> 
 <p>输出：</p> 
 <pre><code class="lang-shell">[root@localhost yiibai]# lsof /bin/bash
COMMAND  PID   USER  FD   TYPE DEVICE SIZE/OFF  NODE NAME
bash    2240   root txt    REG  253,0   960392 66362 /usr/bin/bash
bash    2261   root txt    REG  253,0   960392 66362 /usr/bin/bash
bash    2278 yiibai txt    REG  253,0   960392 66362 /usr/bin/bash
bash    2454   root txt    REG  253,0   960392 66362 /usr/bin/bash
bash    2490 yiibai txt    REG  253,0   960392 66362 /usr/bin/bash
bash    2706   root txt    REG  253,0   960392 66362 /usr/bin/bash
[root@localhost yiibai]#
</code></pre> 
 <h3 id="h3--3-"><a name="实例3：递归查看某个目录的文件信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例3：递归查看某个目录的文件信息</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof /home/yiibai
</code></pre> 
 <p>输出：</p> 
 <pre><code class="lang-shell">[root@localhost yiibai]# lsof /home/yiibai
COMMAND    PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
bash      2278 yiibai  cwd    DIR  253,2     4096   68 /home/yiibai
python    2291 yiibai  cwd    DIR  253,2     4096   68 /home/yiibai
bash      2454   root  cwd    DIR  253,2     4096   68 /home/yiibai
bash      2490 yiibai  cwd    DIR  253,2     4096   68 /home/yiibai
bash      2706   root  cwd    DIR  253,2     4096   68 /home/yiibai
sftp-serv 2738 yiibai  cwd    DIR  253,2     4096   68 /home/yiibai
lsof      2766   root  cwd    DIR  253,2     4096   68 /home/yiibai
lsof      2767   root  cwd    DIR  253,2     4096   68 /home/yiibai
[root@localhost yiibai]#
</code></pre> 
 <p>说明：使用了<code>+D</code>，对应目录下的所有子目录和文件都会被列出</p> 
 <h3 id="h3--4-d-"><a name="实例4：不使用+D选项，遍历查看某个目录的所有文件信息的方法" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例4：不使用+D选项，遍历查看某个目录的所有文件信息的方法</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell"> lsof |grep '/home/yiibai'
</code></pre> 
 <p>输出：</p> 
 <pre><code class="lang-shell">[root@localhost yiibai]#  lsof |grep '/home/yiibai'
bash      2278       yiibai  cwd       DIR              253,2      4096         68 /home/yiibai
python    2291       yiibai  cwd       DIR              253,2      4096         68 /home/yiibai
python    2291       yiibai    1w      REG              253,2         0        100 /home/yiibai/nohup.out
python    2291       yiibai    2w      REG              253,2         0        100 /home/yiibai/nohup.out
bash      2454         root  cwd       DIR              253,2      4096         68 /home/yiibai
bash      2490       yiibai  cwd       DIR              253,2      4096         68 /home/yiibai
bash      2706         root  cwd       DIR              253,2      4096         68 /home/yiibai
sftp-serv 2738       yiibai  cwd       DIR              253,2      4096         68 /home/yiibai
lsof      2780         root  cwd       DIR              253,2      4096         68 /home/yiibai
grep      2781         root  cwd       DIR              253,2      4096         68 /home/yiibai
lsof      2782         root  cwd       DIR              253,2      4096         68 /home/yiibai
[root@localhost yiibai]#
</code></pre> 
 <h3 id="h3--5-"><a name="实例5：列出某个用户打开的文件信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例5：列出某个用户打开的文件信息</h3>
 <p>命令：</p>   
 <pre><code class="lang-shell">lsof -u username
</code></pre> 
 <p><strong>说明: </strong></p> 
 <ul> 
  <li><code>-u</code> 选项，<code>u</code>其实是<code>user</code>的缩写</li>
 </ul> 
 <h3 id="h3--6-"><a name="实例6：列出某个程序进程所打开的文件信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例6：列出某个程序进程所打开的文件信息</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -c mysql
</code></pre> 
 <p><strong>说明:</strong></p> 
 <ul> 
  <li><code>-c</code> 选项将会列出所有以mysql这个进程开头的程序的文件，其实你也可以写成 lsof | grep mysql, 但是第一种方法明显比第二种方法要少打几个字符了</li>
 </ul> 
 <h3 id="h3--7-"><a name="实例7：列出多个进程多个打开的文件信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例7：列出多个进程多个打开的文件信息</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -c mysql -c apache
</code></pre> 
 <h3 id="h3--8-"><a name="实例8：列出某个用户以及某个进程所打开的文件信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例8：列出某个用户以及某个进程所打开的文件信息</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof  -u test -c mysql
</code></pre> 
 <p><strong>说明：</strong><br>用户与进程可相关，也可以不相关</p> 
 <h3 id="h3--9-"><a name="实例9：列出除了某个用户外的被打开的文件信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例9：列出除了某个用户外的被打开的文件信息</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -u ^root
</code></pre> 
 <p><strong>说明：</strong><br>^这个符号在用户名之前，将会把是root用户打开的进程不让显示</p> 
 <h3 id="h3--10-"><a name="实例10：通过某个进程号显示该进行打开的文件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例10：通过某个进程号显示该进行打开的文件</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -p 1
</code></pre> 
 <h3 id="h3--11-"><a name="实例11：列出多个进程号对应的文件信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例11：列出多个进程号对应的文件信息</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -p 1,2,3
</code></pre> 
 <h3 id="h3--12-"><a name="实例12：列出除了某个进程号，其他进程号所打开的文件信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例12：列出除了某个进程号，其他进程号所打开的文件信息</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -p ^1
</code></pre> 
 <h3 id="h3--13-"><a name="实例13：列出所有的网络连接" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例13：列出所有的网络连接</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -i
</code></pre> 
 <h3 id="h3--14-tcp-"><a name="实例14：列出所有tcp 网络连接信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例14：列出所有tcp 网络连接信息</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -i tcp
</code></pre> 
 <h3 id="h3--15-udp-"><a name="实例15：列出所有udp网络连接信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例15：列出所有udp网络连接信息</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -i udp
</code></pre> 
 <h3 id="h3--16-"><a name="实例16：列出谁在使用某个端口" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例16：列出谁在使用某个端口</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -i :8080
</code></pre> 
 <h3 id="h3--17-udp-"><a name="实例17：列出谁在使用某个特定的udp端口" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例17：列出谁在使用某个特定的udp端口</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -i udp:5500
</code></pre> 
 <p>或者：特定的tcp端口<br>命令：</p> 
 <pre><code class="lang-shell">lsof -i tcp:8081
</code></pre> 
 <h3 id="h3--18-"><a name="实例18：列出某个用户的所有活跃的网络端口" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例18：列出某个用户的所有活跃的网络端口</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -a -u test -i
</code></pre> 
 <h3 id="h3--19-"><a name="实例19：列出所有网络文件系统" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例19：列出所有网络文件系统</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -N
</code></pre> 
 <h3 id="h3--20-socket-"><a name="实例20：域名socket文件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例20：域名socket文件</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -u
</code></pre> 
 <h3 id="h3--21-"><a name="实例21：某个用户组所打开的文件信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例21：某个用户组所打开的文件信息</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -g 5555
</code></pre> 
 <h3 id="h3--22-"><a name="实例22：根据文件描述列出对应的文件信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例22：根据文件描述列出对应的文件信息</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -d description(like 2)
</code></pre> 
 <p>例如：lsof -d txt<br>例如：lsof -d 1<br>例如：lsof -d 2<br><strong>说明：</strong><br>0表示标准输入，1表示标准输出，2表示标准错误，从而可知：所以大多数应用程序所打开的文件的 FD 都是从 3 开始</p> 
 <h3 id="h3--23-"><a name="实例23：根据文件描述范围列出文件信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例23：根据文件描述范围列出文件信息</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -d 2-3
</code></pre> 
 <h3 id="h3--24-command-sshd-txt-"><a name="实例24：列出COMMAND列中包含字符串”sshd”，且文件描符的类型为txt的文件信息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例24：列出COMMAND列中包含字符串”sshd”，且文件描符的类型为txt的文件信息</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -c sshd -a -d txt
</code></pre> 
 <p>输出：</p> 
 <pre><code class="lang-shell">[root@localhost yiibai]# lsof -c sshd -a -d txt
COMMAND  PID   USER  FD   TYPE DEVICE SIZE/OFF     NODE NAME
sshd    1107   root txt    REG  253,0   819640 34027130 /usr/sbin/sshd
sshd    2257   root txt    REG  253,0   819640 34027130 /usr/sbin/sshd
sshd    2733   root txt    REG  253,0   819640 34027130 /usr/sbin/sshd
sshd    2737 yiibai txt    REG  253,0   819640 34027130 /usr/sbin/sshd
[root@localhost yiibai]# lsof -c python -a -d bin
[root@localhost yiibai]# lsof -c python -a -d txt
COMMAND  PID   USER  FD   TYPE DEVICE SIZE/OFF   NODE NAME
python  2291 yiibai txt    REG  253,0     7136 141693 /usr/bin/python2.7
</code></pre> 
 <h3 id="h3--25-1234-ipv4-network-files"><a name="实例25：列出被进程号为1234的进程所打开的所有IPV4 network files" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例25：列出被进程号为1234的进程所打开的所有IPV4 network files</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -i 4 -a -p 22
</code></pre> 
 <h3 id="h3--26-localhost-20-21-22-25-53-80-3-lsof-"><a name="实例26：列出目前连接主机 localhost 上端口为：20，21，22，25，53，80相关的所有文件信息，且每隔3秒不断的执行lsof指令" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例26：列出目前连接主机 localhost 上端口为：20，21，22，25，53，80相关的所有文件信息，且每隔3秒不断的执行lsof指令</h3>
 <p>命令：</p> 
 <pre><code class="lang-shell">lsof -i @localhost:20,21,22,25,53,80  -r  3
</code></pre>
 <br>      
</div></body></html>
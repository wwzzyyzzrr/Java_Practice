<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Solr索引数据</h1><div style="width:100%;float:left;" class="article-content">   
 <p>一般来说，索引是系统地排列文档或(其他实体)。索引使用户能够在文档中快速地查找信息。</p> 
 <ul> 
  <li>索引集合，解析和存储文档。</li>
  <li>索引是为了在查找所需文档时提高搜索查询的速度和性能。</li>
 </ul> 
 <h2 id="h2--apache-solr-"><a name="在Apache Solr中的索引" class="reference-link"></a><span class="header-link octicon octicon-link"></span>在Apache Solr中的索引</h2>
 <p>在Apache Solr中，我们可以索引(添加，删除，修改)各种文档格式，如xml，csv，pdf等。可以通过几种方式向Solr索引添加数据。<br>在本章中，将讨论创建索引的几个方法 -</p> 
 <ul> 
  <li>使用Solr Web界面。</li>
  <li>使用任何客户端API(如Java，Python等)。</li>
  <li>使用提交工具。</li>
 </ul> 
 <p>在本章中，将讨论如何使用各种接口(命令行，Web界面和Java客户端API)向<strong>Apache Solr</strong>的索引添加数据，</p> 
 <h2 id="h2--post-"><a name="使用Post命令添加文档" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用Post命令添加文档</h2>
 <p>Solr在其<code>bin/</code>目录中有一个<code>post</code>命令。使用这个命令，可以在<code>Apache Solr</code>中索引各种格式的文件，例如JSON，XML，CSV。</p> 
 <p>进入到Apache Solr的<code>bin</code>目录并执行<code>post</code>命令的<code>-h</code>选项，如以下代码块所示。</p> 
 <pre><code class="lang-shell">yiibai@ubuntu:/usr/local/solr-6.4.0/bin$ cd $SOLR_HOME 
yiibai@ubuntu:/usr/local/solr-6.4.0/bin$ ./post -h
</code></pre> 
 <p>在执行上述命令时，将得到<code>post</code>命令的选项列表，如下所示。</p> 
 <pre><code class="lang-shell">Usage: post -c &lt;collection&gt; [OPTIONS] &lt;files|directories|urls|-d [".."]&gt; 
or post –help  
   collection name defaults to DEFAULT_SOLR_COLLECTION if not specified  
OPTIONS 
======= 
Solr options: 
   -url &lt;base Solr update URL&gt; (overrides collection, host, and port) 
   -host &lt;host&gt; (default: localhost) 
   -p or -port &lt;port&gt; (default: 8983) 
   -commit yes|no (default: yes)  

Web crawl options:  
   -recursive &lt;depth&gt; (default: 1) 
   -delay &lt;seconds&gt; (default: 10)  

Directory crawl options: 
   -delay &lt;seconds&gt; (default: 0)  

stdin/args options: 
   -type &lt;content/type&gt; (default: application/xml)  

Other options: 
   -filetypes &lt;type&gt;[,&lt;type&gt;,...] (default:   
   xml,json,jsonl,csv,pdf,doc,docx,ppt,pptx,xls,xlsx,odt,odp,ods,ott,otp,ots,
   rtf,htm,html,txt,log) 
   -params "&lt;key&gt; = &lt;value&gt;[&amp;&lt;key&gt; = &lt;value&gt;...]" (values must be 
   URL-encoded; these pass through to Solr update request) 
   -out yes|no (default: no; yes outputs Solr response to console) 
   -format Solr (sends application/json content as Solr commands 
   to /update instead of /update/json/docs)  

Examples: 
* JSON file:./post -c wizbang events.json 
* XML files: ./post -c records article*.xml 
* CSV file: ./post -c signals LATEST-signals.csv 
* Directory of files: ./post -c myfiles ~/Documents 
* Web crawl: ./post -c gettingstarted http://lucene.apache.org/Solr -recursive 1 -delay 1 
* Standard input (stdin): echo '{commit: {}}' | ./post -c my_collection -
type application/json -out yes –d 
* Data as string: ./post -c signals -type text/csv -out yes -d $'id,value\n1,0.47'
</code></pre> 
 <h3 id="h3--"><a name="示例`" class="reference-link"></a><span class="header-link octicon octicon-link"></span>示例`</h3>
 <p>假设有一个名称为<code>sample.csv</code>的文件，其内容如下(这个文件也在`bin目录中)。<br>上述数据集包含个人详细信息，如学生ID，名字，姓氏，电话和城市。数据集的CSV文件如下所示。 在这里必须注意：数据记录的第一行。</p> 
 <pre><code>id,    first_name,   last_name,   phone_no,      location 
001,   Pruthvi,      Reddy,       9848022337,    Hyderabad 
002,   kasyap,       Sastry,      9848022338,    Vishakapatnam 
003,   Rajesh,       Khanna,      9848022339,    Delhi 
004,   Preethi,      Agarwal,     9848022330,    Pune 
005,   Trupthi,      Mohanty,     9848022336,    Bhubaneshwar 
006,   Archana,      Mishra,      9848022335,    Chennai
</code></pre>
 <p>可以使用<code>post</code>命令在名称为<strong>Solr_sample</strong>的核心下，对此数据编制索引，如下所示：</p> 
 <pre><code class="lang-shell">yiibai@ubuntu:/usr/local/solr-6.4.0/bin$ ./post -c solr_sample sample.csv
</code></pre> 
 <p>在执行上述命令时，给定文档在指定的核心下会生成索引，生成以下输出。</p> 
 <pre><code class="lang-shell">yiibai@ubuntu:/usr/local/solr-6.4.0/bin$ ./post -c solr_sample sample.csv
/usr/local/jdk1.8.0_65/bin/java -classpath /usr/local/solr-6.4.0/dist/solr-core-6.4.0.jar -Dauto=yes -Dc=solr_sample -Ddata=files org.apache.solr.util.SimplePostTool sample.csv
SimplePostTool version 5.0.0
Posting files to [base] url http://localhost:8983/solr/solr_sample/update...
Entering auto mode. File endings considered are xml,json,jsonl,csv,pdf,doc,docx,ppt,pptx,xls,xlsx,odt,odp,ods,ott,otp,ots,rtf,htm,html,txt,log
POSTing file sample.csv (text/csv) to [base]
1 files indexed.
COMMITting Solr index changes to http://localhost:8983/solr/solr_sample/update...
Time spent: 0:00:00.663
</code></pre> 
 <p>访问Solr Web UI的主页使用以下URL -</p> 
 <ul> 
  <li><a target="_blank" href="http://localhost:8983/">http://localhost:8983/</a></li>
 </ul> 
 <p>选择核心<code>Solr_sample</code>。 默认情况下，请求处理程序是<code>/select</code>，查询为“<code>：</code>”。 不做任何修改，单击页面底部的<strong>ExecuteQuery</strong>按钮。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201702/0402/913090243_42096.png" alt=""></p> 
 <p>在执行查询时，可以以JSON格式(默认)观察索引的CSV文档的内容，如下面的屏幕截图所示。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201702/0402/172090244_73539.png" alt=""></p> 
 <blockquote> 
  <p>注意 - 以相同的方式，可以索引其他文件格式，如JSON，XML，CSV等。</p> 
 </blockquote> 
 <h2 id="h2--solr-web-"><a name="使用Solr Web界面添加文档" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用Solr Web界面添加文档</h2>
 <p>还可以使用Solr提供的Web界面对文档编制索引。看看下面如何索引JSON格式的文档。</p>   
 <pre><code class="lang-json">[ 
   { 
      "id" : "001", 
      "name" : "Ram", 
      "age" : 53, 
      "Designation" : "Manager", 
      "Location" : "Hyderabad", 
   }, 
   { 
      "id" : "002", 
      "name" : "Robert", 
      "age" : 43, 
      "Designation" : "SR.Programmer", 
      "Location" : "Chennai", 
   }, 
   { 
      "id" : "003", 
      "name" : "Rahim", 
      "age" : 25, 
      "Designation" : "JR.Programmer", 
      "Location" : "Delhi", 
   } 
]
</code></pre> 
 <h3 id="h3--1-"><a name="第1步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第1步</h3>
 <p>使用以下URL打开Solr Web界面 -</p> 
 <ul> 
  <li><a target="_blank" href="http://localhost:8983/">http://localhost:8983/</a></li>
 </ul> 
 <h3 id="h3--2-"><a name="第2步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第2步</h3>
 <p>选择核心<code>Solr_sample</code>。 默认情况下，<code>Request Handler</code>，<code>Common Within</code>，<code>Overwrite</code>和<code>Boost</code>字段的值分别为<code>/update</code>，<code>1000</code>，<code>true</code>和<code>1.0</code>，如下面的屏幕截图所示。<br><img src="http://www.yiibai.com/uploads/images/201702/0402/413090250_71138.png" alt=""></p> 
 <p>现在，从JSON，CSV，XML等中选择所需的文档格式。在文本区域中键入要索引的文档，然后单击提交文档按钮，如下面的屏幕截图所示。<br><img src="http://www.yiibai.com/uploads/images/201702/0402/281100210_82522.png" alt=""></p> 
 <h2 id="h2--java-client-api-"><a name="使用Java Client API添加文档" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用Java Client API添加文档</h2>
 <p>以下是Java程序向Apache Solr索引添加文档代码。将代码保存在<code>AddingDocument.java</code>文件中。</p> 
 <pre><code class="lang-java">import java.io.IOException;  

import org.apache.Solr.client.Solrj.SolrClient; 
import org.apache.Solr.client.Solrj.SolrServerException; 
import org.apache.Solr.client.Solrj.impl.HttpSolrClient; 
import org.apache.Solr.common.SolrInputDocument; 

public class AddingDocument { 
   public static void main(String args[]) throws Exception { 
      //Preparing the Solr client 
      String urlString = "http://localhost:8983/Solr/my_core"; 
      SolrClient Solr = new HttpSolrClient.Builder(urlString).build();   

      //Preparing the Solr document 
      SolrInputDocument doc = new SolrInputDocument(); 

      //Adding fields to the document 
      doc.addField("id", "003"); 
      doc.addField("name", "Rajaman"); 
      doc.addField("age","34"); 
      doc.addField("addr","vishakapatnam"); 

      //Adding the document to Solr 
      Solr.add(doc);         

      //Saving the changes 
      Solr.commit(); 
      System.out.println("Documents added"); 
   } 
}
</code></pre> 
 <p>通过在终端中执行以下命令编译上述代码 -</p> 
 <pre><code class="lang-bash">
yiibai@ubuntu:/usr/local/solr-6.4.0/bin$ javac AddingDocument.java
yiibai@ubuntu:/usr/local/solr-6.4.0/bin$ java AddingDocument
</code></pre> 
 <p>执行上述命令后，将得到以下输出。</p> 
 <pre><code class="lang-bash">Documents added
</code></pre>
 <br>      
</div></body></html>
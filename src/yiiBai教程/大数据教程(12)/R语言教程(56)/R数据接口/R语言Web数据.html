<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">R语言Web数据</h1><div style="width:100%;float:left;" class="article-content">   
 <p>许多网站为用户提供一些公开的数据。 例如，世界卫生组织(WHO)以CSV，txt和XML文件的形式提供关于健康和医疗信息的报告。 使用R程序，我们可以从这些网站以编程方式提取特定的数据。 用于从网络中废弃数据的R中的一些包是 - <em>RCurl</em>，<em>XML</em>和<em>stringr</em>，用于连接URL，识别文件所需的链接并将其下载到本地环境。</p> 
 <h2 id="h2--r-"><a name="安装R包" class="reference-link"></a><span class="header-link octicon octicon-link"></span>安装R包</h2>
 <p>需要以下包才能处理URL和链接到文件。 如果它们在R环境中不可用，则可以使用以下命令安装它们。</p> 
 <pre><code class="lang-r">install.packages("RCurl")
install.packages("XML")
install.packages("stringr")
install.packages("plyr")
</code></pre> 
 <h2 id="h2-u51C6u5907u8F93u5165u6570u636E"><a name="准备输入数据" class="reference-link"></a><span class="header-link octicon octicon-link"></span>准备输入数据</h2>
 <p>我们将访问URL<a target="_blank" href="http://www.geos.ed.ac.uk/~weather/jcmb_ws/" title="天气数据">天气数据</a>，并使用R来下载<code>2015</code>年天气的CSV文件。</p> 
 <h2 id="h2-u4F8Bu5B50"><a name="例子" class="reference-link"></a><span class="header-link octicon octicon-link"></span>例子</h2>
 <p>我们将使用函数<code>getHTMLLinks()</code>来收集文件的URL。然后将使用函数<code>download.file()</code>将文件保存到本地系统。由于我们将为多个文件一次又一次地应用相同的代码，所以将创建一个被多次调用的函数。文件名作为参数以R列表对象的形式传递给此函数。</p> 
 <pre><code class="lang-r"># Read the URL.
url &lt;- "http://www.geos.ed.ac.uk/~weather/jcmb_ws/"

# Gather the html links present in the webpage.
links &lt;- getHTMLLinks(url)

# Identify only the links which point to the JCMB 2015 files. 
filenames &lt;- links[str_detect(links, "JCMB_2015")]

# Store the file names as a list.
filenames_list &lt;- as.list(filenames)

# Create a function to download the files by passing the URL and filename list.
downloadcsv &lt;- function (mainurl,filename) {
   filedetails &lt;- str_c(mainurl,filename)
   download.file(filedetails,filename)
}

# Now apply the l_ply function and save the files into the current R working directory.
l_ply(filenames,downloadcsv,mainurl = "http://www.geos.ed.ac.uk/~weather/jcmb_ws/")
</code></pre> 
 <h2 id="h2-u9A8Cu8BC1u6587u4EF6u4E0Bu8F7D"><a name="验证文件下载" class="reference-link"></a><span class="header-link octicon octicon-link"></span>验证文件下载</h2>
 <p>运行上述代码后，可以在当前R工作目录中找到以下文件。</p>   
 <pre><code class="lang-shell">"JCMB_2015.csv" "JCMB_2015_Apr.csv" "JCMB_2015_Feb.csv" "JCMB_2015_Jan.csv"
   "JCMB_2015_Mar.csv"
</code></pre>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">R语言连接数据库（MySQL)</h1><div style="width:100%;float:left;" class="article-content">   
 <p>关系数据库系统中的数据是以规范化格式存储的。 所以，为了进行统计计算，我们需要非常高级和复杂的SQL查询。但是R可以很容易地连接到许多关系数据库，如：<a target="_blank" href="http://www.yiibai.com/mysql/" title="MySQL">MySQL</a>，<a target="_blank" href="http://www.oraok.com/" title="Oracle">Oracle</a>，Sql Server等，并将它们作为数据帧提取。 当从数据库中读取数据到R环境中可用以后，它就成为一个正常的R数据集，可以使用所有强大的软件包和函数进行操作或分析。</p> 
 <p>在本教程中，我们将使用R编程语言连接到MySQL数据库。</p> 
 <h2 id="h2-rmysql-"><a name="RMySQL包" class="reference-link"></a><span class="header-link octicon octicon-link"></span>RMySQL包</h2>
 <p>R有一个名为<code>RMySQL</code>的内置包，它提供与MySql数据库之间的本机连接。您可以使用以下命令在R环境中安装此软件包。</p> 
 <pre><code class="lang-r">install.packages("RMySQL")
</code></pre> 
 <h2 id="h2--r-mysql"><a name="将R连接到MySql" class="reference-link"></a><span class="header-link octicon octicon-link"></span>将R连接到MySql</h2>
 <p>当安装了软件包(<code>RMySQL</code>)之后，我们在R中创建一个连接对象以连接到数据库。它需要用户名，密码，数据库名称和主机名等数据库连接所需要的信息。</p> 
 <pre><code class="lang-r">library("RMySQL");
# Create a connection Object to MySQL database.
# We will connect to the sampel database named "testdb" that comes with MySql installation.
mysqlconnection = dbConnect(MySQL(), user = 'root', password = '123456', dbname = 'testdb',
   host = 'localhost')

# List the tables available in this database.
dbListTables(mysqlconnection)
</code></pre> 
 <p>当我们执行上述代码时，会产生以下结果(当前数据中的所有表) -</p> 
 <pre><code class="lang-shell"> [1] "articles"       "contacts"       "demos"          "divisions"     
 [5] "items"          "luxuryitems"    "order"          "persons"       
 [9] "posts"          "revenues"       "special_isnull" "t"             
[13] "tbl"            "tmp"            "v1"             "vparts"
</code></pre> 
 <h2 id="h2-u67E5u8BE2u8868"><a name="查询表" class="reference-link"></a><span class="header-link octicon octicon-link"></span>查询表</h2>
 <p>可以使用<code>dbSendQuery()</code>函数查询MySQL中的数据库表。该查询在MySql中执行，并使用R 的<code>fetch()</code>函数返回结果集,最后将此结果作为数据帧存储在R中。</p> 
 <p>假设要查询的表是：<code>persons</code>，其创建语句和数据如下 - </p> 
 <pre><code class="lang-sql">/*
Navicat MySQL Data Transfer

Source Server         : localhost-57
Source Server Version : 50709
Source Host           : localhost:3306
Source Database       : testdb

Target Server Type    : MYSQL
Target Server Version : 50709
File Encoding         : 65001

Date: 2017-08-24 00:35:17
*/

SET FOREIGN_KEY_CHECKS=0;

-- ----------------------------
-- Table structure for `persons`
-- ----------------------------
DROP TABLE IF EXISTS `persons`;
CREATE TABLE `persons` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `full_name` varchar(255) NOT NULL,
  `date_of_birth` date NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of persons
-- ----------------------------
INSERT INTO `persons` VALUES ('1', 'John Doe', '1990-01-01');
INSERT INTO `persons` VALUES ('2', 'David Taylor', '1989-06-06');
INSERT INTO `persons` VALUES ('3', 'Peter Drucker', '1988-03-02');
INSERT INTO `persons` VALUES ('4', 'Lily Minsu', '1992-05-05');
INSERT INTO `persons` VALUES ('5', 'Mary William', '1995-12-01');
</code></pre> 
 <p>将上述表导入到数据库中，并创建以下R代码，用来执行从数据库的表中查询数据 -</p> 
 <pre><code class="lang-r">library("RMySQL");
# Create a connection Object to MySQL database.
# We will connect to the sampel database named "testdb" that comes with MySql installation.
mysqlconnection = dbConnect(MySQL(), user = 'root', password = '123456', dbname = 'testdb',
   host = 'localhost');
# Query the "actor" tables to get all the rows.
result = dbSendQuery(mysqlconnection, "select * from persons")

# Store the result in a R data frame object. n = 5 is used to fetch first 5 rows.
data.frame = fetch(result, n = 5)
print(data.frame)
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">  id     full_name date_of_birth
1  1      John Doe    1990-01-01
2  2  David Taylor    1989-06-06
3  3 Peter Drucker    1988-03-02
4  4    Lily Minsu    1992-05-05
5  5  Mary William    1995-12-01
</code></pre> 
 <h2 id="h2-u4F7Fu7528u8FC7u6EE4u5B50u53E5u67E5u8BE2"><a name="使用过滤子句查询" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用过滤子句查询</h2>
 <p>我们可以传递任何有效的选择查询来获取结果，如下代码所示 - </p> 
 <pre><code class="lang-r">library("RMySQL");
# Create a connection Object to MySQL database.
# We will connect to the sampel database named "testdb" that comes with MySql installation.
mysqlconnection = dbConnect(MySQL(), user = 'root', password = '123456', dbname = 'testdb',
   host = 'localhost');
result = dbSendQuery(mysqlconnection, "select * from persons where date_of_birth = '1990-01-01'")

# Fetch all the records(with n = -1) and store it as a data frame.
data.frame = fetch(result, n = -1)
print(data.frame)
</code></pre> 
 <p>当我们执行上述代码时，会产生以下结果 -</p>   
 <pre><code class="lang-shell">  id full_name date_of_birth
1  1  John Doe    1990-01-01
</code></pre> 
 <h2 id="h2-u66F4u65B0u8868u4E2Du7684u884Cu8BB0u5F55"><a name="更新表中的行记录" class="reference-link"></a><span class="header-link octicon octicon-link"></span>更新表中的行记录</h2>
 <p>可以通过将更新查询传递给<code>dbSendQuery()</code>函数来更新MySQL表中的行。</p> 
 <pre><code class="lang-r">dbSendQuery(mysqlconnection, "update persons set date_of_birth = '1999-01-01' where id=3")
</code></pre> 
 <p>执行上述代码后，可以看到在MySql已经更新<code>persons</code>表中对应的记录。</p> 
 <h2 id="h2-u5C06u6570u636Eu63D2u5165u5230u8868u4E2D"><a name="将数据插入到表中" class="reference-link"></a><span class="header-link octicon octicon-link"></span>将数据插入到表中</h2>
 <p>参考以下代码实现 - </p> 
 <pre><code class="lang-r">library("RMySQL");
# Create a connection Object to MySQL database.
# We will connect to the sampel database named "testdb" that comes with MySql installation.
mysqlconnection = dbConnect(MySQL(), user = 'root', password = '123456', dbname = 'testdb',
   host = 'localhost');
dbSendQuery(mysqlconnection,
   "insert into persons(full_name, date_of_birth) values ('Maxsu', '1992-01-01')"
)
</code></pre> 
 <p>执行上述代码后，可以看到向MySql的<code>persons</code>表中，插入一行数据。</p> 
 <h2 id="h2--mysql-"><a name="在MySql中创建表" class="reference-link"></a><span class="header-link octicon octicon-link"></span>在MySql中创建表</h2>
 <p>我们通过使用<code>dbWriteTable()</code>函数向MySql中创建表。它会覆盖表，如果它已经存在并且以数据帧为输入。</p> 
 <pre><code class="lang-r">library("RMySQL");
# Create the connection object to the testdb database where we want to create the table.
mysqlconnection = dbConnect(MySQL(), user = 'root', password = '123456', dbname = 'testdb',host = 'localhost')

# Use the R data frame "mtcars" to create the table in MySql.
# All the rows of mtcars are taken inot MySql.
dbWriteTable(mysqlconnection, "mtcars", mtcars[, ], overwrite = TRUE)
</code></pre> 
 <p>执行上述代码后，我们可以看到在MySql数据库中创建一个名称为：<em>mtcars</em>的表，并有填充了一些数据。</p> 
 <h2 id="h2--mysql-"><a name="在MySql中删除表" class="reference-link"></a><span class="header-link octicon octicon-link"></span>在MySql中删除表</h2>
 <p>我们可以删除MySql数据库中的表，将<code>drop table</code>语句传递到<code>dbSendQuery()</code>函数中，就像在SQL中查询表中的数据一样。</p> 
 <pre><code class="lang-r">dbSendQuery(mysqlconnection, 'drop table if exists mtcars')
</code></pre> 
 <p>执行上述代码后，我们可以看到MySql数据库中的<code>mtcars</code>表被删除。</p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Pandas缺失数据</h1><div style="width:100%;float:left;" class="article-content">   
 <p>数据丢失(缺失)在现实生活中总是一个问题。 机器学习和数据挖掘等领域由于数据缺失导致的数据质量差，在模型预测的准确性上面临着严重的问题。 在这些领域，缺失值处理是使模型更加准确和有效的重点。</p> 
 <h2 id="h2--"><a name="何时以及为什么数据丢失？" class="reference-link"></a><span class="header-link octicon octicon-link"></span>何时以及为什么数据丢失？</h2>
 <p>想象一下有一个产品的在线调查。很多时候，人们不会分享与他们有关的所有信息。 很少有人分享他们的经验，但不是他们使用产品多久; 很少有人分享使用产品的时间，经验，但不是他们的个人联系信息。 因此，以某种方式或其他方式，总会有一部分数据总是会丢失，这是非常常见的现象。</p> 
 <p>现在来看看如何处理使用<em>Pandas</em>的缺失值(如<code>NA</code>或<code>NaN</code>)。</p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np

df = pd.DataFrame(np.random.randn(5, 3), index=['a', 'c', 'e', 'f',
'h'],columns=['one', 'two', 'three'])

df = df.reindex(['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'])

print (df)
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">        one       two     three
a  0.691764 -0.118095 -0.950871
b       NaN       NaN       NaN
c -0.886898  0.053705 -1.269253
d       NaN       NaN       NaN
e -0.344967 -0.837128  0.730831
f -1.193740  1.767796  0.888104
g       NaN       NaN       NaN
h -0.755934 -1.331638  0.272248
</code></pre> 
 <p>使用重构索引(reindexing)，创建了一个缺少值的DataFrame。 在输出中，<code>NaN</code>表示不是数字的值。</p> 
 <h2 id="h2-u68C0u67E5u7F3Au5931u503C"><a name="检查缺失值" class="reference-link"></a><span class="header-link octicon octicon-link"></span>检查缺失值</h2>
 <p>为了更容易地检测缺失值(以及跨越不同的数组<code>dtype</code>)，Pandas提供了<code>isnull()</code>和<code>notnull()</code>函数，它们也是Series和DataFrame对象的方法 -</p> 
 <p><strong>示例1</strong></p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np

df = pd.DataFrame(np.random.randn(5, 3), index=['a', 'c', 'e', 'f',
'h'],columns=['one', 'two', 'three'])

df = df.reindex(['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'])

print (df['one'].isnull())
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">a    False
b     True
c    False
d     True
e    False
f    False
g     True
h    False
Name: one, dtype: bool
</code></pre> 
 <p><strong>示例2</strong></p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np

df = pd.DataFrame(np.random.randn(5, 3), index=['a', 'c', 'e', 'f',
'h'],columns=['one', 'two', 'three'])

df = df.reindex(['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'])

print (df['one'].notnull())
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">a     True
b    False
c     True
d    False
e     True
f     True
g    False
h     True
Name: one, dtype: bool
</code></pre> 
 <h4 id="h4-u7F3Au5C11u6570u636Eu7684u8BA1u7B97"><a name="缺少数据的计算" class="reference-link"></a><span class="header-link octicon octicon-link"></span>缺少数据的计算</h4>
 <ul> 
  <li>在求和数据时，<code>NA</code>将被视为<code>0</code></li>
  <li>如果数据全部是<code>NA</code>，那么结果将是<code>NA</code></li>
 </ul> 
 <p><strong>实例1</strong></p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np

df = pd.DataFrame(np.random.randn(5, 3), index=['a', 'c', 'e', 'f',
'h'],columns=['one', 'two', 'three'])

df = df.reindex(['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'])

print (df['one'].sum())
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">-2.6163354325445014
</code></pre> 
 <p><strong>示例2</strong></p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np

df = pd.DataFrame(index=[0,1,2,3,4,5],columns=['one','two'])
print (df['one'].sum())
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">nan
</code></pre> 
 <h2 id="h2--"><a name="清理/填充缺少数据" class="reference-link"></a><span class="header-link octicon octicon-link"></span>清理/填充缺少数据</h2>
 <p><em>Pandas</em>提供了各种方法来清除缺失的值。<code>fillna()</code>函数可以通过几种方法用非空数据“填充”<code>NA</code>值，在下面的章节中将学习和使用。</p> 
 <h2 id="h2--nan"><a name="用标量值替换NaN" class="reference-link"></a><span class="header-link octicon octicon-link"></span>用标量值替换NaN</h2>
 <p>以下程序显示如何用<code>0</code>替换<code>NaN</code>。</p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np
df = pd.DataFrame(np.random.randn(3, 3), index=['a', 'c', 'e'],columns=['one',
'two', 'three'])
df = df.reindex(['a', 'b', 'c'])
print (df)
print ("NaN replaced with '0':")
print (df.fillna(0))
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">        one       two     three
a -0.479425 -1.711840 -1.453384
b       NaN       NaN       NaN
c -0.733606 -0.813315  0.476788
NaN replaced with '0':
        one       two     three
a -0.479425 -1.711840 -1.453384
b  0.000000  0.000000  0.000000
c -0.733606 -0.813315  0.476788
</code></pre> 
 <p>在这里填充零值; 当然，也可以填写任何其他的值。</p> 
 <h2 id="h2--na-"><a name="填写NA前进和后退" class="reference-link"></a><span class="header-link octicon octicon-link"></span>填写NA前进和后退</h2>
 <p>使用重构索引章节讨论的填充概念，来填补缺失的值。</p> 
 <table> 
  <thead> 
   <tr> 
    <th>方法</th> 
    <th>动作</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td><code>pad/fill</code></td> 
    <td>填充方法向前</td> 
   </tr> 
   <tr> 
    <td><code>bfill/backfill</code></td> 
    <td>填充方法向后</td> 
   </tr> 
  </tbody> 
 </table> 
 <p><strong>示例1</strong></p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np

df = pd.DataFrame(np.random.randn(5, 3), index=['a', 'c', 'e', 'f',
'h'],columns=['one', 'two', 'three'])
df = df.reindex(['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'])

print (df.fillna(method='pad'))
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p>   
 <pre><code class="lang-shell">        one       two     three
a  0.614938 -0.452498 -2.113057
b  0.614938 -0.452498 -2.113057
c -0.118390  1.333962 -0.037907
d -0.118390  1.333962 -0.037907
e  0.699733  0.502142 -0.243700
f  0.544225 -0.923116 -1.123218
g  0.544225 -0.923116 -1.123218
h -0.669783  1.187865  1.112835
</code></pre> 
 <p><strong>示例2</strong></p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np

df = pd.DataFrame(np.random.randn(5, 3), index=['a', 'c', 'e', 'f',
'h'],columns=['one', 'two', 'three'])

df = df.reindex(['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'])
print (df.fillna(method='backfill'))
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">        one       two     three
a  2.278454  1.550483 -2.103731
b -0.779530  0.408493  1.247796
c -0.779530  0.408493  1.247796
d  0.262713 -1.073215  0.129808
e  0.262713 -1.073215  0.129808
f -0.600729  1.310515 -0.877586
g  0.395212  0.219146 -0.175024
h  0.395212  0.219146 -0.175024
</code></pre> 
 <h2 id="h2-u4E22u5931u7F3Au5C11u7684u503C"><a name="丢失缺少的值" class="reference-link"></a><span class="header-link octicon octicon-link"></span>丢失缺少的值</h2>
 <p>如果只想排除缺少的值，则使用<code>dropna</code>函数和<code>axis</code>参数。 默认情况下，<code>axis = 0</code>，即在行上应用，这意味着如果行内的任何值是<code>NA</code>，那么整个行被排除。</p> 
 <p><strong>实例1</strong></p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np

df = pd.DataFrame(np.random.randn(5, 3), index=['a', 'c', 'e', 'f',
'h'],columns=['one', 'two', 'three'])

df = df.reindex(['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'])
print (df.dropna())
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">        one       two     three
a -0.719623  0.028103 -1.093178
c  0.040312  1.729596  0.451805
e -1.029418  1.920933  1.289485
f  1.217967  1.368064  0.527406
h  0.667855  0.147989 -1.035978
</code></pre> 
 <p><strong>示例2</strong></p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np

df = pd.DataFrame(np.random.randn(5, 3), index=['a', 'c', 'e', 'f',
'h'],columns=['one', 'two', 'three'])

df = df.reindex(['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'])
print (df.dropna(axis=1))
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">Empty DataFrame
Columns: []
Index: [a, b, c, d, e, f, g, h]
</code></pre> 
 <h2 id="h2--"><a name="替换丢失(或)通用值" class="reference-link"></a><span class="header-link octicon octicon-link"></span>替换丢失(或)通用值</h2>
 <p>很多时候，必须用一些具体的值取代一个通用的值。可以通过应用替换方法来实现这一点。</p> 
 <p>用标量值替换<code>NA</code>是<code>fillna()</code>函数的等效行为。</p> 
 <p><strong>示例1</strong></p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np
df = pd.DataFrame({'one':[10,20,30,40,50,2000],
'two':[1000,0,30,40,50,60]})
print (df.replace({1000:10,2000:60}))
</code></pre> 
 <p>执行上面示例，得到以下结果 - </p> 
 <pre><code class="lang-shell">   one  two
0   10   10
1   20    0
2   30   30
3   40   40
4   50   50
5   60   60
</code></pre> 
 <p><strong>示例2</strong></p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np
df = pd.DataFrame({'one':[10,20,30,40,50,2000],
'two':[1000,0,30,40,50,60]})
print (df.replace({1000:10,2000:60}))
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">   one  two
0   10   10
1   20    0
2   30   30
3   40   40
4   50   50
5   60   60
</code></pre>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Pandas稀疏数据</h1><div style="width:100%;float:left;" class="article-content">   
 <p>当任何匹配特定值的数据(NaN/缺失值，尽管可以选择任何值)被省略时，稀疏对象被“压缩”。 一个特殊的SparseIndex对象跟踪数据被“稀疏”的地方。 这将在一个例子中更有意义。 所有的标准Pandas数据结构都应用了<code>to_sparse</code>方法 -</p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np

ts = pd.Series(np.random.randn(10))
ts[2:-2] = np.nan
sts = ts.to_sparse()
print (sts)
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">0   -0.391926
1   -1.774880
2         NaN
3         NaN
4         NaN
5         NaN
6         NaN
7         NaN
8    0.642988
9   -0.373698
dtype: float64
BlockIndex
Block locations: array([0, 8])
Block lengths: array([2, 2])
</code></pre> 
 <p>为了内存效率的原因，所以需要稀疏对象的存在。</p> 
 <p>现在假设有一个大的NA DataFrame并执行下面的代码 -</p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np

df = pd.DataFrame(np.random.randn(10000, 4))
df.ix[:9998] = np.nan
sdf = df.to_sparse()

print (sdf.density)
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">0.0001
</code></pre> 
 <p>通过调用<code>to_dense</code>可以将任何稀疏对象转换回标准密集形式 -</p> 
 <pre><code class="lang-python">import pandas as pd
import numpy as np
ts = pd.Series(np.random.randn(10))
ts[2:-2] = np.nan
sts = ts.to_sparse()
print (sts.to_dense())
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">0   -0.275846
1    1.172722
2         NaN
3         NaN
4         NaN
5         NaN
6         NaN
7         NaN
8   -0.612009
9   -1.413996
dtype: float64
</code></pre> 
 <h2 id="h2--dtypes"><a name="稀疏Dtypes" class="reference-link"></a><span class="header-link octicon octicon-link"></span>稀疏Dtypes</h2>
 <p>稀疏数据应该具有与其密集表示相同的dtype。 目前，支持<code>float64</code>，<code>int64</code>和<code>booldtypes</code>。 取决于原始的<code>dtype</code>，<code>fill_value</code>默认值的更改 -</p> 
 <ul> 
  <li><code>float64</code> − <code>np.nan</code></li>
  <li><code>int64</code> − <code>0</code></li>
  <li><code>bool</code> − <code>False</code></li>
 </ul> 
 <p>执行下面的代码来理解相同的内容 -</p>   
 <pre><code class="lang-python">import pandas as pd
import numpy as np

s = pd.Series([1, np.nan, np.nan])
print (s)
print ("=============================")
s.to_sparse()
print (s)
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">0    1.0
1    NaN
2    NaN
dtype: float64
=============================
0    1.0
1    NaN
2    NaN
dtype: float64
</code></pre>
 <br>      
</div></body></html>
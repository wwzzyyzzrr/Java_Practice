<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">MySQL重命名表</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在本教程中，您将学习如何使用MySQL <code>RENAME TABLE</code>语句和<code>ALTER TABLE</code>语句重命名表。</p> 
 <h2 id="h2-mysql-rename-table-"><a name="MySQL RENAME TABLE语句简介" class="reference-link"></a><span class="header-link octicon octicon-link"></span>MySQL RENAME TABLE语句简介</h2>
 <p>由于业务需求变化，我们需要将当前表重新命名为新表，以更好地反映或表示新情况。 MySQL提供了一个非常有用的语句来更改一个或多个表的名称。</p> 
 <p>要更改一个或多个表，我们使用<code>RENAME TABLE</code>语句如下：</p> 
 <pre><code class="lang-sql">RENAME TABLE old_table_name TO new_table_name;
</code></pre> 
 <p>旧表(<code>old_table_name</code>)必须存在，新表(<code>new_table_name</code>)必须不存在。 如果新表<code>new_table_name</code>存在，则该语句将失败。</p> 
 <p>除了表之外，我们还可以使用<code>RENAME TABLE</code>语句来重命名<a target="_blank" href="http://www.yiibai.com/mysql/views.html" title="视图">视图</a>。</p> 
 <p>在执行<code>RENAME TABLE</code>语句之前，必须确保没有活动事务或<a target="_blank" href="http://www.yiibai.com/mysql/table-locking.html" title="锁定表">锁定表</a>。</p> 
 <blockquote> 
  <p>请注意，不能使用<code>RENAME TABLE</code>语句来重命名<a target="_blank" href="http://www.yiibai.com/mysql/temporary-table.html" title="临时表">临时表</a>，但可以使用<a target="_blank" href="http://www.yiibai.com/mysql/alter-table.html" title="ALTER TABLE语句">ALTER TABLE语句</a>重命名临时表。</p> 
 </blockquote> 
 <p>在安全性方面，我们<a target="_blank" href="http://www.yiibai.com/mysql/grant.html" title="授予旧表">授予旧表</a>的任何权限必须手动迁移到新表。</p> 
 <p>在重命名表之前，应该彻底地评估影响。 例如，应该调查哪些应用程序正在使用该表。 如果表的名称更改，那么引用表名的应用程序代码也需要更改。 此外，您必须手动调整引用该表的其他数据库对象，如<a target="_blank" href="http://www.yiibai.com/mysql/views.html" title="视图">视图</a>，<a target="_blank" href="http://www.yiibai.com/mysql/stored-procedure.html" title="存储过程">存储过程</a>，<a target="_blank" href="http://www.yiibai.com/mysql/triggers.html" title="触发器">触发器</a>，<a target="_blank" href="http://www.yiibai.com/mysql/foreign-key.html" title="外键约束">外键约束</a>等。 我们将在下面的例子中更详细地讨论。</p> 
 <h2 id="h2-mysql-rename-table-"><a name="MySQL RENAME TABLE示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>MySQL RENAME TABLE示例</h2>
 <p><strong>首先</strong>，我们创建一个名为<code>hrdb</code>的新数据库，它由两个表组成：<code>employees</code> 和 <code>departments</code>。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201707/2307/189110738_65195.png" alt=""></p> 
 <p>创建数据库 - </p> 
 <pre><code class="lang-sql">CREATE DATABASE IF NOT EXISTS hrdb;
</code></pre> 
 <p>创建表 - </p> 
 <pre><code class="lang-sql">USE hrdb;

CREATE TABLE departments (
    department_id INT AUTO_INCREMENT PRIMARY KEY,
    dept_name VARCHAR(100)
);

CREATE TABLE employees (
    id int AUTO_INCREMENT primary key,
    first_name varchar(50) not null,
    last_name varchar(50) not null,
    department_id int not null,
    FOREIGN KEY (department_id)
        REFERENCES departments (department_id)
);
</code></pre> 
 <p><strong>其次</strong>，将样本数据插入到 <code>employees</code> 和 <code>departments</code> 表中：</p> 
 <pre><code class="lang-sql">-- 插入数据到 departments 表中
INSERT INTO departments(dept_name)
VALUES('Sales'),('Markting'),('Finance'),('Accounting'),('Warehouses'),('Production');

-- 插入数据到 employees 表中
INSERT INTO employees(first_name,last_name,department_id) 
VALUES('John','Doe',1),
 ('Bush','Lily',2),
 ('David','Dave',3),
 ('Mary','Jane',4),
 ('Jonatha','Josh',5),
 ('Mateo','More',1);
</code></pre> 
 <p><strong>第三</strong>，查询在 <code>employees</code> 和 <code>departments</code> 表中的数据：</p> 
 <pre><code class="lang-sql">mysql&gt; SELECT 
    department_id, dept_name
FROM
    departments;
+---------------+------------+
| department_id | dept_name  |
+---------------+------------+
|             1 | Sales      |
|             2 | Markting   |
|             3 | Finance    |
|             4 | Accounting |
|             5 | Warehouses |
|             6 | Production |
+---------------+------------+
6 rows in set

mysql&gt; SELECT 
    id, first_name, last_name, department_id
FROM
    employees;
+----+------------+-----------+---------------+
| id | first_name | last_name | department_id |
+----+------------+-----------+---------------+
|  1 | John       | Doe       |             1 |
|  2 | Bush       | Lily      |             2 |
|  3 | David      | Dave      |             3 |
|  4 | Mary       | Jane      |             4 |
|  5 | Jonatha    | Josh      |             5 |
|  6 | Mateo      | More      |             1 |
+----+------------+-----------+---------------+
6 rows in set
</code></pre> 
 <p><strong>重命名视图引用的表</strong></p> 
 <p>如果重命名一个被<a target="_blank" href="http://www.yiibai.com/mysql/views.html" title="视图">视图</a>引用的表，在重命名表后，视图就无效了，并且必须手动调整视图。</p> 
 <p>例如，我们基于<code>employees</code>和<code>departments</code>表创建一个名为<code>v_employee_info</code>的视图，如下所示：</p> 
 <pre><code class="lang-sql">CREATE VIEW v_employee_info as
    SELECT 
        id, first_name, last_name, dept_name
    from
        employees
            inner join
        departments USING (department_id);
</code></pre> 
 <p>视图使用<a target="_blank" href="http://www.yiibai.com/mysql/inner-join.html" title="内连接">内连接</a>子句来连接<code>employees</code>和<code>departments</code>表。</p> 
 <p>以下<a target="_blank" href="http://www.yiibai.com/mysql/select-statement-query-data.html" title="SELECT语句">SELECT语句</a>返回<code>v_employee_info</code>视图中的所有数据。</p> 
 <pre><code class="lang-sql">mysql&gt; SELECT 
    *
FROM
    v_employee_info;
+----+------------+-----------+------------+
| id | first_name | last_name | dept_name  |
+----+------------+-----------+------------+
|  1 | John       | Doe       | Sales      |
|  2 | Bush       | Lily      | Markting   |
|  3 | David      | Dave      | Finance    |
|  4 | Mary       | Jane      | Accounting |
|  5 | Jonatha    | Josh      | Warehouses |
|  6 | Mateo      | More      | Sales      |
+----+------------+-----------+------------+
6 rows in set
</code></pre> 
 <p>现在，将<code>v_employee_info</code>视图中的<code>employees</code>表重命名为<code>people</code>，并查询视图的数据。</p> 
 <pre><code class="lang-sql">RENAME TABLE employees TO people;

-- 查询数据
SELECT 
    *
FROM
    v_employee_info;
</code></pre> 
 <p>MySQL返回以下错误消息：</p> 
 <pre><code class="lang-sql">1356 - View 'hrdb.v_employee_info' references invalid table(s) or column(s) or function(s) or definer/invoker of view lack rights to use them
</code></pre> 
 <p>我们可以使用<code>CHECK TABLE</code>语句来检查<code>v_employee_info</code>视图的状态如下：</p> 
 <pre><code class="lang-sql">CHECK TABLE v_employee_info;
mysql&gt; CHECK TABLE v_employee_info;
+----------------------+-------+----------+----------------------------------------------------------------------------------------------------------------------------------------+
| Table                | Op    | Msg_type | Msg_text                                                                                                                               |
+----------------------+-------+----------+----------------------------------------------------------------------------------------------------------------------------------------+
| hrdb.v_employee_info | check | Error    | Table 'hrdb.employees' doesn't exist                                                                                                   |
| hrdb.v_employee_info | check | Error    | View 'hrdb.v_employee_info' references invalid table(s) or column(s) or function(s) or definer/invoker of view lack rights to use them |
| hrdb.v_employee_info | check | error    | Corrupt                                                                                                                                |
+----------------------+-------+----------+----------------------------------------------------------------------------------------------------------------------------------------+
3 rows in set
</code></pre> 
 <p>需要手动更改<code>v_employee_info</code>视图，以便它引用<code>people</code>表而不是<code>employees</code>表。</p> 
 <p><strong>重命名由存储过程引用的表</strong></p> 
 <p>如果要重命名由<a target="_blank" href="http://www.yiibai.com/mysql/stored-procedure-tutorial.html" title="存储过程">存储过程</a>引用的表，则必须像对视图一样进行手动调整。</p> 
 <p>首先，将<code>people</code>表重命名为<code>employees</code>表。</p>   
 <pre><code class="lang-sql">RENAME TABLE people TO employees;
</code></pre> 
 <p>然后，创建一个名为<code>get_employee</code>的新存储过程，该过程引用<code>employees</code>表。</p> 
 <pre><code class="lang-sql">DELIMITER $$

CREATE PROCEDURE get_employee(IN p_id INT)

BEGIN
 SELECT first_name
 ,last_name
 ,dept_name
 FROM employees
 INNER JOIN departments using (department_id)
 WHERE id = p_id;
END $$

DELIMITER;
</code></pre> 
 <p>接下来，执行<code>get_employee</code>存储过程从<code>employees</code>表来获取<code>id</code>为<code>1</code>的员工的数据，如下所示：</p> 
 <pre><code class="lang-sql">CALL get_employee(1);
</code></pre> 
 <p>执行上面查询语句，得到以下结果 - </p> 
 <pre><code class="lang-sql">mysql&gt; CALL get_employee(1);
+------------+-----------+-----------+
| first_name | last_name | dept_name |
+------------+-----------+-----------+
| John       | Doe       | Sales     |
+------------+-----------+-----------+
1 row in set

Query OK, 0 rows affected
</code></pre> 
 <p>之后，我们再次将<code>employees</code>表重新命名为<code>people</code>表。</p> 
 <pre><code class="lang-sql">RENAME TABLE employees TO people;
</code></pre> 
 <p>最后，调用<code>get_employee</code>存储过程来获取<code>id</code>为<code>2</code>的员工信息：</p> 
 <pre><code class="lang-sql">CALL get_employee(2);
</code></pre> 
 <p>MySQL返回以下错误消息：</p> 
 <pre><code class="lang-sql">1146 - Table 'hrdb.employees' doesn't exist
</code></pre> 
 <p>要解决这个问题，我们必须手动将存储过程中的<code>employees</code>表更改为<code>people</code>表。</p> 
 <p><strong>重命名引用外键的表</strong></p> 
 <p><code>departments</code>表使用<code>department_id</code>列链接到<code>employees</code>表。 <code>employees</code>表中的<code>department_id</code>列是引用<code>departments</code>表的<code>department_id</code>列作为<a target="_blank" href="http://www.yiibai.com/mysql/foreign-key.html" title="外键">外键</a>。</p> 
 <p>如果重命名<code>departments</code>表，那么指向<code>departments</code>表的所有外键都不会被自动更新。 在这种情况下，我们必须手动删除并重新创建外键。</p> 
 <pre><code class="lang-sql">RENAME TABLE departments TO depts;
</code></pre> 
 <p>我们删除<code>ID</code>为<code>1</code>的部门，由于外键约束，<code>people</code>表中的所有行也应删除。 但是，我们将<code>department</code>表重命名为<code>depts</code>表，而不会手动更新外键，MySQL会返回错误，如下所示：</p> 
 <pre><code class="lang-sql">DELETE FROM depts 
WHERE
    department_id = 1;
</code></pre> 
 <p>执行上面语句，得到以下以下错误提示 - </p> 
 <pre><code class="lang-sql">1451 - Cannot delete or update a parent row: a foreign key constraint fails (`hrdb`.`people`, CONSTRAINT `people_ibfk_1` FOREIGN KEY (`department_id`) REFERENCES `depts` (`department_id`))
</code></pre> 
 <h2 id="h2-u91CDu547Du540Du591Au4E2Au8868"><a name="重命名多个表" class="reference-link"></a><span class="header-link octicon octicon-link"></span>重命名多个表</h2>
 <p>也可以使用<code>RENAME TABLE</code>语句来一次重命名多个表。 见下列声明：</p> 
 <pre><code class="lang-sql">RENAME TABLE old_table_name_1 TO new_table_name_2,
             old_table_name_2 TO new_table_name_2,...
</code></pre> 
 <p>以下语句将 <code>people</code> 和 <code>depts</code> 重命名为 <code>employees</code> 和 <code>departments</code> 表：</p> 
 <pre><code class="lang-sql">RENAME TABLE depts TO departments,
             people TO employees;
</code></pre> 
 <blockquote> 
  <p>注意<code>RENAME TABLE</code>语句不是原子的。所以如果在任何时候发生错误，MySQL会将所有重新命名的表都回滚到旧名称。</p> 
 </blockquote> 
 <p><strong>使用ALTER TABLE语句重命名表</strong></p> 
 <p>我们可以使用<code>ALTER TABLE</code>语句重命名一个表，如下所示：</p> 
 <pre><code class="lang-sql">ALTER TABLE old_table_name
RENAME TO new_table_name;
</code></pre> 
 <p><code>RENAME TABLE</code>语句不能用于重命名临时表，这时就可以使用<code>ALTER TABLE</code>语句来重命名一个临时表。</p> 
 <p><strong>重命名临时表示例</strong></p> 
 <p>首先，我们创建一个<a target="_blank" href="http://www.yiibai.com/mysql/temporary-table.html" title="临时表">临时表</a>，其中包含来自<code>employees</code>表的<code>last_name</code>列的所有唯一的姓氏：</p> 
 <pre><code class="lang-sql">CREATE TEMPORARY TABLE lastnames
SELECT DISTINCT last_name from employees;
</code></pre> 
 <p><strong>第二步</strong>，使用<code>RENAME TABLE</code>重命名姓氏表：</p> 
 <pre><code class="lang-sql">RENAME TABLE lastnames TO unique_lastnames;
</code></pre> 
 <p>MySQL返回以下错误消息：</p> 
 <pre><code class="lang-sql">Error Code: 1017. Can't find file: '.\hrdb\lastnames.frm' (errno: 2 - No such file or directory)
</code></pre> 
 <p><strong>第三</strong>，使用<code>ALTER TABLE</code>语句来重命名姓氏表。</p> 
 <pre><code class="lang-sql">ALTER TABLE lastnames
RENAME TO unique_lastnames;
</code></pre> 
 <p><strong>第四</strong>，从<code>unique_lastnames</code>临时表查询数据：</p> 
 <pre><code class="lang-sql">SELECT 
    last_name
FROM
    unique_lastnames;

+-----------+
| last_name |
+-----------+
| Doe       |
| Lily      |
| Dave      |
| Jane      |
| Josh      |
| More      |
+-----------+
6 rows in set
</code></pre> 
 <p>在本教程中，我们向您展示了如何使用MySQL <code>RENAME TABLE</code>和<code>ALTER TABLE</code>语句重命名表。</p>
 <br>      
</div></body></html>
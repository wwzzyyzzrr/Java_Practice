<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">SQL Server视图</h1><div style="width:100%;float:left;" class="article-content">   
 <p> 在SQL Server中，视图是被存储在数据库中的预写查询。视图是由一个SELECT语句，当你运行视图，会看到它的结果，就像打开一个表时一样。 有些人喜欢把视图称作为虚拟表。这是因为，一个视图可以拉动多个表，并汇总数据在一起并将其显示，就好像它是一个单一的表。</p> 
 <h2> 视图的优点</h2> 
 <p> 当有多个用户提供不同级别的访问权限，需要看到在数据库中(但不一定是所有数据)中的数据的各不同部分的视图，可能是有用的。视图可以执行以下操作：</p> 
 <ul> 
  <li> 限制访问特定的表中的行</li> 
  <li> 限制访问特定的表中的列</li> 
  <li> 从多个表中加入列，并呈现出来，好像他们是一个单一的表的一部分</li> 
  <li> 呈现汇总的信息(如COUNT函数的结果)</li> 
 </ul> 
 <h2> 视图语法</h2> 
 <p> 创建一个视图通过使用CREATE VIEW语句，其次是SELECT语句。</p> 
 <div class="code-snippet" style="border-left-width: 6px; border-left-style: solid; border-left-color: rgb(255, 204, 0); padding: 0px 10px 10px; font-size: 0.8em; color: rgb(0, 0, 0);  Verdana,  line-height: 27.2000007629395px; background: rgb(255, 244, 200);"> 
  <span class="button" data-clipboard-target="bodyTextNo1" id="copy-button-bodyTextNo1" style="color: rgb(255, 204, 0); cursor: pointer;" title="Click to copy">✂</span> 
  <pre class="prettyprint overthrow prettyprinted" id="bodyTextNo1" style="'Anonymous Pro', Monaco, Menlo, Courier, monospace; tab-size: 4; padding: 2px; border: 0px; max-width: 700px; overflow: auto;">
<span class="pln" style="color: rgb(102, 51, 0);">CREATE VIEW </span><span class="typ" style="color: rgb(66, 113, 174);">ViewName</span><span class="pln" style="color: rgb(102, 51, 0);"> AS
SELECT </span><span class="pun" style="color: rgb(255, 153, 0);">...</span></pre> 
 </div> 
 <h2> 创建视图</h2> 
 <p> 我们以前使用的查询设计器创建两个表中选择数据的查询。现在让我们在查询并将其保存为一个名为“ToDoList”的视图。基本上，我们需要做的就是把CREATE VIEW ToDoList的AS查询，像这样的面前：</p> 
 <div class="code-snippet" style="border-left-width: 6px; border-left-style: solid; border-left-color: rgb(255, 204, 0); padding: 0px 10px 10px; font-size: 0.8em; color: rgb(0, 0, 0);  Verdana,  line-height: 27.2000007629395px; background: rgb(255, 244, 200);"> 
  <span class="button" data-clipboard-target="bodyTextNo2" id="copy-button-bodyTextNo2" style="color: rgb(255, 204, 0); cursor: pointer;" title="Click to copy">✂</span> 
  <pre class="prettyprint overthrow prettyprinted" id="bodyTextNo2" style="'Anonymous Pro', Monaco, Menlo, Courier, monospace; tab-size: 4; padding: 2px; border: 0px; max-width: 700px; overflow: auto;">
<span class="pln" style="color: rgb(102, 51, 0);">CREATE VIEW </span><span class="typ" style="color: rgb(66, 113, 174);">ToDoList</span><span class="pln" style="color: rgb(102, 51, 0);"> AS
SELECT	</span><span class="typ" style="color: rgb(66, 113, 174);">Tasks</span><span class="pun" style="color: rgb(255, 153, 0);">.</span><span class="typ" style="color: rgb(66, 113, 174);">TaskName</span><span class="pun" style="color: rgb(255, 153, 0);">,</span><span class="pln" style="color: rgb(102, 51, 0);"> </span><span class="typ" style="color: rgb(66, 113, 174);">Tasks</span><span class="pun" style="color: rgb(255, 153, 0);">.</span><span class="typ" style="color: rgb(66, 113, 174);">Description</span><span class="pln" style="color: rgb(102, 51, 0);">
FROM	</span><span class="typ" style="color: rgb(66, 113, 174);">Status</span><span class="pln" style="color: rgb(102, 51, 0);"> INNER JOIN
			</span><span class="typ" style="color: rgb(66, 113, 174);">Tasks</span><span class="pln" style="color: rgb(102, 51, 0);"> ON </span><span class="typ" style="color: rgb(66, 113, 174);">Status</span><span class="pun" style="color: rgb(255, 153, 0);">.</span><span class="typ" style="color: rgb(66, 113, 174);">StatusId</span><span class="pln" style="color: rgb(102, 51, 0);"> </span><span class="pun" style="color: rgb(255, 153, 0);">=</span><span class="pln" style="color: rgb(102, 51, 0);"> </span><span class="typ" style="color: rgb(66, 113, 174);">Tasks</span><span class="pun" style="color: rgb(255, 153, 0);">.</span><span class="typ" style="color: rgb(66, 113, 174);">StatusId</span><span class="pln" style="color: rgb(102, 51, 0);">
WHERE	</span><span class="pun" style="color: rgb(255, 153, 0);">(</span><span class="typ" style="color: rgb(66, 113, 174);">Status</span><span class="pun" style="color: rgb(255, 153, 0);">.</span><span class="typ" style="color: rgb(66, 113, 174);">StatusId</span><span class="pln" style="color: rgb(102, 51, 0);"> </span><span class="pun" style="color: rgb(255, 153, 0);">=</span><span class="pln" style="color: rgb(102, 51, 0);"> </span><span class="lit" style="color: rgb(245, 135, 31);">1</span><span class="pun" style="color: rgb(255, 153, 0);">)</span></pre> 
 </div> 
 <p> 一旦运行该脚本，刷新浏览文件夹在左窗格中，你会看到视图就在左窗格中：</p> 
 <img alt="Screenshot of view" class="screenshot" src="/uploads/allimg/150427/0642055422-0.png" style="border: 0px solid transparent; max-width: 100%; margin: 10px 0px 20px; -webkit-box-shadow: rgba(0, 0, 0, 0.4) 5px 5px 30px; box-shadow: rgba(0, 0, 0, 0.4) 5px 5px 30px; color: rgb(0, 0, 0);  Verdana,  font-size: 16px; line-height: 27.2000007629395px;"> 
 <h2> 运行视图</h2> 
 <p> 所以，现在你已经创建的视图，你可以简单地查看结果选择它就像你会选择任何表。而不是输入出大SELECT语句的INNER JOIN等等，可以简单地键入select* from todolist，它会运行完整的查询：<br style="color: rgb(34, 34, 34);  Verdana,  font-size: 12px;"> <img alt="Screenshot of view results" class="screenshot" src="/uploads/allimg/150427/06420541R-1.png" style="border: 0px solid transparent; max-width: 100%; margin: 10px 0px 20px; -webkit-box-shadow: rgba(0, 0, 0, 0.4) 5px 5px 30px; box-shadow: rgba(0, 0, 0, 0.4) 5px 5px 30px; line-height: 27.2000007629395px;"></p> 
 <div> 
  <p> <em>注：</em>也可以在视图上单击鼠标右键，并选择&nbsp;"Select Top 1000 Rows".</p> 
 </div> 
 <h2> 数据更新</h2> 
 <p> 该视图将返回最新的数据。如果表中的数据发生变化时，视图的结果会改变过。所以，如果要添加新任务以及状态 "To Do", 下一次运行来看，这将包括在结果集中的新纪录。</p> 
 <h2> 修改视图</h2> 
 <p> 可以通过使用ALTER而不是CREATE修改现有的视图。</p> 
 <p> 因此，如果我们想要更改视图使用StatusName字段，而不是StatusId，我们可以这样做：</p> 
 <div class="code-snippet" style="border-left-width: 6px; border-left-style: solid; border-left-color: rgb(255, 204, 0); padding: 0px 10px 10px; font-size: 0.8em; color: rgb(0, 0, 0);  Verdana,  line-height: 27.2000007629395px; background: rgb(255, 244, 200);"> 
  <span class="button" data-clipboard-target="bodyTextNo3" id="copy-button-bodyTextNo3" style="color: rgb(255, 204, 0); cursor: pointer;" title="Click to copy">✂</span>   
  <pre class="prettyprint overthrow prettyprinted" id="bodyTextNo3" style="'Anonymous Pro', Monaco, Menlo, Courier, monospace; tab-size: 4; padding: 2px; border: 0px; max-width: 700px; overflow: auto;">
<span class="pln" style="color: rgb(102, 51, 0);">ALTER VIEW </span><span class="typ" style="color: rgb(66, 113, 174);">ToDoList</span><span class="pln" style="color: rgb(102, 51, 0);"> AS
SELECT	</span><span class="typ" style="color: rgb(66, 113, 174);">Tasks</span><span class="pun" style="color: rgb(255, 153, 0);">.</span><span class="typ" style="color: rgb(66, 113, 174);">TaskName</span><span class="pun" style="color: rgb(255, 153, 0);">,</span><span class="pln" style="color: rgb(102, 51, 0);"> </span><span class="typ" style="color: rgb(66, 113, 174);">Tasks</span><span class="pun" style="color: rgb(255, 153, 0);">.</span><span class="typ" style="color: rgb(66, 113, 174);">Description</span><span class="pln" style="color: rgb(102, 51, 0);">
FROM	</span><span class="typ" style="color: rgb(66, 113, 174);">Status</span><span class="pln" style="color: rgb(102, 51, 0);"> INNER JOIN
			</span><span class="typ" style="color: rgb(66, 113, 174);">Tasks</span><span class="pln" style="color: rgb(102, 51, 0);"> ON </span><span class="typ" style="color: rgb(66, 113, 174);">Status</span><span class="pun" style="color: rgb(255, 153, 0);">.</span><span class="typ" style="color: rgb(66, 113, 174);">StatusId</span><span class="pln" style="color: rgb(102, 51, 0);"> </span><span class="pun" style="color: rgb(255, 153, 0);">=</span><span class="pln" style="color: rgb(102, 51, 0);"> </span><span class="typ" style="color: rgb(66, 113, 174);">Tasks</span><span class="pun" style="color: rgb(255, 153, 0);">.</span><span class="typ" style="color: rgb(66, 113, 174);">StatusId</span><span class="pln" style="color: rgb(102, 51, 0);">
WHERE	</span><span class="pun" style="color: rgb(255, 153, 0);">(</span><span class="typ" style="color: rgb(66, 113, 174);">Status</span><span class="pun" style="color: rgb(255, 153, 0);">.</span><span class="typ" style="color: rgb(66, 113, 174);">StatusName</span><span class="pln" style="color: rgb(102, 51, 0);"> </span><span class="pun" style="color: rgb(255, 153, 0);">=</span><span class="pln" style="color: rgb(102, 51, 0);"> </span><span class="str" style="color: rgb(0, 136, 0);">'To Do'</span><span class="pun" style="color: rgb(255, 153, 0);">)</span></pre> 
 </div> 
 <div> 
  <p> <em>注：</em>使用查询设计器也可以右键单击视图，然后选择设计来修改您的视图。</p> 
 </div> 
 <p> 正如你所看到的，视图让您保存查询，以便可以做一个SELECT，再次运行它也会比较简单。但它们的确有其局限性。它们允许选择数据，但不允许执行任何业务逻辑，如条件语句等。&nbsp;要做到这一点需要一个<a target="_blank" href="http://www.yiibai.com/sql_server/sql_server_stored_procedures.html">存储过程</a>。&nbsp;</p> 
 <br>      
</div></body></html>
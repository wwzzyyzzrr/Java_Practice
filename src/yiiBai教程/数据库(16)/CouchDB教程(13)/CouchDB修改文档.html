<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">CouchDB修改文档</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在本篇文章中，我们来学习如何编辑/修改 CouchDB 数据库中的文档。编辑/修改 CouchDB 数据库中的文档有两种方法，下面分别来看看如何操作。</p> 
 <h2 id="h2-1-fauxton-"><a name="1. 使用fauxton更新(编辑)文档" class="reference-link"></a><span class="header-link octicon octicon-link"></span>1. 使用fauxton更新(编辑)文档</h2>
 <p>打开Fauxton url：<a target="_blank" href="http://127.0.0.1:5984/_utils">http://127.0.0.1:5984/_utils</a></p> 
 <p>在创建文档后，还可以更新/更改/编辑文档。首先打数据库概览，里边有文档列表，如下表所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201705/1605/206150538_25795.png" alt=""></p> 
 <p>点击想要修改的文档，例如点击<code>ID</code>为<code>10010</code>这一条文档信息，进入文档详细页面 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201705/1605/593150540_10695.png" alt=""></p> 
 <p>双击要修改的数据项，如上图中，修改<code>age</code>字段的值，出现可编辑的输入框后填写修改的数据信息，然后点后面的绿色“勾”图标保存新填入的数据，然后再点击左上角的“<strong>Save Document</strong>”即可。</p> 
 <h2 id="h2-2-couchdb-curl-"><a name="2. CouchDB使用cURL工具更新文档" class="reference-link"></a><span class="header-link octicon octicon-link"></span>2. CouchDB使用cURL工具更新文档</h2>
 <p>cURL方便用户通过cURL工具，向服务器发送HTTP PUT方法请求来更新CouchDB中的文档。</p> 
 <p><strong>语法</strong></p> 
 <pre><code class="lang-shell">curl -X PUT http://localhost:5984/database_name/document_id/ -d '{ "field" : "value", "_rev" : "revision id" }'
</code></pre> 
 <p><strong>例子：</strong></p> 
 <p>在数据库<code>yiibai_db</code>中有一个<code>id</code>为<code>10010</code>的文档。</p> 
 <p>首先，检索要更新的文档的修订版本号。可以使用以下命令在文档中找到文档的<code>_rev</code>：</p> 
 <pre><code class="lang-shell">yiibai@ubuntu:~$ curl -X GET http://127.0.0.1:5984/yiibai_db/10010
{"_id":"10010","_rev":"2-b4aa165c0e34ec08581e7dc9f85ec454","name":"minsu","age":28,"address":"No. 112 ZhongShangRoad GuangZhou"}
yiibai@ubuntu:~$
</code></pre> 
 <p>从上面获得的文档的修订版本号<code>_rev</code>来更改数据。 在这里，假设要将年龄从<code>28</code>岁改为<code>22</code>岁，名称修改为：<code>Maxsu</code>，那么可以使用如下请求命令 - </p>   
 <pre><code class="lang-shell">curl -H 'Content-Type: application/json' -X PUT http://127.0.0.1:5984/yiibai_db/10010/ -d'{"age": "22","name":"Maxsu",  "_rev":"2-b4aa165c0e34ec08581e7dc9f85ec454"}'
</code></pre> 
 <p>执行结果如下所示 -</p> 
 <pre><code class="lang-shell">yiibai@ubuntu:~$ curl -H 'Content-Type: application/json' -X PUT http://127.0.0.1:5984/yiibai_db/10010/ -d'{"age": "22","name":"Maxsu",  "_rev":"2-b4aa165c0e34ec08581e7dc9f85ec454"}'
{"ok":true,"id":"10010","rev":"3-592bfcd696098263c19dfe761bf92929"}
yiibai@ubuntu:~$ curl -X GET http://127.0.0.1:5984/yiibai_db/10010
{"_id":"10010","_rev":"3-592bfcd696098263c19dfe761bf92929","age":"22","name":"Maxsu"}
yiibai@ubuntu:~$
</code></pre> 
 <p>可以看到上面返回的数据已经是修改过的数据了。</p> 
 <p><strong>在更新文档时要记住的要点：</strong></p> 
 <ul> 
  <li>在请求中发送的URL必须包含数据库名称和文档ID。</li>
  <li>更新现有文档与更新整个文档相同。无法向现有文档添加字段。只能使用相同的文档ID将文档的全新版本写入数据库。</li>
  <li>使用修订号(<code>_rev</code>)用作JSON请求的一部分。</li>
  <li>在返回的JSON数据中包含成功消息，正在更新的文档的ID以及新的修订信息。 如果要更新文- 档的新版本，则必须引用最新版本号。</li>
 </ul>
 <br>      
</div></body></html>
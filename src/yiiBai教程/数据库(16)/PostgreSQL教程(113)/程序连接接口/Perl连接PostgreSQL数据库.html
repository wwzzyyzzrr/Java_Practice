<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Perl连接PostgreSQL数据库</h1><div style="width:100%;float:left;" class="article-content">   
 <p>PostgreSQL可以使用<code>Perl DBI</code>模块与Perl集成，<code>Perl DBI</code>模块是Perl编程语言的数据库访问模块。 它定义了一组提供标准数据库接口的方法，变量和约定。</p> 
 <p>以下是在Linux / Unix机器上安装DBI模块的简单步骤：</p> 
 <pre><code class="lang-shell">$ wget http://search.cpan.org/CPAN/authors/id/T/TI/TIMB/DBI-1.625.tar.gz
$ tar xvfz DBI-1.625.tar.gz
$ cd DBI-1.625
$ perl Makefile.PL
$ make
$ make install
</code></pre> 
 <p>如果您需要安装DBI的<code>SQLite</code>驱动程序，那么可以安装如下：</p> 
 <pre><code class="lang-shell">$ wget http://search.cpan.org/CPAN/authors/id/T/TU/TURNSTEP/DBD-Pg-2.19.3.tar.gz
$ tar xvfz DBD-Pg-2.19.3.tar.gz
$ cd DBD-Pg-2.19.3
$ perl Makefile.PL
$ make
$ make install
</code></pre> 
 <p>在开始使用Perl连接PostgreSQL接口之前，请在PostgreSQL安装目录中找到<code>pg_hba.conf</code>文件，并添加以下行：</p> 
 <pre><code class="lang-shell"># IPv4 local connections:
host    all         all         127.0.0.1/32          md5
</code></pre> 
 <p>您可以启动/重新启动<code>postgres</code>服务器，可使用以下命令运行：</p> 
 <pre><code class="lang-shell">[root@host]# service postgresql restart
Stopping postgresql service:                               [  OK  ]
Starting postgresql service:                               [  OK  ]
</code></pre> 
 <h2 id="h2-perl-postgresql-"><a name="Perl连接到PostgreSQL数据库" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Perl连接到PostgreSQL数据库</h2>
 <p>以下Perl代码显示如何连接到现有的数据库。 如果数据库不存在，那么它将自动创建，最后将返回一个数据库对象。</p> 
 <pre><code class="lang-perl">#!/usr/bin/perl

use DBI;
use strict;

my $driver   = "Pg"; 
my $database = "testdb";
my $dsn = "DBI:$driver:dbname=$database;host=127.0.0.1;port=5432";
my $userid = "postgres";
my $password = "pass123";
my $dbh = DBI-&gt;connect($dsn, $userid, $password, { RaiseError =&gt; 1 }) 
                      or die $DBI::errstr;

print "Opened database successfully\n";
</code></pre> 
 <p>现在，我们运行上面的程序来打开数据库:<code>testdb</code>，如果成功打开数据库，那么它将给出以下消息：</p> 
 <pre><code class="lang-shell">Open database successfully
</code></pre> 
 <h2 id="h2-u521Bu5EFAu8868"><a name="创建表" class="reference-link"></a><span class="header-link octicon octicon-link"></span>创建表</h2>
 <p>以下Perl程序将用于在之前创建的数据库(<code>testdb</code>)中创建一个表：</p> 
 <pre><code class="lang-perl">#!/usr/bin/perl

use DBI;
use strict;

my $driver   = "Pg"; 
my $database = "testdb";
my $dsn = "DBI:$driver:dbname=$database;host=127.0.0.1;port=5432";
my $userid = "postgres";
my $password = "pass123";
my $dbh = DBI-&gt;connect($dsn, $userid, $password, { RaiseError =&gt; 1 })
                      or die $DBI::errstr;
print "Opened database successfully\n";

my $stmt = qq(CREATE TABLE COMPANY
      (ID INT PRIMARY KEY     NOT NULL,
       NAME           TEXT    NOT NULL,
       AGE            INT     NOT NULL,
       ADDRESS        CHAR(50),
       SALARY         REAL););
my $rv = $dbh-&gt;do($stmt);
if($rv &lt; 0){
   print $DBI::errstr;
} else {
   print "Table created successfully\n";
}
$dbh-&gt;disconnect();
</code></pre> 
 <p>当执行上述程序时，它将在<code>testdb</code>中创建一张<code>COMPANY</code>表，并显示以下消息：</p> 
 <pre><code class="lang-shell">Opened database successfully
Table created successfully
</code></pre> 
 <h2 id="h2-u63D2u5165u64CDu4F5C"><a name="插入操作" class="reference-link"></a><span class="header-link octicon octicon-link"></span>插入操作</h2>
 <p>以下Perl程序显示了如何在上述示例中创建的<code>COMPANY</code>表中创建/插入记录：</p> 
 <pre><code class="lang-perl">#!/usr/bin/perl

use DBI;
use strict;

my $driver   = "Pg"; 
my $database = "testdb";
my $dsn = "DBI:$driver:dbname=$database;host=127.0.0.1;port=5432";
my $userid = "postgres";
my $password = "pass123";
my $dbh = DBI-&gt;connect($dsn, $userid, $password, { RaiseError =&gt; 1 })
                      or die $DBI::errstr;
print "Opened database successfully\n";

my $stmt = qq(INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY)
      VALUES (1, 'Paul', 32, 'California', 20000.00 ));
my $rv = $dbh-&gt;do($stmt) or die $DBI::errstr;

$stmt = qq(INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY)
      VALUES (2, 'Allen', 25, 'Texas', 15000.00 ));
$rv = $dbh-&gt;do($stmt) or die $DBI::errstr;

$stmt = qq(INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY)
      VALUES (3, 'Teddy', 23, 'Norway', 20000.00 ));
$rv = $dbh-&gt;do($stmt) or die $DBI::errstr;

$stmt = qq(INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY)
      VALUES (4, 'Mark', 25, 'Rich-Mond ', 65000.00 ););
$rv = $dbh-&gt;do($stmt) or die $DBI::errstr;

print "Records created successfully\n";
$dbh-&gt;disconnect();
</code></pre> 
 <p>当执行上述程序时，它将在<code>COMPANY</code>表中创建/插入给定的记录，并显示以下两行：</p> 
 <pre><code class="lang-shell">Opened database successfully
Records created successfully
</code></pre> 
 <h2 id="h2-select-"><a name="SELECT操作" class="reference-link"></a><span class="header-link octicon octicon-link"></span>SELECT操作</h2>
 <p>以下Perl程序显示了如何从上述示例中创建的<code>COMPANY</code>表中获取和显示记录：</p> 
 <pre><code class="lang-perl">#!/usr/bin/perl

use DBI;
use strict;

my $driver   = "Pg"; 
my $database = "testdb";
my $dsn = "DBI:$driver:dbname=$database;host=127.0.0.1;port=5432";
my $userid = "postgres";
my $password = "pass123";
my $dbh = DBI-&gt;connect($dsn, $userid, $password, { RaiseError =&gt; 1 })
                      or die $DBI::errstr;
print "Opened database successfully\n";

my $stmt = qq(SELECT id, name, address, salary  from COMPANY;);
my $sth = $dbh-&gt;prepare( $stmt );
my $rv = $sth-&gt;execute() or die $DBI::errstr;
if($rv &lt; 0){
   print $DBI::errstr;
}
while(my @row = $sth-&gt;fetchrow_array()) {
      print "ID = ". $row[0] . "\n";
      print "NAME = ". $row[1] ."\n";
      print "ADDRESS = ". $row[2] ."\n";
      print "SALARY =  ". $row[3] ."\n\n";
}
print "Operation done successfully\n";
$dbh-&gt;disconnect();
</code></pre> 
 <p>执行上述程序时，会产生以下结果：</p>   
 <pre><code class="lang-shell">Opened database successfully
ID = 1
NAME = Paul
ADDRESS = California
SALARY =  20000

ID = 2
NAME = Allen
ADDRESS = Texas
SALARY =  15000

ID = 3
NAME = Teddy
ADDRESS = Norway
SALARY =  20000

ID = 4
NAME = Mark
ADDRESS = Rich-Mond
SALARY =  65000

Operation done successfully
</code></pre> 
 <h2 id="h2-u66F4u65B0u64CDu4F5C"><a name="更新操作" class="reference-link"></a><span class="header-link octicon octicon-link"></span>更新操作</h2>
 <p>Perl代码显示了如何使用<code>UPDATE</code>语句来更新指定记录，然后从<code>COMPANY</code>表中获取和显示更新的记录：</p> 
 <pre><code class="lang-perl">#!/usr/bin/perl

use DBI;
use strict;

my $driver   = "Pg"; 
my $database = "testdb";
my $dsn = "DBI:$driver:dbname=$database;host=127.0.0.1;port=5432";
my $userid = "postgres";
my $password = "pass123";
my $dbh = DBI-&gt;connect($dsn, $userid, $password, { RaiseError =&gt; 1 })
                      or die $DBI::errstr;
print "Opened database successfully\n";

my $stmt = qq(UPDATE COMPANY set SALARY = 25000.00 where ID=1;);
my $rv = $dbh-&gt;do($stmt) or die $DBI::errstr;
if( $rv &lt; 0 ){
   print $DBI::errstr;
}else{
   print "Total number of rows updated : $rv\n";
}
$stmt = qq(SELECT id, name, address, salary  from COMPANY;);
my $sth = $dbh-&gt;prepare( $stmt );
$rv = $sth-&gt;execute() or die $DBI::errstr;
if($rv &lt; 0){
   print $DBI::errstr;
}
while(my @row = $sth-&gt;fetchrow_array()) {
      print "ID = ". $row[0] . "\n";
      print "NAME = ". $row[1] ."\n";
      print "ADDRESS = ". $row[2] ."\n";
      print "SALARY =  ". $row[3] ."\n\n";
}
print "Operation done successfully\n";
$dbh-&gt;disconnect();
</code></pre> 
 <p>执行上述程序时，会产生以下结果：</p> 
 <pre><code class="lang-shell">Opened database successfully
Total number of rows updated : 1
ID = 1
NAME = Paul
ADDRESS = California
SALARY =  25000

ID = 2
NAME = Allen
ADDRESS = Texas
SALARY =  15000

ID = 3
NAME = Teddy
ADDRESS = Norway
SALARY =  20000

ID = 4
NAME = Mark
ADDRESS = Rich-Mond
SALARY =  65000

Operation done successfully
</code></pre> 
 <h2 id="h2-u5220u9664u64CDu4F5C"><a name="删除操作" class="reference-link"></a><span class="header-link octicon octicon-link"></span>删除操作</h2>
 <p>Perl代码显示了如何使用<code>DELETE</code>语句删除指定记录，然后从<code>COMPANY</code>表中获取并显示剩余的记录：</p> 
 <pre><code class="lang-perl">#!/usr/bin/perl

use DBI;
use strict;

my $driver   = "Pg"; 
my $database = "testdb";
my $dsn = "DBI:$driver:dbname=$database;host=127.0.0.1;port=5432";
my $userid = "postgres";
my $password = "pass123";
my $dbh = DBI-&gt;connect($dsn, $userid, $password, { RaiseError =&gt; 1 })
                      or die $DBI::errstr;
print "Opened database successfully\n";

my $stmt = qq(DELETE from COMPANY where ID=2;);
my $rv = $dbh-&gt;do($stmt) or die $DBI::errstr;
if( $rv &lt; 0 ){
   print $DBI::errstr;
}else{
   print "Total number of rows deleted : $rv\n";
}
$stmt = qq(SELECT id, name, address, salary  from COMPANY;);
my $sth = $dbh-&gt;prepare( $stmt );
$rv = $sth-&gt;execute() or die $DBI::errstr;
if($rv &lt; 0){
   print $DBI::errstr;
}
while(my @row = $sth-&gt;fetchrow_array()) {
      print "ID = ". $row[0] . "\n";
      print "NAME = ". $row[1] ."\n";
      print "ADDRESS = ". $row[2] ."\n";
      print "SALARY =  ". $row[3] ."\n\n";
}
print "Operation done successfully\n";
$dbh-&gt;disconnect();
</code></pre> 
 <p>执行上述程序时，会产生以下结果：</p> 
 <pre><code class="lang-shell">Opened database successfully
Total number of rows deleted : 1
ID = 1
NAME = Paul
ADDRESS = California
SALARY =  25000

ID = 3
NAME = Teddy
ADDRESS = Norway
SALARY =  20000

ID = 4
NAME = Mark
ADDRESS = Rich-Mond
SALARY =  65000

Operation done successfully
</code></pre>
 <br>      
</div></body></html>
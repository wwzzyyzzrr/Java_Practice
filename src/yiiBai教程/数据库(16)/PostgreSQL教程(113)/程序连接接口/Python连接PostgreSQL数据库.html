<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Python连接PostgreSQL数据库</h1><div style="width:100%;float:left;" class="article-content">   
 <p>PostgreSQL可以使用<code>psycopg2</code>模块与Python集成。<code>sycopg2</code>是用于Python编程语言的PostgreSQL数据库适配器。 <code>psycopg2</code>是非常小，快速，稳定的。 您不需要单独安装此模块，因为默认情况下它会随着<code>Python 2.5.x</code>版本一起发布。 如果还没有在您的机器上安装它，那么可以使用<code>yum</code>命令安装它，如下所示：</p> 
 <pre><code class="lang-shell">$yum install python-psycopg2
</code></pre> 
 <p>要使用<code>psycopg2</code>模块，必须首先创建一个表示数据库的<code>Connection</code>对象，然后可以选择创建可以帮助您执行所有SQL语句的游标对象。</p> 
 <h2 id="h2-u8FDEu63A5u5230u6570u636Eu5E93"><a name="连接到数据库" class="reference-link"></a><span class="header-link octicon octicon-link"></span>连接到数据库</h2>
 <p>以下Python代码显示了如何连接到现有的数据库。 如果数据库不存在，那么它将自动创建，最后将返回一个数据库对象。</p> 
 <pre><code class="lang-python">#!/usr/bin/python

import psycopg2

conn = psycopg2.connect(database="testdb", user="postgres", password="pass123", host="127.0.0.1", port="5432")

print "Opened database successfully"
</code></pre> 
 <p>在这里指定使用<code>testdb</code>作为数据库名称，如果数据库已成功打开连接，则会提供以下消息：</p> 
 <pre><code class="lang-shell">Open database successfully
</code></pre> 
 <h2 id="h2-u521Bu5EFAu8868"><a name="创建表" class="reference-link"></a><span class="header-link octicon octicon-link"></span>创建表</h2>
 <p>以下Python程序将用于在先前创建的数据库(<code>testdb</code>)中创建一个表：</p> 
 <pre><code class="lang-python">#!/usr/bin/python

import psycopg2

conn = psycopg2.connect(database="testdb", user="postgres", password="pass123", host="127.0.0.1", port="5432")
print "Opened database successfully"

cur = conn.cursor()
cur.execute('''CREATE TABLE COMPANY
       (ID INT PRIMARY KEY     NOT NULL,
       NAME           TEXT    NOT NULL,
       AGE            INT     NOT NULL,
       ADDRESS        CHAR(50),
       SALARY         REAL);''')
print "Table created successfully"

conn.commit()
conn.close()
</code></pre> 
 <p>当执行上述程序时，它将在数据库<code>testdb</code>中创建<code>COMPANY</code>表，并显示以下消息：</p> 
 <pre><code class="lang-shell">Opened database successfully
Table created successfully
</code></pre> 
 <h2 id="h2-u63D2u5165u64CDu4F5C"><a name="插入操作" class="reference-link"></a><span class="header-link octicon octicon-link"></span>插入操作</h2>
 <p>以下Python程序显示了如何在上述示例中创建的<code>COMPANY</code>表中创建记录：</p> 
 <pre><code class="lang-python">#!/usr/bin/python

import psycopg2

conn = psycopg2.connect(database="testdb", user="postgres", password="pass123", host="127.0.0.1", port="5432")
print "Opened database successfully"

cur = conn.cursor()

cur.execute("INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY) \
      VALUES (1, 'Paul', 32, 'California', 20000.00 )");

cur.execute("INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY) \
      VALUES (2, 'Allen', 25, 'Texas', 15000.00 )");

cur.execute("INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY) \
      VALUES (3, 'Teddy', 23, 'Norway', 20000.00 )");

cur.execute("INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY) \
      VALUES (4, 'Mark', 25, 'Rich-Mond ', 65000.00 )");

conn.commit()
print "Records created successfully";
conn.close()
</code></pre> 
 <p>当执行上述程序时，它将在<code>COMPANY</code>表中创建/插入给定的记录，并显示以下两行：</p> 
 <pre><code class="lang-shell">Opened database successfully
Records created successfully
</code></pre> 
 <h2 id="h2-select-"><a name="SELECT操作" class="reference-link"></a><span class="header-link octicon octicon-link"></span>SELECT操作</h2>
 <p>以下Python程序显示了如何从上述示例中创建的<code>COMPANY</code>表中获取和显示记录：</p> 
 <pre><code class="lang-python">#!/usr/bin/python

import psycopg2

conn = psycopg2.connect(database="testdb", user="postgres", password="pass123", host="127.0.0.1", port="5432")
print "Opened database successfully"

cur = conn.cursor()

cur.execute("SELECT id, name, address, salary  from COMPANY")
rows = cur.fetchall()
for row in rows:
   print "ID = ", row[0]
   print "NAME = ", row[1]
   print "ADDRESS = ", row[2]
   print "SALARY = ", row[3], "\n"

print "Operation done successfully";
conn.close()
</code></pre> 
 <p>执行上述程序时，会产生以下结果：</p> 
 <pre><code class="lang-shell">Opened database successfully
ID =  1
NAME =  Paul
ADDRESS =  California
SALARY =  20000.0

ID =  2
NAME =  Allen
ADDRESS =  Texas
SALARY =  15000.0

ID =  3
NAME =  Teddy
ADDRESS =  Norway
SALARY =  20000.0

ID =  4
NAME =  Mark
ADDRESS =  Rich-Mond
SALARY =  65000.0

Operation done successfully
</code></pre> 
 <h2 id="h2-u66F4u65B0u64CDu4F5C"><a name="更新操作" class="reference-link"></a><span class="header-link octicon octicon-link"></span>更新操作</h2>
 <p>以下Python代码显示了如何使用<code>UPDATE</code>语句来更新任何记录，然后从<code>COMPANY</code>表中获取并显示更新的记录：</p>   
 <pre><code class="lang-python">#!/usr/bin/python

import psycopg2

conn = psycopg2.connect(database="testdb", user="postgres", password="pass123", host="127.0.0.1", port="5432")
print "Opened database successfully"

cur = conn.cursor()

cur.execute("UPDATE COMPANY set SALARY = 25000.00 where ID=1")
conn.commit
print "Total number of rows updated :", cur.rowcount

cur.execute("SELECT id, name, address, salary  from COMPANY")
rows = cur.fetchall()
for row in rows:
   print "ID = ", row[0]
   print "NAME = ", row[1]
   print "ADDRESS = ", row[2]
   print "SALARY = ", row[3], "\n"

print "Operation done successfully";
conn.close()
</code></pre> 
 <p>执行上述程序时，会产生以下结果：</p> 
 <pre><code class="lang-shell">Opened database successfully
Total number of rows updated : 1
ID =  1
NAME =  Paul
ADDRESS =  California
SALARY =  25000.0

ID =  2
NAME =  Allen
ADDRESS =  Texas
SALARY =  15000.0

ID =  3
NAME =  Teddy
ADDRESS =  Norway
SALARY =  20000.0

ID =  4
NAME =  Mark
ADDRESS =  Rich-Mond
SALARY =  65000.0

Operation done successfully
</code></pre> 
 <h2 id="h2-u5220u9664u64CDu4F5C"><a name="删除操作" class="reference-link"></a><span class="header-link octicon octicon-link"></span>删除操作</h2>
 <p>以下Python代码显示了如何使用<code>DELETE</code>语句来删除记录，然后从<code>COMPANY</code>表中获取并显示剩余的记录：</p> 
 <pre><code class="lang-python">#!/usr/bin/python

import psycopg2

conn = psycopg2.connect(database="testdb", user="postgres", password="pass123", host="127.0.0.1", port="5432")
print "Opened database successfully"

cur = conn.cursor()

cur.execute("DELETE from COMPANY where ID=2;")
conn.commit
print "Total number of rows deleted :", cur.rowcount

cur.execute("SELECT id, name, address, salary  from COMPANY")
rows = cur.fetchall()
for row in rows:
   print "ID = ", row[0]
   print "NAME = ", row[1]
   print "ADDRESS = ", row[2]
   print "SALARY = ", row[3], "\n"

print "Operation done successfully";
conn.close()
</code></pre> 
 <p>执行上述程序时，会产生以下结果：</p> 
 <pre><code class="lang-shell">Opened database successfully
Total number of rows deleted : 1
ID =  1
NAME =  Paul
ADDRESS =  California
SALARY =  20000.0

ID =  3
NAME =  Teddy
ADDRESS =  Norway
SALARY =  20000.0

ID =  4
NAME =  Mark
ADDRESS =  Rich-Mond
SALARY =  65000.0

Operation done successfully
</code></pre>
 <br>      
</div></body></html>
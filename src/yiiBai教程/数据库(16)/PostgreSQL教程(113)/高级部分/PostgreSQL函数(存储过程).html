<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">PostgreSQL函数(存储过程)</h1><div style="width:100%;float:left;" class="article-content">   
 <p>PostgreSQL函数也称为PostgreSQL存储过程。 PostgreSQL函数或存储过程是存储在数据库服务器上并可以使用SQL界面调用的一组SQL和过程语句(声明，分配，循环，控制流程等)。 它有助于您执行通常在数据库中的单个函数中进行多次查询和往返操作的操作。</p> 
 <p>您可以在许多语言(如SQL，PL/pgSQL，C，Python等)中创建PostgreSQL函数。</p> 
 <p><strong>语法：</strong></p> 
 <pre><code class="lang-sql">CREATE [OR REPLACE] FUNCTION function_name (arguments)   
RETURNS return_datatype AS $variable_name$  
  DECLARE  
    declaration;  
    [...]  
  BEGIN  
    &lt; function_body &gt;  
    [...]  
    RETURN { variable_name | value }  
  END; LANGUAGE plpgsql;
</code></pre> 
 <h3 id="h3-u53C2u6570u8BF4u660E"><a name="参数说明" class="reference-link"></a><span class="header-link octicon octicon-link"></span>参数说明</h3>
 <ul> 
  <li><code>function_name</code>：指定函数的名称。</li>
  <li><code>[OR REPLACE]</code>：是可选的，它允许您修改/替换现有函数。</li>
  <li><code>RETURN</code>：它指定要从函数返回的数据类型。它可以是基础，复合或域类型，或者也可以引用表列的类型。</li>
  <li><code>function_body</code>：<code>function_body</code>包含可执行部分。</li>
  <li><code>plpgsql</code>：它指定实现该函数的语言的名称。</li>
 </ul> 
 <h2 id="h2--"><a name="例子：" class="reference-link"></a><span class="header-link octicon octicon-link"></span>例子：</h2>
 <p>下面我们来举个例子来演示<code>PostgreSQL</code>函数使用，我们有一个名为“<code>EMPLOYEES</code>”的表具有以下数据。<br><img src="http://www.yiibai.com/uploads/images/201704/1004/739160419_45710.png" alt=""></p> 
 <p>在<code>EMPLOYEES</code>表上创建一个名为<code>total records()</code>的函数。<br>函数的定义如下：</p>   
 <pre><code class="lang-sql">CREATE OR REPLACE FUNCTION totalRecords ()  
RETURNS integer AS $total$  
declare  
    total integer;  
BEGIN  
   SELECT count(*) into total FROM EMPLOYEES;  
   RETURN total;  
END;  
$total$ LANGUAGE plpgsql;
</code></pre> 
 <p><strong>输出：</strong><br><img src="http://www.yiibai.com/uploads/images/201704/1004/687160421_63489.png" alt=""></p> 
 <p>您可以看到一个名为“<code>totalrecords</code>”的函数被创建。现在，来执行一个调用这个函数并检查<code>EMPLOYEES</code>表中的记录，如下所示 -</p> 
 <pre><code class="lang-sql">select totalRecords();
</code></pre> 
 <p>当执行上述查询时，结果为：<br><img src="http://www.yiibai.com/uploads/images/201704/1004/814160422_94842.png" alt=""></p>
 <br>      
</div></body></html>
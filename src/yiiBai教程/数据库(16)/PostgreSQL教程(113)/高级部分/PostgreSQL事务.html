<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">PostgreSQL事务</h1><div style="width:100%;float:left;" class="article-content">   
 <p>事务是对数据库执行的工作单元。事务是以逻辑顺序完成的工作的单位或顺序，无论是用户手动的方式还是通过某种数据库程序自动执行。</p> 
 <h2 id="h2-u4E8Bu52A1u6027u8D28"><a name="事务性质" class="reference-link"></a><span class="header-link octicon octicon-link"></span>事务性质</h2>
 <p>事务具有以下四个标准属性，一般是由首字母缩写词<code>ACID</code>简称：</p> 
 <ul> 
  <li><strong>原子性(Atomicity)</strong>：确保工作单位内的所有操作成功完成; 否则事务将在故障点中止，以前的操作回滚到其以前的状态。</li>
  <li><strong>一致性(Consistency)</strong>：确保数据库在成功提交的事务时正确更改状态。</li>
  <li><strong>隔离性(Isolation)</strong>：使事务能够独立运作并相互透明。</li>
  <li><strong>持久性(Durability)</strong>：确保在系统发生故障的情况下，提交的事务的结果或效果仍然存在。</li>
 </ul> 
 <h2 id="h2-u4E8Bu52A1u63A7u5236"><a name="事务控制" class="reference-link"></a><span class="header-link octicon octicon-link"></span>事务控制</h2>
 <p>以下命令用于控制事务：</p> 
 <ul> 
  <li><code>BEGIN TRANSACTION</code>：开始事务。</li>
  <li><code>COMMIT</code>：保存更改，或者您可以使用<code>END TRANSACTION</code>命令。</li>
  <li><code>ROLLBACK</code>：回滚更改。</li>
 </ul> 
 <p>事务控制命令仅用于DML命令<code>INSERT</code>，<code>UPDATE</code>和<code>DELETE</code>。 创建表或删除它们时不能使用它们，因为这些操作会在数据库中自动提交。</p> 
 <h2 id="h2-begin-transaction-"><a name="BEGIN TRANSACTION命令：" class="reference-link"></a><span class="header-link octicon octicon-link"></span>BEGIN TRANSACTION命令：</h2>
 <p>可以使用<code>BEGIN TRANSACTION</code>或简单的<code>BEGIN</code>命令来开始事务。 这样的事务通常会持续下去，直到遇到下一个<code>COMMIT</code>或<code>ROLLBACK</code>命令。 但如果数据库关闭或发生错误，则事务也将<code>ROLLBACK</code>。</p> 
 <p>以下是启动/开始事务的简单语法：</p> 
 <pre><code class="lang-sql">BEGIN;

or

BEGIN TRANSACTION;
</code></pre> 
 <h2 id="h2-commit-"><a name="COMMIT命令" class="reference-link"></a><span class="header-link octicon octicon-link"></span>COMMIT命令</h2>
 <p><code>COMMIT</code>命令是用于将事务调用的更改保存到数据库的事务命令。<br><code>COMMIT</code>命令自上次的<code>COMMIT</code>或<code>ROLLBACK</code>命令后将所有事务保存到数据库。<br><code>COMMIT</code>命令的语法如下：</p> 
 <pre><code class="lang-sql">COMMIT;

or

END TRANSACTION;
</code></pre> 
 <h2 id="h2-rollback-"><a name="ROLLBACK命令" class="reference-link"></a><span class="header-link octicon octicon-link"></span>ROLLBACK命令</h2>
 <p><code>ROLLBACK</code>命令是用于还原尚未保存到数据库的事务的事务命令。自上次发出<code>COMMIT</code>或<code>ROLLBACK</code>命令以来，<code>ROLLBACK</code>命令只能用于撤销事务。<br><code>ROLLBACK</code>命令的语法如下：</p>   
 <pre><code class="lang-sql">ROLLBACK;
</code></pre> 
 <h2 id="h2-u793Au4F8B"><a name="示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>示例</h2>
 <p>考虑<code>COMPANY</code>表有以下记录：</p> 
 <pre><code class="lang-sql"> id | name  | age | address   | salary
----+-------+-----+-----------+--------
  1 | Paul  |  32 | California|  20000
  2 | Allen |  25 | Texas     |  15000
  3 | Teddy |  23 | Norway    |  20000
  4 | Mark  |  25 | Rich-Mond |  65000
  5 | David |  27 | Texas     |  85000
  6 | Kim   |  22 | South-Hall|  45000
  7 | James |  24 | Houston   |  10000
</code></pre> 
 <p>现在，我们开始一个事务，并删除表中<code>age = 25</code>的记录，最后使用<code>ROLLBACK</code>命令撤消所有的更改。</p> 
 <pre><code class="lang-sql">yiibai_db=# BEGIN;
DELETE FROM COMPANY WHERE AGE = 25;
ROLLBACK;
</code></pre> 
 <p>如果再次查看<code>COMPANY</code>表应该仍然看到以下记录：</p> 
 <pre><code class="lang-sql">id | name  | age | address   | salary
----+-------+-----+-----------+--------
  1 | Paul  |  32 | California|  20000
  2 | Allen |  25 | Texas     |  15000
  3 | Teddy |  23 | Norway    |  20000
  4 | Mark  |  25 | Rich-Mond |  65000
  5 | David |  27 | Texas     |  85000
  6 | Kim   |  22 | South-Hall|  45000
  7 | James |  24 | Houston   |  10000
</code></pre> 
 <p>现在，让我们开始另一个事务，并从表中删除<code>age = 25</code>的记录，最后使用<code>COMMIT</code>命令提交所有的更改。</p> 
 <pre><code class="lang-sql">yiibai_db=# BEGIN;
DELETE FROM COMPANY WHERE AGE = 25;
COMMIT;
</code></pre> 
 <p>如果查看<code>COMPANY</code>表应该看到删除后剩下的记录：</p> 
 <pre><code class="lang-sql"> id | name  | age | address    | salary
----+-------+-----+------------+--------
  1 | Paul  |  32 | California |  20000
  3 | Teddy |  23 | Norway     |  20000
  5 | David |  27 | Texas      |  85000
  6 | Kim   |  22 | South-Hall |  45000
  7 | James |  24 | Houston    |  10000
(5 rows)
</code></pre>
 <br>      
</div></body></html>
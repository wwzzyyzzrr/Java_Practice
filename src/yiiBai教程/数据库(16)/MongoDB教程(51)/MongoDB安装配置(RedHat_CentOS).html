<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">MongoDB安装配置(RedHat/CentOS)</h1><div style="width:100%;float:left;" class="article-content">   
 <p>本教程介绍如何在Red Hat Enterprise Linux或CentOS Linux版本6和7上使用<code>.rpm</code>软件包来安装 MongoDB 社区版。 虽然Red Hat包含自己的MongoDB软件包，但安装最新 MongoDB社区版还要自己手动安装。</p> 
 <blockquote> 
  <p>平台支持： 本安装指南仅支持64位系统。有关详细信息，请参阅<a target="_blank" href="http://docs.mongodb.com/manual/release-notes/3.0-compatibility/#compatibility-platform-support" title="平台支持">平台支持</a>。MongoDB 3.2不支持Red Hat Enterprise Linux 5。</p> 
 </blockquote> 
 <p><code>mongodb-org-server</code>包提供了一个使用<code>/etc/mongod.conf</code>配置文件启动 mongod 的初始化脚本。</p> 
 <p>由软件包提供的默认的 <code>/etc/mongod.conf</code> 配置文件的 <code>bind_ip</code> 默认设置为 <code>127.0.0.1</code>。 在初始化副本集合之前，根据环境的需要修改此设置。</p> 
 <h2 id="h2--mongodb-"><a name="安装MongoDB社区版" class="reference-link"></a><span class="header-link octicon octicon-link"></span>安装MongoDB社区版</h2>
 <p>本安装指南仅支持64位系统。有关详细信息，请参阅<a target="_blank" href="http://docs.mongodb.com/manual/release-notes/3.0-compatibility/#compatibility-platform-support" title="平台支持">平台支持</a>。请参考以下步骤一步一步地来完成。</p> 
 <p><strong>第一步：配置包管理系统(yum)</strong></p> 
 <p>创建一个 <code>/etc/yum.repos.d/mongodb-org-3.4.repo</code> 文件，以便可以使用 <code>yum</code> 命令直接安装 MongoDB。</p> 
 <p>MongoDB版本3.0中更改：MongoDB Linux软件包位于以 3.0 开头的新存储库中。</p> 
 <p>对于最新稳定发布的MongoDB</p> 
 <p>创建存储库文件(使用命令：<code>vi /etc/yum.repos.d/mongodb-org-3.4.repo</code>)，写入如下内容：</p> 
 <pre><code class="lang-shell">[mongodb-org-3.4]
name=MongoDB Repository
baseurl=http://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.4/x86_64/
gpgcheck=1
enabled=1
gpgkey=http://www.mongodb.org/static/pgp/server-3.4.asc
</code></pre> 
 <p><strong>第二步：安装MongoDB软件包和相关工具</strong></p> 
 <p>要安装最新的稳定版本(<code>3.4</code>)的MongoDB，请执行以下命令：</p> 
 <pre><code class="lang-shell"># sudo yum install -y mongodb-org
</code></pre> 
 <p>执行过程如下所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201706/2906/611160602_52240.png" alt=""></p> 
 <p>安装完成后，如下图所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201706/2906/202160634_59607.png" alt=""></p> 
 <h2 id="h2--mongodb"><a name="运行MongoDB" class="reference-link"></a><span class="header-link octicon octicon-link"></span>运行MongoDB</h2>
 <p>大多数类Unix操作系统限制会话，以减少系统资源的使用。 这些限制可能会对 MongoDB 操作产生负面影响。有关详细信息，请参阅<a target="_blank" href="http://docs.mongodb.com/manual/reference/ulimit/" title="UNIX ulimit设置">UNIX ulimit设置</a>。</p> 
 <p><strong>配置SELinux</strong></p> 
 <blockquote> 
  <p>如果您使用SELinux，则必须配置SELinux以允许MongoDB在基于Red Hat Linux的系统(Red Hat Enterprise Linux或CentOS Linux)上启动。</p> 
 </blockquote> 
 <p>要配置SELinux，管理员有三个选项：</p> 
 <ul> 
  <li>如果SELinux处于强制模式，则可以访问MongoDB部署将使用的相关端口(例如<code>27017</code>)。 有关MongoDB默认端口的更多信息，请参阅<a target="_blank" href="http://docs.mongodb.com/manual/reference/default-mongodb-port/" title="默认MongoDB端口">默认MongoDB端口</a>。 对于默认设置，可以通过运行下面命令来实现 - </li>
 </ul> 
 <pre><code class="lang-shell"># semanage port -a -t mongod_port_t -p tcp 27017
</code></pre> 
 <ul> 
  <li>通过在<code>/etc/selinux/config</code>中将 SELINUX 设置为 <code>disabled</code> 来禁用SELinux。</li>
 </ul> 
 <pre><code class="lang-shell">SELINUX=disabled
</code></pre> 
 <blockquote> 
  <p>以学习为目的，建议使用此项设置，但是必须重新启动系统才能使更改生效。</p> 
 </blockquote> 
 <ul> 
  <li>在<code>/etc/selinux/config</code> 中设置为许可模式，即，将SELinux设置为 <code>permissive</code> 。</li>
 </ul> 
 <pre><code class="lang-shell">SELINUX=permissive
</code></pre> 
 <p>上述设置完成后，必须重新启动系统才能使更改生效。可以使用 <code>setenforce</code> 更改为允许模式。 <code>setenforce</code> 不需要重启，但不持续。</p> 
 <p>或者，可以选择在安装Linux操作系统时不要安装SELinux软件包，或选择删除相关软件包。这个选项是最具侵入性的，所以不推荐。</p> 
 <p>MongoDB实例默认将其数据文件存储在<code>/var/lib/mongo</code>目录，及其日志文件<code>/var/log/mongodb</code>中，并使用 mongod 用户帐户运行。可以在 <code>/etc/mongod.conf</code> 中指定备用日志和数据文件目录。 有关其他信息，请参阅<a target="_blank" href="http://docs.mongodb.com/manual/reference/configuration-options/#systemLog.path" title="systemLog.path">systemLog.path</a>和<a target="_blank" href="http://docs.mongodb.com/manual/reference/configuration-options/#storage.dbPath" title="storage.dbPath">storage.dbPath</a>。</p> 
 <p>如果更改运行 MongoDB 进程的用户，则必须修改 <em>/var/lib/mongo</em> 和 <em>/var/log/mongodb</em> 目录的访问控制权限，以使此用户能够访问这些目录。</p> 
 <p><strong>启动 MongoDB </strong></p> 
 <p>可以通过发出以下命令来启动 mongod 进程：</p> 
 <pre><code class="lang-shell"># sudo service mongod start
</code></pre> 
 <p><strong>验证MongoDB是否已成功启动</strong></p> 
 <p>可以通过检查 <code>/var/log/mongodb/mongod.log</code> 中的日志文件的内容来验证 mongod 进程是否成功启动，查看此文件应该会看到类似的内容 - </p> 
 <pre><code class="lang-shell">[root@localhost ~]# cat /var/log/mongodb/mongod.log
2017-06-29T04:36:57.410-0400 I CONTROL  [main] ***** SERVER RESTARTED *****
2017-06-29T04:36:57.695-0400 I CONTROL  [initandlisten] options: { command: [ "run" ], config: "/etc/mongod.conf", net: { bindIp: "127.0.0.1", port: 27017 }, processManagement: { fork: true, pidFilePath: "/var/run/mongodb/mongod.pid" }, storage: { dbPath: "/var/lib/mongo", journal: { enabled: true } }, systemLog: { destination: "file", logAppend: true, path: "/var/log/mongodb/mongod.log", quiet: true } }
2017-06-29T04:36:57.809-0400 I STORAGE  [initandlisten] wiredtiger_open config: create,cache_size=256M,session_max=20000,eviction=(threads_min=4,threads_max=4),config_base=false,statistics=(fast),log=(enabled=true,archive=true,path=journal,compressor=snappy),file_manager=(close_idle_time=100000),checkpoint=(wait=60,log_size=2GB),statistics_log=(wait=0),
... ...
2017-06-29T04:36:59.529-0400 I INDEX    [initandlisten] build index on: admin.system.version properties: { v: 2, key: { version: 1 }, name: "incompatible_with_version_32", ns: "admin.system.version" }
2017-06-29T04:36:59.529-0400 I INDEX    [initandlisten]          building index using bulk method; build may temporarily use up to 500 megabytes of RAM
2017-06-29T04:36:59.541-0400 I INDEX    [initandlisten] build index done.  scanned 0 total records. 0 secs
2017-06-29T04:36:59.542-0400 I COMMAND  [initandlisten] setting featureCompatibilityVersion to 3.4
2017-06-29T04:36:59.548-0400 I NETWORK  [thread1] waiting for connections on port 27017
[root@localhost ~]#
</code></pre> 
 <p>或者，使用以下命令 - </p>   
 <pre><code class="lang-shell">[root@localhost ~]# ps -aux|grep mongod
mongod     2169  2.7  3.9 971208 39804 ?        Sl   04:36   0:03 /usr/bin/mongod --quiet -f /etc/mongod.conf run
root       2376  0.0  0.0 112648   964 pts/0    R+   04:38   0:00 grep --color=auto mongod
[root@localhost ~]#
</code></pre> 
 <p>可以选择确保通过发出以下命令，MongoDB 将在系统启动后启动 mongod 服务：</p> 
 <pre><code class="lang-shell"># sudo chkconfig mongod on
</code></pre> 
 <p><strong>停止 MongoDB </strong></p> 
 <p>根据需要，可以通过发出以下命令来停止 mongod 进程：</p> 
 <pre><code class="lang-shell"># sudo service mongod stop
</code></pre> 
 <p><strong>重启 MongoDB </strong></p> 
 <p>根据需要，可以通过发出以下命令来重启 mongod 进程：</p> 
 <pre><code class="lang-shell"># sudo service mongod restart
</code></pre> 
 <p>可以通过查看 <em>/var/log/mongodb/mongod.log</em> 文件中的输出来跟踪进程状态的错误或重要信息。</p> 
 <p><strong>开始使用 MongoDB </strong></p> 
 <p>进入 MongoDB 命令行，简单地使用 - </p> 
 <pre><code>[root@localhost ~]# mongo

## 查看数据库
&gt; show dbs;

## 查看数据库版本
&gt; db.version();

## 常用命令帮助
&gt; db.help();
</code></pre>
 <pre><code class="lang-shell">
[root@localhost ~]# mongo
MongoDB shell version v3.4.5
connecting to: mongodb://127.0.0.1:27017
MongoDB server version: 3.4.5
Welcome to the MongoDB shell.
For interactive help, type "help".
For more comprehensive documentation, see
        http://docs.mongodb.org/
Questions? Try the support group
        http://groups.google.com/group/mongodb-user
Server has startup warnings:
2017-06-29T04:36:58.888-0400 I CONTROL  [initandlisten]
2017-06-29T04:36:58.888-0400 I CONTROL  [initandlisten] ** WARNING: Access contr                                                                                        ol is not enabled for the database.
2017-06-29T04:36:58.888-0400 I CONTROL  [initandlisten] **          Read and wri                                                                                        te access to data and configuration is unrestricted.
2017-06-29T04:36:58.888-0400 I CONTROL  [initandlisten]
2017-06-29T04:36:58.892-0400 I CONTROL  [initandlisten]
2017-06-29T04:36:58.892-0400 I CONTROL  [initandlisten] ** WARNING: /sys/kernel/                                                                                        mm/transparent_hugepage/enabled is 'always'.
2017-06-29T04:36:58.892-0400 I CONTROL  [initandlisten] **        We suggest set                                                                                        ting it to 'never'
2017-06-29T04:36:58.892-0400 I CONTROL  [initandlisten]
2017-06-29T04:36:58.892-0400 I CONTROL  [initandlisten] ** WARNING: /sys/kernel/                                                                                        mm/transparent_hugepage/defrag is 'always'.
2017-06-29T04:36:58.892-0400 I CONTROL  [initandlisten] **        We suggest set                                                                                        ting it to 'never'
2017-06-29T04:36:58.892-0400 I CONTROL  [initandlisten]
&gt;
&gt; show dbs;
admin  0.000GB
local  0.000GB
&gt; use local
switched to db local
&gt; db.version()
3.4.5
&gt;
</code></pre>
 <br>      
</div></body></html>
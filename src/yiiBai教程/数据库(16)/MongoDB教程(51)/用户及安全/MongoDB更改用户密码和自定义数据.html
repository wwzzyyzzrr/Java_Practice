<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">MongoDB更改用户密码和自定义数据</h1><div style="width:100%;float:left;" class="article-content">   
 <p>具有适当权限的用户可以更改自己的密码和自定义数据。 自定义数据存储可选的用户信息。</p> 
 <p><strong>注意事项</strong></p> 
 <p>在此过程要生成一个强大的密码，您可以使用<code>openssl</code>实用程序的<code>rand</code>命令。 例如，使用以下选项发出<code>openssl rand</code>，以创建<code>48</code>个伪随机字节的<code>base64</code>编码字符串：</p> 
 <pre><code class="lang-shell">openssl rand -base64 48
</code></pre> 
 <h2 id="h2-u5148u51B3u6761u4EF6"><a name="先决条件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>先决条件</h2>
 <p>要修改自己的密码和自定义数据，您必须具有在用户数据库上分别授予<code>changeOwnPassword</code>和<code>changeOwnCustomData</code>操作的权限。</p> 
 <p><strong>第一步：使用相应的权限连接到MongoDB</strong></p> 
 <p>使用“<strong>先决条件</strong>”部分指定的权限连接到 <code>mongod</code> 或 <code>mongos</code> 。</p> 
 <p>以下过程使用在“启用认证”中创建的用户：<code>myUserAdmin</code>。</p> 
 <pre><code class="lang-shell">$ mongo --port 27017 -u "myUserAdmin" -p "abc123" --authenticationDatabase "admin"
</code></pre> 
 <p><strong>第二步：使用适当的权限创建角色</strong></p> 
 <p>在管理数据库中，使用<code>changeOwnPassword</code>和<code>changeOwnCustomData</code>创建一个新角色。</p> 
 <pre><code class="lang-shell">use admin
db.createRole(
   { role: "changeOwnPasswordCustomDataRole",
     privileges: [
        {
          resource: { db: "", collection: ""},
          actions: [ "changeOwnPassword", "changeOwnCustomData" ]
        }
     ],
     roles: []
   }
)
</code></pre> 
 <p><strong>第三步：添加具有此角色的用户</strong></p> 
 <p>在<code>test</code>数据库中，使用创建的“<code>changeOwnPasswordCustomDataRole</code>”角色创建一个新用户。 例如，以下操作将创建具有内置角色<code>readWrite</code>和用户创建的“<code>changeOwnPasswordCustomDataRole</code>”的用户。</p> 
 <pre><code class="lang-shell">use test
db.createUser(
   {
     user:"user123",
     pwd:"12345678",
     roles:[ "readWrite", { role:"changeOwnPasswordCustomDataRole", db:"admin" } ]
   }
)
</code></pre> 
 <p>要向现有用户授予新角色，请使用<code>db.grantRolesToUser()</code>。</p> 
 <p><strong>执行过程</strong></p> 
 <p><strong>第一步：使用相应的权限连接到MongoDB</strong></p> 
 <p>使用“<strong>先决条件</strong>”部分指定的权限连接到 <code>mongod</code> 或 <code>mongos</code> 。</p> 
 <p>以下过程使用在“启用认证”中创建的用户：<code>myUserAdmin</code>。</p>   
 <pre><code class="lang-shell">$ mongo --port 27017 -u "myUserAdmin" -p "abc123" --authenticationDatabase "admin"
</code></pre> 
 <p>要检查您是否具有<strong>先决条件</strong>部分中指定的权限以及查看用户信息，请使用带有<code>--showPrivileges</code>选项的<code>usersInfo</code>命令。</p> 
 <p><strong>第二步：更改您的密码和自定义数据</strong></p> 
 <p>使用<code>db.updateUser()</code>方法来更新密码和自定义数据。</p> 
 <p>例如，以下操作将用户的密码更改为：<code>KNlZmiaNUp0B</code>，并将自定义数据更改为<code>{title：“Senior Manager”}</code>：</p> 
 <pre><code class="lang-shell">use test
db.updateUser(
   "user123",
   {
      pwd: "KNlZmiaNUp0B",
      customData: { title: "Senior Manager" }
   }
)
</code></pre>
 <br>      
</div></body></html>
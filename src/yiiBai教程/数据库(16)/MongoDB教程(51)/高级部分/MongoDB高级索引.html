<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">MongoDB高级索引</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在这一章节中，我们来学习高级索引，假设<code>users</code>集合的以下文档 -</p> 
 <pre><code class="lang-shell">{
   "address": {
      "city": "Haikou",
      "province": "Hainan",
      "pincode": "123456"
   },
   "tags": [
      "music",
      "cricket",
      "blogs"
   ],
   "name": "Maxsu"
}
</code></pre> 
 <p>上述文档包含地址子文档和标签数组。</p> 
 <h2 id="h2-u7D22u5F15u6570u7EC4u5B57u6BB5"><a name="索引数组字段" class="reference-link"></a><span class="header-link octicon octicon-link"></span>索引数组字段</h2>
 <p>假设要根据用户的标签搜索用户文档。为此，我们将在集合中的<code>tags</code>数组上创建一个索引。</p> 
 <p>在数组上创建一个索引依次为每个字段创建单独的索引条目。所以在这个例子中，当在<code>tags</code>数组上创建一个索引时，将为其值<code>music</code>，<code>cricket</code>和<code>blogs</code>创建单独的索引。</p> 
 <p>要在<code>tags</code>数组上创建索引，请使用以下代码 -</p> 
 <pre><code class="lang-shell">&gt;db.users.ensureIndex({"tags":1})
</code></pre> 
 <p>创建索引后，可以搜索这个集合的标签字段 -</p> 
 <pre><code class="lang-shell">&gt;db.users.find({tags:"cricket"})
</code></pre> 
 <p>要验证是否使用正确的索引，请使用以下说明命令 -</p> 
 <pre><code class="lang-shell">&gt;db.users.find({tags:"cricket"}).explain()
</code></pre> 
 <p>上面的命令生成：<code>“cursor”：“BtreeCursor tags_1”</code>，它确认使用了正确的索引。</p> 
 <h2 id="h2-u7D22u5F15u5B50u6587u6863u5B57u6BB5"><a name="索引子文档字段" class="reference-link"></a><span class="header-link octicon octicon-link"></span>索引子文档字段</h2>
 <p>假设要搜索基于<code>city</code>，<code>province</code>和<code>pincode</code>字段的文档。 由于所有这些字段都是地址子文档字段的一部分，因此将在子文档的所有字段上创建一个索引。</p> 
 <p>要在子文档的所有三个字段上创建索引，请使用以下代码 -</p>   
 <pre><code class="lang-shell">&gt;db.users.ensureIndex({"address.city":1,"address.state":1,"address.pincode":1})
</code></pre> 
 <p>创建索引后，就可以使用此索引来搜索任何子文档的字段了，如下所示：</p> 
 <pre><code class="lang-shell">&gt;db.users.find({"address.city":"Haikou"})
</code></pre> 
 <p>请记住，查询表达式必须遵循指定的索引的顺序。 所以上面创建的索引将支持以下查询 -</p> 
 <pre><code class="lang-shell">&gt;db.users.find({"address.city":"Haikou","address.province":"Hainan"})
</code></pre> 
 <p>它还将支持以下查询 -</p> 
 <pre><code class="lang-shell">&gt;db.users.find({"address.city":"Haikou","address.province":"Hainan",
   "address.pincode":"12345"})
</code></pre>
 <br>      
</div></body></html>
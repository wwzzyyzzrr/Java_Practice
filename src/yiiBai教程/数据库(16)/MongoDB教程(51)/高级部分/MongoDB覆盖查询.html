<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">MongoDB覆盖查询</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在本章中，我们将了解覆盖查询。</p> 
 <h2 id="h2--"><a name="什么是覆盖查询？" class="reference-link"></a><span class="header-link octicon octicon-link"></span>什么是覆盖查询？</h2>
 <p>根据官方MongoDB文档，覆盖查询是一个查询，其中 -</p> 
 <ul> 
  <li>查询中的所有字段都是索引的一部分。</li>
  <li>查询中返回的所有字段都在同一个索引中。</li>
 </ul> 
 <p>由于查询中存在的所有字段都是索引的一部分，所以MongoDB查询指定条件匹配，并使用相同的索引返回结果，而不会实际查找文档。由于索引存在于RAM/内存中，与通过扫描文档获取数据相比，从索引获取数据更快。</p> 
 <h2 id="h2-u4F7Fu7528u8986u76D6u67E5u8BE2"><a name="使用覆盖查询" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用覆盖查询</h2>
 <p>要测试覆盖的查询，请在<code>users</code>集合中考虑以下文档 -</p> 
 <pre><code class="lang-shell">{
   "_id": ObjectId("234324fd852426020001111"),
   "contact": "13800138000",
   "dob": "1991-11-11",
   "gender": "M",
   "name": "Maxsu",
   "user_name": "user_maxsu"
}
</code></pre> 
 <p>首先使用以下查询在<code>users</code>集合 的字段：<code>gender</code> 和 <code>user_name</code> 上创建一个复合索引 -</p> 
 <pre><code class="lang-shell">&gt; db.users.ensureIndex({gender:1,user_name:1})
</code></pre> 
 <p>现在，这个索引将覆盖以下查询 -</p>   
 <pre><code class="lang-shell">&gt;db.users.find({gender:"M"},{user_name:1,_id:0})
</code></pre> 
 <p>也就是说，对于上述查询，MongoDB不会查找数据库文档。相反，它将从索引数据中获取所需的数据。</p> 
 <p>由于索引不包括<code>_id</code>字段，在上面示例中，已经将其从查询的结果集中明确排除，因为MongoDB默认情况下在每个查询中返回<code>_id</code>字段。 所以下面的查询不会在上面创建的索引中被覆盖(查询有返回<code>_id</code>字段) -</p> 
 <pre><code class="lang-shell">&gt;db.users.find({gender:"M"},{user_name:1})
</code></pre> 
 <p>最后，请记住，如果有下列情况，则索引无法覆盖查询 -</p> 
 <ul> 
  <li>任何索引的字段是一个数组</li>
  <li>任何索引的字段是一个子文档</li>
 </ul>
 <br>      
</div></body></html>
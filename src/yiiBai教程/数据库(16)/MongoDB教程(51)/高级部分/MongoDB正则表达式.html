<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">MongoDB正则表达式</h1><div style="width:100%;float:left;" class="article-content">   
 <p>正则表达式在所有的编程语言中经常使用，用于以搜索任何字符串中的模式或单词。 MongoDB还提供使用<code>$regex</code>运算符的字符串模式匹配的正则表达式的功能。 MongoDB使用PCRE(Perl兼容正则表达式)作为正则表达式语言。</p> 
 <p>与文本搜索不同，不需要使用任何配置或命令来使用正则表达式。</p> 
 <p>请考虑以下文档结构，其中包含<code>post</code>文本及其标签 -</p> 
 <pre><code class="lang-shell">{
   "post_text": "enjoy the mongodb articles on yiibai tutorials",
   "tags": [
      "mongodb",
      "yiibai"
   ]
}
</code></pre> 
 <h2 id="h2-u4F7Fu7528u6B63u5219u8868u8FBEu5F0F"><a name="使用正则表达式" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用正则表达式</h2>
 <p>以下<code>regex</code>查询搜索包含”<code>yiibai</code>“字符串的所有帖子 -</p> 
 <pre><code class="lang-shell">&gt;db.posts.find({post_text:{$regex:"yiibai"}})
</code></pre> 
 <p>上面的查询也可以写成 -</p> 
 <pre><code class="lang-shell">&gt;db.posts.find({post_text:/yiibai/})
</code></pre> 
 <h2 id="h2-u4F7Fu7528u4E0Du533Au5206u5927u5C0Fu5199u7684u6B63u5219u8868u8FBEu5F0F"><a name="使用不区分大小写的正则表达式" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用不区分大小写的正则表达式</h2>
 <p>要使搜索不区分大小写，可指定<code>$options</code>参数的值为<code>$i</code>。 以下命令将寻找具有单词<code>yiibai</code>的字符串，不管其是小写还是大写字母 -</p> 
 <pre><code class="lang-shell">&gt;db.posts.find({post_text:{$regex:"yiibai", $options:"$i"}})
</code></pre> 
 <p>此查询返回的结果之一是以下文档，其中包含大小写字母的”<code>yiibai</code>“单词 -</p> 
 <pre><code class="lang-shell">{
   "_id" : ObjectId("595b99e1f6a6243715b3c316"),
   "post_text" : "hey! this is my post on Yiibai Yiibai", 
   "tags" : [ "yiibai" ]
},
{
   "_id" : ObjectId("595b99e1f6a6243715b3c317"),
   "post_text" : "hey! this is my post on yiiBai Yiibai", 
   "tags" : [ "yiibai" ]
}
</code></pre> 
 <h2 id="h2-u5BF9u6570u7EC4u5143u7D20u4F7Fu7528u6B63u5219u8868u8FBEu5F0F"><a name="对数组元素使用正则表达式" class="reference-link"></a><span class="header-link octicon octicon-link"></span>对数组元素使用正则表达式</h2>
 <p>我们也可以在数组字段上使用正则表达式。当实现标签的功能时，这尤其重要。 所以，如果要从单词：<code>tutorial</code>(<code>tutorial</code>，<code>tutorials</code> , <code>tutorialpoint</code> 或 <code>tutorialphp</code> 或 <code>tutorialpython</code> 或 <code>tutorialphp</code>)开始搜索所有具有标签的帖子，可以使用以下代码 -</p>   
 <pre><code class="lang-shell">&gt; db.posts.find({tags:{$regex:"tutorial"}})
</code></pre> 
 <h2 id="h2-u4F18u5316u6B63u5219u8868u8FBEu5F0Fu67E5u8BE2"><a name="优化正则表达式查询" class="reference-link"></a><span class="header-link octicon octicon-link"></span>优化正则表达式查询</h2>
 <ul> 
  <li><p>如果文档字段创建了索引，则查询将使用索引值来匹配正则表达式。 与正常表达式扫描整个集合相比，使用索引值使得搜索非常快。</p> </li>
  <li><p>如果正则表达式是前缀表达式，则所有匹配都是以某个字符串字符开始。 例如，如果正则表达式是<code>^tut</code>，则查询必须仅搜索以<code>tut</code>开头的那些字符串。</p> </li>
 </ul>
 <br>      
</div></body></html>
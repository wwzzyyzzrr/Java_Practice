<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">MongoDB关联关系</h1><div style="width:100%;float:left;" class="article-content">   
 <p>MongoDB中的关系表示各个文档在逻辑上的相互关联。关系可以通过嵌入式和引用方法建模。 这种关系可以是<code>1：1</code>，<code>1：N</code>，<code>N：1</code>或<code>N：N</code>。</p> 
 <p>假设有一种情况：要存储用户的地址。一个用户可以拥有多个地址，这就是<code>1：N</code>关系。</p> 
 <p>以下是用户(<code>user</code>)文档示例的文档结构 -</p> 
 <pre><code class="lang-shell">{
   "_id":10999110,
   "name": "Maxsu",
   "contact": "13888990021",
   "dob": "1992-10-11"
}
</code></pre> 
 <p>以下是地址(<code>address</code>)文档的示例文档结构 -</p> 
 <pre><code class="lang-shell">{
   "_id":12200,
   "building": "Hainan Building NO.2100",
   "pincode": 571100,
   "city": "Haikou",
   "province": "Hainan"
}
</code></pre> 
 <h2 id="h2-u5D4Cu5165u5F0Fu5173u7CFBu5EFAu6A21"><a name="嵌入式关系建模" class="reference-link"></a><span class="header-link octicon octicon-link"></span>嵌入式关系建模</h2>
 <p>在嵌入式方法中，我们将地址(<code>address</code>)文档嵌入到用户(<code>user</code>)文档中。</p> 
 <pre><code class="lang-shell">{
   "_id": 21000100,
   "contact": "13800138000",
   "dob": "1991-11-11",
   "name": "Maxsu",
   "address": [
      {
         "building": "Hainan Building NO.2100",
         "pincode": 571100,
         "city": "Haikou",
         "province": "Hainan"
      },
      {
         "building": "Sanya Building NO.2100",
         "pincode": 572200,
         "city": "Sanya",
         "province": "Hainan"
      },
   ]
}
</code></pre> 
 <p>该方法将所有相关数据保存在单个文档中，这使得检索和维护更容易。可以使用单个查询来在整个文档检索，例如 -</p> 
 <pre><code class="lang-shell">&gt; db.users.findOne({"name":"Maxsu"},{"address":1, "name":1})
</code></pre> 
 <p>请注意，在上述查询中，<code>db</code>和<code>users</code>分别是数据库和集合。缺点是如果嵌入式文档的大小如果不断增长，可能会影响读/写性能。</p> 
 <h2 id="h2-u5EFAu6A21u53C2u8003u5173u7CFB"><a name="建模参考关系" class="reference-link"></a><span class="header-link octicon octicon-link"></span>建模参考关系</h2>
 <p>这是设计规范化关系的方法。 在这种方法中，用户和地址文件将分别维护，但用户文档将包含一个将引用地址文档的<code>id</code>字段的字段。</p>   
 <pre><code class="lang-shell">{
   "_id":ObjectId("52ffc33321332111sdfaf"),
   "contact": "13800138000",
   "dob": "1991-11-11",
   "name": "Maxsu",
   "address_ids": [
      ObjectId("123123"),
      ObjectId("123412")
   ]
}
</code></pre> 
 <p>如上所示，用户文档包含对应地址的<code>ObjectId</code>的数组字段<code>address_ids</code>。 使用这些ObjectIds，我们可以从那里查询地址文件并获取地址详细信息。 使用这种方法，需要两个查询：首先从用户文档获取<code>address_ids</code>字段，然后从地址集中获取这些地址。</p> 
 <pre><code class="lang-shell">&gt;var result = db.users.findOne({"name":"Maxsu"},{"address_ids":1})
&gt;var addresses = db.address.find({"_id":{"$in":result["address_ids"]}})
</code></pre>
 <br>      
</div></body></html>
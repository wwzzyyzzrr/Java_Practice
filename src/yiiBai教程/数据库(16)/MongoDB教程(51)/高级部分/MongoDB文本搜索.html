<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">MongoDB文本搜索</h1><div style="width:100%;float:left;" class="article-content">   
 <p>从<em>MongoDB 2.4</em>版开始，MongoDB开始支持文本索引来搜索字符串内容。文本搜索使用词法技术通过删除字符串字词，如<code>a</code>，<code>an</code>等等来查找字符串字段中的指定单词。目前，MongoDB支持大约15种语言。</p> 
 <h2 id="h2-u542Fu7528u6587u672Cu641Cu7D22"><a name="启用文本搜索" class="reference-link"></a><span class="header-link octicon octicon-link"></span>启用文本搜索</h2>
 <p>最初，文本搜索是一个实验性功能，但从<em>MongoDB 2.4</em>版开始，默认情况下启用配置。 但是，如果使用<em>2.4</em>之前版本的MongoDB，则必须使用以下代码启用文本搜索 -</p> 
 <pre><code class="lang-shell">&gt;db.adminCommand({setParameter:true,textSearchEnabled:true})
</code></pre> 
 <h2 id="h2-u521Bu5EFAu6587u672Cu7D22u5F15"><a name="创建文本索引" class="reference-link"></a><span class="header-link octicon octicon-link"></span>创建文本索引</h2>
 <p>请考虑以下文档，其中包含帖子文字及其标签 -</p> 
 <pre><code class="lang-shell">{
   "post_text": "enjoy the mongodb articles on yiibai tutorials",
   "tags": [
      "mongodb",
      "yiibai tutorials"
   ]
}
</code></pre> 
 <p>我们将在<code>post_text</code>字段上创建一个文本索引，以便可以在<code>posts</code>的文本中搜索 -</p> 
 <pre><code class="lang-shell">&gt;db.posts.ensureIndex({post_text:"text"})
</code></pre> 
 <h2 id="h2-u4F7Fu7528u6587u672Cu7D22u5F15"><a name="使用文本索引" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用文本索引</h2>
 <p>现在我们已经在<code>post_text</code>字段上创建了文本索引，下面在其文本中搜索所有带有“<code>yiibai</code>”一词的帖子。</p> 
 <pre><code class="lang-shell">&gt;db.posts.find({$text:{$search:"yiibai"}})
</code></pre> 
 <p>上述命令返回以下结果文件，其文本中包含“<code>yiibai</code>”一词 -</p>   
 <pre><code class="lang-shell">{ 
   "_id" : ObjectId("595b99e2f6a6243715b3c316"), 
   "post_text" : "enjoy the mongodb articles on yiibai", 
   "tags" : [ "mongodb", "yiibai" ]
}
{
   "_id" : ObjectId("595b99e2f6a6243715b3c317"), 
   "post_text" : "writing yiibai tutorials on mongodb",
   "tags" : [ "mongodb", "tutorial" ] 
}
</code></pre> 
 <p>如果您使用旧版本的MongoDB，则必须使用以下命令 -</p> 
 <pre><code class="lang-shell">&gt;db.posts.runCommand("text",{search:" yiibai "})
</code></pre> 
 <p>与正常搜索相比，使用文本搜索极大地提高了搜索效率。</p> 
 <h2 id="h2-u5220u9664u6587u672Cu7D22u5F15"><a name="删除文本索引" class="reference-link"></a><span class="header-link octicon octicon-link"></span>删除文本索引</h2>
 <p>要删除现有的文本索引，首先使用以下查询找到索引的名称 -</p> 
 <pre><code class="lang-shell">
&gt;db.posts.getIndexes()
</code></pre> 
 <p>从上面的查询获取索引的名称后，运行以下命令。 这里，<code>post_text_text</code>是索引的名称。</p> 
 <pre><code class="lang-shell">&gt;db.posts.dropIndex("post_text_text")
</code></pre>
 <br>      
</div></body></html>
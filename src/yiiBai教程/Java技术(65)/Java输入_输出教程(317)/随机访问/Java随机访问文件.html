<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Java随机访问文件</h1><div style="width:100%;float:left;" class="article-content">   
 <p>使用随机访问文件，我们可以从文件读取以及写入文件。使用文件输入和输出流的读取和写入是顺序过程。使用随机访问文件，可以在文件中的任何位置读取或写入。<br><code>RandomAccessFile</code>类的一个对象可以进行随机文件访问。可以读/写字节和所有原始类型的值到一个文件。</p> 
 <p><code>RandomAccessFile</code>可以使用其<code>readUTF()</code>和<code>writeUTF()</code>方法处理字符串。<code>RandomAccessFile</code>类不在<code>InputStream</code>和<code>OutputStream</code>类的类层次结构中。</p> 
 <h2 id="h2-u6A21u5F0F"><a name="模式" class="reference-link"></a><span class="header-link octicon octicon-link"></span>模式</h2>
 <p>可以在四种不同的访问模式中创建随机访问文件。访问模式值是一个字符串。 它们列出如下：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>模式</th> 
    <th>含义</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>“r”</td> 
    <td>文件以只读模式打开。</td> 
   </tr> 
   <tr> 
    <td>“rw”</td> 
    <td>该文件以读写模式打开。 如果文件不存在，则创建该文件。</td> 
   </tr> 
   <tr> 
    <td>“rws”</td> 
    <td>该文件以读写模式打开。 对文件的内容及其元数据的任何修改就会立即被写入存储设备。</td> 
   </tr> 
   <tr> 
    <td>“rwd”</td> 
    <td>该文件以读写模式打开。 对文件内容的任何修改都会立即写入存储设备。</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 id="h2-u8BFBu548Cu5199"><a name="读和写" class="reference-link"></a><span class="header-link octicon octicon-link"></span>读和写</h2>
 <p>通过指定文件名和访问模式来创建<code>RandomAccessFile</code>类的实例。</p> 
 <pre><code class="lang-java">RandomAccessFile  raf = new RandomAccessFile("randomtest.txt", "rw");
</code></pre> 
 <p>随机访问文件具有文件指针，当从其读取数据或向其写入数据时，文件指针向前移动。文件指针是下一次读取或写入将开始的光标。其值指示光标与文件开头的距离(以字节为单位)。</p> 
 <p>可以通过使用其<code>getFilePointer()</code>方法来获取文件指针的值。当创建一个<code>RandomAccessFile</code>类的对象时，文件指针被设置为零。可以使用<code>seek()</code>方法将文件指针设置在文件中的特定位置。</p> 
 <p><code>RandomAccessFile</code>类的<code>length()</code>方法返回文件的当前长度。可以通过使用其<code>setLength()</code>方法来扩展或截断文件。</p> 
 <h2 id="h2-u793Au4F8B"><a name="示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>示例</h2>
 <p>以下代码显示如何使用<code>RandomAccessFile</code>对象读取和写入文件。</p>   
 <pre><code class="lang-java">import java.io.File;
import java.io.IOException;
import java.io.RandomAccessFile;

public class Main {
  public static void main(String[] args) throws IOException {
    String fileName = "randomaccessfile.txt";
    File fileObject = new File(fileName);

    if (!fileObject.exists()) {
      initialWrite(fileName);
    }
    readFile(fileName);
    readFile(fileName);
  }

  public static void readFile(String fileName) throws IOException {
    RandomAccessFile raf = new RandomAccessFile(fileName, "rw");
    int counter = raf.readInt();
    String msg = raf.readUTF();

    System.out.println(counter);
    System.out.println(msg);
    incrementReadCounter(raf);
    raf.close();
  }

  public static void incrementReadCounter(RandomAccessFile raf)
      throws IOException {
    long currentPosition = raf.getFilePointer();
    raf.seek(0);
    int counter = raf.readInt();
    counter++;
    raf.seek(0);
    raf.writeInt(counter);
    raf.seek(currentPosition);
  }

  public static void initialWrite(String fileName) throws IOException {
    RandomAccessFile raf = new RandomAccessFile(fileName, "rw");
    raf.writeInt(0);
    raf.writeUTF("Hello world!");
    raf.close();
  }
}
</code></pre> 
 <p>上面的代码生成以下结果。</p> 
 <pre><code class="lang-java">0
Hello world!
1
Hello world!
</code></pre>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Java文件所有者权限</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在Java中，有三种方法可以管理文件所有者：</p> 
 <ul> 
  <li>使用<code>Files.getOwner()</code>和<code>Files.setOwner()</code>方法。</li>
  <li>使用“<code>owner</code>”作为属性名称的<code>Files.getAttribute()</code>和<code>Files.setAttribute()</code>方法。</li>
  <li>使用<code>FileOwnerAttributeView</code>。</li>
 </ul> 
 <p>需要使用<code>UserPrincipal</code>和<code>GroupPrincipal</code>接口来管理文件的所有者。文件的所有者可以是用户或组。<code>UserPrincipal</code>表示用户，<code>GroupPrincipal</code>表示组。<br>当读取文件的所有者时，得到一个<code>UserPrincipal</code>的实例。调用<code>UserPrincipal</code>对象上的<code>getName()</code>方法以获取用户的名称。</p> 
 <p>要设置文件的所有者，请从用户名获取<code>UserPrincipal</code>的对象。</p> 
 <p>要从文件系统获取<code>UserPrincipal</code>，请使用<code>UserPrincipalLookupService</code>类的实例，可以使用<code>FileSystem</code>类的<code>getUserPrincipalLookupService()</code>方法获取该实例。</p> 
 <p>以下代码为用户ID为<code>myName</code>的用户获取一个<code>UserPrincipal</code>对象：</p> 
 <pre><code class="lang-java">FileSystem fs  = FileSystems.getDefault();
UserPrincipalLookupService upls  = fs.getUserPrincipalLookupService();

UserPrincipal user = upls.lookupPrincipalByName("myName"); 
System.out.format("User principal name is %s%n", user.getName());
</code></pre> 
 <p>以下代码显示如何使用<code>FileOwnerAttributeView</code>更改文件的所有者。</p> 
 <pre><code class="lang-java">import java.io.IOException;
import java.nio.file.FileSystem;
import java.nio.file.FileSystems;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.attribute.FileOwnerAttributeView;
import java.nio.file.attribute.UserPrincipal;
import java.nio.file.attribute.UserPrincipalLookupService;

public class Main {
  public static void main(String[] args) throws Exception {

      Path path = Paths.get("C:\\Java_Dev\\test1.txt");

      FileOwnerAttributeView foav = Files.getFileAttributeView(path,
          FileOwnerAttributeView.class);

      UserPrincipal owner = foav.getOwner();
      System.out.format("Original owner  of  %s  is %s%n", path,
          owner.getName());

      FileSystem fs = FileSystems.getDefault();
      UserPrincipalLookupService upls = fs.getUserPrincipalLookupService();

      UserPrincipal newOwner = upls.lookupPrincipalByName("brice");
      foav.setOwner(newOwner);

      UserPrincipal changedOwner = foav.getOwner();
      System.out.format("New owner  of  %s  is %s%n", path,
          changedOwner.getName());

  }
}
</code></pre> 
 <p>以下代码使用<code>Files.setOwner()</code>方法更新在<strong>Windows</strong>上使用路径<code>C:\Java_Dev\test1.txt</code>标识的文件的所有者：</p> 
 <pre><code class="lang-java">UserPrincipal owner  = get   the   owner;
Path  path   = Paths.get("C:\\Java_Dev\\test1.txt"); 
Files.setOwner(path,  owner);
</code></pre> 
 <h2 id="h2-acl-"><a name="ACL文件权限" class="reference-link"></a><span class="header-link octicon octicon-link"></span>ACL文件权限</h2>
 <p>Microsoft Windows上支持ACL类型文件属性。ACL由访问控制条目的有序列表组成。每个条目由一个<code>UserPrincipal</code>，访问类型和对对象的访问级别组成。<code>AclEntry</code>类表示ACL中的条目。</p> 
 <p>使用<code>AclFileAttributeView</code>的<code>getAcl()</code>和<code>setAcl()</code>方法获取和设置文件的<code>AclEntry</code>列表。</p> 
 <p>以下代码获取名为 <code>C:\Java_Dev\test1.txt</code> 的文件的ACL条目列表：</p> 
 <pre><code class="lang-java">Path  path   = Paths.get("C:\\Java_Dev\\test1.txt"); 
AclFileAttributeView view  = Files.getFileAttributeView(path,  AclFileAttributeView.class); 
List&lt;AclEntry&gt; aclEntries = view.getAcl();
</code></pre> 
 <p><code>AclEntry</code>类可以读取ACL条目的各种属性。 其<code>principal()</code>方法返回<code>UserPrincipal</code>以标识用户或组。<code>AclEntry</code>的<code>permissions()</code>返回一组<code>AclEntryPermission</code>对象以标识权限。<br><code>AclEntry</code>的<code>type()</code>方法返回类型<code>AclEntryType</code>的枚举常量，例如<code>ALARM</code>，<code>ALLOW</code>，<code>AUDIT``和DENY</code>，用于指示访问类型。<br><code>AclEntry</code>的<code>flags()</code>方法返回一组<code>AclEntryFlag</code>枚举常量，其中包含ACL条目的继承标志。</p> 
 <p>以下代码显示如何读取文件 <code>C:\Java_Dev\test1.txt</code> 的ACL条目。</p> 
 <pre><code class="lang-java">import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.attribute.AclEntry;
import java.nio.file.attribute.AclEntryPermission;
import java.nio.file.attribute.AclFileAttributeView;
import java.util.List;
import java.util.Set;

public class Main {
  public static void main(String[] args) throws Exception {
    Path path = Paths.get("C:\\Java_Dev\\test1.txt");
    AclFileAttributeView aclView = Files.getFileAttributeView(path,
        AclFileAttributeView.class);
    if (aclView == null) {
      System.out.format("ACL view  is not  supported.%n");
      return;
    }
    List&lt;AclEntry&gt; aclEntries = aclView.getAcl();
    for (AclEntry entry : aclEntries) {
      System.out.format("Principal: %s%n", entry.principal());
      System.out.format("Type: %s%n", entry.type());
      System.out.format("Permissions are:%n");

      Set&lt;AclEntryPermission&gt; permissions = entry.permissions();
      for (AclEntryPermission p : permissions) {
        System.out.format("%s %n", p);
      }

    }

  }
}
</code></pre> 
 <h2 id="h2-u793Au4F8B"><a name="示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>示例</h2>
 <p>以下代码显示如何为名为<code>brice</code>的用户添加新的ACL条目。 它在 <code>C:\Java_Dev\test1.txt</code> 文件中为用户添加<code>DATA_READ</code>和<code>DATA_ WRITE</code>权限。</p> 
 <pre><code class="lang-java">import static java.nio.file.attribute.AclEntryPermission.READ_DATA;
import static java.nio.file.attribute.AclEntryPermission.WRITE_DATA;

import java.io.IOException;
import java.nio.file.FileSystems;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.attribute.AclEntry;
import java.nio.file.attribute.AclEntryPermission;
import java.nio.file.attribute.AclEntryType;
import java.nio.file.attribute.AclFileAttributeView;
import java.nio.file.attribute.UserPrincipal;
import java.util.EnumSet;
import java.util.List;
import java.util.Set;

public class Main {
  public static void main(String[] args) throws Exception {
    Path path = Paths.get("C:\\Java_Dev\\test1.txt");

    AclFileAttributeView aclView = Files.getFileAttributeView(path,
        AclFileAttributeView.class);
    if (aclView == null) {
      System.out.format("ACL view  is not  supported.%n");
      return;
    }
    UserPrincipal bRiceUser = FileSystems.getDefault()
        .getUserPrincipalLookupService().lookupPrincipalByName("brice");

    Set&lt;AclEntryPermission&gt; permissions = EnumSet.of(READ_DATA, WRITE_DATA);

    AclEntry.Builder builder = AclEntry.newBuilder();
    builder.setPrincipal(bRiceUser);
    builder.setType(AclEntryType.ALLOW);
    builder.setPermissions(permissions);
    AclEntry newEntry = builder.build();

    List&lt;AclEntry&gt; aclEntries = aclView.getAcl();

    aclEntries.add(newEntry);

    aclView.setAcl(aclEntries);
  }
}
</code></pre> 
 <h2 id="h2-posix-"><a name="POSIX文件权限" class="reference-link"></a><span class="header-link octicon octicon-link"></span>POSIX文件权限</h2>
 <p>UNIX支持POSIX标准文件属性。POSIX文件权限由九个组件组成：</p> 
 <ul> 
  <li>三个为所有者</li>
  <li>三个为所在用户组</li>
  <li>三个为其它</li>
 </ul> 
 <p>这三种类型的权限分别是：读，写和执行。</p> 
 <p>典型POSIX的字符串形式文件权限看起来像“<code>rw-rw----</code>”，它表示所有者和组的读取和写入权限。<code>PosixFilePermission</code>枚举类型定义九个常量，每个权限组件一个。九个常量命名为<code>X_Y</code>，其中X是<code>OWNER</code>，<code>GROUP</code>和<code>OTHERS</code>，<code>Y</code>是<code>READ</code>，<code>WRITE</code>和<code>EXECUTE</code>。</p> 
 <p><code>PosixFilePermissions</code>是一个实用程序类，它将文件的POSIX权限从一种形式转换为另一种形式的方法。<br>它的<code>toString()</code>方法将一组<code>PosixFilePermission</code>枚举常量转换为<code>rwxrwxrwx</code>形式的字符串。它的<code>fromString()</code>方法将<code>rwxrwxrwx</code>形式的字符串中的POSIX文件权限转换为一组<code>PosixFilePermissio</code>n枚举常量。它的<code>asFileAttribute()</code>方法将一组<code>PosixFilePermission</code>枚举常量转换为<code>FileAttribute</code>对象。</p> 
 <p>以下代码是在默认目录中一个名称为<code>test</code>的文件夹的<code>rwxrwxrwx</code>格式读取和打印POSIX文件权限：</p>   
 <pre><code class="lang-java">import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.attribute.PosixFileAttributeView;
import java.nio.file.attribute.PosixFileAttributes;
import java.nio.file.attribute.PosixFilePermission;
import java.nio.file.attribute.PosixFilePermissions;
import java.util.Set;

public class Main {
  public static void main(String[] argv)throws Exception {
    Path path = Paths.get("test");
    PosixFileAttributeView posixView = Files.getFileAttributeView(path,
        PosixFileAttributeView.class);
    PosixFileAttributes attribs = posixView.readAttributes();
    Set&lt;PosixFilePermission&gt; permissions = attribs.permissions();
    // Convert the file permissions into the rwxrwxrwx string form
    String rwxFormPermissions = PosixFilePermissions.toString(permissions);
    // Print the permissions
    System.out.println(rwxFormPermissions);
  }
}
</code></pre> 
 <p>要更新POSIX文件权限，请调用<code>PosixFileAttributeView</code>的<code>setPermissions()</code>方法，将<code>PosixFilePermission</code>枚举常量的<code>Set</code>作为参数传递。</p> 
 <p>以下代码显示如何设置POSIX文件权限：</p> 
 <pre><code class="lang-java">String rwxFormPermissions = "rw-r-----";
Set&lt;PosixFilePermission&gt; permissions = PosixFilePermissions.fromString(rwxFormPermissions);

posixView.setPermissions(permissions);
</code></pre> 
 <p>以下代码直接创建一组<code>PosixFilePermission</code>枚举常量，并将其设置为文件权限。</p> 
 <pre><code class="lang-java">Set&lt;PosixFilePermission&gt; permissions = EnumSet.of(OWNER_READ,  OWNER_WRITE, GROUP_READ);
posixView.setPermissions(permissions);
</code></pre> 
 <p>以下代码演示如何在类似UNIX的平台上读取和更新名为<code>test</code>的文件的POSIX文件权限(注：最好在Linux/Unix操作系统上执行)。</p> 
 <pre><code class="lang-java">import static java.nio.file.attribute.PosixFilePermission.GROUP_READ;
import static java.nio.file.attribute.PosixFilePermission.OWNER_READ;
import static java.nio.file.attribute.PosixFilePermission.OWNER_WRITE;

import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.attribute.PosixFileAttributeView;
import java.nio.file.attribute.PosixFileAttributes;
import java.nio.file.attribute.PosixFilePermission;
import java.nio.file.attribute.PosixFilePermissions;
import java.util.EnumSet;
import java.util.Set;

public class Main {
  public static void main(String[] args) throws Exception {
    Path path = Paths.get("test");
    PosixFileAttributeView posixView = Files.getFileAttributeView(path,
        PosixFileAttributeView.class);
    if (posixView == null) {
      System.out.format("POSIX attribute view  is not  supported%n.");
      return;
    }
    readPermissions(posixView);
    updatePermissions(posixView);
  }

  public static void readPermissions(PosixFileAttributeView posixView)
      throws Exception {
    PosixFileAttributes attribs;
    attribs = posixView.readAttributes();
    Set&lt;PosixFilePermission&gt; permissions = attribs.permissions();
    // Convert the set of posix file permissions into rwxrwxrwx form
    String rwxFormPermissions = PosixFilePermissions.toString(permissions);
    System.out.println(rwxFormPermissions);
  }
  public static void updatePermissions(PosixFileAttributeView posixView)
      throws Exception {
    Set&lt;PosixFilePermission&gt; permissions = EnumSet.of(OWNER_READ, OWNER_WRITE,
        GROUP_READ);
    posixView.setPermissions(permissions);
    System.out.println("Permissions set successfully.");
  }
}
</code></pre> 
 <p>上面的代码生成以下结果。</p> 
 <pre><code class="lang-java">POSIX attribute view  is not  supported
.
</code></pre>
 <br>      
</div></body></html>
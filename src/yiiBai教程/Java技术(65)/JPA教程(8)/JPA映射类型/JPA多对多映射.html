<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">JPA多对多映射</h1><div style="width:100%;float:left;" class="article-content">   
 <p>多对多映射表示集合值关联，其中任何数量的实体可以与其他实体的集合关联。 在关系数据库中，一个实体的任何行可以被引用到另一个实体的任意数量的行。</p> 
 <p>完整的项目目录结构如下所示 - </p> 
 <h2 id="h2--manytomany-"><a name="@ManyToMany 示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span><a target="_blank" href="https://github.com/ManyToMany" title="@ManyToMany" class="at-link">@ManyToMany</a> 示例</h2>
 <p>在这个例子中，我们将创建学生和图书馆之间的多对多关系，以便可以为任何数量的学生发放任何类型的书籍。</p> 
 <p>这个例子包含以下步骤 -</p> 
 <p><strong>第1步:</strong> 在<code>com.yiibai.mapping</code>包中创建一个实体类<code>Student.java</code>，包含学生ID(s_id)和学生姓名(s_name)，其中包含一个使用<code>@<a target="_blank" href="https://github.com/ManyToMany" title="@ManyToMany" class="at-link">@ManyToMany</a></code>注解的<code>List</code>类型的<code>Library</code>类对象。</p> 
 <p>文件:<em>Student.java</em> 的代码如下所示 - </p> 
 <pre><code class="lang-java">package com.yiibai.mapping;

import java.util.List;

import javax.persistence.*;

@Entity
public class Student {

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private int s_id;
    private String s_name;

    @ManyToMany(targetEntity = Library.class)
    private List lib;

    public Student(int s_id, String s_name, List lib) {
        super();
        this.s_id = s_id;
        this.s_name = s_name;
        this.lib = lib;
    }

    public Student() {
        super();
        // TODO Auto-generated constructor stub
    }

    public List getLib() {
        return lib;
    }

    public void ListLib(List lib) {
        this.lib = lib;
    }

    public int getS_id() {
        return s_id;
    }

    public void ListS_id(int s_id) {
        this.s_id = s_id;
    }

    public String getS_name() {
        return s_name;
    }

    public void ListS_name(String s_name) {
        this.s_name = s_name;
    }
}
</code></pre> 
 <p><strong>第2步:</strong> 在包含<code>book id(b_id)</code>，<code>book name(b_name)</code>和<code><a target="_blank" href="https://github.com/ManyToMany" title="@ManyToMany" class="at-link">@ManyToMany</a></code>注释的<code>com.yiibai.mapping</code>包下创建另一个实体类<code>Library.java</code>，其中包含List类型的<code>Student</code>类对象。</p> 
 <p>文件:<em>Library.java</em> 的代码如下所示 - </p> 
 <pre><code class="lang-java">package com.yiibai.mapping;

import java.util.List;

import javax.persistence.*;

@Entity
public class Library {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private int b_id;
    private String b_name;

    @ManyToMany(targetEntity = Student.class)
    private List stud;

    public Library(int b_id, String b_name, List stud) {
        super();
        this.b_id = b_id;
        this.b_name = b_name;
        this.stud = stud;
    }

    public Library() {
        super();
        // TODO Auto-generated constructor stub
    }

    public int getB_id() {
        return b_id;
    }

    public void ListB_id(int b_id) {
        this.b_id = b_id;
    }

    public String getB_name() {
        return b_name;
    }

    public void ListB_name(String b_name) {
        this.b_name = b_name;
    }

    public List getStud() {
        return stud;
    }

    public void ListStud(List stud) {
        this.stud = stud;
    }

}
</code></pre> 
 <p><strong>第3步:</strong> 将实体类和其他数据库配置映射到<code>persistence.xml</code>文件中。</p> 
 <p>文件:<em>persistence.xml</em> 的代码如下所示 - </p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.1"
    xmlns="http://xmlns.jcp.org/xml/ns/persistence"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"&gt;
    &lt;persistence-unit name="book_issued"&gt;
        &lt;class&gt;com.yiibai.mapping.Student&lt;/class&gt;
        &lt;class&gt;com.yiibai.mapping.Library&lt;/class&gt;
        &lt;properties&gt;
            &lt;property name="javax.persistence.jdbc.driver"
                value="com.mysql.jdbc.Driver" /&gt;
            &lt;property name="javax.persistence.jdbc.url"
                value="jdbc:mysql://localhost:3306/testdb?serverTimezone=UTC" /&gt;
            &lt;property name="javax.persistence.jdbc.user" value="root" /&gt;
            &lt;property name="javax.persistence.jdbc.password"
                value="123456" /&gt;
            &lt;property name="eclipselink.logging.level" value="SEVERE" /&gt;
            &lt;property name="eclipselink.ddl-generation"
                value="create-or-extend-tables" /&gt;
        &lt;/properties&gt;
    &lt;/persistence-unit&gt;

&lt;/persistence&gt;
</code></pre> 
 <p>在<code>com.yiibai.mapping</code>包下创建一个持久化类<code>ManyToManyExample</code>，用于将实体对象与数据保持一致。</p> 
 <p>文件:<em>ManyToManyExample.java</em> 的代码如下所示 - </p>   
 <pre><code class="lang-java">package com.yiibai.mapping;

import java.util.ArrayList;

import javax.persistence.*;
import com.yiibai.mapping.Student;
import com.yiibai.mapping.Library;

public class ManyToManyExample {

    public static void main(String[] args) {

        EntityManagerFactory emf = Persistence.createEntityManagerFactory("books_issued");
        EntityManager em = emf.createEntityManager();

        em.getTransaction().begin();

        Student st1 = new Student(1, "Maxsu", null);
        Student st2 = new Student(2, "Xiaonew", null);

        em.persist(st1);
        em.persist(st2);

        ArrayList&lt;Student&gt; al1 = new ArrayList&lt;Student&gt;();
        ArrayList&lt;Student&gt; al2 = new ArrayList&lt;Student&gt;();

        al1.add(st1);
        al1.add(st2);

        al2.add(st1);
        al2.add(st2);

        Library lib1 = new Library(101, "Data Structure", al1);
        Library lib2 = new Library(102, "DBMS", al2);

        em.persist(lib1);
        em.persist(lib2);

        em.getTransaction().commit();
        em.close();
        emf.close();

    }

}
</code></pre> 
 <h2 id="h2-u7A0Bu5E8Fu8F93u51FAu7ED3u679C"><a name="程序输出结果" class="reference-link"></a><span class="header-link octicon octicon-link"></span>程序输出结果</h2>
 <p>程序执行完成后，下面的表格在MySQL工作台下生成。</p> 
 <ul> 
  <li>Student表 - 此表包含学生详细信息。要获取数据，请在MySQL中运行<code>select * from student</code>查询。结果如下所示 - </li>
 </ul> 
 <pre><code class="lang-shell">mysql&gt; select * from student;
+------+---------+
| S_ID | S_NAME  |
+------+---------+
|    2 | Xiaonew |
|    1 | Maxsu   |
+------+---------+
2 rows in set
</code></pre> 
 <ul> 
  <li>Library表 - 这个表格代表学生和图书库之间的映射。 要获取数据，请在MySQL中运行<code>select * from library</code>查询。结果如下所示 - </li>
 </ul> 
 <pre><code class="lang-shell">mysql&gt; select * from library;
+------+----------------+
| B_ID | B_NAME         |
+------+----------------+
|  102 | DBMS           |
|  101 | Data Structure |
+------+----------------+
2 rows in set
</code></pre> 
 <ul> 
  <li><code>Library_student</code>表 - 此表包含库的详细信息。要获取数据，请在MySQL中运行<code>select * from library_student</code>查询。</li>
 </ul> 
 <pre><code class="lang-shell">mysql&gt; select * from library_student;
+--------------+-----------+
| Library_B_ID | stud_S_ID |
+--------------+-----------+
|          101 |         1 |
|          101 |         2 |
|          102 |         1 |
|          102 |         2 |
+--------------+-----------+
4 rows in set
</code></pre>
 <br>      
</div></body></html>
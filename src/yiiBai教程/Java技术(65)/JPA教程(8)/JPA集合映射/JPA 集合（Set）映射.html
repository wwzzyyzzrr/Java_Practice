<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">JPA 集合（Set）映射</h1><div style="width:100%;float:left;" class="article-content">   
 <p>集合(Set)是一个包含唯一元素的接口。 这些元素不保留任何顺序。当需要以无序方式检索唯一元素时，可以使用<code>Set</code>。</p> 
 <p>完整的项目目录结构如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201806/0806/389170655_54945.png" alt=""></p> 
 <h2 id="h2-u96C6u5408u6620u5C04u5B9Eu4F8B"><a name="集合映射实例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>集合映射实例</h2>
 <p>在这个例子中，我们将一个对象嵌入到一个实体类中，并将其定义为一个集合类型 - <code>Set</code>。</p> 
 <pre><code class="lang-java">private Set&lt;Address&gt; address=new HashSet&lt;Address&gt;();
</code></pre> 
 <p>这个例子包含以下步骤 -</p> 
 <p><strong>第1步:</strong> 在<code>com.yiibai.jpa</code>包下创建一个实体类<code>Employee.java</code>，这个类包含员工<code>id</code>，<code>name</code> 和嵌入对象(员工地址)。注解 <code><a target="_blank" href="https://github.com/ElementCollection" title="@ElementCollection" class="at-link">@ElementCollection</a></code> 表示嵌入对象。</p> 
 <p>文件:<em>Employee.java</em> 的代码如下所示 - </p> 
 <pre><code class="lang-java">package com.yiibai.jpa;

import java.util.*;

import javax.persistence.*;
import java.util.*;

import javax.persistence.*;


@Entity
public class Employee {

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private int e_id;
    private String e_name;

    @ElementCollection
    private Set&lt;Address&gt; address = new HashSet&lt;Address&gt;();

    public int getE_id() {
        return e_id;
    }

    public void setE_id(int e_id) {
        this.e_id = e_id;
    }

    public String getE_name() {
        return e_name;
    }

    public void setE_name(String e_name) {
        this.e_name = e_name;
    }

    public Set&lt;Address&gt; getAddress() {
        return address;
    }

    public void setAddress(Set&lt;Address&gt; address) {
        this.address = address;
    }

}
</code></pre> 
 <p><strong>第2步:</strong> 在<code>com.yiibai.jpa</code>包下创建一个嵌入对象<code>Address.java</code>类。 注解<code><a target="_blank" href="https://github.com/Embeddable" title="@Embeddable" class="at-link">@Embeddable</a></code>表示可嵌入对象。</p> 
 <p>文件:<em>Address.java</em> 的代码如下所示 - </p> 
 <pre><code class="lang-java">package com.yiibai.jpa;

import javax.persistence.*;

@Embeddable
public class Address {

    private int e_pincode;
    private String e_city;
    private String e_state;

    public int getE_pincode() {
        return e_pincode;
    }

    public void setE_pincode(int e_pincode) {
        this.e_pincode = e_pincode;
    }

    public String getE_city() {
        return e_city;
    }

    public void setE_city(String e_city) {
        this.e_city = e_city;
    }

    public String getE_state() {
        return e_state;
    }

    public void setE_state(String e_state) {
        this.e_state = e_state;
    }

}
</code></pre> 
 <p><strong>第3步:</strong> 将实体类和其他数据库配置映射到<code>persistence.xml</code>文件中。</p> 
 <p>文件:<em>persistence.xml</em> 的代码如下所示 - </p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.1"
    xmlns="http://xmlns.jcp.org/xml/ns/persistence"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"&gt;
    &lt;persistence-unit name="Collection_Type"&gt;
        &lt;class&gt;com.yiibai.jpa.Employee&lt;/class&gt;
        &lt;class&gt;com.yiibai.jpa.Address&lt;/class&gt;
        &lt;properties&gt;
            &lt;property name="javax.persistence.jdbc.driver"
                value="com.mysql.jdbc.Driver" /&gt;
            &lt;property name="javax.persistence.jdbc.url"
                value="jdbc:mysql://localhost:3306/testdb?serverTimezone=UTC" /&gt;
            &lt;property name="javax.persistence.jdbc.user" value="root" /&gt;
            &lt;property name="javax.persistence.jdbc.password"
                value="123456" /&gt;
            &lt;property name="eclipselink.logging.level" value="SEVERE" /&gt;
            &lt;property name="eclipselink.ddl-generation"
                value="create-or-extend-tables" /&gt;
        &lt;/properties&gt;
    &lt;/persistence-unit&gt;

&lt;/persistence&gt;
</code></pre> 
 <p>在<code>com.yiibai.collection</code>包下创建一个持久化类<code>SetMapping.java</code>，以便将实体对象与数据保持一致。</p> 
 <p>文件:<em>SetMapping.java</em> 的代码如下所示 - </p>   
 <pre><code class="lang-java">package com.yiibai.collection;

import javax.persistence.*;

import com.yiibai.jpa.*;

public class SetMapping {

    public static void main(String[] args) {

        EntityManagerFactory emf = Persistence.createEntityManagerFactory("Collection_Type");
        EntityManager em = emf.createEntityManager();

        em.getTransaction().begin();

        Address a1 = new Address();
        a1.setE_pincode(501000);
        a1.setE_city("Guangzhou");
        a1.setE_state("GuangDong");

        Address a2 = new Address();
        a2.setE_pincode(571100);
        a2.setE_city("Haikou");
        a2.setE_state("Hainan");

        Address a3 = new Address();
        a3.setE_pincode(533300);
        a3.setE_city("Hangzhou");
        a3.setE_state("Zhejiang");

        Address a4 = new Address();
        a4.setE_pincode(780000);
        a4.setE_city("Nanjing");
        a4.setE_state("Jiangsu");

        Employee e1 = new Employee();
        e1.setE_id(1000);
        e1.setE_name("Maxsu");

        Employee e2 = new Employee();
        e2.setE_id(1002);
        e2.setE_name("Marry");

        Employee e3 = new Employee();
        e3.setE_id(1003);
        e3.setE_name("William");

        Employee e4 = new Employee();
        e4.setE_id(1004);
        e4.setE_name("Curry");

        e1.getAddress().add(a1);
        e2.getAddress().add(a2);
        e3.getAddress().add(a3);
        e4.getAddress().add(a4);

        em.persist(e1);
        em.persist(e2);
        em.persist(e3);
        em.persist(e4);

        em.getTransaction().commit();

        em.close();
        emf.close();

    }

}
</code></pre> 
 <h2 id="h2-u7A0Bu5E8Fu8F93u51FAu7ED3u679C"><a name="程序输出结果" class="reference-link"></a><span class="header-link octicon octicon-link"></span>程序输出结果</h2>
 <p>程序执行完成后，下面的表格在MySQL工作台下生成。</p> 
 <ul> 
  <li>Employee表 - 此表包含员工详细信息。要获取数据，请在MySQL中运行<code>select * from employee</code>查询。结果如下所示 - <pre><code class="lang-shell">mysql&gt; select * from employee;
+------+---------+
| E_ID | E_NAME  |
+------+---------+
| 1003 | William |
| 1004 | Curry   |
| 1000 | Maxsu   |
| 1002 | Marry   |
+------+---------+
4 rows in set
</code></pre> </li>
  <li>Employee_address表 - 此表表示员工和地址表之间的映射。 要获取数据，请在MySQL中运行<code>select * from employee_address</code>查询。结果如下所示 - <pre><code class="lang-shell">mysql&gt; select * from employee_address;
+-----------+-----------+-----------+---------------+
| E_CITY    | E_PINCODE | E_STATE   | Employee_E_ID |
+-----------+-----------+-----------+---------------+
| Hangzhou  |    533300 | Zhejiang  |          1003 |
| Nanjing   |    780000 | Jiangsu   |          1004 |
| Guangzhou |    501000 | GuangDong |          1000 |
| Haikou    |    571100 | Hainan    |          1002 |
+-----------+-----------+-----------+---------------+
4 rows in set
</code></pre> </li>
 </ul>
 <br>      
</div></body></html>
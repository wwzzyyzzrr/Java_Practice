<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">使用Gradle构建多模块项目</h1><div style="width:100%;float:left;" class="article-content">   
 <h2 id="h2-1-"><a name="1- 介绍" class="reference-link"></a><span class="header-link octicon octicon-link"></span>1- 介绍</h2>
 <p>本教程文章基于：</p> 
 <ul> 
  <li>Eclipse Java EE IDE for Web Developers. Version: Mars.1 Release (4.5.1)</li>
 </ul> 
 <p>如果您是初学者Gradle的。那么建议先看看初学者Gradle（Gradle Hello world）的文章：<br><a target="_blank" href="http://www.yiibai.com/gradle/gradle-tutorial-for-beginners.html">http://www.yiibai.com/gradle/gradle-tutorial-for-beginners.html</a></p> 
 <h2 id="h2-2-"><a name="2- 示例模型" class="reference-link"></a><span class="header-link octicon octicon-link"></span>2- 示例模型</h2>
 <p>这是本文章中的模型示例。如下图所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/830221121_21734.png" alt=""></p> 
 <p>本文章教程的目的是：</p> 
 <ul> 
  <li>如何在Gradle中使用其他模块在一个模块中；</li>
  <li>使用Gradle打包多个模块（输出为：jar，war）；</li>
  <li>在Gradle Tomcat插件上运行Web应用程序；</li>
 </ul> 
 <p><strong>MathWebApp</strong>: 这是一个WebApp项目；<br><strong>MathLibrary</strong>: 这是一个库项目，包含<code>MathWebApp</code>使用的实用程序类。</p> 
 <p><strong>GradleMain</strong>：将打包上面的两个项目，它是一个主要模块。<code>GradleMain</code> 将：</p> 
 <ul> 
  <li>将 <code>MathLibary</code> 打包装到<code>jar</code>文件中；</li>
  <li>将 <code>MathWebApp</code> 打包装到<code>war</code>文件中；</li>
 </ul> 
 <h2 id="h2-3-"><a name="3-创建项目数学库" class="reference-link"></a><span class="header-link octicon octicon-link"></span>3-创建项目数学库</h2>
 <p>创建一个 <code>Gradle</code> 项目，在 <strong>Eclipse</strong> 菜单中，File/New/Other… 找到 <code>Gradle</code> 如下图所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/197141133_78005.png" alt=""></p> 
 <p>点击下一步（<strong>Next&gt;</strong>）并输入项目名称: <code>MathLibrary</code>，如下图所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/373141135_61146.png" alt=""></p> 
 <p>点击下一步（<strong>Next&gt;</strong>）并选择 <code>Gradle</code> 的安装目录，如下图所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/540141137_65742.png" alt=""></p> 
 <p>点击下一步（<strong>Next&gt;</strong>），等待 Eclipse 创建项目，最后点击完成（<strong>Finish</strong>）就好。如下图所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/535141138_68834.png" alt=""></p> 
 <p>项目创建完成后，其结构如下图中所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/366141140_18358.png" alt=""></p> 
 <p>接下来，我们创建一个 <code>MathUtils</code>类，如下所示:</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/603141142_31234.png" alt=""></p> 
 <p><code>MathUtils</code>类的代码实现如下所示 - </p> 
 <pre><code class="lang-java">package com.yiibai;

public class MathUtils {

      public static int sum(int a, int b) {
          return a + b;
      }

    }
</code></pre> 
 <h2 id="h2-4-mathwebapp"><a name="4- 创建另一个项目：MathWebApp" class="reference-link"></a><span class="header-link octicon octicon-link"></span>4- 创建另一个项目：MathWebApp</h2>
 <p>同样地，创建另外一个叫作 <code>MathWebApp</code> 的<code>Gradle</code>项目，参考上面 <code>MathLibrary</code> 项目创建的步骤。</p> 
 <p><img src="http://yiibai.com/en/11243/cache/images/i/5044207.png" alt=""></p> 
 <p>打开 <code>build.gradle</code> 文件，并添加一些依懒库，如下图中所示 -</p> 
 <pre><code class="lang-groovy">apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'war'  

apply plugin: 'com.bmuschko.tomcat'

repositories {
   jcenter()
}

dependencies {    

   testCompile 'junit:junit:4.12'


   providedCompile "javax.servlet:javax.servlet-api:3.1.0"      

   compile project(':MathLibrary')
}


dependencies {
   def tomcatVersion = '7.0.59'

   tomcat "org.apache.tomcat.embed:tomcat-embed-core:${tomcatVersion}",
          "org.apache.tomcat.embed:tomcat-embed-logging-juli:${tomcatVersion}",
          "org.apache.tomcat.embed:tomcat-embed-jasper:${tomcatVersion}"
}


buildscript {

   repositories {
       jcenter()
   }

   dependencies {
       classpath 'com.bmuschko:gradle-tomcat-plugin:2.2.2'
   }
}
</code></pre> 
 <p>完成后，执行 <code>Gradle Project Refresh</code>- </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/100141149_67541.png" alt=""></p> 
 <p>创建<code>index.jsp</code>文件，并在这个<code>JSP</code>文件中使用在项目<code>Math Library</code>中创建的<code>MathUtils</code>类。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/491141154_91250.png" alt=""></p> 
 <p><code>index.jsp</code> 文件的代码如下所示 - </p> 
 <pre><code class="lang-html">&lt;html&gt;
&lt;body&gt;
&lt;h2&gt;Hello World!&lt;/h2&gt;

&lt;%

int a = 200;
int b = 300;

int c = com.yiibai.MathUtils.sum(a,b);

out.println("&lt;h2&gt;"+ c+"&lt;/h2&gt;");

%&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <h2 id="h2-5-gradlemain-"><a name="5- 创建GradleMain项目" class="reference-link"></a><span class="header-link octicon octicon-link"></span>5- 创建GradleMain项目</h2>
 <p>同样地，我们再来创建一个Gradle项目：<code>GradleMain</code> 。完成其项目结构如下图所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/302141158_46086.png" alt=""></p> 
 <p>打开 <code>GradleMain/settings.gradle</code> 修改其内容如下 - </p> 
 <pre><code class="lang-groovy">rootProject.name = 'GradleMain'


include   ':MathLibrary', ':MathWebApp'
project(':MathLibrary').projectDir = new File(settingsDir, '../MathLibrary')
project(':MathWebApp').projectDir = new File(settingsDir, '../MathWebApp')
</code></pre> 
 <p>并声明<code>GradleMain</code>依赖于<code>MathLibrary</code>＆<code>MathWebApp</code>这两个项目。编辑 <code>GradleMain/build.gradle</code> 代码内容如下- </p>   
 <pre><code class="lang-groovy">apply plugin: 'java'
apply plugin: 'eclipse'

repositories {
    jcenter()
}

dependencies {   

    testCompile 'junit:junit:4.12'     
}

dependencies {
    compile project(':MathLibrary')
    compile project(':MathWebApp')
}
</code></pre> 
 <p>完成后，执行 <code>Gradle Project Refresh</code>- </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/100141149_67541.png" alt=""></p> 
 <h2 id="h2-6-"><a name="6- 构建项目" class="reference-link"></a><span class="header-link octicon octicon-link"></span>6- 构建项目</h2>
 <p>切换到标签“<code>Gradle Task</code>”，然后选择“<code>build/Run Gradle Tasks</code>”。执行结果如下图所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/638151108_27359.png" alt=""></p> 
 <p>Gradle将按项目的顺序构建完成，结果如下：</p> 
 <pre><code class="lang-groovy">Working Directory: D:/worksp/GradleMain
Gradle User Home: D:/worksp/gradle/Downloads
Gradle Distribution: Local installation at D:/worksp/yiibai.com/gradle-3.1
Gradle Version: 3.1
Java Home: D:/Program Files/Java/jdk1.8.0_65
JVM Arguments: None
Program Arguments: None
Gradle Tasks: build

:MathLibrary:compileJava
:MathLibrary:processResources UP-TO-DATE
:MathLibrary:classes
:MathLibrary:jar
:MathWebApp:compileJava
:MathWebApp:processResources UP-TO-DATE
:MathWebApp:classes
:MathWebApp:jar
:compileJava
:processResources UP-TO-DATE
:classes
:jar
:assemble
:compileTestJava
:processTestResources UP-TO-DATE
:testClasses
:test
:check
:build
:MathLibrary:assemble
:MathLibrary:compileTestJava
:MathLibrary:processTestResources UP-TO-DATE
:MathLibrary:testClasses
:MathLibrary:test
:MathLibrary:check
:MathLibrary:build
:MathWebApp:war
:MathWebApp:assemble
:MathWebApp:compileTestJava
:MathWebApp:processTestResources UP-TO-DATE
:MathWebApp:testClasses
:MathWebApp:test
:MathWebApp:check
:MathWebApp:build

BUILD SUCCESSFUL

Total time: 3.619 secs
</code></pre> 
 <h2 id="h2-7-mathwebapp"><a name="7- 运行MathWebApp" class="reference-link"></a><span class="header-link octicon octicon-link"></span>7- 运行MathWebApp</h2>
 <p>在 MathWebApp 项目上右键点击，在弹出的菜单中选择 “<code>Run As</code>“ -&gt; “<code>Run Configurations ...</code>“，在弹出的对话框中，在 “<code>Gradle Project</code>” 右键点击选择 “<code>New</code>”，如下图所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/431151118_76139.png" alt=""></p> 
 <p>然后写入一些必要的参数，如下图中红圈的输入部分 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/115151122_94461.png" alt=""></p> 
 <p>执行后，在终端上输出结果如下- </p> 
 <pre><code class="lang-groovy">Working Directory: D:/worksp/GradleMain
Gradle User Home: D:/worksp/gradle/Downloads
Gradle Distribution: Local installation at D:/worksp/yiibai.com/gradle-3.1
Gradle Version: 3.1
Java Home: D:/Program Files/Java/jdk1.8.0_65
JVM Arguments: None
Program Arguments: None
Gradle Tasks: tomcatRun

:MathLibrary:compileJava UP-TO-DATE
:MathLibrary:processResources UP-TO-DATE
:MathLibrary:classes UP-TO-DATE
:MathLibrary:jar UP-TO-DATE
:MathWebApp:compileJava UP-TO-DATE
:MathWebApp:processResources UP-TO-DATE
:MathWebApp:classes UP-TO-DATE
:MathWebApp:tomcatRun
Started Tomcat Server
The Server is running at http://localhost:8080/MathWebApp
</code></pre> 
 <p>现在，我们打开浏览器访问 - <a target="_blank" href="http://localhost:8080/MathWebApp/">http://localhost:8080/MathWebApp/</a> 得到以下结果 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201611/01/170151125_94892.png" alt=""></p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring AOP基于XML的切入点</h1><div style="width:100%;float:left;" class="article-content">   
 <p>切入点(JoinPoint)代表示您的应用程序中可以插入AOP方面的某个点。 您也可以说，这是应用程序中使用<strong>Spring AOP</strong>框架执行操作的实际位置。 请考虑以下示例：</p> 
 <ul> 
  <li>包中包含的所有方法类。</li>
  <li>一个类的特定方法。</li>
 </ul> 
 <h2 id="h2-u5207u5165u70B9"><a name="切入点" class="reference-link"></a><span class="header-link octicon octicon-link"></span>切入点</h2>
 <p>切入点(<code>PointCut</code>)是一组一个或多个连接点，其中它用来执行通知。可以使用表达式或模式指定切入点，我们将在下面AOP示例中看到。 在Spring，切入点有助于使用特定的连接点来应用通知。 请考虑以下示例：</p> 
 <ul> 
  <li><code>expression="execution(* com.yiibai.*.*(..))"</code></li>
  <li><code>expression="execution(* com.yiibai.Student.getName(..))"</code></li>
 </ul> 
 <h2 id="h2-u8BEDu6CD5"><a name="语法" class="reference-link"></a><span class="header-link octicon octicon-link"></span>语法</h2>
 <pre><code>   &lt;aop:config&gt;
   &lt;aop:aspect id="log" ref="adviceClass"&gt;
      &lt;aop:pointcut id="pointcut-id" expression="execution( expression )"/&gt;    
   &lt;/aop:aspect&gt;
   &lt;/aop:config&gt;
</code></pre>
 <p>在上面语法中 -</p> 
 <ul> 
  <li><code>adviceClass</code> - 关联(ref)的类包含通知方法。</li>
  <li><code>pointcut-id</code> - 切入点的<code>ID</code>。</li>
  <li><code>execution( expression)</code> - 涵盖应用通知的方法的表达式。</li>
 </ul> 
 <p>要了解上面提到的连接点(<code>JoinPoint</code>)和切入点(<code>PointCut</code>)相关的概念，我们来写一个例子来实现一些切入点。为了方便编写这个例子，让我们使用<strong>Eclipse IDE</strong>，并按照以下步骤创建一个Spring应用程序：</p> 
 <ol> 
  <li>更新在<a target="_blank" href="http://www.yiibai.com/springaop/springaop_application.html" title="Spring AOP应用实例">Spring AOP应用实例</a>中创建过的<code>Student</code>项目。</li>
  <li>更新bean配置并运行应用程序，如下所述。</li>
 </ol> 
 <p>这是<code>Logging.java</code>文件的内容。这实际上是一个<code>Aspect</code>模块的样本，它定义了在各个点被调用的方法。</p> 
 <pre><code class="lang-java">package com.yiibai;

public class Logging {

   /** 
    * This is the method which I would like to execute
    * before a selected method execution.
    */
   public void beforeAdvice(){
      System.out.println("[beforeAdvice]Going to setup student profile.");
   }   
}
</code></pre> 
 <p>以下是 <em>Student.java</em> 文件的内容：</p> 
 <pre><code class="lang-java">package com.yiibai;

public class Student {
   private Integer age;
   private String name;

   public void setAge(Integer age) {
      this.age = age;
   }
   public Integer getAge() {
      System.out.println("Age : " + age );
      return age;
   }

   public void setName(String name) {
      this.name = name;
   }
   public String getName() {
      System.out.println("Name : " + name );
      return name;
   }

   public void printThrowException(){
       System.out.println("Exception raised");
       throw new IllegalArgumentException();
   }
}
</code></pre> 
 <p>以下是 <em>MainApp.java</em> 文件的内容：</p> 
 <pre><code class="lang-java">package com.yiibai;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class MainApp {
   public static void main(String[] args) {
      ApplicationContext context = 
             new ClassPathXmlApplicationContext("Beans.xml");

      Student student = (Student) context.getBean("student");

      student.getName();
      student.getAge();     
   }
}
</code></pre> 
 <p>以下是 <em>Beans.xml</em> 文件的内容：</p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:aop="http://www.springframework.org/schema/aop"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd 
    http://www.springframework.org/schema/aop 
    http://www.springframework.org/schema/aop/spring-aop-3.0.xsd "&gt;

   &lt;aop:config&gt;
      &lt;aop:aspect id="log" ref="logging"&gt;
         &lt;aop:pointcut id="selectAll" 
         expression="execution(* com.yiibai.*.*(..))"/&gt;
         &lt;aop:before pointcut-ref="selectAll" method="beforeAdvice"/&gt;         
      &lt;/aop:aspect&gt;
   &lt;/aop:config&gt;

   &lt;!-- Definition for student bean --&gt;
   &lt;bean id="student" class="com.yiibai.Student"&gt;
      &lt;property name="name"  value="Maxsu" /&gt;
      &lt;property name="age"  value="24"/&gt;      
   &lt;/bean&gt;

   &lt;!-- Definition for logging aspect --&gt;
   &lt;bean id="logging" class="com.yiibai.Logging"/&gt; 

&lt;/beans&gt;
</code></pre> 
 <p>完成创建源和<code>bean</code>配置文件后，让我们运行应用程序。 如果您的应用程序一切正常，这将打印以下消息：</p>   
 <pre><code class="lang-shell">四月 12, 2017 5:56:10 上午 org.springframework.context.support.ClassPathXmlApplicationContext prepareRefresh
信息: Refreshing org.springframework.context.support.ClassPathXmlApplicationContext@300ffa5d: startup date [Wed Apr 12 05:56:10 CST 2017]; root of context hierarchy
四月 12, 2017 5:56:10 上午 org.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions
信息: Loading XML bean definitions from class path resource [Beans.xml]
[beforeAdvice]Going to setup student profile.
Name : Maxsu
[beforeAdvice]Going to setup student profile.
Age : 23
[beforeAdvice]Going to setup student profile.
Exception raised
</code></pre> 
 <p>让我解释一下，上面定义的<code>&lt;aop：pointcut&gt;</code>可以选择<code>com.yiibai</code>包中定义的所有方法。假设要在特定方法之前或之后执行您的通知，可以通过用切入点定义中的星(*)替换实际的类和方法名称来定义切入点来缩小执行范围。 下面是一个修改后的<code>XML</code>配置文件来显示这个概念：</p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:aop="http://www.springframework.org/schema/aop"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd 
    http://www.springframework.org/schema/aop 
    http://www.springframework.org/schema/aop/spring-aop-3.0.xsd "&gt;

   &lt;aop:config&gt;
   &lt;aop:aspect id="log" ref="logging"&gt;
      &lt;aop:pointcut id="selectAll" 
      expression="execution(* com.yiibai.Student.getName(..))"/&gt;
      &lt;aop:before pointcut-ref="selectAll" method="beforeAdvice"/&gt;
   &lt;/aop:aspect&gt;
   &lt;/aop:config&gt;

   &lt;!-- Definition for student bean --&gt;
   &lt;bean id="student" class="com.yiibai.Student"&gt;
      &lt;property name="name"  value="Maxsu" /&gt;
      &lt;property name="age"  value="24"/&gt;      
   &lt;/bean&gt;

   &lt;!-- Definition for logging aspect --&gt;
   &lt;bean id="logging" class="com.yiibai.Logging"/&gt; 

&lt;/beans&gt;
</code></pre> 
 <h2 id="h2-u8FD0u884Cu9879u76EE"><a name="运行项目" class="reference-link"></a><span class="header-link octicon octicon-link"></span>运行项目</h2>
 <p>完成创建源代码和配置文件后，运行应用程序。右键单击应用程序中的<code>MainApp.java</code>，并使用运行方式作为<strong>Java应用程序命令</strong>。 如果您的应用程序一切正常，这将打印以下消息：</p> 
 <pre><code class="lang-shell">[beforeAdvice]Going to setup student profile.
Name : Maxsu
Age : 24
</code></pre>
 <br>      
</div></body></html>
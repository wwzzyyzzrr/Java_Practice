<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring AOP基于XML的应用程序</h1><div style="width:100%;float:left;" class="article-content">   
 <p>从这篇文章开始，我们使用Spring-AOP框架编写实际的AOP应用程序。在开始使用Spring-WS框架编写第一个示例之前，必须确保已经按照Spring AOP安装配置教程中的说明正确设置了Spring-AOP开发运行环境。</p> 
 <p>现在我们继续来编写一个简单的基于控制台的Spring AOP应用程序，它用于演示AOP的概念。</p> 
 <p>先来看看要创建的项目的目录结构 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201704/1204/865180400_13141.png" alt=""></p> 
 <h2 id="h2-u521Bu5EFAu9879u76EE"><a name="创建项目" class="reference-link"></a><span class="header-link octicon octicon-link"></span>创建项目</h2>
 <p>打开命令控制台，进入<code>D:\MVN</code>目录并执行下面的<code>mvn</code>命令。</p> 
 <pre><code class="lang-shell">D:\MVN&gt; mvn archetype:generate -DgroupId=com.yiibai -DartifactId=Student -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false
</code></pre> 
 <p>上面命令执行后，Maven将开始处理，并将创建完整的java应用程序项目结构。您可能会看到一堆下载的东西，但是不要惊慌，耐心等待下载和构建完成，如下所示 -</p> 
 <pre><code class="lang-shell">Downloaded: http://repo.maven.apache.org/maven2/org/apache/maven/archetypes/maven-archetype-quickstart/1.0/maven-archetype-quickstart-1.0.jar (5 KB at 7.7 KB/sec)
[INFO] ----------------------------------------------------------------------------
[INFO] Using following parameters for creating project from Old (1.x) Archetype: maven-archetype-quickstart:1.0
[INFO] ----------------------------------------------------------------------------
[INFO] Parameter: basedir, Value: D:\mvn
[INFO] Parameter: package, Value: com.yiibai
[INFO] Parameter: groupId, Value: com.yiibai
[INFO] Parameter: artifactId, Value: Student
[INFO] Parameter: packageName, Value: com.yiibai
[INFO] Parameter: version, Value: 1.0-SNAPSHOT
[INFO] project created from Old (1.x) Archetype in dir: D:\mvn\Student
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 09:20 min
[INFO] Finished at: 2017-04-12T03:05:53+08:00
[INFO] Final Memory: 14M/99M
[INFO] ------------------------------------------------------------------------

D:\mvn&gt;
</code></pre> 
 <p>现在打开<code>C：\MVN</code>目录。您将看到一个名为<code>student</code>的java应用程序项目(在<code>artifactId</code>中指定)。更新<code>POM.xml</code>以包含<strong>Spring-AOP</strong>依赖关系。添加<code>MainApp.java</code>，<code>Student.java</code>和<code>Logging.java</code>这几个代码文件。</p> 
 <p>文件 - <em>POM.xml</em> 的内容如下 -</p> 
 <pre><code class="lang-xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" 
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
   http://maven.apache.org/maven-v4_0_0.xsd"&gt;
   &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
   &lt;groupId&gt;com.yiibai&lt;/groupId&gt;
   &lt;artifactId&gt;Student&lt;/artifactId&gt;
   &lt;packaging&gt;jar&lt;/packaging&gt;
   &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
   &lt;name&gt;Student&lt;/name&gt;
   &lt;url&gt;http://maven.apache.org&lt;/url&gt;
   &lt;dependencies&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;junit&lt;/groupId&gt;
         &lt;artifactId&gt;junit&lt;/artifactId&gt;
         &lt;version&gt;3.8.1&lt;/version&gt;
         &lt;scope&gt;test&lt;/scope&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;org.springframework&lt;/groupId&gt;
         &lt;artifactId&gt;spring-aop&lt;/artifactId&gt;
         &lt;version&gt;4.1.0.RELEASE&lt;/version&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;org.springframework&lt;/groupId&gt;
         &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
         &lt;version&gt;4.1.4.RELEASE&lt;/version&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;org.aspectj&lt;/groupId&gt;
         &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;
         &lt;version&gt;1.6.8&lt;/version&gt;
      &lt;/dependency&gt;
   &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre> 
 <p>文件 - <em>Logging.java</em> 的内容如下 -</p> 
 <pre><code class="lang-java">package com.yiibai;

public class Logging {

   /** 
    * This is the method which I would like to execute
    * before a selected method execution.
    */
   public void beforeAdvice(){
      System.out.println("Going to setup student profile.");
   }

   /** 
    * This is the method which I would like to execute
    * after a selected method execution.
    */
   public void afterAdvice(){
      System.out.println("Student profile has been setup.");
   }

   /** 
    * This is the method which I would like to execute
    * when any method returns.
    */
   public void afterReturningAdvice(Object retVal){
      System.out.println("Returning:" + retVal.toString() );
   }

   /**
    * This is the method which I would like to execute
    * if there is an exception raised.
    */
   public void AfterThrowingAdvice(IllegalArgumentException ex){
      System.out.println("There has been an exception: " + ex.toString());   
   }

}
</code></pre> 
 <p>文件 - <em>Student.java</em> 的内容如下 -</p> 
 <pre><code class="lang-java">package com.yiibai;

public class Student {
   private Integer age;
   private String name;

   public void setAge(Integer age) {
      this.age = age;
   }
   public Integer getAge() {
      System.out.println("Age : " + age );
      return age;
   }

   public void setName(String name) {
      this.name = name;
   }
   public String getName() {
      System.out.println("Name : " + name );
      return name;
   }

   public void printThrowException(){
       System.out.println("Exception raised");
       throw new IllegalArgumentException();
   }
}
</code></pre> 
 <p>文件 - <em>MainApp.java</em> 的内容如下 -</p> 
 <pre><code class="lang-java">package com.yiibai;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class MainApp {
   public static void main(String[] args) {
      ApplicationContext context = 
             new ClassPathXmlApplicationContext("Beans.xml");

      Student student = (Student) context.getBean("student");

      student.getName();
      student.getAge();

      student.printThrowException();
   }
}
</code></pre> 
 <p>在<code>src/main/resources</code>文件夹下添加配置文件<code>Beans.xml</code>：</p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:aop="http://www.springframework.org/schema/aop"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd 
    http://www.springframework.org/schema/aop 
    http://www.springframework.org/schema/aop/spring-aop-3.0.xsd "&gt;

   &lt;aop:config&gt;
      &lt;aop:aspect id="log" ref="logging"&gt;
         &lt;aop:pointcut id="selectAll" 
         expression="execution(* com.yiibai.*.*(..))"/&gt;
         &lt;aop:before pointcut-ref="selectAll" method="beforeAdvice"/&gt;
         &lt;aop:after pointcut-ref="selectAll" method="afterAdvice"/&gt;
         &lt;aop:after-returning pointcut-ref="selectAll" 
                              returning="retVal"
                              method="afterReturningAdvice"/&gt;
         &lt;aop:after-throwing pointcut-ref="selectAll" 
                             throwing="ex"
                             method="AfterThrowingAdvice"/&gt;
      &lt;/aop:aspect&gt;
   &lt;/aop:config&gt;

   &lt;!-- Definition for student bean --&gt;
   &lt;bean id="student" class="com.yiibai.Student"&gt;
      &lt;property name="name"  value="Maxsu" /&gt;
      &lt;property name="age"  value="21"/&gt;      
   &lt;/bean&gt;

   &lt;!-- Definition for logging aspect --&gt;
   &lt;bean id="logging" class="com.yiibai.Logging"/&gt; 

&lt;/beans&gt;
</code></pre> 
 <p>打开命令控制台，进入<code>D:\MVN</code>目录并执行下面的mvn命令。</p>   
 <pre><code class="lang-shell">D:\MVN&gt;Student&gt; mvn package
</code></pre> 
 <p>Maven将开始处理并下载所需的库。</p> 
 <pre><code class="lang-shell">Downloading: http://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.1/commons-lang-2.1.jar
Downloading: http://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0/plexus-utils-3.0.jar
Downloaded: http://repo.maven.apache.org/maven2/org/apache/maven/maven-archiver/2.5/maven-archiver-2.5.jar (22 KB at 25.9 KB/sec)
Downloaded: http://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-io/2.0.2/plexus-io-2.0.2.jar (57 KB at 54.3 KB/sec)
Downloaded: http://repo.maven.apache.org/maven2/commons-lang/commons-lang/2.1/commons-lang-2.1.jar (203 KB at 188.7 KB/sec)
Downloaded: http://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-utils/3.0/plexus-utils-3.0.jar (221 KB at 145.8 KB/sec)
Downloaded: http://repo.maven.apache.org/maven2/org/codehaus/plexus/plexus-archiver/2.1/plexus-archiver-2.1.jar (181 KB at 100.8 KB/sec)
[INFO] Building jar: D:\mvn\Student\target\Student-1.0-SNAPSHOT.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 43.164 s
[INFO] Finished at: 2017-04-12T05:11:44+08:00
[INFO] Final Memory: 19M/158M
[INFO] ------------------------------------------------------------------------

D:\mvn\Student&gt;
</code></pre> 
 <h2 id="h2--eclipse-"><a name="在Eclipse中导入项目" class="reference-link"></a><span class="header-link octicon octicon-link"></span>在Eclipse中导入项目</h2>
 <p>打开Eclipse IDE，导入项目目录。</p> 
 <p>选择<strong>文件</strong>&gt;<strong>导入</strong>&gt;<strong>选项</strong>。<br>选择<strong>Maven项目</strong>选项。点击<strong>下一步</strong>按钮。<br>选择<strong>项目位置</strong>，其中使用Maven创建<code>Student</code>项目。<br>单击完成按钮。</p> 
 <h2 id="h2-u8FD0u884Cu9879u76EE"><a name="运行项目" class="reference-link"></a><span class="header-link octicon octicon-link"></span>运行项目</h2>
 <p>完成创建源代码和配置文件后，运行应用程序。 右键单击应用程序中的<code>MainApp.java</code>，并使用运行方式作为<strong>Java应用程序命令</strong>。 如果您的应用程序没有问题，将打印以下消息：</p> 
 <pre><code class="lang-shell">四月 12, 2017 5:19:04 上午 org.springframework.context.support.ClassPathXmlApplicationContext prepareRefresh
信息: Refreshing org.springframework.context.support.ClassPathXmlApplicationContext@300ffa5d: startup date [Wed Apr 12 05:19:04 CST 2017]; root of context hierarchy
四月 12, 2017 5:19:04 上午 org.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions
信息: Loading XML bean definitions from class path resource [Beans.xml]
Going to setup student profile.
Exception in thread "main" Name : Maxsu
Student profile has been setup.
Returning:Maxsu
Going to setup student profile.
Age : 21
Student profile has been setup.
Returning:21
Going to setup student profile.
Exception raised
Student profile has been setup.
There has been an exception: java.lang.IllegalArgumentException
java.lang.IllegalArgumentException
    at com.yiibai.Student.printThrowException(Student.java:25)
    at com.yiibai.Student$$FastClassBySpringCGLIB$$e9280b4b.invoke(&lt;generated&gt;)
    at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204)
    at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:717)
    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
    at org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(MethodBeforeAdviceInterceptor.java:52)
    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
    at org.springframework.aop.aspectj.AspectJAfterAdvice.invoke(AspectJAfterAdvice.java:43)
    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
    at org.springframework.aop.framework.adapter.AfterReturningAdviceInterceptor.invoke(AfterReturningAdviceInterceptor.java:52)
    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
    at org.springframework.aop.aspectj.AspectJAfterThrowingAdvice.invoke(AspectJAfterThrowingAdvice.java:58)
    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
    at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
    at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:653)
    at com.yiibai.Student$$EnhancerBySpringCGLIB$$92ccc3c2.printThrowException(&lt;generated&gt;)
    at com.yiibai.MainApp.main(MainApp.java:16)
</code></pre>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring AOP基于注解的AfterThrowing</h1><div style="width:100%;float:left;" class="article-content">   
 <p><code><a target="_blank" href="https://github.com/AfterThrowing" title="@AfterThrowing" class="at-link">@AfterThrowing</a></code>是一种通知类型，可以确保在方法抛出异常时运行一个通知。 以下是<code><a target="_blank" href="https://github.com/AfterThrowing" title="@AfterThrowing" class="at-link">@AfterThrowing</a></code>通知的语法：</p> 
 <p><strong>语法</strong></p> 
 <pre><code class="lang-java">@AfterThrowing(pointcut="execution(* com.yiibai.Student.*(..))", throwing= "error")
public void afterThrowingAdvice(JoinPoint jp, Throwable error){
   System.out.println("Method Signature: "  + jp.getSignature());  
   System.out.println("Exception: "+error);  
}
</code></pre> 
 <p>在上面的语法示例中 -</p> 
 <ul> 
  <li><code><a target="_blank" href="https://github.com/AfterReturning" title="@AfterReturning" class="at-link">@AfterReturning</a></code> - 如果方法返回成功，则将函数标记为在切入点覆盖的方法之前执行的通知。</li>
  <li><code><a target="_blank" href="https://github.com/Pointcut" title="@Pointcut" class="at-link">@Pointcut</a></code> - 将函数标记为切入点</li>
  <li><code><a target="_blank" href="https://github.com/After" title="@After" class="at-link">@After</a></code> - 将函数标记为在切入点覆盖的方法之后执行的通知。</li>
  <li><code>execution( expression )</code> - 涵盖应用通知的方法的表达式。</li>
  <li><code>throwing</code> - 返回的异常名称。</li>
 </ul> 
 <p>要了解上面提到的<code><a target="_blank" href="https://github.com/AfterThrowing" title="@AfterThrowing" class="at-link">@AfterThrowing</a></code>通知相关的概念，我们写一个Spring AOP基于注解的应用例子，它将使用基于注解配置实现通知。打开并使用<strong>Eclipse IDE</strong>，并按照以下步骤创建一个Spring应用程序：</p> 
 <ol> 
  <li>更新在<a target="_blank" href="http://www.yiibai.com/spring_aop/springaop_annotation_application.html" title="Spring AOP应用实例">Spring AOP应用实例</a>中创建过的<code>Student</code>项目。</li>
  <li>更新<code>bean</code>配置并运行应用程序，如下所述。</li>
 </ol> 
 <p>整个项目的目录结构如下所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201704/1304/520150402_89549.png" alt=""></p> 
 <p>下面是<code>Logging.java</code>文件的内容。 这实际上是一个<code>Aspect</code>模块的样本，它定义了在各个点被调用的方法。</p> 
 <pre><code class="lang-java">package com.yiibai;

import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.JoinPoint;  
import org.aspectj.lang.annotation.AfterThrowing;  

@Aspect
public class Logging {

   /** 
    * This is the method which I would like to execute
    * after a selected method execution throws exception.
    */
   @AfterThrowing(pointcut="execution(* com.yiibai.Student.*(..))", throwing= "error")
   public void afterThrowingAdvice(JoinPoint jp, Throwable error){
      System.out.println("[afterThrowingAdvice] Method Signature: "  + jp.getSignature());  
      System.out.println("[afterThrowingAdvice] Exception: "+error);  
   }
}
</code></pre> 
 <p>以下是<em>Student.java</em>文件的内容：</p> 
 <pre><code class="lang-java">package com.yiibai;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class MainApp {
   public static void main(String[] args) {
      ApplicationContext context = 
             new ClassPathXmlApplicationContext("Beans.xml");

      Student student = (Student) context.getBean("student");

      student.printThrowException();     
   }
}
</code></pre> 
 <p>以下是<code>MainApp.java</code>文件的内容：</p> 
 <pre><code class="lang-java">package com.yiibai;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class MainApp {
   public static void main(String[] args) {
      ApplicationContext context = 
             new ClassPathXmlApplicationContext("Beans.xml");

      Student student = (Student) context.getBean("student");

      student.printThrowException();     
   }
}
</code></pre> 
 <p>以下是配置文件<em>Beans.xml</em>文件的内容：</p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:aop="http://www.springframework.org/schema/aop"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd 
    http://www.springframework.org/schema/aop 
    http://www.springframework.org/schema/aop/spring-aop-3.0.xsd "&gt;

   &lt;aop:aspectj-autoproxy/&gt;

   &lt;!-- Definition for student bean --&gt;
   &lt;bean id="student" class="com.yiibai.Student"&gt;
      &lt;property name="name"  value="minsu" /&gt;
      &lt;property name="age"  value="24"/&gt;      
   &lt;/bean&gt;

   &lt;!-- Definition for logging aspect --&gt;
   &lt;bean id="logging" class="com.yiibai.Logging"/&gt; 

&lt;/beans&gt;
</code></pre> 
 <h2 id="h2-u8FD0u884Cu9879u76EE"><a name="运行项目" class="reference-link"></a><span class="header-link octicon octicon-link"></span>运行项目</h2>
 <p>完成创建源代码和配置文件后，运行应用程序。右键单击应用程序中的<code>MainApp.java</code>，并使用运行方式作为<strong>Java应用程序命令</strong>。 如果您的应用程序一切正常，这将打印以下消息：</p>   
 <pre><code class="lang-shell">Exception raised
[afterThrowingAdvice] Method Signature: void com.yiibai.Student.printThrowException()
[afterThrowingAdvice] Exception: java.lang.IllegalArgumentException
Exception in thread "main" java.lang.IllegalArgumentException
    at com.yiibai.Student.printThrowException(Student.java:25)
    at com.yiibai.Student$$FastClassBySpringCGLIB$$e9280b4b.invoke(&lt;generated&gt;)
    at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204)
    at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:717)
    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
    at org.springframework.aop.aspectj.AspectJAfterThrowingAdvice.invoke(AspectJAfterThrowingAdvice.java:58)
    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
    at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
    at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:653)
    at com.yiibai.Student$$EnhancerBySpringCGLIB$$bb5ffc0.printThrowException(&lt;generated&gt;)
    at com.yiibai.MainApp.main(MainApp.java:16)
</code></pre>
 <br>      
</div></body></html>
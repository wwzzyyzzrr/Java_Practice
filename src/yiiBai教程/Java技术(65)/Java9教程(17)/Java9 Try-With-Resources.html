<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Java9 Try-With-Resources</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在这篇文章中，我们将讨论Java SE 9中的一些改进<code>Try-With-Resources</code>语句。现在让我们开始学习这个构造。</p> 
 <h2 id="h2-java-se-7-try-with-resources-"><a name="Java SE 7:Try-With-Resources基础知识" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Java SE 7:Try-With-Resources基础知识</h2>
 <p>Java SE 7引入了一个新的构造:<code>Try-With-Resources</code> 语句，用于更好的异常处理。 如果没有这个构造，开发人员必须编写大量冗余和难看的代码。 如果开发人员忘记正确关闭资源，那么可能在应用程序中有资源泄漏问题。</p> 
 <p>这个新功能的主要目标是:</p> 
 <ul> 
  <li>语法更精简，避免写一些<code>try-catch/finally</code>块。</li>
  <li>代码且有更好的可读性</li>
  <li>不需要做空检查</li>
  <li>无需检查资源引用是指引用对象还是<code>null</code>。</li>
  <li>更好的资源管理，ARM(自动资源管理)</li>
  <li>避免内存泄漏</li>
 </ul> 
 <p><strong>Try-With-Resources 示例-1</strong></p> 
 <pre><code class="lang-java">void testARM_Before_Java9() throws IOException{
 BufferedReader reader1 = new BufferedReader(new FileReader("mytest.txt"));
 try (BufferedReader reader2 = reader1) {
   System.out.println(reader2.readLine());
 }
}
</code></pre> 
 <p>这里创建了一个实用程序方法，它创建一个<code>BufferedReader</code>对象来读取文件的内容。 如果观察上面的代码片段，即使<code>reader1</code>引用了<code>BufferedReader</code>对象，也应该创建一个重复的<code>reader2</code>来在<code>Try-With-Resources</code>中使用它。 这是Java SE 7或8版本中的一个小错误或问题。</p> 
 <p>我们不能在<code>Try-With-Resources</code>语句的<code>try()</code>块内使用任何资源(在<code>Try-With-Resources</code>之外声明)。</p> 
 <p>以下代码在Java SE 7或8版本中无效，它会引发编译时错误。</p> 
 <p><strong>Try-With-Resources 示例-2</strong></p> 
 <pre><code class="lang-java">void testARM_Before_Java9() throws IOException{
 BufferedReader reader1 = new BufferedReader(new FileReader("mytest.txt"));
 try (reader1) {
   System.out.println(reader1.readLine());
 }
}
</code></pre> 
 <h2 id="h2-java-se-7-try-with-resources-"><a name="Java SE 7:Try-With-Resources规则" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Java SE 7:Try-With-Resources规则</h2>
 <p>在Java SE 7或8版本中，我们应该遵循这些规则为自动资源管理(ARM)来使用<code>Try-With-Resources</code>语句，</p> 
 <ul> 
  <li>任何资源(其中预定义的Java API类或用户定义的类)必须实<code>java.lang.AutoCloseable</code>。</li>
  <li>资源对象必须引用<code>final</code>或有效的<code>final</code>变量</li>
  <li>如果资源已经在<code>Try-With-Resources</code>语句之外声明，则应该重新引用局部变量(如上面的<strong>示例-1</strong>中的代码所示)</li>
  <li>新创建的局部变量可以在<code>Try-With-Resources</code>语句中使用。</li>
 </ul> 
 <h2 id="h2-java-se-9-try-with-resources-"><a name="Java SE 9:Try-With-Resources改进" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Java SE 9:Try-With-Resources改进</h2>
 <p>Java SE 9为Try-With-Resources语句提供了一些改进。 正如我们在前面几节中讨论的那样，Java SE 7或8版本在这个语句中有一个小问题或错误。</p> 
 <p>在Java SE 9中，如果我们有一个已经在<code>Try-With-Resource</code>语句之外声明的资源作为<code>final</code>或有效的<code>final</code>，那么不需要声明局部变量。 我们可以在<code>Try-With-Resource</code>语句中使用以前创建的变量，没有任何问题，如下所示:</p> 
 <p><strong>Try-With-Resources 示例-3</strong></p>   
 <pre><code class="lang-java">void testARM_Java9() throws IOException{
 BufferedReader reader1 = new BufferedReader(new FileReader("mytest.txt"));
 try (reader1) {
   System.out.println(reader1.readLine());
 }
}
</code></pre> 
 <p>这个例子是Java SE 9的有效代码。我们不会像<strong>示例1</strong> 所示的那样创建另一个局部变量，如<code>reader2</code>来引用<code>reader1</code>。下面在Java SE 9 REPL中执行这两个示例来测试它们。如下所示 - </p> 
 <pre><code class="lang-shell">jshell&gt; void testARM_Before_Java9() throws IOException{
   ...&gt; BufferedReader reader1 = new BufferedReader(new FileReader("mytest.txt"));
   ...&gt; try (BufferedReader reader2 = reader1) {
   ...&gt; System.out.println(reader2.readLine());
   ...&gt; }
   ...&gt; }
|  created method testARM_Before_Java9()

jshell&gt; testARM_Before_Java9()
mytest
</code></pre> 
 <p><strong>测试示例-3使用Java SE 9 REPL</strong></p> 
 <pre><code class="lang-shell">jshell&gt; void testARM_Java9() throws IOException{
   ...&gt; BufferedReader reader1 = new BufferedReader(new FileReader("mytest.txt"));
   ...&gt; try (reader1) {
   ...&gt; System.out.println(reader1.readLine());
   ...&gt; }
   ...&gt; }
|  created method testARM_Java9()

jshell&gt; testARM_Java9()
mytest
</code></pre> 
 <p>上面就是<strong>“Java SE 9:Try-With-Resources改进”</strong>新功能的全部内容。</p>
 <br>      
</div></body></html>
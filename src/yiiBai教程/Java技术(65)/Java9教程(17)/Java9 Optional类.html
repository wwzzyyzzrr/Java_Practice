<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Java9 Optional类</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在这篇文章中，我们将讨论“Java SE 8的<code>Optional</code>类如何解决空检查问题？”以及“Java SE 9的<code>Optional</code>类改进”。</p> 
 <p>作为Java开发人员，我们知道为了避免<code>NullPointerException</code>错误而对每个对象进行空检查时需要做不少的工作。</p> 
 <h2 id="h2-java-se-8-optional-"><a name="Java SE 8:Optional类基础" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Java SE 8:Optional类基础</h2>
 <p>Oracle公司已经引入了<code>Optional</code>类作为<code>java.util</code>包的一部分。 它是一个容器对象，它可能包含或不包含非空值。</p> 
 <p>它主要用于避免大量空检查和<code>NullPointerException</code>问题。 尽管它是<code>java.util</code>包的一部分，但它并未实现任何<code>Collection</code> API接口。 它扩展了<code>Object</code>类，如下所示。</p> 
 <pre><code class="lang-java">public final class Optional&lt;T&gt; extends Object
</code></pre> 
 <p>它是<code>final</code>类，因此不能重写它。 如果可选对象不为空，则表示该对象中存在值。 如果它是空的，则不存在如下所示的值。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201802/2802/438170237_15882.png" alt=""></p> 
 <h2 id="h2-java-se-8-optional-"><a name="Java SE 8:Optional基本示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Java SE 8:Optional基本示例</h2>
 <p>在本节中，我们将探讨如何使用Java SE 8 <code>Optional</code>对象来避免空检查和<code>NullPointerException</code>。</p> 
 <p>它是<code>Optional</code>类中的简单基本示例。 它演示了如何使用<code>Optional.empty()</code>创建一个空的<code>Optional</code>对象，以及如何创建非空的<code>Optional</code>对象。</p> 
 <pre><code class="lang-java">import java.util.Optional;

public class JavaSE8OptionalDemo
{
  public static void main(String[] args)
  {
    System.out.println(division(4,2));
    System.out.println(division(4,0));
  }


  public static Optional&lt;Integer&gt; division(Integer i1,Integer i2)
  {
    if(i2 == 0) return Optional.empty();
    else {
       Integer i3 = i1/i2;
       return Optional.of(i3);
    }
  }

}
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">Optional[2]
Optional.empty
</code></pre> 
 <h2 id="h2-java-se-9-optional-"><a name="Java SE 9:Optional类改进" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Java SE 9:Optional类改进</h2>
 <p>在Java SE 9中，Oracle公司引入了以下三种方法来改进<code>Optional</code>类功能。几个方法如下所示 - </p> 
 <ul> 
  <li><code>stream()</code></li>
  <li><code>ifPresentOrElse()</code></li>
  <li><code>or()</code></li>
 </ul> 
 <p>我们将逐一介绍这些方法，并在接下来的章节中详细讨论一些合适的例子。</p> 
 <p><strong>Java SE 9:Optional类的stream()方法</strong></p> 
 <p>如果给定<code>Optional</code>对象中存在一个值，则此<code>stream()</code>方法将返回具有该值的顺序流。 否则，它将返回一个空流。</p> 
 <p>Java 9已经添加了<code>stream()</code>方法来延迟处理<code>Optional</code>对象，如下所示:</p> 
 <pre><code class="lang-java">Stream&lt;Optional&gt; emp = getEmployee(id)
Stream empStream = emp.flatMap(Optional::stream)
</code></pre> 
 <p>这里使用<code>Optional.stream()</code>方法将<code>Employee</code>对象的一个<code>Optional</code>的<code>Stream</code>转换为一个<code>Employee</code>流，以便可以在结果代码中懒地处理这个结果。</p> 
 <h2 id="h2-java-se-8-optional-"><a name="Java SE 8样式:Optional方法" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Java SE 8样式:Optional方法</h2>
 <p>在Java SE 8中，我们应该使用<code>ifPresent()</code>，<code>isPresent()</code>和<code>orElse()</code>等方法来检查<code>Optional</code>对象并对其执行一些功能。 执行此操作有点繁琐。 但是，Java SE 9引入了一种新方法来解决这个问题。</p> 
 <p>在这里，我们将探索以下三种可选的类方法:</p> 
 <ul> 
  <li><p><code>ifPresent()</code> - 如果存在值，则使用该值执行给定操作，否则不执行任何操作。</p> <pre><code class="lang-java">void ifPresent(Consumer action)
</code></pre> </li>
  <li><p><code>isPresent()</code> - 如果存在值，则返回true，否则返回false。</p> <pre><code class="lang-java">boolean isPresent()
</code></pre> </li>
  <li><p><code>orElse()</code> - 如果存在值，则返回该值，否则返回其他值。</p> </li>
 </ul> 
 <pre><code class="lang-java">public T orElse(T other)
</code></pre> 
 <p>示例代码 - </p> 
 <pre><code class="lang-java">import java.util.Optional;

public class JavaSE8OptionalDemo
{
  public static void main(String[] args)
  {

    Optional&lt;Integer&gt; opt1 = division(4,2);    
    opt1.ifPresent( x -&gt; System.out.println("Option1: Result found = " + x));

    Optional&lt;Integer&gt; opt2 = division(4,0);    
    opt2.ifPresent( x -&gt; System.out.println("Option2: Result found: " + x));

    System.out.println("Option2: Result not found, default vlaue = " + opt2.orElse(new Integer(0)));

    if(opt2.isPresent())
      System.out.println("Option2: Result found.");
    else
      System.out.println("Option2: Result not found.");

  }

  public static Optional&lt;Integer&gt; division(Integer i1,Integer i2)
  {
    if(i2 == 0) return Optional.empty();
    else {
       Integer i3 = i1/i2;
       return Optional.of(i3);
    }
  }

}
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p>   
 <pre><code class="lang-shell">Option1: Result found = 2
Option2: Result not found, default vlaue = 0
Option2: Result not found.
</code></pre> 
 <p><strong>Java SE 9:可选ifPresentOrElse()方法</strong></p> 
 <p>在本节中，通过使用Java SE 9的<code>Optional</code>类的<code>ifPresentOrElse()</code>方法来探索相同类型的场景。 它以一种很好的方式将<code>ifPresent()</code>，<code>isPresent()</code>和<code>orElse()</code>方法等所有方法组合在一起。</p> 
 <p>Java SE 9 <code>Optional</code>类 ifPresentOrElse()API: -</p> 
 <pre><code class="lang-java">public void ifPresentOrElse(Consumerl&lt;? super Tl&gt; action, Runnable emptyAction)
</code></pre> 
 <p>如果存在值，则使用该值执行给定操作，否则执行给定的基于空的操作。</p> 
 <p><strong>ifPresentOrElse()示例</strong></p> 
 <pre><code class="lang-shell">jshell&gt; Optional&lt;Integer&gt; opt1 = Optional.of(4)
opt1 ==&gt; Optional[4]

jshell&gt; opt1.ifPresentOrElse( x -&gt; System.out.println("Result found: " + x), () -&gt; System.out.println("Not Found."))
Result found: 4

jshell&gt; Optional&lt;Integer&gt; opt2 = Optional.empty()
opt2 ==&gt; Optional.empty

jshell&gt; opt2.ifPresentOrElse( x -&gt; System.out.println("Result found: " + x), () -&gt; System.out.println("Not Found."))
Not Found.
</code></pre> 
 <p><strong>Java SE 9: Optional类or()方法</strong></p> 
 <p>在Java SE 9Optional类API中，如果<code>Optional</code>包含值，则使用<code>or()</code>方法返回值。 否则返回供应商中指定的值。 这个<code>or()</code>方法将供应商作为参数来指定默认值。</p> 
 <pre><code class="lang-shell">public Optional&lt;T&gt; or(Supplier&lt;? extends Optional&lt;? extends T&gt;&gt; supplier)
</code></pre> 
 <p>让我们看一个示例，首先在<code>Optional</code>中显示一个值。</p> 
 <p><strong>Java SE 9 Optional类of()方法</strong></p> 
 <pre><code class="lang-shell">jshell&gt; Optional&lt;String&gt; opStr = Optional.of("Rams")
opStr ==&gt; Optional[Rams]

jshell&gt; import java.util.function.*


jshell&gt; Supplier&lt;Optional&lt;String&gt;&gt; supStr = () -&gt; Optional.of("No Name")
supStr ==&gt; $Lambda$67/222624801@23faf8f2


jshell&gt; opStr.or(supStr)
$5 ==&gt; Optional[Rams]
</code></pre>
 <br>      
</div></body></html>
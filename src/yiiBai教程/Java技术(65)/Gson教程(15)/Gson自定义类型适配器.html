<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Gson自定义类型适配器</h1><div style="width:100%;float:left;" class="article-content">   
 <p>Gson使用其内置适配器执行对象的序列化/反序列化。 它也支持自定义适配器。 让我们来讨论如何创建一个自定义适配器以及如何使用它。</p> 
 <h2 id="h2-u521Bu5EFAu81EAu5B9Au4E49u9002u914Du5668"><a name="创建自定义适配器" class="reference-link"></a><span class="header-link octicon octicon-link"></span>创建自定义适配器</h2>
 <p>通过扩展<code>TypeAdapter</code>类并传递目标类型的对象来创建自定义适配器。 重写读写方法分别执行自定义的反序列化和序列化。</p> 
 <pre><code class="lang-java">class StudentAdapter extends TypeAdapter&lt;Student&gt; { 
   @Override 
   public Student read(JsonReader reader) throws IOException { 
      ... 
   } 
   @Override 
   public void write(JsonWriter writer, Student student) throws IOException { 
   } 
}
</code></pre> 
 <h2 id="h2-u6CE8u518Cu81EAu5B9Au4E49u9002u914Du5668"><a name="注册自定义适配器" class="reference-link"></a><span class="header-link octicon octicon-link"></span>注册自定义适配器</h2>
 <p>使用<code>GsonBuilder</code>注册自定义适配器并使用<code>GsonBuilder</code>创建一个Gson实例。参考以下实现代码 - </p> 
 <pre><code class="lang-java">GsonBuilder builder = new GsonBuilder(); 
builder.registerTypeAdapter(Student.class, new StudentAdapter()); 
Gson gson = builder.create();
</code></pre> 
 <h2 id="h2-u4F7Fu7528u9002u914Du5668"><a name="使用适配器" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用适配器</h2>
 <p>Gson现在将使用自定义适配器将Json文本转换为对象，反之亦然。参考以下实现代码 - </p> 
 <pre><code class="lang-java">String jsonString = "{\"name\":\"Maxsu\", \"rollNo\":1}"; 
Student student = gson.fromJson(jsonString, Student.class); 
System.out.println(student);  
jsonString = gson.toJson(student); 
System.out.println(jsonString);
</code></pre> 
 <p><strong>示例</strong></p> 
 <p>我们来看一个自定义类型适配器的例子。 创建一个名为<code>GsonTester</code>的Java类文件:<em>GsonTester.java</em> - </p> 
 <pre><code class="lang-java">import java.io.IOException;  

import com.google.gson.Gson; 
import com.google.gson.GsonBuilder; 
import com.google.gson.TypeAdapter; 
import com.google.gson.stream.JsonReader; 
import com.google.gson.stream.JsonToken; 
import com.google.gson.stream.JsonWriter;  

public class GsonTester { 
   public static void main(String args[]) { 
      GsonBuilder builder = new GsonBuilder(); 
      builder.registerTypeAdapter(Student.class, new StudentAdapter()); 
      builder.setPrettyPrinting(); 
      Gson gson = builder.create();  

      String jsonString = "{\"name\":\"Maxsu\", \"rollNo\":1}";  
      Student student = gson.fromJson(jsonString, Student.class); 
      System.out.println(student);  

      jsonString = gson.toJson(student); 
      System.out.println(jsonString);  
   }      
}  
class StudentAdapter extends TypeAdapter&lt;Student&gt; { 
   @Override 
   public Student read(JsonReader reader) throws IOException { 
      Student student = new Student(); 
      reader.beginObject(); 
      String fieldname = null; 

      while (reader.hasNext()) { 
         JsonToken token = reader.peek();            

         if (token.equals(JsonToken.NAME)) {     
            //get the current token 
            fieldname = reader.nextName(); 
         } 
         if ("name".equals(fieldname)) {       
            //move to next token 
            token = reader.peek(); 
            student.setName(reader.nextString()); 
         } 
         if("rollNo".equals(fieldname)) { 
            //move to next token 
            token = reader.peek(); 
            student.setRollNo(reader.nextInt()); 
         }               
      } 
      reader.endObject(); 
      return student; 
   }  
   @Override 
   public void write(JsonWriter writer, Student student) throws IOException { 
      writer.beginObject(); 
      writer.name("name"); 
      writer.value(student.getName()); 
      writer.name("rollNo"); 
      writer.value(student.getRollNo()); 
      writer.endObject(); 
   } 
}  
class Student { 
   private int rollNo; 
   private String name;  

   public int getRollNo() { 
      return rollNo; 
   }  
   public void setRollNo(int rollNo) { 
      this.rollNo = rollNo; 
   }  
   public String getName() { 
      return name; 
   }  
   public void setName(String name) { 
      this.name = name; 
   }   
   public String toString() { 
      return "Student[ name = "+name+", roll no: "+rollNo+ "]"; 
   } 
}
</code></pre> 
 <p>执行上面示例代码，得到以下结果 - </p>   
 <pre><code class="lang-shell">Student[ name = Maxsu, roll no: 1] 
{ 
   "name": "Maxsu", 
   "rollNo": 1 
}
</code></pre>
 <br>      
</div></body></html>
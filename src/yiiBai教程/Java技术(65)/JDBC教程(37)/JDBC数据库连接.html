<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">JDBC数据库连接</h1><div style="width:100%;float:left;" class="article-content">   
 <p>安装相应的驱动程序后，现在是时候来学习使用JDBC建立数据库连接了。</p> 
 <p>建立JDBC连接所涉及的编程相当简单。 以下是基本的四个步骤 -</p> 
 <ul> 
  <li><strong>导入JDBC包</strong>：使用Java语言的<code>import</code>语句在Java代码开头位置导入所需的类。</li>
  <li><strong>注册JDBC驱动程序</strong>：使JVM将所需的驱动程序实现加载到内存中，从而可以满足JDBC请求。</li>
  <li><strong>数据库URL配置</strong>：创建一个正确格式化的地址，指向要连接到的数据库(如：MySQL,Oracle和MSSQL等等)。</li>
  <li><strong>创建连接对象</strong>：最后，调用<code>DriverManager</code>对象的<code>getConnection()</code>方法来建立实际的数据库连接。</li>
 </ul> 
 <h2 id="h2-1-jdbc-"><a name="1. 导入JDBC包" class="reference-link"></a><span class="header-link octicon octicon-link"></span>1. 导入JDBC包</h2>
 <p><code>import</code>语句告诉Java编译器在哪里找到在代码中引用的类，<code>import</code>语句一般放置在源代码的开头。<br>要使用标准的JDBC包，它允许在数据库表中执行选择，插入，更新和删除数据，请将以下导入添加到源代码中 -</p> 
 <pre><code class="lang-java">import java.sql.* ;  // for standard JDBC programs
import java.math.* ; // for BigDecimal and BigInteger support
</code></pre> 
 <h2 id="h2-2-jdbc-"><a name="2. 注册JDBC驱动程序" class="reference-link"></a><span class="header-link octicon octicon-link"></span>2. 注册JDBC驱动程序</h2>
 <p>在使用程序之前，必须先注册该驱动程序。 注册驱动程序是将Oracle驱动程序的类文件加载到内存中的过程，因此可以将其用作JDBC接口的实现。</p> 
 <p>只需在程序中一次注册就可以。可以通过两种方式之一来注册驱动程序。</p> 
 <h3 id="h3-2-1-i-class-forname-"><a name="2.1 方法I - Class.forName()" class="reference-link"></a><span class="header-link octicon octicon-link"></span>2.1 方法I - Class.forName()</h3>
 <p>注册驱动程序最常见的方法是使用Java的<code>Class.forName()</code>方法，将驱动程序的类文件动态加载到内存中，并将其自动注册。这个方法是推荐使用的方法，因为它使驱动程序注册可配置和便携。</p> 
 <p>以下示例使用<code>Class.forName()</code>注册Oracle驱动程序 -</p> 
 <pre><code class="lang-java">try {
   Class.forName("oracle.jdbc.driver.OracleDriver");
}
catch(ClassNotFoundException ex) {
   System.out.println("Error: unable to load driver class!");
   System.exit(1);
}
</code></pre> 
 <p>使用JDBC驱动程序连接MySQL数据库的示例代码片段 - </p> 
 <pre><code class="lang-java">Class.forName("com.mysql.jdbc.Driver");
Connection conn = null;
conn = DriverManager.getConnection("jdbc:mysql://hostname:port/db_name","db_username", "db_password");
conn.close();
</code></pre> 
 <p>使用<code>getInstance()</code>方法来解决不合规的JVM，但是必须编写两个额外的异常，如下所示：</p> 
 <pre><code class="lang-java">try {
   Class.forName("oracle.jdbc.driver.OracleDriver").newInstance();
}
catch(ClassNotFoundException ex) {
   System.out.println("Error: unable to load driver class!");
   System.exit(1);
catch(IllegalAccessException ex) {
   System.out.println("Error: access problem while loading!");
   System.exit(2);
catch(InstantiationException ex) {
   System.out.println("Error: unable to instantiate driver!");
   System.exit(3);
}
</code></pre> 
 <h3 id="h3-2-2-ii-drivermanager-registerdriver-"><a name="2.2 方法II - DriverManager.registerDriver()" class="reference-link"></a><span class="header-link octicon octicon-link"></span>2.2 方法II - DriverManager.registerDriver()</h3>
 <p>第二种方法是使用静态<code>DriverManager.registerDriver()</code>方法来注册驱动程序。</p> 
 <p>如果使用的是非JDK兼容的JVM(如Microsoft提供的)，则应使用<code>registerDriver()</code>方法。</p> 
 <p>以下示例使用<code>registerDriver()</code>注册Oracle驱动程序 -</p> 
 <pre><code class="lang-java">try {
   Driver myDriver = new oracle.jdbc.driver.OracleDriver();
   DriverManager.registerDriver( myDriver );
}
catch(ClassNotFoundException ex) {
   System.out.println("Error: unable to load driver class!");
   System.exit(1);
}
</code></pre> 
 <h2 id="h2--url-"><a name="数据库URL配置" class="reference-link"></a><span class="header-link octicon octicon-link"></span>数据库URL配置</h2>
 <p>加载驱动程序后，可以使用<code>DriverManager.getConnection()</code>方法建立连接。 为了方便参考，这里列出三个重载的<code>DriverManager.getConnection()</code>方法 -</p> 
 <ul> 
  <li><code>getConnection(String url)</code></li>
  <li><code>getConnection(String url, Properties prop)</code></li>
  <li><code>getConnection(String url, String user, String password)</code></li>
 </ul> 
 <p>这里每个格式都需要一个数据库URL。 数据库URL是指向数据库的地址。</p> 
 <p>制定数据库URL是建立连接相关联的大多数错误问题发生的地方。</p> 
 <p>下表列出了常用的JDBC驱动程序名称和数据库URL。</p> 
 <table> 
  <thead> 
   <tr> 
    <th>RDBMS</th> 
    <th>JDBC驱动程序名称</th> 
    <th>URL格式</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>MySQL</td> 
    <td><code>com.mysql.jdbc.Driver</code></td> 
    <td><code>jdbc:mysql://hostname/databaseName</code></td> 
   </tr> 
   <tr> 
    <td>ORACLE</td> 
    <td><code>oracle.jdbc.driver.OracleDriver</code></td> 
    <td><code>jdbc:oracle:thin:<a target="_blank" href="https://github.com/hostname" title="@hostname" class="at-link">@hostname</a>:portNumber:databaseName</code></td> 
   </tr> 
   <tr> 
    <td>PostgreSQL</td> 
    <td><code>org.postgresql.Driver</code></td> 
    <td><code>jdbc:postgresql://hostname:port/dbname</code></td> 
   </tr> 
   <tr> 
    <td>DB2</td> 
    <td><code>com.ibm.db2.jdbc.net.DB2Driver</code></td> 
    <td><code>jdbc:db2:hostname:port Number/databaseName</code></td> 
   </tr> 
   <tr> 
    <td>Sybase</td> 
    <td><code>com.sybase.jdbc.SybDriver</code></td> 
    <td><code>jdbc:sybase:Tds:hostname: portNumber/databaseName</code></td> 
   </tr> 
  </tbody> 
 </table> 
 <p>URL格式的所有突出部分都是静态的，只需要根据数据库设置更改对应的部分。</p> 
 <h2 id="h2-u521Bu5EFAu8FDEu63A5u5BF9u8C61"><a name="创建连接对象" class="reference-link"></a><span class="header-link octicon octicon-link"></span>创建连接对象</h2>
 <p>上面列出了三种形式的<code>DriverManager.getConnection()</code>方法来创建一个连接对象。</p> 
 <h2 id="h2--url"><a name="使用具有用户名和密码的数据库URL" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用具有用户名和密码的数据库URL</h2>
 <p><code>getConnection()</code>最常用的形式要求传递数据库URL，用户名和密码：</p> 
 <p>假设使用Oracle thin驱动程序，那么需要为URL的数据库部分指定：<code>host:port:databaseName</code>值。</p> 
 <p>如果主机名为<strong>amrood</strong>的TCP/IP地址为<em>192.0.0.10</em>，并且Oracle侦听器配置为侦听端口<code>1521</code>，并且要连接的数据库名称是<code>EMP</code>，则完整的数据库URL将是 -</p> 
 <pre><code class="lang-java">jdbc:oracle:thin:@amrood:1521:EMP
// 或者
jdbc:oracle:thin:@192.0.0.10:1521:EMP
</code></pre> 
 <p>现在必须使用适当的用户名和密码调用<code>getConnection()</code>方法获取一个<code>Connection</code>对象，如下所示：</p>   
 <pre><code class="lang-java">String URL = "jdbc:oracle:thin:@amrood:1521:EMP";
// String URL = "jdbc:oracle:thin:@192.0.0.10:1521:EMP";
String USER = "username";
String PASS = "password"
Connection conn = DriverManager.getConnection(URL, USER, PASS);
</code></pre> 
 <h3 id="h3--url"><a name="仅使用数据库URL" class="reference-link"></a><span class="header-link octicon octicon-link"></span>仅使用数据库URL</h3>
 <p><code>DriverManager.getConnection()</code>方法的第二种形式只需要数据库URL -</p> 
 <pre><code class="lang-java">DriverManager.getConnection(String url);
</code></pre> 
 <p>但是，在本示例中，数据库URL包括用户名和密码，并具有以下一般形式 -</p> 
 <pre><code class="lang-java">jdbc:oracle:driver:username/password@database
</code></pre> 
 <p>所以，上述连接可以使用如下方式创建 -</p> 
 <pre><code class="lang-java">String URL = "jdbc:oracle:thin:username/password@192.168.0.10:1521:EMP";
Connection conn = DriverManager.getConnection(URL);
</code></pre> 
 <h3 id="h3--url-properties-"><a name="使用数据库URL和Properties对象" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用数据库URL和Properties对象</h3>
 <p><code>DriverManager.getConnection()</code>方法的第三种形式需要一个数据库URL和一个<code>Properties</code>对象 -</p> 
 <pre><code class="lang-java">DriverManager.getConnection(String url, Properties info);
</code></pre> 
 <p><code>Properties</code>对象包含一组键-值对。 在调用<code>getConnection()</code>方法时，它用于将驱动程序属性传递给驱动程序。</p> 
 <p>要进行与上述示例相同的连接，请使用以下代码 -</p> 
 <pre><code class="lang-java">import java.util.*;

String URL = "jdbc:oracle:thin:@amrood:1521:EMP";
Properties info = new Properties( );
info.put( "user", "root" );
info.put( "password", "password12321" );

Connection conn = DriverManager.getConnection(URL, info);
</code></pre> 
 <h2 id="h2--jdbc-"><a name="关闭JDBC连接" class="reference-link"></a><span class="header-link octicon octicon-link"></span>关闭JDBC连接</h2>
 <p>在JDBC程序结束之后，显式地需要关闭与数据库的所有连接以结束每个数据库会话。 但是，如果在编写程序中忘记了关闭也没有关系，Java的垃圾收集器将在清除过时的对象时也会关闭这些连接。</p> 
 <p>依靠垃圾收集，特别是数据库编程，是一个非常差的编程实践。所以应该要使用与连接对象关联的<code>close()</code>方法关闭连接。</p> 
 <p>要确保连接已关闭，可以将关闭连接的代码中编写在“<code>finally</code>”块中。 一个<code>finally</code>块总是会被执行，不管是否发生异常。</p> 
 <p>要关闭上面打开的连接，应该调用<code>close()</code>方法如下 -</p> 
 <pre><code class="lang-sql">conn.close();
</code></pre> 
 <p>显式关闭连接可节省数据库系统的资源。为了更好的理解，建议您学习的<a target="_blank" href="http://www.yiibai.com/jdbc/jdbc-sample-code.html" title="JDBC示例代码教程">JDBC示例代码教程</a>。</p> 
 <p>参考Oracle+JDBC示例代码：</p> 
 <pre><code class="lang-java">package com.yiibai;

import java.sql.DriverManager;
import java.sql.Connection;
import java.sql.SQLException;

public class OracleJDBCExample {

    public static void main(String[] argv) {

        System.out.println("-------- Oracle JDBC Connection Testing ------");

        try {

            Class.forName("oracle.jdbc.driver.OracleDriver");

        } catch (ClassNotFoundException e) {

            System.out.println("Where is your Oracle JDBC Driver?");
            e.printStackTrace();
            return;

        }

        System.out.println("Oracle JDBC Driver Registered!");

        Connection connection = null;

        try {

            connection = DriverManager.getConnection(
                    "jdbc:oracle:thin:@localhost:1521:xe", "system", "password");

        } catch (SQLException e) {

            System.out.println("Connection Failed! Check output console");
            e.printStackTrace();
            return;

        }

        if (connection != null) {
            System.out.println("You made it, take control your database now!");
        } else {
            System.out.println("Failed to make connection!");
        }
    }

}
</code></pre>
 <br>      
</div></body></html>
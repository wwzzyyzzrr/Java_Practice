<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">JDBC异常</h1><div style="width:100%;float:left;" class="article-content">   
 <p>异常处理允许我们以受控的方式处理异常情况，而不是直接退出程序，例如程序定义的错误。</p> 
 <p>发生异常时可以抛出异常。术语“<strong>异常</strong>”表示当前的程序执行停止，并且被重定向到最近的适用的<code>catch</code>子句。如果没有适用的<code>catch</code>子句存在，则程序的执行结束。</p> 
 <p>JDBC异常处理与Java异常处理非常相似，但对于JDBC，要处理的最常见异常是<code>java.sql.SQLException</code>。</p> 
 <h2 id="h2-sqlexception-"><a name="SQLException方法" class="reference-link"></a><span class="header-link octicon octicon-link"></span>SQLException方法</h2>
 <p>驱动程序和数据库中都会发生<code>SQLException</code>。 发生这种异常时，<code>SQLException</code>类型的对象将被传递给<code>catch</code>子句。</p> 
 <p>传递的<code>SQLException</code>对象具有以下可用于检索有关异常信息的方法 -</p> 
 <table> 
  <thead> 
   <tr> 
    <th>方法</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td><code>getErrorCode( )</code></td> 
    <td>获取与异常关联的错误代码。</td> 
   </tr> 
   <tr> 
    <td><code>getMessage( )</code></td> 
    <td>获取驱动程序处理的错误的JDBC驱动程序的错误消息，或获取数据库错误的Oracle错误代码和消息。</td> 
   </tr> 
   <tr> 
    <td><code>getSQLState( )</code></td> 
    <td>获取XOPEN SQLstate字符串。 对于JDBC驱动程序错误，不会从此方法返回有用的信息。 对于数据库错误，返回五位数的XOPEN SQLstate代码。 此方法可以返回<code>null</code>。</td> 
   </tr> 
   <tr> 
    <td><code>getNextException( )</code></td> 
    <td>获取异常链中的下一个<code>Exception</code>对象。</td> 
   </tr> 
   <tr> 
    <td><code>printStackTrace( )</code></td> 
    <td>打印当前异常或可抛出的异常，并将其追溯到标准错误流。</td> 
   </tr> 
   <tr> 
    <td><code>printStackTrace(PrintStream s)</code></td> 
    <td>将此<code>throwable</code>及其回溯打印到指定的打印流。</td> 
   </tr> 
   <tr> 
    <td><code>printStackTrace(PrintWriter w)</code></td> 
    <td>打印这个<code>throwable</code>，它是回溯到指定的打印器(<code>PrintWriter</code>)。</td> 
   </tr> 
  </tbody> 
 </table> 
 <p>通过利用<code>Exception</code>对象提供的信息，可以捕获异常并适当地继续执行程序。下面是一个<code>try</code>块的一般形式 -</p> 
 <pre><code class="lang-java">try {
   // Your risky code goes between these curly braces!!!
}
catch(Exception ex) {
   // Your exception handling code goes between these 
   // curly braces, similar to the exception clause 
   // in a PL/SQL block.
}
finally {
   // Your must-always-be-executed code goes between these 
   // curly braces. Like closing database connection.
}
</code></pre> 
 <h2 id="h2-u5B9Eu4F8B"><a name="实例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例</h2>
 <p>学习研究以下示例代码以了解<em>try …. catch … finally</em>块的用法。将下面代码保存到文件：<em>TryCatchFinally.java</em> 中，</p> 
 <pre><code class="lang-java">//STEP 1. Import required packages
// See more detail at http://www.yiibai.com/jdbc/


import java.sql.*;

public class TryCatchFinally {
   // JDBC driver name and database URL
   static final String JDBC_DRIVER = "com.mysql.jdbc.Driver";  
   static final String DB_URL = "jdbc:mysql://localhost/EMP";

   //  Database credentials
   static final String USER = "root";
   static final String PASS = "123456";

   public static void main(String[] args) {
   Connection conn = null;
   try{
      //STEP 2: Register JDBC driver
      Class.forName("com.mysql.jdbc.Driver");

      //STEP 3: Open a connection
      System.out.println("Connecting to database...");
      conn = DriverManager.getConnection(DB_URL,USER,PASS);

      //STEP 4: Execute a query
      System.out.println("Creating statement...");
      Statement stmt = conn.createStatement();
      String sql;
      sql = "SELECT id, first, last, age FROM Employees";
      ResultSet rs = stmt.executeQuery(sql);

      //STEP 5: Extract data from result set
      while(rs.next()){
         //Retrieve by column name
         int id  = rs.getInt("id");
         int age = rs.getInt("age");
         String first = rs.getString("first");
         String last = rs.getString("last");

         //Display values
         System.out.print("ID: " + id);
         System.out.print(", Age: " + age);
         System.out.print(", First: " + first);
         System.out.println(", Last: " + last);
      }
      //STEP 6: Clean-up environment
      rs.close();
      stmt.close();
      conn.close();
   }catch(SQLException se){
      //Handle errors for JDBC
      se.printStackTrace();
   }catch(Exception e){
      //Handle errors for Class.forName
      e.printStackTrace();
   }finally{
      //finally block used to close resources
      try{
         if(conn!=null)
            conn.close();
      }catch(SQLException se){
         se.printStackTrace();
      }//end finally try
   }//end try
   System.out.println("Goodbye!");
}//end main
}//end JDBCExample
</code></pre> 
 <p>现在编译上面例子中代码如下 -</p>   
 <pre><code class="lang-shell">F:\worksp\jdbc&gt;javac -Djava.ext.dirs=F:\worksp\jdbc\libs TryCatchFinally.java
</code></pre> 
 <p>执行上面编译后的代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">F:\worksp\jdbc&gt;java -Djava.ext.dirs=F:\worksp\jdbc\libs TryCatchFinally
Connecting to database...
Thu Jun 01 02:59:01 CST 2017 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.
Creating statement...
ID: 100, Age: 28, First: Max, Last: Su
ID: 101, Age: 25, First: Wei, Last: Wang
ID: 102, Age: 35, First: Xueyou, Last: Zhang
ID: 103, Age: 30, First: Jack, Last: Ma
ID: 106, Age: 28, First: Curry, Last: Stephen
ID: 107, Age: 32, First: Kobe, Last: Bryant
Goodbye!

F:\worksp\jdbc&gt;
</code></pre>
 <br>      
</div></body></html>
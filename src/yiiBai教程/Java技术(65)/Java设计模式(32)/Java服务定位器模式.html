<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Java服务定位器模式</h1><div style="width:100%;float:left;" class="article-content">   
 <p>当我们想要使用JNDI查找来定位各种服务时，使用服务定位器设计模式。 考虑到为服务查找JNDI的高成本，所以在服务定位器模式使用缓存技术。 首次需要服务时，服务定位器在JNDI中查找并缓存服务对象。 通过服务定位器进一步查找或相同的服务在其缓存中完成，这在很大程度上提高了应用的性能。 以下是这种类型的设计模式的实体。</p> 
 <ul> 
  <li><strong>服务</strong> - 将处理请求的实际服务。 将在JNDI服务器中查找此类服务的引用。</li>
  <li><strong>上下文/初始上下文</strong> - JNDI上下文携带对用于查找目的的服务的引用。</li>
  <li><strong>服务定位器</strong> - 服务定位器是通过JNDI查找缓存服务获得服务的单一联系点。</li>
  <li><strong>缓存</strong> - 用于存储服务的引用以重用它们的缓存。</li>
  <li><strong>客户端</strong> - 客户端是通过<code>ServiceLocator</code>调用服务的对象。</li>
 </ul> 
 <h2 id="h2-u5B9Eu73B0u5B9Eu4F8B"><a name="实现实例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实现实例</h2>
 <p>在这个实现的实例中，将创建一个<code>ServiceLocator</code>，<code>InitialContext</code>，<code>Cache</code>，<code>Service</code>作为表示实体的各种对象。 <code>Service1</code>和<code>Service2</code>用来表示具体服务。</p> 
 <p><code>ServiceLocatorPatternDemo</code>是一个演示类，在这里充当客户端，将使用<code>ServiceLocator</code>演示服务定位器设计模式。</p> 
 <p>服务定位器模式示例的结构如下图所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201612/09/251141254_29691.jpg" alt=""></p> 
 <h3 id="h3--1-"><a name="第1步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第1步</h3>
 <p>创建一个名为 <code>Service</code> 的接口，其代码如下 -<br><em>Service.java</em></p> 
 <pre><code class="lang-java">public interface Service {
   public String getName();
   public void execute();
}
</code></pre> 
 <h3 id="h3--2-"><a name="第2步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第2步</h3>
 <p>创建具体的服务类，其代码如下 - </p> 
 <p><em>Service1.java</em></p> 
 <pre><code class="lang-java">public class Service1 implements Service {
   public void execute(){
      System.out.println("Executing Service1");
   }

   @Override
   public String getName() {
      return "Service1";
   }
}
</code></pre> 
 <p><em>Service2.java</em></p> 
 <pre><code class="lang-java">public class Service2 implements Service {
   public void execute(){
      System.out.println("Executing Service2");
   }

   @Override
   public String getName() {
      return "Service2";
   }
}
</code></pre> 
 <h3 id="h3--3-"><a name="第3步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第3步</h3>
 <p>为<code>JNDI</code>查找创建<code>InitialContext</code> 类，其代码如下 -<br><em>InitialContext.java</em></p> 
 <pre><code class="lang-java">public class InitialContext {
   public Object lookup(String jndiName){

      if(jndiName.equalsIgnoreCase("SERVICE1")){
         System.out.println("Looking up and creating a new Service1 object");
         return new Service1();
      }
      else if (jndiName.equalsIgnoreCase("SERVICE2")){
         System.out.println("Looking up and creating a new Service2 object");
         return new Service2();
      }
      return null;        
   }
}
</code></pre> 
 <h3 id="h3--4-"><a name="第4步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第4步</h3>
 <p>创建缓存类，其代码如下 -<br><em>Cache.java</em></p> 
 <pre><code class="lang-java">import java.util.ArrayList;
import java.util.List;

public class Cache {

   private List&lt;Service&gt; services;

   public Cache(){
      services = new ArrayList&lt;Service&gt;();
   }

   public Service getService(String serviceName){

      for (Service service : services) {
         if(service.getName().equalsIgnoreCase(serviceName)){
            System.out.println("Returning cached  " + serviceName + " object");
            return service;
         }
      }
      return null;
   }

   public void addService(Service newService){
      boolean exists = false;

      for (Service service : services) {
         if(service.getName().equalsIgnoreCase(newService.getName())){
            exists = true;
         }
      }
      if(!exists){
         services.add(newService);
      }
   }
}
</code></pre> 
 <h3 id="h3--5-"><a name="第5步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第5步</h3>
 <p>创建服务定位器，其代码如下 - </p> 
 <p><em>ServiceLocator.java</em></p>   
 <pre><code class="lang-java">public class ServiceLocator {
   private static Cache cache;

   static {
      cache = new Cache();        
   }

   public static Service getService(String jndiName){

      Service service = cache.getService(jndiName);

      if(service != null){
         return service;
      }

      InitialContext context = new InitialContext();
      Service service1 = (Service)context.lookup(jndiName);
      cache.addService(service1);
      return service1;
   }
}
</code></pre> 
 <h3 id="h3--6-"><a name="第6步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第6步</h3>
 <p>使用<code>ServiceLocator</code>类来演示服务定位器设计模式。<br><em>ServiceLocatorPatternDemo.java</em></p> 
 <pre><code class="lang-java">public class ServiceLocatorPatternDemo {
   public static void main(String[] args) {
      Service service = ServiceLocator.getService("Service1");
      service.execute();
      service = ServiceLocator.getService("Service2");
      service.execute();
      service = ServiceLocator.getService("Service1");
      service.execute();
      service = ServiceLocator.getService("Service2");
      service.execute();        
   }
}
</code></pre> 
 <h3 id="h3--7-"><a name="第7步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第7步</h3>
 <p>验证输出，执行上面的代码得到以下结果 -</p> 
 <pre><code class="lang-java">Looking up and creating a new Service1 object
Executing Service1
Looking up and creating a new Service2 object
Executing Service2
Returning cached  Service1 object
Executing Service1
Returning cached  Service2 object
Executing Service2
</code></pre>
 <br>      
</div></body></html>
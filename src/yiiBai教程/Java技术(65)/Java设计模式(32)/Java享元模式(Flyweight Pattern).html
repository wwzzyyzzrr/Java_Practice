<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Java享元模式(Flyweight Pattern)</h1><div style="width:100%;float:left;" class="article-content">   
 <p>享元模式(<strong>Flyweight Pattern</strong>)主要用于减少创建的对象数量，并减少内存占用并提高性能。 这种类型的设计模式属于结构模式，因为该模式提供了减少对象计数的方法，从而改善应用的对象结构。</p> 
 <p>享元模式(<strong>Flyweight Pattern</strong>)尝试通过存储已经存在的类似对象以重用，并在找不到匹配的对象时创建新对象。我们将通过绘制不同位置的<code>20</code>个圆圈来演示这种模式，但是这里只创建<code>5</code>个对象。只有<code>5</code>种颜色可用，因此<code>color</code>属性用于检查已经存在的<code>Circle</code>对象。</p> 
 <h2 id="h2-u5B9Eu73B0u5B9Eu4F8B"><a name="实现实例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实现实例</h2>
 <p>在这个实例中，将创建一个<code>Shape</code>接口和一个实现<code>Shape</code>接口的具体类<code>Circle</code>。在下一步中将定义一个工厂类<code>ShapeFactory</code>。</p> 
 <p><code>ShapeFactory</code>有一个<code>HashMap</code>的<code>Circle</code>作为<code>Circle</code>对象的颜色。每当一个请求向<code>ShapeFactory</code>创建一个指定颜色的圆形时，它会检查<code>HashMap</code>中的圆形对象，如果找到对象则返回这个对象，否则就会创建一个新对象然后存储在<code>hashmap</code>中以供将来使用，并返回这个新创建的对象给客户端。</p> 
 <p><code>FlyWeightPatternDemo</code>这是一个演示类，将使用<code>ShapeFactory</code>来获取一个<code>Shape</code>对象。它将信息（红色/绿色/蓝色/黑色/白色）传递给<code>ShapeFactory</code>以获得所需颜色的圆形。</p> 
 <p>享元模式的实现实例结构如下图中所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201612/08/737141259_85000.jpg" alt=""></p> 
 <h3 id="h3--1-"><a name="第1步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第1步</h3>
 <p>创建一个接口，如下代码 -<br><em>Shape.java</em></p> 
 <pre><code class="lang-java">public interface Shape {
   void draw();
}
</code></pre> 
 <h3 id="h3--2-"><a name="第2步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第2步</h3>
 <p>创建一个实现相同接口的具体类。<br><em>Circle.java</em></p> 
 <pre><code class="lang-java">public class Circle implements Shape {
   private String color;
   private int x;
   private int y;
   private int radius;

   public Circle(String color){
      this.color = color;        
   }

   public void setX(int x) {
      this.x = x;
   }

   public void setY(int y) {
      this.y = y;
   }

   public void setRadius(int radius) {
      this.radius = radius;
   }

   @Override
   public void draw() {
      System.out.println("Circle: Draw() [Color : " + color + ", x : " + x + ", y :" + y + ", radius :" + radius);
   }
}
</code></pre> 
 <h3 id="h3--3-"><a name="第3步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第3步</h3>
 <p>创建一个工厂根据给定的信息生成具体类的对象。<br><em>ShapeFactory.java</em></p> 
 <pre><code class="lang-java">import java.util.HashMap;

public class ShapeFactory {
   private static final HashMap&lt;String, Shape&gt; circleMap = new HashMap();

   public static Shape getCircle(String color) {
      Circle circle = (Circle)circleMap.get(color);

      if(circle == null) {
         circle = new Circle(color);
         circleMap.put(color, circle);
         System.out.println("Creating circle of color : " + color);
      }
      return circle;
   }
}
</code></pre> 
 <h3 id="h3--4-"><a name="第4步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第4步</h3>
 <p>使用工厂并通过传递诸如颜色的信息来获得具体类的对象。</p> 
 <p><em>FlyweightPatternDemo.java</em></p>   
 <pre><code class="lang-java">public class FlyweightPatternDemo {
   private static final String colors[] = { "Red", "Green", "Blue", "White", "Black" };
   public static void main(String[] args) {

      for(int i=0; i &lt; 20; ++i) {
         Circle circle = (Circle)ShapeFactory.getCircle(getRandomColor());
         circle.setX(getRandomX());
         circle.setY(getRandomY());
         circle.setRadius(100);
         circle.draw();
      }
   }
   private static String getRandomColor() {
      return colors[(int)(Math.random()*colors.length)];
   }
   private static int getRandomX() {
      return (int)(Math.random()*100 );
   }
   private static int getRandomY() {
      return (int)(Math.random()*100);
   }
}
</code></pre> 
 <h3 id="h3--5-"><a name="第5步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第5步</h3>
 <p>验证输出，执行上面的代码得到以下结果 -</p> 
 <pre><code class="lang-java">Creating circle of color : Black
Circle: Draw() [Color : Black, x : 36, y :71, radius :100
Creating circle of color : Green
Circle: Draw() [Color : Green, x : 27, y :27, radius :100
Creating circle of color : White
Circle: Draw() [Color : White, x : 64, y :10, radius :100
Creating circle of color : Red
Circle: Draw() [Color : Red, x : 15, y :44, radius :100
Circle: Draw() [Color : Green, x : 19, y :10, radius :100
Circle: Draw() [Color : Green, x : 94, y :32, radius :100
Circle: Draw() [Color : White, x : 69, y :98, radius :100
Creating circle of color : Blue
Circle: Draw() [Color : Blue, x : 13, y :4, radius :100
Circle: Draw() [Color : Green, x : 21, y :21, radius :100
Circle: Draw() [Color : Blue, x : 55, y :86, radius :100
Circle: Draw() [Color : White, x : 90, y :70, radius :100
Circle: Draw() [Color : Green, x : 78, y :3, radius :100
Circle: Draw() [Color : Green, x : 64, y :89, radius :100
Circle: Draw() [Color : Blue, x : 3, y :91, radius :100
Circle: Draw() [Color : Blue, x : 62, y :82, radius :100
Circle: Draw() [Color : Green, x : 97, y :61, radius :100
Circle: Draw() [Color : Green, x : 86, y :12, radius :100
Circle: Draw() [Color : Green, x : 38, y :93, radius :100
Circle: Draw() [Color : Red, x : 76, y :82, radius :100
Circle: Draw() [Color : Blue, x : 95, y :82, radius :100
</code></pre>
 <br>      
</div></body></html>
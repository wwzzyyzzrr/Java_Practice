<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Java观察者模式</h1><div style="width:100%;float:left;" class="article-content">   
 <p>观察者模式在对象之间存在一对多关系时使用，例如，如果一个对象被修改，它的依赖对象将被自动通知。 观察者模式属于行为模式类别。</p> 
 <h2 id="h2-u5B9Eu73B0u5B9Eu4F8B"><a name="实现实例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实现实例</h2>
 <p>观察者模式使用三个操作类- <strong>Subject</strong>, <strong>Observer</strong> 和 <strong>Client</strong>。<code>Subject</code>是具有将观察者附加和分离到<code>Client</code>对象的方法的对象。创建了一个抽象类<code>Observer</code>和一个具体类<code>Subject</code>，它们都是扩展了 <code>Observer</code> 类。</p> 
 <p><strong>ObserverPatternDemo</strong>这是一个演示类，将使用 <code>Subject</code> 和具体类对象在操作中显示观察者模式。</p> 
 <p>观察者模式示例的结构如下图所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201612/09/143081255_38386.jpg" alt=""></p> 
 <h3 id="h3--1-"><a name="第1步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第1步</h3>
 <p>创建一个 <code>Subject</code> 类，如下代码所示 -<br><em>Subject.java</em></p> 
 <pre><code class="lang-java">import java.util.ArrayList;
import java.util.List;

public class Subject {

   private List&lt;Observer&gt; observers = new ArrayList&lt;Observer&gt;();
   private int state;

   public int getState() {
      return state;
   }

   public void setState(int state) {
      this.state = state;
      notifyAllObservers();
   }

   public void attach(Observer observer){
      observers.add(observer);        
   }

   public void notifyAllObservers(){
      for (Observer observer : observers) {
         observer.update();
      }
   }     
}
</code></pre> 
 <h3 id="h3--2-"><a name="第2步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第2步</h3>
 <p>创建一个 <code>Observer</code> 类，如下代码所示 -<br><em>Observer.java</em></p> 
 <pre><code class="lang-java">public abstract class Observer {
   protected Subject subject;
   public abstract void update();
}
</code></pre> 
 <h3 id="h3--3-"><a name="第3步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第3步</h3>
 <p>创建具体的观察者类，如下代码所示 -<br><em>BinaryObserver.java</em></p> 
 <pre><code class="lang-java">public class BinaryObserver extends Observer{

   public BinaryObserver(Subject subject){
      this.subject = subject;
      this.subject.attach(this);
   }

   @Override
   public void update() {
      System.out.println( "Binary String: " + Integer.toBinaryString( subject.getState() ) ); 
   }
}
</code></pre> 
 <p><em>OctalObserver.java</em></p>   
 <pre><code class="lang-java">public class OctalObserver extends Observer{

   public OctalObserver(Subject subject){
      this.subject = subject;
      this.subject.attach(this);
   }

   @Override
   public void update() {
     System.out.println( "Octal String: " + Integer.toOctalString( subject.getState() ) ); 
   }
}
</code></pre> 
 <p><em>HexaObserver.java</em></p> 
 <pre><code class="lang-java">public class HexaObserver extends Observer{

   public HexaObserver(Subject subject){
      this.subject = subject;
      this.subject.attach(this);
   }

   @Override
   public void update() {
      System.out.println( "Hex String: " + Integer.toHexString( subject.getState() ).toUpperCase() ); 
   }
}
</code></pre> 
 <h3 id="h3--4-"><a name="第4步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第4步</h3>
 <p>使用 <code>Subject</code> 和具体的观察者对象。<br><em>ObserverPatternDemo.java</em></p> 
 <pre><code class="lang-java">public class ObserverPatternDemo {
   public static void main(String[] args) {
      Subject subject = new Subject();

      new HexaObserver(subject);
      new OctalObserver(subject);
      new BinaryObserver(subject);

      System.out.println("First state change: 15");    
      subject.setState(15);
      System.out.println("Second state change: 10");    
      subject.setState(10);
   }
}
</code></pre> 
 <h3 id="h3--5-"><a name="第5步" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第5步</h3>
 <p>验证输出，执行上面的代码得到以下结果 -</p> 
 <pre><code class="lang-java">First state change: 15
Hex String: F
Octal String: 17
Binary String: 1111
Second state change: 10
Hex String: A
Octal String: 12
Binary String: 1010
</code></pre>
 <br>      
</div></body></html>
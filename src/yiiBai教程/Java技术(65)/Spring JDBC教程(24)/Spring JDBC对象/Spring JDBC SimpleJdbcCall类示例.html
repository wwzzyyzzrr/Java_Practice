<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring JDBC SimpleJdbcCall类示例</h1><div style="width:100%;float:left;" class="article-content">   
 <p><code>org.springframework.jdbc.core.SimpleJdbcCall</code>类是表示对存储过程或存储函数的调用的多线程，可重用的对象。 它提供元数据处理以简化访问基本存储过程/函数所需的代码。 所有需要提供的是程序/函数的名称和包含执行调用时参数的<code>Map</code>对象。 提供的参数的名称将与创建存储过程时声明的输入和输出参数相匹配。</p> 
 <p>使用到的 <code>Student</code> 表的结构如下 - </p> 
 <pre><code class="lang-sql">CREATE TABLE Student(
   ID   INT NOT NULL AUTO_INCREMENT,
   NAME VARCHAR(20) NOT NULL,
   AGE  INT NOT NULL,
   PRIMARY KEY (ID)
);
</code></pre> 
 <p><strong>类的声明</strong></p> 
 <p>以下是<code>org.springframework.jdbc.core.SimpleJdbcCall</code>接口的声明 -</p> 
 <pre><code class="lang-java">public class SimpleJdbcCall
   extends AbstractJdbcCall
      implements SimpleJdbcCallOperations
</code></pre> 
 <p>以下示例将演示如何使用Spring的<code>SimpleJdbcCall</code>对象调用存储过程。通过调用存储过程来读取<code>Student</code>表中的一条记录。传递一个学生编号作为参数并读取学生记录。</p> 
 <p><strong>语法</strong></p> 
 <pre><code class="lang-java">SimpleJdbcCall jdbcCall = new SimpleJdbcCall(dataSource).withProcedureName("getRecord");
SqlParameterSource in = new MapSqlParameterSource().addValue("in_id", id);
Map&lt;String, Object&gt; out = jdbcCall.execute(in);
Student student = new Student();
student.setId(id);
student.setName((String) out.get("out_name"));
student.setAge((Integer) out.get("out_age"));
</code></pre> 
 <p>在上代码中，</p> 
 <ul> 
  <li><em>jdbcCall</em> - <code>SimpleJdbcCall</code>对象来表示存储过程。</li>
  <li><em>in</em> - <code>SqlParameterSource</code>对象将参数传递给存储过程。</li>
  <li><em>student</em> - 学生(<code>Student</code>)对象。</li>
  <li><em>out</em> - <code>Map</code>对象来表示存储过程调用结果的输出。</li>
 </ul> 
 <h2 id="h2-u5B9Eu4F8Bu9879u76EE"><a name="实例项目" class="reference-link"></a><span class="header-link octicon octicon-link"></span>实例项目</h2>
 <p>要了解上述与Spring JDBC相关的概念，下面我们编写一个使用<code>SimpleJdbcCall</code>进行存储过程调用。打开Eclipse IDE，并按照以下步骤创建一个Spring应用程序，这里创建一个名称为：<strong>SimpleJdbcCall</strong> 的项目。</p> 
 <p><strong>步骤说明</strong></p> 
 <ol> 
  <li>参考第一个Spring JDBC项目来创建一个Maven项目 - <a target="_blank" href="http://www.yiibai.com/springjdbc/first_application.html">http://www.yiibai.com/springjdbc/first_application.html</a></li>
  <li>更新bean配置并运行应用程序。</li>
 </ol> 
 <p>完整的项目结构如下所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201706/1306/155140626_31621.png" alt=""></p> 
 <p>要了解如何调用数据库中的存储过程，请创建以下MySQL存储过程，该过程需要学生ID作为参数，并使用<code>OUT</code>参数返回相应的学生姓名和年龄。所以首先打开MySQL命令提示符，并在<code>test</code>数据库中创建一个存储过程 -</p> 
 <pre><code class="lang-sql">DELIMITER $$

DROP PROCEDURE IF EXISTS `TEST`.`getRecord` $$
CREATE PROCEDURE `TEST`.`getRecord` (
IN in_id INTEGER,
OUT out_name VARCHAR(20),
OUT out_age  INTEGER)
BEGIN
   SELECT name, age
   INTO out_name, out_age
   FROM Student where id = in_id;
END $$

DELIMITER ;
</code></pre> 
 <p>以下是Maven配置文件：<em>pom.xml</em>的代码内容：</p> 
 <pre><code class="lang-xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.yiibai&lt;/groupId&gt;
    &lt;artifactId&gt;SimpleJdbcCall&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;name&gt;SimpleJdbcCall&lt;/name&gt;
    &lt;url&gt;http://maven.apache.org&lt;/url&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;3.8.1&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;version&gt;5.1.40&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
            &lt;version&gt;4.1.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
            &lt;version&gt;4.1.4.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre> 
 <p>以下是数据访问对象接口文件：<em>StudentDAO.java</em>的内容：</p> 
 <pre><code class="lang-java">package com.yiibai;

import java.util.List;
import javax.sql.DataSource;

public interface StudentDAO {
    /**
     * This is the method to be used to initialize database resources ie.
     * connection.
     */
    public void setDataSource(DataSource ds);

    /**
     * This is the method to be used to create a record in the Student table.
     */
    public void create(String name, Integer age);

    /**
     * This is the method to be used to list down all the records from the
     * Student table.
     */
    public List&lt;Student&gt; listStudents();

    /**
     * This is the method to be used to list down a record from the Student
     * table corresponding to a passed student id.
     */
    public Student getStudent(Integer id);
}
</code></pre> 
 <p>以下是文件：<em>Student.java</em>的代码内容：</p> 
 <pre><code class="lang-java">package com.yiibai;

public class Student {
    private Integer age;
    private String name;
    private Integer id;

    public void setAge(Integer age) {
        this.age = age;
    }

    public Integer getAge() {
        return age;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public Integer getId() {
        return id;
    }
}
</code></pre> 
 <p>以下是文件：<em>StudentMapper.java</em>的代码内容：</p> 
 <pre><code class="lang-java">package com.yiibai;

import java.sql.ResultSet;
import java.sql.SQLException;
import org.springframework.jdbc.core.RowMapper;

public class StudentMapper implements RowMapper&lt;Student&gt; {
    public Student mapRow(ResultSet rs, int rowNum) throws SQLException {
        Student student = new Student();
        student.setId(rs.getInt("id"));
        student.setName(rs.getString("name"));
        student.setAge(rs.getInt("age"));
        return student;
    }
}
</code></pre> 
 <p>实现类<code>StudentJDBCTemplate.java</code>实现了定义的DAO接口 - <code>StudentDAO.java</code>，以下是文件：<em>StudentJDBCTemplate.java</em>的代码内容：</p> 
 <pre><code class="lang-java">package com.yiibai;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.sql.DataSource;

import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.namedparam.MapSqlParameterSource;
import org.springframework.jdbc.core.namedparam.SqlParameterSource;
import org.springframework.jdbc.core.simple.SimpleJdbcCall;
import org.springframework.jdbc.core.simple.SimpleJdbcInsert;

public class StudentJDBCTemplate implements StudentDAO {
    private DataSource dataSource;
    private JdbcTemplate jdbcTemplateObject;
    SimpleJdbcInsert jdbcInsert;

    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
        this.jdbcTemplateObject = new JdbcTemplate(dataSource);
        this.jdbcInsert = new SimpleJdbcInsert(dataSource).withTableName("Student");
    }

    public void create(String name, Integer age) {
        Map&lt;String, Object&gt; parameters = new HashMap&lt;String, Object&gt;();
        parameters.put("name", name);
        parameters.put("age", age);
        jdbcInsert.execute(parameters);
        System.out.println("Created Record Name = " + name + " Age = " + age);
        return;
    }

    public List&lt;Student&gt; listStudents() {
        String SQL = "select * from Student";
        List&lt;Student&gt; students = jdbcTemplateObject.query(SQL, new StudentMapper());
        return students;
    }

    public Student getStudent(Integer id) {
        SimpleJdbcCall jdbcCall = new SimpleJdbcCall(dataSource).withProcedureName("getRecord");

        SqlParameterSource in = new MapSqlParameterSource().addValue("in_id", id);
        Map&lt;String, Object&gt; out = jdbcCall.execute(in);

        Student student = new Student();
        student.setId(id);
        student.setName((String) out.get("out_name"));
        student.setAge((Integer) out.get("out_age"));
        return student;
    }
}
</code></pre> 
 <p>以下是文件：<em>MainApp.java</em>的代码内容：</p>   
 <pre><code class="lang-java">package com.yiibai;

import java.util.ArrayList;
import java.util.List;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import com.yiibai.StudentJDBCTemplate;

public class MainApp {
    public static void main(String[] args) {
        ApplicationContext context = new ClassPathXmlApplicationContext("application-beans.xml");

        StudentJDBCTemplate studentJDBCTemplate = (StudentJDBCTemplate) context.getBean("studentJDBCTemplate");

        System.out.println("------Records Creation--------");
        studentJDBCTemplate.create("Maxsu", 21);
        studentJDBCTemplate.create("Curry", 22);
        studentJDBCTemplate.create("Suzend", 23);

        System.out.println("------SimpleJdbcCall--------");
        Student student = studentJDBCTemplate.getStudent(1);

        System.out.print("ID : " + student.getId());
        System.out.print(", Name : " + student.getName());
        System.out.println(", Age : " + student.getAge());

        System.out.println("------Listing Multiple Records--------");
        List&lt;Student&gt; students = studentJDBCTemplate.listStudents();
        for (Student record : students) {
            System.out.print("ID : " + record.getId());
            System.out.print(", Name : " + record.getName());
            System.out.println(", Age : " + record.getAge());
        }
    }
}
</code></pre> 
 <p>以下是文件：<em>application-beans.xml</em>的代码内容：</p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd "&gt;

    &lt;!-- Initialization for data source --&gt;
    &lt;bean id="dataSource"
        class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;
        &lt;property name="driverClassName" value="com.mysql.jdbc.Driver" /&gt;
        &lt;property name="url" value="jdbc:mysql://localhost:3306/test?characterEncoding=utf8&amp;useSSL=true" /&gt;
        &lt;property name="username" value="root" /&gt;
        &lt;property name="password" value="123456" /&gt;
    &lt;/bean&gt;

    &lt;!-- Definition for studentJDBCTemplate bean --&gt;
    &lt;bean id="studentJDBCTemplate" class="com.yiibai.StudentJDBCTemplate"&gt;
        &lt;property name="dataSource" ref="dataSource" /&gt;
    &lt;/bean&gt;

&lt;/beans&gt;
</code></pre> 
 <blockquote> 
  <p>注意： <em>application-beans.xml</em> 文件的位置是：{workspace}/fistapp/src/main/java 目录，如果放置错了，程序可能会因为找不到此配置文件而出错。</p> 
 </blockquote> 
 <p>完成创建源代码和bean和数据库连接信息的文件配置后，运行应用程序。这里先简单说明一下运行的步骤，在项目名称(<strong>SimpleJdbcCall</strong>)上点击右键，在弹出的菜单中选择：【Run As】-&gt; 【Maven test】</p> 
 <p>在运行测试成功后，应该会输出类似以下内容(含有 <em> BUILD SUCCESS</em> 的信息) 。<br>接下来，点击类文件：<em>MainApp.java</em> 选择【Run As】-&gt;【Java Application】，如果应用程序一切正常，这将打印以下结果：</p> 
 <pre><code class="lang-shell">------Records Creation--------
Created Record Name = Maxsu Age = 21
Created Record Name = Curry Age = 22
Created Record Name = Suzend Age = 23
------SimpleJdbcCall--------
ID : 1, Name : Maxsu, Age : 21
------Listing Multiple Records--------
ID : 1, Name : Maxsu, Age : 21
ID : 2, Name : Curry, Age : 22
ID : 3, Name : Suzend, Age : 23
</code></pre>
 <br>      
</div></body></html>
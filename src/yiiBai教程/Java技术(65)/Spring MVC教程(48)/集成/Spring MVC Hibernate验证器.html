<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring MVC Hibernate验证器</h1><div style="width:100%;float:left;" class="article-content">   
 <p>下面的示例演示如何使用<strong>Spring Web MVC</strong>框架在表单中使用错误处理和验证器。 首先使用Eclipse IDE，并按照以下步骤使用<strong>Spring Web Framework</strong>开发基于动态表单的Web应用程序：</p> 
 <ol> 
  <li>创建一个名称为 <strong>HibernateValidator</strong> 的动态WEB项目。</li>
  <li>在 <code>com.yiibai.springmvc</code> 包下创建三个Java类：<code>Student</code>和<code>StudentController</code> 。</li>
  <li>在<code>jsp</code>子文件夹下创建两个视图文件：<code>addStudent.jsp</code>, <code>result.jsp</code>。</li>
  <li>下载Hibernate Validator库 - <a target="_blank" href="http://hibernate.org/validator/" title="Hibernate Validator">Hibernate Validator</a>。解压缩<code>hibernate-validator-5.3.4.Final.jar</code>和所需的依赖关系存并将它们放在<code>CLASSPATH</code>中。</li>
  <li>在<code>src</code>文件夹下创建属性文件<code>messages.properties</code>。</li>
  <li>最后一步是创建所有源和配置文件的内容并运行应用程序，详细如下所述。</li>
 </ol> 
 <p>完整的项目文件目录结构如下所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201701/2201/272150142_91486.png" alt=""></p> 
 <p><strong>Student.java</strong> 的代码如下所示 -</p> 
 <pre><code class="lang-java">package com.yiibai.springmvc;
import org.hibernate.validator.constraints.NotEmpty;
import org.hibernate.validator.constraints.Range;

public class Student {

   @Range(min = 1, max = 150) 
   private Integer age;
   @NotEmpty
   private String name;
   private Integer id;

   public void setAge(Integer age) {
      this.age = age;
   }
   public Integer getAge() {
      return age;
   }

   public void setName(String name) {
      this.name = name;
   }
   public String getName() {
      return name;
   }

   public void setId(Integer id) {
      this.id = id;
   }
   public Integer getId() {
      return id;
   }
}
</code></pre> 
 <p><strong>StudentController.java</strong> 的代码如下所示 -</p> 
 <pre><code class="lang-java">package com.yiibai.springmvc;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.ModelAndView;

@Controller
public class StudentController {

   @RequestMapping(value = "/addStudent", method = RequestMethod.GET)
   public ModelAndView student() {
      return new ModelAndView("addStudent", "command", new Student());
   }

   @ModelAttribute("student")
   public Student createStudentModel() {    
      return new Student();
   }

   @RequestMapping(value = "/addStudent", method = RequestMethod.POST)
   public String addStudent(@ModelAttribute("student") @Validated Student student, 
      BindingResult bindingResult, Model model) {
      if (bindingResult.hasErrors()) {
         return "addStudent";
      }
      model.addAttribute("name", student.getName());
      model.addAttribute("age", student.getAge());
      model.addAttribute("id", student.getId());

      return "result";
   }
}
</code></pre> 
 <p><strong>message.properties</strong> 配置如下所示 - </p> 
 <pre><code>NotEmpty.student.name = Name is required!
Range.student.age = Age value must be between 1 and 150!
</code></pre>
 <p>这里的键可以是<code>&lt;Annotation&gt;</code>.<code>&lt;object-name&gt;</code>.<code>&lt;attribute&gt;</code>。<code>Value</code>是要显示的消息。</p> 
 <p><strong>HibernateValidator-servlet.xml</strong> 配置如下所示 - </p> 
 <pre><code class="lang-xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
   xmlns:context="http://www.springframework.org/schema/context"
   xmlns:mvc="http://www.springframework.org/schema/mvc"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="
   http://www.springframework.org/schema/beans     
   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
   http://www.springframework.org/schema/context 
   http://www.springframework.org/schema/context/spring-context-3.0.xsd
   http://www.springframework.org/schema/mvc
   http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd"&gt;

   &lt;context:component-scan base-package="com.yiibai.springmvc" /&gt;
   &lt;mvc:annotation-driven /&gt;
   &lt;bean class="org.springframework.context.support.ResourceBundleMessageSource"
      id="messageSource"&gt;
      &lt;property name="basename" value="messages" /&gt;
   &lt;/bean&gt;
   &lt;bean class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
      &lt;property name="prefix" value="/WEB-INF/jsp/" /&gt;
      &lt;property name="suffix" value=".jsp" /&gt;      
   &lt;/bean&gt;
&lt;/beans&gt;
</code></pre> 
 <p>这里的第一个服务方法<code>student()</code>，已经在<code>ModelAndView</code>对象中传递了一个名称为“<code>command</code>”的空对象，因为如果在JSP文件中使用<code>&lt;form：form&gt;</code>标签，<strong>spring</strong>框架需要一个名称为“<code>command</code>”的对象。 所以当调用<code>student()</code>方法时，返回<code>addStudent.jsp</code>视图。</p> 
 <p>第二个服务方法<code>addStudent()</code>将在URL： <code>HibernateValidator/addStudent</code> 上的POST方法被调用。将根据提交的信息准备模型对象。 最后从服务方法返回“<code>result</code>”视图，这将渲染<code>result.jsp</code>。 如果使用<code>validator</code>生成错误，则返回相同的视图“<code>addStudent</code>”，则Spring自动从视图中的<code>BindingResult</code>注入错误消息并显示出来。</p> 
 <p><strong>addStudent.jsp</strong> 的代码如下所示 -</p>   
 <pre><code class="lang-html">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@taglib uri="http://www.springframework.org/tags/form" prefix="form"%&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Spring MVC Form Handling&lt;/title&gt;
&lt;/head&gt;
&lt;style&gt;
.error {
   color: #ff0000;
}

.errorblock {
   color: #000;
   background-color: #ffEEEE;
   border: 3px solid #ff0000;
   padding: 8px;
   margin: 16px;
}
&lt;/style&gt;
&lt;body&gt;

&lt;h2&gt;学生信息&lt;/h2&gt;
&lt;form:form method="POST" action="/HibernateValidator/addStudent" commandName="student"&gt;
   &lt;form:errors path="*" cssClass="errorblock" element="div" /&gt;
   &lt;table&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;form:label path="name"&gt;姓名：&lt;/form:label&gt;&lt;/td&gt;
        &lt;td&gt;&lt;form:input path="name" /&gt;&lt;/td&gt;
        &lt;td&gt;&lt;form:errors path="name" cssClass="error" /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;form:label path="age"&gt;年龄：&lt;/form:label&gt;&lt;/td&gt;
        &lt;td&gt;&lt;form:input path="age" /&gt;&lt;/td&gt;
        &lt;td&gt;&lt;form:errors path="age" cssClass="error" /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;form:label path="id"&gt;编号：&lt;/form:label&gt;&lt;/td&gt;
        &lt;td&gt;&lt;form:input path="id" /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td colspan="2"&gt;
            &lt;input type="submit" value="提交"/&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;  
&lt;/form:form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>上面的代码中使用了<code>&lt;form：errors /&gt;</code>标记，其中<code>path =“*”</code>来呈现错误消息。例如-</p> 
 <pre><code class="lang-java">&lt;form:errors path="*" cssClass="errorblock" element="div" /&gt;
</code></pre> 
 <p>它将呈现所有输入验证的错误消息。<br>使用带有<code>path =“name”</code>的<code>&lt;form：errors /&gt;</code>标记来渲染<code>name</code>字段的错误消息。例如 -</p> 
 <pre><code class="lang-java">&lt;form:errors path="name" cssClass="error" /&gt;
&lt;form:errors path="age" cssClass="error" /&gt;
</code></pre> 
 <p>它将呈现姓名(name)和年龄(age)字段验证的错误消息。</p> 
 <p><strong>result.jsp</strong> 的代码如下所示 -</p> 
 <pre><code class="lang-html">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@taglib uri="http://www.springframework.org/tags/form" prefix="form"%&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Spring MVC Form Handling&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h2&gt;提交的学生信息如下 -&lt;/h2&gt;
   &lt;table&gt;
    &lt;tr&gt;
        &lt;td&gt;姓名：&lt;/td&gt;
        &lt;td&gt;${name}&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;年龄：&lt;/td&gt;
        &lt;td&gt;${age}&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;编号：&lt;/td&gt;
        &lt;td&gt;${id}&lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;  
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>完成创建源和配置文件后，发布应用程序到Tomcat服务器。</p> 
 <p>现在启动Tomcat服务器，当访问URL =&gt; <a target="_blank" href="http://localhost:8080/HibernateValidator/addStudent">http://localhost:8080/HibernateValidator/addStudent</a> ， 如果<strong>Spring Web</strong>应用程序没有问题，应该看到以下结果：</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201701/2201/909150135_51383.png" alt=""></p>
 <br>      
</div></body></html>
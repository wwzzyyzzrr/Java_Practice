<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring MVC文件上传教程</h1><div style="width:100%;float:left;" class="article-content">   
 <h2> 1- 介绍</h2> 
 <div>
   这篇教程文章是基于 Spring MVC来实现文件的上传功能，这里主要是实现两个功能：1、上传单个文件并将其移动到对应的上传目录；2、一次上传多个文件并将它们存储在指定文件夹下，接下来我们一步步地实现。
 </div> 
 <h2> 2- 创建工程</h2> 
 <div> 
  <ul> 
   <li> File/New/Other..</li> 
  </ul> 
 </div> 
 <p> <img alt="" src="/uploads/tutorial/20160119/1-16011921513Y05.png"><br> <img alt="" src="/uploads/tutorial/20160119/1-160119215220912.png"></p> 
 <p> <img alt="" src="/uploads/tutorial/20160119/1-160119215300351.png"></p> 输入： 
 <div> 
  <ul> 
   <li> Group ID: com.yiibai</li> 
   <li> Artifact ID: SpringMVCFileUpload</li> 
   <li> Package: com.yiibai.springmvcfileupload</li> 
  </ul> 
 </div> 
 <img alt="" src="/uploads/tutorial/20160119/1-16011921533c15.png">
 <br> 这样，工程就被创建了，如下图所示： 
 <div>
   &nbsp;
 </div> 
 <div> 
  <img alt="" src="/uploads/tutorial/20160119/1-16011921541R96.png">
  <br> 不要担心项目被创建时有错误消息。原因是，你还没有声明的Servlet库。
 </div> 注意:
 <br> 
 <div>
   Eclipse&nbsp;4.4&nbsp;(Luna)&nbsp;创建&nbsp;Maven&nbsp;项目结构可能会有错误，需要修复它。
  <br> 
  <img alt="" src="/uploads/tutorial/20160119/1-160119215441401.png">
 </div> 
 <div>
   &nbsp;
 </div> 
 <h2> 3- 配置Maven</h2> 
 <div> 
  <ul> 
   <li> pom.xml</li> 
  </ul> 
 </div> 
 <div style="background-color:#E5EECC;"> 
  <div style="background-color:white !important;"> 
   <pre class="prettyprint lang-xml">
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
 
 
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.yiibai&lt;/groupId&gt;
    &lt;artifactId&gt;SpringMVCFileUpload&lt;/artifactId&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;SpringMVCFileUpload Maven Webapp&lt;/name&gt;
    &lt;url&gt;http://maven.apache.org&lt;/url&gt;
 
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;3.8.1&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
 
 
        &lt;!-- Servlet API --&gt;
        &lt;!-- http://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
            &lt;version&gt;3.1.0&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
 
        &lt;!-- Jstl for jsp page --&gt;
        &lt;!-- http://mvnrepository.com/artifact/javax.servlet/jstl --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;jstl&lt;/artifactId&gt;
            &lt;version&gt;1.2&lt;/version&gt;
        &lt;/dependency&gt;
 
 
        &lt;!-- JSP API --&gt;
        &lt;!-- http://mvnrepository.com/artifact/javax.servlet.jsp/jsp-api --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;
            &lt;artifactId&gt;jsp-api&lt;/artifactId&gt;
            &lt;version&gt;2.2&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
 
 
        &lt;!-- Spring dependencies --&gt;
        &lt;!-- http://mvnrepository.com/artifact/org.springframework/spring-core --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-core&lt;/artifactId&gt;
            &lt;version&gt;4.1.4.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
 
        &lt;!-- http://mvnrepository.com/artifact/org.springframework/spring-web --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-web&lt;/artifactId&gt;
            &lt;version&gt;4.1.4.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
 
        &lt;!-- http://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
            &lt;version&gt;4.1.4.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
 
 
        &lt;!-- Apache Commons FileUpload --&gt;
        &lt;!-- http://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
            &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
            &lt;version&gt;1.3.1&lt;/version&gt;
        &lt;/dependency&gt;
 
        &lt;!-- Apache Commons IO --&gt;
        &lt;!-- http://mvnrepository.com/artifact/commons-io/commons-io --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;commons-io&lt;/groupId&gt;
            &lt;artifactId&gt;commons-io&lt;/artifactId&gt;
            &lt;version&gt;2.4&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;finalName&gt;SpringMVCFileUpload&lt;/finalName&gt;
        &lt;plugins&gt;
 
            &lt;!-- Config: Maven Tomcat Plugin --&gt;
            &lt;!-- http://mvnrepository.com/artifact/org.apache.tomcat.maven/tomcat7-maven-plugin --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt;
                &lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.2&lt;/version&gt;
                 
                &lt;!-- Config: contextPath and Port (Default - /SpringMVCFileUpload : 8080) --&gt;
                 
                &lt;!--
                &lt;configuration&gt;
                    &lt;path&gt;/&lt;/path&gt;
                    &lt;port&gt;8899&lt;/port&gt;
                &lt;/configuration&gt;
                --&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
     
&lt;/project&gt;</pre> 
  </div> 
 </div> 
 <h2> 4- 配置Spring</h2> 
 <div>
   &nbsp;
 </div> 
 <img alt="" src="/uploads/tutorial/20160119/1-160119215G2309.png">
 <br> 配置&nbsp;web.xml.
 <br> 
 <div>
   SpringContextListener 将读取参数 contextConfigLocation 在配置文件：
 </div> 
 <div> 
  <ul> 
   <li> WEB-INF/web.xml</li> 
  </ul> 
 </div> 
 <div style="background-color:#E5EECC;"> 
  <div style="background-color:white !important;"> 
   <pre class="prettyprint lang-xml">
&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
         http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
   version="3.0"&gt;
 
   &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
   &lt;servlet&gt;
       &lt;servlet-name&gt;spring-mvc&lt;/servlet-name&gt;
       &lt;servlet-class&gt;
           org.springframework.web.servlet.DispatcherServlet
       &lt;/servlet-class&gt;
       &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
   &lt;/servlet&gt;
 
   &lt;servlet-mapping&gt;
       &lt;servlet-name&gt;spring-mvc&lt;/servlet-name&gt;
       &lt;url-pattern&gt;/&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;
 
   &lt;!-- Other XML Configuration --&gt;
   &lt;!-- Load by Spring ContextLoaderListener --&gt;
   &lt;context-param&gt;
       &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
       &lt;param-value&gt;
          /WEB-INF/root-context.xml
        &lt;/param-value&gt;        
   &lt;/context-param&gt;
 
 
   &lt;!-- Spring ContextLoaderListener --&gt;
   &lt;listener&gt;
       &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
   &lt;/listener&gt;
 
&lt;/web-app&gt;</pre> 
  </div> 
 </div> 
 <div>
   配置&nbsp;Spring MVC:
 </div> 
 <div> 
  <ul> 
   <li> WEB-INF/spring-mvc-servlet.xml</li> 
  </ul> 
 </div> 
 <div style="background-color:#E5EECC;"> 
  <div style="background-color:white !important;"> 
   <pre class="prettyprint lang-xml">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xmlns:p="http://www.springframework.org/schema/p"
   xmlns:context="http://www.springframework.org/schema/context"
   xmlns:mvc="http://www.springframework.org/schema/mvc"
   xsi:schemaLocation="http://www.springframework.org/schema/beans
     http://www.springframework.org/schema/beans/spring-beans-4.1.xsd  
     http://www.springframework.org/schema/context
     http://www.springframework.org/schema/context/spring-context-4.1.xsd  
     http://www.springframework.org/schema/mvc
     http://www.springframework.org/schema/mvc/spring-mvc-4.1.xsd"&gt;
 
   &lt;!-- Package Scan --&gt;
   &lt;context:component-scan base-package="com.yiibai.springmvcfileupload" /&gt;
    
   &lt;!-- Enables the Spring MVC Annotation Configuration --&gt;
   &lt;context:annotation-config /&gt;
   &lt;bean
       class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
 
       &lt;property name="prefix"&gt;
           &lt;value&gt;/WEB-INF/pages/&lt;/value&gt;
       &lt;/property&gt;
 
       &lt;property name="suffix"&gt;
           &lt;value&gt;.jsp&lt;/value&gt;
       &lt;/property&gt;
   &lt;/bean&gt;
    
   &lt;bean id="multipartResolver"
       class="org.springframework.web.multipart.commons.CommonsMultipartResolver"&gt;
 
        &lt;!-- Maximum file size: 1MB --&gt;
        &lt;!-- 1MB = 125000 Byte --&gt;
       &lt;property name="maxUploadSize" value="125000" /&gt;
   &lt;/bean&gt;
 
&lt;/beans&gt;</pre> 
  </div> 
 </div> 
 <div style="background-color:inherit;"> 
  <ul style="background-color:inherit;"> 
   <li style="background-color:inherit;"> <strong>WEB-INF/root-context.xml</strong></li> 
  </ul> 
 </div> 
 <div style="background-color:#E5EECC;"> 
  <div style="background-color:white !important;"> 
   <pre class="prettyprint lang-xml">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;
 
   &lt;!-- Empty --&gt;
 
&lt;/beans&gt;</pre> 
  </div> 
 </div> 
 <h1 style="background-color:inherit;font-size:25px;font-weight:lighter;"> 5- Java类</h1> 
 <div style="background-color:inherit;"> 
  <ul style="background-color:inherit;"> 
   <li style="background-color:inherit;"> <strong>MyFileUploadController.java</strong></li> 
  </ul> 
 </div> 
 <div style="background-color:#E1EAED;"> 
  <div style="background-color:white !important;"> 
   <pre class="prettyprint lang-java">
package com.yiibai.springmvcfileupload;
 
import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.util.ArrayList;
import java.util.List;
 
import javax.servlet.http.HttpServletRequest;
 
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.multipart.MultipartFile;
 
@Controller
public class MyFileUploadController {
 
    // Upload One File.
    @RequestMapping(value = "/uploadOneFile")
    public String uploadOneFileHandler() {
        // Forward to "/WEB-INF/pages/uploadOneFile.jsp".
        return "uploadOneFile";
    }
 
    // Upload Multi File.
    @RequestMapping(value = "/uploadMultiFile")
    public String uploadMultiFileHandler() {
        // Forward to "/WEB-INF/pages/uploadMultiFile.jsp".
        return "uploadMultiFile";
    }
 
    // uploadOneFile.jsp, uploadMultiFile.jsp submit to.
    @RequestMapping(value = "/doUpload", method = RequestMethod.POST)
    public String uploadFileHandler(HttpServletRequest request, Model model,
            @RequestParam("file") MultipartFile[] files) {
 
        // Root Directory.
        String uploadRootPath = request.getServletContext().getRealPath(
                "upload");
        System.out.println("uploadRootPath=" + uploadRootPath);
 
        File uploadRootDir = new File(uploadRootPath);
        //
        // Create directory if it not exists.
        if (!uploadRootDir.exists()) {
            uploadRootDir.mkdirs();
        }
        //
        List&lt;File&gt; uploadedFiles = new ArrayList&lt;File&gt;();
        for (int i = 0; i &lt; files.length; i++) {
            MultipartFile file = files[i];
 
            // Client File Name
            String name = file.getOriginalFilename();
            System.out.println("Client File Name = " + name);
 
            if (name != null &amp;&amp; name.length() &gt; 0) {
                try {
                    byte[] bytes = file.getBytes();
 
                    // Create the file on server
                    File serverFile = new File(uploadRootDir.getAbsolutePath()
                            + File.separator + name);
 
                    // Stream to write data to file in server.
                    BufferedOutputStream stream = new BufferedOutputStream(
                            new FileOutputStream(serverFile));
                    stream.write(bytes);
                    stream.close();
                    //
                    uploadedFiles.add(serverFile);
                    System.out.println("Write file: " + serverFile);
                } catch (Exception e) {
                    System.out.println("Error Write file: " + name);
                }
            }
        }
        model.addAttribute("uploadedFiles", uploadedFiles);
        return "uploadResult";
    }
 
}</pre> 
  </div> 
 </div> 
 <h1> 6- 视图(JSP)</h1> 
 <div> 
  <ul> 
   <li> uploadOneFile.jsp</li> 
  </ul> 
 </div> 
 <div style="background-color:#FFFFCC;"> 
  <div style="background-color:white !important;">   
   <pre class="prettyprint lang-html">
&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;Upload One File&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
 
    &lt;h3&gt;Upload One File:&lt;/h3&gt;
 
    &lt;form method="POST" action="doUpload" enctype="multipart/form-data"&gt;
        File to upload: &lt;input type="file" name="file"&gt;&lt;br /&gt;       
        &lt;input type="submit" value="Upload"&gt;
    &lt;/form&gt;
     
&lt;/body&gt;
&lt;/html&gt;</pre> 
  </div> 
 </div> 
 <div style="background-color:inherit;"> 
  <ul style="background-color:inherit;"> 
   <li style="background-color:inherit;"> <strong>uploadMultiFile.jsp</strong></li> 
  </ul> 
 </div> 
 <div style="background-color:#FFFFCC;"> 
  <div style="background-color:white !important;"> 
   <pre class="prettyprint lang-html">
&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;Upload Multi File&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
 
   &lt;h3&gt;Upload Multiple File:&lt;/h3&gt;
    
    &lt;form method="POST" action="doUpload" enctype="multipart/form-data"&gt;
 
        File to upload (1): &lt;input type="file" name="file"&gt;&lt;br /&gt;      
        File to upload (2): &lt;input type="file" name="file"&gt;&lt;br /&gt;  
        File to upload (3): &lt;input type="file" name="file"&gt;&lt;br /&gt;  
        File to upload (4): &lt;input type="file" name="file"&gt;&lt;br /&gt;  
        File to upload (5): &lt;input type="file" name="file"&gt;&lt;br /&gt;   
         
        &lt;input type="submit" value="Upload"&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</pre> 
  </div> 
 </div> 
 <div style="background-color:inherit;"> 
  <ul style="background-color:inherit;"> 
   <li style="background-color:inherit;"> <strong>uploadResult.jsp</strong></li> 
  </ul> 
 </div> 
 <div style="background-color:#FFFFCC;"> 
  <div style="background-color:white !important;"> 
   <pre class="prettyprint lang-html">
&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
 
&lt;%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%&gt;
     
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;Upload Result&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
   &lt;h3&gt;Uploaded Files:&lt;/h3&gt;
  
    &lt;c:forEach items="${uploadedFiles}" var="file"&gt;
           - ${file} &lt;br&gt;
    &lt;/c:forEach&gt;
 
&lt;/body&gt;
&lt;/html&gt;</pre> 
  </div> 
 </div> 
 <h2> 7- 运行应用程序</h2> 
 <div>
   首先，运行应用程序之前，你需要构建整个项目。
 </div> 
 <div>
   右键单击该项目并选择：
  <br> 
  <img alt="" src="/uploads/tutorial/20160119/1-160119221406238.png">
  <br> 
  <img alt="" src="/uploads/tutorial/20160119/1-160119221439208.png">
 </div> 
 <div>
   &nbsp;
 </div> 
 <div>
   运行配置：
 </div> 
 <div>
   &nbsp;
 </div> 
 <div> 
  <img alt="" src="/uploads/tutorial/20160119/1-16011922150DQ.png">
  <br> 输入：
 </div> 
 <div> 
  <ul> 
   <li> Name:&nbsp;Run SpringMVCFileUpload</li> 
   <li> Base directory:&nbsp;${workspace_loc:/SpringMVCFileUpload}</li> 
   <li> Goals:&nbsp;tomcat7:run</li> 
  </ul> 
 </div> 
 <img alt="" src="/uploads/tutorial/20160119/1-1601192215251C.png">
 <br> 
 <img alt="" src="/uploads/tutorial/20160119/1-160119221613925.png">
 <br> 
 <img alt="" src="/uploads/tutorial/20160119/1-160119221643132.png">
 <br> 
 <br> 点击运行(Run)： 
 <div> 
  <ul> 
   <li> <a target="_blank" href="http://localhost:8080/SpringMVCFileUpload/uploadOneFile">http://localhost:8080/SpringMVCFileUpload/uploadOneFile</a><br> <img alt="" src="/uploads/tutorial/20160119/1-160119221F5912.png"><br> <img alt="" src="/uploads/tutorial/20160119/1-160119221I22T.png"><br> <img alt="" src="/uploads/tutorial/20160119/1-160119221K42Y.png"></li> 
  </ul> 
 </div> 
 <div> 
  <ul> 
   <li> <a target="_blank" href="http://localhost:8080/SpringMVCFileUpload/uploadMultiFile">http://localhost:8080/SpringMVCFileUpload/uploadMultiFile</a><br> <img alt="" src="/uploads/tutorial/20160119/1-160119221Q6151.png"><br> <img alt="" src="/uploads/tutorial/20160119/1-160119221S5195.png"></li> 
  </ul> 
 </div> 到此整个教程讲解完成！代码下载地址：
 <a target="_blank" href="http://pan.baidu.com/s/1eQQQP3c">http://pan.baidu.com/s/1eQQQP3c</a>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring4 MVC ContentNegotiatingViewResolver多种输出格式实例</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    本文演示支持多种输出格式，这里 Spring4&nbsp;MVC应用程序使用了&nbsp;Spring&nbsp;
   <a target="_blank" href="http://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/view/ContentNegotiatingViewResolver.html">ContentNegotiatingViewResolver</a>&nbsp;。我们将生成应用程序输出XML，JSON，PDF，XLS和HTML格式，全部采用基于注解配置的。 
  </div> 
 </div> 
 <div> 
  <p> ContentNegotiatingViewResolver是 ViewResolver 使用所请求的媒体类型的一个实现(基于文件类型扩展，输出格式URL参数指定类型或接受报头)来选择一个合适的视图一个请求。ContentNegotiatingViewResolver本身并不解决视图，只不表示为其他的 ViewResolver，您可以配置来处理特定的视图(XML，JSON，PDF，XLS，HTML，..)。 </p> 
  <p> 这里需要使用到以下技术： </p> 
  <ul> 
   <li> Spring 4.0.6.RELEASE </li> 
   <li> jackson-databind 2.4.1.3 </li> 
   <li> jackson-annotations 2.4.1 </li> 
   <li> lowagie itext 4.2.1 </li> 
   <li> Apache POI 3.10-beta2 </li> 
   <li> Maven 3 </li> 
   <li> JDK 1.6 </li> 
   <li> Tomcat 7.0.54 </li> 
   <li> Eclipse JUNO Service Release 2 </li> 
  </ul> 
  <p> 我们现在就开始！ </p> 
  <h4> 
   <div>
     第1步：创建目录结构 
   </div> </h4> 
  <div>
    以下将是本实例的最终目录结构： 
  </div> 
  <p> <img src="/uploads/tutorial/20160115/1-1601151K40H36.jpg" alt=""> </p> 
  <div>
    我们将使用Spring&nbsp;Java配置(注释)。现在，让我们来添加/更新上述项目结构中提到的内容。 
  </div> 
  <h4> 
   <div>
     第2步：用所需的依赖更新 pom.xml 
   </div> </h4> 
  <pre>&lt;?xml version="1.0"?&gt;
&lt;project
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"
	xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;

	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;groupId&gt;com.yiibai.springmvc&lt;/groupId&gt;
	&lt;artifactId&gt;<span style="font-family:Monaco, Consolas, Courier, 'Lucida Console', monospace;line-height:1.6;">ContentNegotiatingViewResolver</span><span style="font-family:Monaco, Consolas, Courier, 'Lucida Console', monospace;line-height:1.6;">&lt;/artifactId&gt;</span> &lt;packaging&gt;war&lt;/packaging&gt;
	&lt;version&gt;1.0.0&lt;/version&gt;
	&lt;name&gt;Spring4MVCContentNegotiatingViewResolverExample&lt;/name&gt;

	&lt;properties&gt;
		&lt;springframework.version&gt;4.0.6.RELEASE&lt;/springframework.version&gt;
	&lt;/properties&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-core&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-web&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;!-- Needed for XML View (with JAXB2) --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-oxm&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;!-- Needed for JSON View --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
			&lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
			&lt;version&gt;2.4.1.3&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
			&lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;
			&lt;version&gt;2.4.1&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;!-- Needed for PDF View --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;com.lowagie&lt;/groupId&gt;
			&lt;artifactId&gt;itext&lt;/artifactId&gt;
			&lt;version&gt;4.2.1&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;!-- Needed for XLS View --&gt;		
		&lt;dependency&gt;
			&lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
			&lt;artifactId&gt;poi&lt;/artifactId&gt;
			&lt;version&gt;3.10-beta2&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;!-- Servlet dependencies --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
			&lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
			&lt;version&gt;3.1.0&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
		    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
		    &lt;artifactId&gt;jstl&lt;/artifactId&gt;
		    &lt;version&gt;1.2&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;
			&lt;artifactId&gt;javax.servlet.jsp-api&lt;/artifactId&gt;
			&lt;version&gt;2.3.1&lt;/version&gt;
		&lt;/dependency&gt;

	&lt;/dependencies&gt;


	&lt;build&gt;
		&lt;pluginManagement&gt;
			&lt;plugins&gt;
				&lt;plugin&gt;
					&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
					&lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
					&lt;version&gt;2.4&lt;/version&gt;
					&lt;configuration&gt;
						&lt;warSourceDirectory&gt;src/main/webapp&lt;/warSourceDirectory&gt;
						&lt;warName&gt;<span style="font-family:Monaco, Consolas, Courier, 'Lucida Console', monospace;line-height:1.6;">ContentNegotiatingViewResolver</span><span style="font-family:Monaco, Consolas, Courier, 'Lucida Console', monospace;line-height:1.6;">&lt;/warName&gt;</span> &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;
					&lt;/configuration&gt;
				&lt;/plugin&gt;
			&lt;/plugins&gt;
		&lt;/pluginManagement&gt;

		&lt;finalName&gt;<span style="font-family:Monaco, Consolas, Courier, 'Lucida Console', monospace;line-height:1.6;">ContentNegotiatingViewResolver</span><span style="font-family:Monaco, Consolas, Courier, 'Lucida Console', monospace;line-height:1.6;">&lt;/finalName&gt;</span> &lt;/build&gt;
&lt;/project&gt;
&nbsp;</pre> 
  <p style="color:#404040;font-size:15px;"> <span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">上面解析 PDF 的依赖库有点问题，可修改为以下测试构建就没有问题：</span> </p> 
  <p style="color:#404040;font-size:15px;"> <span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;"> </span> </p> 
  <pre class="prettyprint lang-xml"> &lt;dependency&gt;
             &lt;groupId&gt;com.lowagie&lt;/groupId&gt;
          &lt;artifactId&gt;itext&lt;/artifactId&gt;
          &lt;version&gt;2.1.7&lt;/version&gt;
          &lt;scope&gt;compile&lt;/scope&gt;
        &lt;/dependency&gt;</pre> 
  <p> spring-oxm是为了支持XML输出生成(使用JAXB2)。&nbsp;jackson-databind&nbsp;&amp;jackson-annotations&nbsp;提供JSON输出支持。iText的提供PDF生成库，支持PDF输出。&nbsp;Apache&nbsp;POI将有助于产生XLS输出格式。 </p> 
  <h4> 
   <div>
     第3步：创建Spring配置文件类 
   </div> </h4> 
  <p> com.yiibai.springmvc.configuration.AppConfig </p> 
  <pre>package com.yiibai.springmvc.configuration;

import java.util.ArrayList;
import java.util.List;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.MediaType;
import org.springframework.oxm.jaxb.Jaxb2Marshaller;
import org.springframework.web.accept.ContentNegotiationManager;
import org.springframework.web.servlet.ViewResolver;
import org.springframework.web.servlet.config.annotation.ContentNegotiationConfigurer;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;
import org.springframework.web.servlet.view.ContentNegotiatingViewResolver;
import org.springframework.web.servlet.view.InternalResourceViewResolver;
import org.springframework.web.servlet.view.JstlView;

import com.yiibai.springmvc.model.Pizza;
import com.yiibai.springmvc.viewresolver.ExcelViewResolver;
import com.yiibai.springmvc.viewresolver.JsonViewResolver;
import com.yiibai.springmvc.viewresolver.Jaxb2MarshallingXmlViewResolver;
import com.yiibai.springmvc.viewresolver.PdfViewResolver;

@Configuration
@EnableWebMvc
@ComponentScan(basePackages = "com.yiibai.springmvc")
public class AppConfig extends WebMvcConfigurerAdapter {

	/*
	 * Configure ContentNegotiationManager
	 */
	@Override
	public void configureContentNegotiation(ContentNegotiationConfigurer configurer) {
		configurer.ignoreAcceptHeader(true).defaultContentType(
				MediaType.TEXT_HTML);
	}

	/*
	 * Configure ContentNegotiatingViewResolver
	 */
	@Bean
	public ViewResolver contentNegotiatingViewResolver(ContentNegotiationManager manager) {
		ContentNegotiatingViewResolver resolver = new ContentNegotiatingViewResolver();
		resolver.setContentNegotiationManager(manager);

		// Define all possible view resolvers
		List&lt;ViewResolver&gt; resolvers = new ArrayList&lt;ViewResolver&gt;();

		resolvers.add(jaxb2MarshallingXmlViewResolver());
		resolvers.add(jsonViewResolver());
		resolvers.add(jspViewResolver());
		resolvers.add(pdfViewResolver());
		resolvers.add(excelViewResolver());
		
		resolver.setViewResolvers(resolvers);
		return resolver;
	}

	/*
	 * Configure View resolver to provide XML output Uses JAXB2 marshaller to
	 * marshall/unmarshall POJO's (with JAXB annotations) to XML
	 */
	@Bean
	public ViewResolver jaxb2MarshallingXmlViewResolver() {
		Jaxb2Marshaller marshaller = new Jaxb2Marshaller();
		marshaller.setClassesToBeBound(Pizza.class);
		return new Jaxb2MarshallingXmlViewResolver(marshaller);
	}

	/*
	 * Configure View resolver to provide JSON output using JACKSON library to
	 * convert object in JSON format.
	 */
	@Bean
	public ViewResolver jsonViewResolver() {
		return new JsonViewResolver();
	}

	/*
	 * Configure View resolver to provide PDF output using lowagie pdf library to
	 * generate PDF output for an object content
	 */
	@Bean
	public ViewResolver pdfViewResolver() {
		return new PdfViewResolver();
	}

	/*
	 * Configure View resolver to provide XLS output using Apache POI library to
	 * generate XLS output for an object content
	 */
	@Bean
	public ViewResolver excelViewResolver() {
		return new ExcelViewResolver();
	}

	/*
	 * Configure View resolver to provide HTML output This is the default format
	 * in absence of any type suffix.
	 */
	@Bean
	public ViewResolver jspViewResolver() {
		InternalResourceViewResolver viewResolver = new InternalResourceViewResolver();
		viewResolver.setViewClass(JstlView.class);
		viewResolver.setPrefix("/WEB-INF/views/");
		viewResolver.setSuffix(".jsp");
		return viewResolver;
	}

}</pre> 
  <div>
    让我们来讨论说明上面的类的详细信息： 
  </div> 
  <p> 第一步是建立它用于通过委托给ContentNegotiationManager，以确定所请求的媒体类型的请求是&nbsp;ContentNegotiationStrategy&nbsp;列表的一个实例。默认情况下PathExtensionContentNegotiationStrategy被查询(使用URL扩展名，例如. .xls, .pdf,.json.)，接着ParameterContentNegotiationStrategy(使用请求参数&nbsp;‘format=xls’，例如)，其次是HeaderContentNegotiationStrategy(使用HTTP接受头)。 </p> 
  <pre>	public void configureContentNegotiation(ContentNegotiationConfigurer configurer) {
		configurer.ignoreAcceptHeader(true).defaultContentType(
				MediaType.TEXT_HTML);
	}
&nbsp;</pre> 
  <p> 在我们的例子中，我们将使用URL扩展名来帮助确定媒体类型。此外，我们还设置默认介质类型TEXT_HTML在没有文件扩展名或当文件类型是未知时，这意味着JSP视图解析器将被用于在没有[known]&nbsp;URL扩展中。 </p> 
  <div>
    下面是 pizza.jsp 默认使用JSP视图解析器内容 
  </div> 
  <pre>&lt;%@ page language="java" contentType="text/html; charset=utf-8"  pageEncoding="utf-8"%&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
	&lt;title&gt;Pizza JSP View&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;table border="1"&gt;
		&lt;tr&gt;
		&lt;td&gt;NAME&lt;/td&gt;
		&lt;td&gt;Flavor&lt;/td&gt;
		&lt;td&gt;Toppings&lt;/td&gt;
		&lt;/tr&gt;
		&lt;tr&gt;
			&lt;td&gt;${pizza.name}&lt;/td&gt;
			&lt;td&gt;${pizza.flavor}&lt;/td&gt;
			&lt;td&gt;
				&lt;c:forEach var="item" items="${pizza.toppings}"&gt;
					&lt;c:out value="${item}"/&gt;&amp;nbsp; 
				&lt;/c:forEach&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
	&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;</pre> 
  <div>
    下一步是配置 ContentNegotaionViewResolver 本身， 
  </div> 
  <pre>	public ViewResolver contentNegotiatingViewResolver(ContentNegotiationManager manager) {
		ContentNegotiatingViewResolver resolver = new ContentNegotiatingViewResolver();
		resolver.setContentNegotiationManager(manager);

		// Define all possible view resolvers
		List&lt;ViewResolver&gt; resolvers = new ArrayList&lt;ViewResolver&gt;();

		resolvers.add(jaxb2MarshallingXmlViewResolver());
		resolvers.add(jsonViewResolver());
		resolvers.add(jspViewResolver());
		resolvers.add(pdfViewResolver());
		resolvers.add(excelViewResolver());
		
		resolver.setViewResolvers(resolvers);
		return resolver;
	}</pre> 
  <div>
    我们需要设置 ContentNegotiationManager由Spring 注入，和为每一个应用程序可能会产生输出格式设置不同的解析器，。 
  </div> 
  <div>
    最后，我们已经创建了不同的视图解析器以对 XML，JSON，PDF，XLS 和 HTML 输出，我们将在节中讨论。 
  </div> 
  <h4> 
   <div>
     第4步：创建不同的视图解析器 
   </div> </h4> 
  <div>
    现在，让我们创建塔实际视图解析器 
  </div> 
  <p> XML View Resolver: </p> 
  <div>
    这个视图解析器依赖于JAXB2编组/解组产生XML输出。domain类需要和JAXB2注释进行注释。 
  </div> 
  <p> com.yiibai.springmvc.viewresolver.Jaxb2MarshallingXmlViewResolver </p> 
  <pre>package com.yiiibai.springmvc.viewresolver;

import java.util.Locale;

import org.springframework.oxm.Marshaller;
import org.springframework.web.servlet.View;
import org.springframework.web.servlet.ViewResolver;
import org.springframework.web.servlet.view.xml.MarshallingView;

public class Jaxb2MarshallingXmlViewResolver implements ViewResolver {

	private Marshaller marshaller;

    
    public Jaxb2MarshallingXmlViewResolver(Marshaller marshaller) {
        this.marshaller = marshaller;
    }
    
    
    @Override
    public View resolveViewName(String viewName, Locale locale) throws Exception {
        MarshallingView view = new MarshallingView();
        view.setMarshaller(marshaller);
        return view;
    }

}</pre> 
  <div>
    下面是域对象(标注了标准的XML注释)在我们的例子： 
  </div> 
  <p> com.yiibai.springmvc.model.Pizza </p> 
  <pre>package com.yiibai.springmvc.model;

import java.util.ArrayList;
import java.util.List;

import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlRootElement;

@XmlRootElement(name = "pizza")
public class Pizza {
	
	private String name;
	
	private String flavor;
	
	private List&lt;String&gt; toppings = new ArrayList&lt;String&gt;();
	
	public Pizza(){
		
	}
	
	public Pizza(String name){
		this.name = name;
		this.flavor = "spicy";
		this.toppings.add("Cheese");
		this.toppings.add("bakon");
	}
	
	@XmlElement
	public void setName(String name) {
		this.name = name;
	}

	public String getName() {
		return name;
	}

	@XmlElement
	public void setFlavor(String flavor) {
		this.flavor = flavor;
	}

	public String getFlavor() {
		return flavor;
	}

	public List&lt;String&gt; getToppings() {
		return toppings;
	}
	
	@XmlElement
	public void setToppings(List&lt;String&gt; toppings) {
		this.toppings = toppings;
	}
	
}</pre> 
  <p> JSON View Resolver: </p> 
  <div>
    这个视图解析器是使用 Spring&nbsp;MappingJackson2JsonView 为了将 POJO 对象转换成 JSON 视图。 
  </div> 
  <p> com.yiibai.springmvc.viewresolver.JsonViewResolver </p>   
  <pre>package com.yiibai.springmvc.viewresolver;

import java.util.Locale;

import org.springframework.web.servlet.View;
import org.springframework.web.servlet.ViewResolver;
import org.springframework.web.servlet.view.json.MappingJackson2JsonView;

public class JsonViewResolver implements ViewResolver{

	@Override
	public View resolveViewName(String viewName, Locale locale) throws Exception {
		MappingJackson2JsonView view = new MappingJackson2JsonView();
        view.setPrettyPrint(true);       
        return view;
      }

}</pre> 
  <p> PDF View Resolver: </p> 
  <div>
    这个视图解析器使用lowagie&nbsp;iText库实际生成PDF输出。还要注意的是实际的视图，从Spring&nbsp;AbstractPdfView&nbsp;内部使用&nbsp;lowagie&nbsp;iText&nbsp;库扩展。 
  </div> 
  <p> com.yiibai.springmvc.viewresolver.PdfView </p> 
  <pre>package com.yiibai.springmvc.viewresolver;

import java.awt.Color;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.web.servlet.view.document.AbstractPdfView;

import com.lowagie.text.Document;
import com.lowagie.text.Element;
import com.lowagie.text.pdf.PdfPTable;
import com.lowagie.text.pdf.PdfWriter;
import com.yiibai.springmvc.model.Pizza;

public class PdfView extends AbstractPdfView {

	@Override
	protected void buildPdfDocument(Map&lt;String, Object&gt; model,
			Document document, PdfWriter writer, HttpServletRequest request,
			HttpServletResponse response) throws Exception {

		Pizza pizza = (Pizza) model.get("pizza");

		PdfPTable table = new PdfPTable(3);
		table.getDefaultCell().setHorizontalAlignment(Element.ALIGN_CENTER);
		table.getDefaultCell().setVerticalAlignment(Element.ALIGN_MIDDLE);
		table.getDefaultCell().setBackgroundColor(Color.lightGray);

		table.addCell("Name");
		table.addCell("Flavor");
		table.addCell("Toppings");

		table.addCell(pizza.getName());
		table.addCell(pizza.getFlavor());

		StringBuffer toppings = new StringBuffer("");
		for (String topping : pizza.getToppings()) {
			toppings.append(topping);
			toppings.append(" ");
		}
		table.addCell(toppings.toString());
		document.add(table);

	}

}</pre> 
  <p> com.yiibai.springmvc.viewresolver.PdfViewResolver类代码： </p> 
  <pre>package com.yiibai.springmvc.viewresolver;

import java.util.Locale;

import org.springframework.web.servlet.View;
import org.springframework.web.servlet.ViewResolver;

public class PdfViewResolver implements ViewResolver{

	@Override
	public View resolveViewName(String viewName, Locale locale) throws Exception {
		PdfView view = new PdfView();
		return view;
      }
	
}</pre> 
  <p> XLS View Resolver: </p> 
  <div>
    这个视图解析器是使用Apache&nbsp;POI库实际生成&nbsp;Microsoft&nbsp;XLS输出。还要注意的是实际的视图，从Spring&nbsp;AbstractExcelView&nbsp;内部使用&nbsp;Apache&nbsp;POI库扩展。 
  </div> 
  <p> com.yiibai.springmvc.viewresolver.ExcelView </p> 
  <pre>package com.yiibai.springmvc.viewresolver;

import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.CellStyle;
import org.apache.poi.ss.usermodel.IndexedColors;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.springframework.web.servlet.view.document.AbstractExcelView;

import com.yiibai.springmvc.model.Pizza;

public class ExcelView extends AbstractExcelView {

	@Override
	protected void buildExcelDocument(Map&lt;String, Object&gt; model,
			HSSFWorkbook workbook, HttpServletRequest request,
			HttpServletResponse response) throws Exception {

		Pizza pizza = (Pizza) model.get("pizza");

		Sheet sheet = workbook.createSheet("sheet 1");
		CellStyle style = workbook.createCellStyle();
		style.setFillForegroundColor(IndexedColors.GREY_40_PERCENT.index);
		style.setFillPattern(CellStyle.SOLID_FOREGROUND);
		style.setAlignment(CellStyle.ALIGN_CENTER);
		Row row = null;
		Cell cell = null;
		int rowCount = 0;
		int colCount = 0;

		// Create header cells
		row = sheet.createRow(rowCount++);

		cell = row.createCell(colCount++);
		cell.setCellStyle(style);
		cell.setCellValue("Name");

		cell = row.createCell(colCount++);
		cell.setCellStyle(style);
		cell.setCellValue("Flavor");

		cell = row.createCell(colCount++);
		cell.setCellStyle(style);
		cell.setCellValue("Toppings");

		// Create data cells
		row = sheet.createRow(rowCount++);
		colCount = 0;
		row.createCell(colCount++).setCellValue(pizza.getName());
		row.createCell(colCount++).setCellValue(pizza.getFlavor());

		StringBuffer toppings = new StringBuffer("");
		for (String topping : pizza.getToppings()) {
			toppings.append(topping);
			toppings.append(" ");
		}
		row.createCell(colCount++).setCellValue(toppings.toString());

		for (int i = 0; i &lt; 3; i++)
			sheet.autoSizeColumn(i, true);

	}

}</pre> 
  <p style="color:#404040;font-size:15px;"> com.yiibai.springmvc.viewresolver.ExcelViewResolver </p> 
  <pre>package com.yiibai.springmvc.viewresolver;

import java.util.Locale;

import org.springframework.web.servlet.View;
import org.springframework.web.servlet.ViewResolver;

public class ExcelViewResolver implements ViewResolver{

	@Override
	public View resolveViewName(String viewName, Locale locale) throws Exception {
		ExcelView view = new ExcelView();
		return view;
      }
	
}</pre> 
  <div>
    这是所有 ContentNegotaingViewResolver&nbsp;需要的配置。 
  </div> 
  <div>
    完成这个例子并让它可以运行，让我们添加缺少 Spring&nbsp;MVC 配置。 
  </div> 
  <h4> 
   <div>
     第5步：创建控制器类 
   </div> </h4> 
  <div>
    下面是一个简单的基于REST的控制器作为我们的示例。 
  </div> 
  <p> com.yiibai.springmvc.controller.AppController </p> 
  <pre>package com.yiibai.springmvc.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import com.yiibai.springmvc.model.Pizza;

@Controller
public class AppController {

	@RequestMapping(value="/pizzavalley/{pizzaName}", method = RequestMethod.GET)
	public String getPizza(@PathVariable String pizzaName, ModelMap model) {
 
		Pizza pizza = new Pizza(pizzaName);
		model.addAttribute("pizza", pizza);
 
		return "pizza";
 
	}
	
}</pre> 
  <h4> 
   <div>
     第6步：创建初始化类 
   </div> </h4> 
  <p> 添加一个初始化类实现WebApplicationInitializer如下图所示(在这种情况下，作为替代在&nbsp;web.xml&nbsp;中定义的任何 Spring&nbsp;配置)。在Servlet&nbsp;3.0的容器启动时，这个类会被加载并实例及其 onStartup方法将通过servlet容器调用。 </p> 
  <p> com.yiibai.springmvc.configuration.AppInitializer </p> 
  <pre>package com.yiibai.springmvc.configuration;

import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.ServletRegistration;

import org.springframework.web.WebApplicationInitializer;
import org.springframework.web.context.support.AnnotationConfigWebApplicationContext;
import org.springframework.web.servlet.DispatcherServlet;

public class AppInitializer implements WebApplicationInitializer {

	public void onStartup(ServletContext container) throws ServletException {

		AnnotationConfigWebApplicationContext ctx = new AnnotationConfigWebApplicationContext();
		ctx.register(AppConfig.class);
		ctx.setServletContext(container);

		ServletRegistration.Dynamic servlet = container.addServlet(
				"dispatcher", new DispatcherServlet(ctx));

		servlet.setLoadOnStartup(1);
		servlet.addMapping("/");
	}

}
&nbsp;</pre> 
  <p> 更新：请注意，上面的类可以写成更加简洁[和它的首选方式]，通过扩展&nbsp;AbstractAnnotationConfigDispatcherServletInitializer&nbsp;基类，如下所示： </p> 
  <pre>package com.yiibai.springmvc.configuration;

import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;

public class AppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

	@Override
	protected Class&lt;?&gt;[] getRootConfigClasses() {
		return new Class[] { AppConfig.class };
	}
 
	@Override
	protected Class&lt;?&gt;[] getServletConfigClasses() {
		return null;
	}
 
	@Override
	protected String[] getServletMappings() {
		return new String[] { "/" };
	}

}</pre> 
  <h4> 
   <div>
     第7步：构建和部署应用程序 
   </div> </h4> 
  <p> 现在构建&nbsp;war(通过Eclipse或Maven&nbsp;[&nbsp;mvn&nbsp;clean&nbsp;install])。部署&nbsp;war&nbsp;到Servlet3.0容器。 </p> 
  <div>
    运行。以下是运行示例触发不同模式输出的快照(注意URL扩展)，访问如下URL：
   <a target="_blank" href="http://localhost:8080/ContentNegotiatingViewResolver/pizzavalley/margherita.xml">http://localhost:8080/ContentNegotiatingViewResolver/pizzavalley/margherita.xml</a> 
  </div> 
  <p style="color:#404040;font-size:15px;"> <img src="/uploads/tutorial/20160115/1-1601151J35E39.png" alt=""><br> <img src="/uploads/tutorial/20160115/1-1601151J41E51.png" alt=""><br> <img src="/uploads/tutorial/20160115/1-1601151J435601.png" alt=""><br> <img src="/uploads/tutorial/20160115/1-1601151J450457.png" alt=""><br> <img src="/uploads/tutorial/20160115/1-1601151J514336.png" alt=""> </p> 
  <p> 到这里，所有教程讲解完毕！<br> 代码下载：<a target="_blank" href="http://pan.baidu.com/s/1skqkZBf">http://pan.baidu.com/s/1skqkZBf</a> </p> 
 </div>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring4 MVC REST服务使用@RestController实例</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    在这篇文章中，我们将通过开发使用&nbsp;Spring4&nbsp;@RestController&nbsp;注解来开发基于Spring&nbsp;MVC4的REST风格的JSON服务。我们将扩展这个例子通过简单的注释与JAXB标注域类支持XML输出和JSON输出。在这个示例中，我们需要URL的后缀为 .xml 或 .json 以获得所需的输出。 
  </div> 
 </div> 
 <hr> 
 <div>
   使用以下技术： 
 </div> 
 <ul> 
  <li> Spring 4.0.6.RELEASE </li> 
  <li> jackson-mapper-asl 1.9.13 </li> 
  <li> Maven 3 </li> 
  <li> JDK 1.6 </li> 
  <li> Tomcat 7.0.54 </li> 
  <li> Eclipse JUNO Service Release 2 </li> 
 </ul> 
 <p> 让我们现在开始！ </p> 
 <h4> 
  <div>
    第1步：创建目录结构 
  </div> </h4> 
 <div>
   之前的文章
  <a target="_blank" href="http://yiibai.com/maven/create-a-maven-web-project-with-eclipse.html">使用Eclipse创建Maven&nbsp;Web项目</a>包含了一步一步的指导，使用&nbsp;Eclipse&nbsp;来创建一个Maven项目(Spring4MVCRestServiceDemo)。 
 </div> 
 <div>
   下面是最终的项目目录结构： 
 </div> 
 <p> <img src="/uploads/tutorial/20160115/1-1601151K952S1.jpg" alt=""> </p> 
 <div>
   我们将使用 Spring&nbsp;Java配置而不使用XML。现在，让我们来添加/更新上述项目结构中提到的内容。 
 </div> 
 <h4> 
  <div>
    第2步：使用&nbsp;pom.xml&nbsp;更新所需的依赖 
  </div> </h4> 
 <pre>&lt;?xml version="1.0"?&gt;
&lt;project
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"
	xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;

	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;groupId&gt;com.yiibai.springmvc&lt;/groupId&gt;
	&lt;artifactId&gt;Spring4MVCRestServiceDemo&lt;/artifactId&gt;
	&lt;packaging&gt;war&lt;/packaging&gt;
	&lt;version&gt;1.0.0&lt;/version&gt;
	&lt;name&gt;Spring4MVCRestServiceDemo Maven Webapp&lt;/name&gt;

	&lt;properties&gt;
		&lt;springframework.version&gt;4.0.6.RELEASE&lt;/springframework.version&gt;
	&lt;/properties&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-core&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-web&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
			&lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
			&lt;version&gt;3.1.0&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;javax.servlet.jsp.jstl&lt;/groupId&gt;
			&lt;artifactId&gt;jstl-api&lt;/artifactId&gt;
			&lt;version&gt;1.2&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;
			&lt;artifactId&gt;javax.servlet.jsp-api&lt;/artifactId&gt;
			&lt;version&gt;2.3.1&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.codehaus.jackson&lt;/groupId&gt;
			&lt;artifactId&gt;jackson-mapper-asl&lt;/artifactId&gt;
			&lt;version&gt;1.9.13&lt;/version&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;
	&lt;build&gt;
		&lt;pluginManagement&gt;
			&lt;plugins&gt;
				&lt;plugin&gt;
					&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
					&lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
					&lt;version&gt;2.4&lt;/version&gt;
					&lt;configuration&gt;
						&lt;warSourceDirectory&gt;src/main/webapp&lt;/warSourceDirectory&gt;
						&lt;warName&gt;Spring4MVCRestServiceDemo&lt;/warName&gt;
						&lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;
					&lt;/configuration&gt;
				&lt;/plugin&gt;
			&lt;/plugins&gt;
		&lt;/pluginManagement&gt;
		&lt;finalName&gt;Spring4MVCRestServiceDemo&lt;/finalName&gt;
	&lt;/build&gt;
&lt;/project&gt;&nbsp;</pre> 
 <p> 上面的 pom.xml 与以前的教程中定义的相同。有一个显着的区别：&nbsp;我们已经包括一个依赖于Jackson&nbsp;库(jackson-mapper-asl)，其将用于所述响应数据转换成JSON字符串。 </p> 
 <p> 对于Spring&nbsp;4.1.x&nbsp;和以上，&nbsp;jackson-databind&nbsp;2.3或以上是推荐使用的，以避免转换问题。 </p> 
 <div>
   安全的选择，你可以包括&nbsp;jackson-databind&nbsp;最新版本。 
 </div> 
 <pre>    &lt;dependency&gt;
        &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
        &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
        &lt;version&gt;2.5.3&lt;/version&gt;
    &lt;/dependency&gt;</pre> 
 <h4> 
  <div>
    第3步：添加一个POJO/域对象 
  </div> </h4> 
 <pre>package com.yiibai.springmvc.domain;

public class Message {

	String name;
	String text;

	public Message(String name, String text) {
		this.name = name;
		this.text = text;
	}

	public String getName() {
		return name;
	}

	public String getText() {
		return text;
	}

}</pre> 
 <div>
   上述对象将从控制器返回&nbsp;Jackson&nbsp;转换成&nbsp;JSON&nbsp;的格式。 
 </div> 
 <h4> 
  <div>
    第4步：添加控制器 
  </div> </h4> 
 <div>
   在&nbsp;src/main/java&nbsp;包下添加控制器类，如下图所示。 
 </div> 
 <pre>package com.yiibai.springmvc.controller;

import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.yiibai.springmvc.domain.Message;

@RestController
public class HelloWorldRestController {

	@RequestMapping("/hello/{player}")
	public Message message(@PathVariable String player) {

		Message msg = new Message(player, "Hello " + player);
		return msg;
	}

}&nbsp;</pre> 
 <p> @PathVariable表示参数将被绑定到变量 URI 模板。更有趣的事情，这里要注意的是，这里我们使用的是 @RestController 注解，这标志着这个类作为控制器，每一个方法返回域对象/pojo代替一个视图。这意味着我们不再使用视图解析器，我们不再直接发送响应的HTML，我们只发送的域对象转换成格式。在我们的例子中，由于&nbsp;jackson&nbsp;包含在类路径中，消息对象将转换成JSON格式。 </p> 
 <h4> 
  <div>
    第5步：添加配置类 
  </div> </h4> 
 <pre>package com.yiibai.springmvc.configuration;

import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;

@Configuration
@EnableWebMvc
@ComponentScan(basePackages = "com.yiibai.springmvc")
public class HelloWorldConfiguration {

}&nbsp;</pre> 
 <p> 在这里，这个类是主要提供组件，扫描和注释支持。需要注意的是，我们没有任何视图解析器配置，因为我们在Rest案例并不需要。 </p> 
 <h4> 
  <div>
    第6步：添加初始化类 
  </div> </h4> 
 <p> 添加一个初始化类实现WebApplicationInitializer在src/main/java，使用如下图所示指定包(在这种情况下，替代在web.xml中定义的任何spring的配置)。在Servlet&nbsp;3.0容器启动时，这个类会被加载并实例，它是在启动时方法将通过servlet容器调用。 </p>   
 <pre>package com.yiibai.springmvc.configuration;

import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.ServletRegistration;

import org.springframework.web.WebApplicationInitializer;
import org.springframework.web.context.support.AnnotationConfigWebApplicationContext;
import org.springframework.web.servlet.DispatcherServlet;

public class HelloWorldInitializer implements WebApplicationInitializer {

	public void onStartup(ServletContext container) throws ServletException {

		AnnotationConfigWebApplicationContext ctx = new AnnotationConfigWebApplicationContext();
		ctx.register(HelloWorldConfiguration.class);
		ctx.setServletContext(container);

		ServletRegistration.Dynamic servlet = container.addServlet(
				"dispatcher", new DispatcherServlet(ctx));

		servlet.setLoadOnStartup(1);
		servlet.addMapping("/");
	}

}&nbsp;</pre> 
 <p> 更新：请注意，上面的类可以写成更加简洁[和它的首选方式]，通过扩展&nbsp;AbstractAnnotationConfigDispatcherServletInitializer&nbsp;基类，如下所示： </p> 
 <pre>package com.yiibai.springmvc.configuration;

import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;

public class HelloWorldInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

	@Override
	protected Class&lt;?&gt;[] getRootConfigClasses() {
		return new Class[] { HelloWorldConfiguration.class };
	}
 
	@Override
	protected Class&lt;?&gt;[] getServletConfigClasses() {
		return null;
	}
 
	@Override
	protected String[] getServletMappings() {
		return new String[] { "/" };
	}

}</pre> 
 <h4> 
  <div>
    第7步：构建和部署应用程序 
  </div> </h4> 
 <p> 现在构建&nbsp;war(在&nbsp;Eclipse中)或通过&nbsp;Maven&nbsp;命令行(&nbsp;mvn&nbsp;clean&nbsp;install)。&nbsp;部署&nbsp;war&nbsp;文件到Servlet3.0容器。 </p> 
 <div>
   运行它。访问：&nbsp;
  <a target="_blank" href="http://localhost:8080/Spring4MVCRestServiceDemo/hello/Messi">http://localhost:8080/Spring4MVCRestServiceDemo/hello/Messi</a>&nbsp;，您将看到 JSON 输出，如下图所示： 
 </div> 
 <p> <img src="/uploads/tutorial/20160115/1-1601151P040F5.png" alt=""> </p> 
 <p> <img src="/uploads/tutorial/20160115/1-1601151P05MR.png" alt=""> </p> 
 <p> 就这样，所有输出如上所示。 </p> 
 <div>
   适应XML输出 
 </div> 
 <p> 现在，如上面提到的，只是通过增加模型类(Message)JAXB注释，我们可以让XML输出支持以及JSON输出。下面是相同的演示： </p> 
 <pre>package com.yiibai.springmvc.domain;

import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlRootElement;

@XmlRootElement(name = "pizza")
public class Message {

	String name;
	String text;

	public Message(){
		
	}
	
	public Message(String name, String text) {
		this.name = name;
		this.text = text;
	}

	@XmlElement
	public String getName() {
		return name;
	}
	
	@XmlElement
	public String getText() {
		return text;
	}

}</pre> 
 <div>
   编译，部署并再次运行它，会看到下面的输出(注意URL后缀)，访问URL：
  <a target="_blank" href="http://localhost:8080/Spring4MVCRestServiceDemo/hello/Yiibai.xml">http://localhost:8080/Spring4MVCRestServiceDemo/hello/Yiibai.xml</a> 
 </div> 
 <p> <img src="/uploads/tutorial/20160115/1-1601151P114126.png" alt=""> </p> 
 <p> 再次访问：<a target="_blank" href="http://localhost:8080/Spring4MVCRestServiceDemo/hello/Yiibai.json">http://localhost:8080/Spring4MVCRestServiceDemo/hello/Yiibai.json</a> </p> 
 <p> <img src="/uploads/tutorial/20160115/1-1601151P132391.png" alt=""> </p> 
 <div>
   如果没有任何后缀，默认格式是XML： 
 </div> 
 <p> <img src="/uploads/tutorial/20160115/1-1601151P151638.png" alt=""> </p> 
 <p> 到这里，全部完成！<br> 代码下载：<a target="_blank" href="http://pan.baidu.com/s/1pK1K2BD">http://pan.baidu.com/s/1pK1K2BD</a> </p> 
 <p> <br> </p> 
 <p> <br> </p>
 <br>      
</div></body></html>
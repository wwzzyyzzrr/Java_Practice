<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Struts2+Log4j集成</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    在本教程中，我们学习如何将log4j框架在Struts2的Web应用程序集成。所有需要做的有： 
  </div> 
 </div> 
 <div> 
  <ol> 
   <li> 
    <div>
      包含 log4j.jar 作为项目依赖 
    </div> </li> 
   <li> 
    <div>
      创建一个 log4j.properties 文件，并把它放入 classpath 的根目录-放到资源文件夹中。 
    </div> </li> 
  </ol> 
  <p> 相关技术和工具的使用： </p> 
  <ol> 
   <li> Log4j 1.2.17 </li> 
   <li> Struts 2.1.8 </li> 
   <li> Tomcat 6 </li> 
   <li> MyEclipse 10 </li> 
  </ol> 
  <h2> 1. 工程结构 </h2> 
  <p> 这里我们创建一个web工程为：struts2log4j，参见下面最终的工程结构：<br> <img src="/uploads/tutorial/20151202/1-151202221213117.png" alt=""> </p> 
  <div style="text-align:center;"> 
   <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/9716bac3815c4331b7e24aea5d8c3059/4j-directory.png" alt="strruts2-log4j-directory" width="465" height="502" style="height:auto;"> 
  </div> 
  <h2> 2. log4j.properties </h2> 
  <div>
    创建log4j的属性文件，并把它放入资源文件夹，请参阅步骤＃1。 
  </div> 
  <div style="background-color:#E6E6FC;color:#333333;font-family:Consolas, Monaco, 'Andale Mono', monospace;font-size:16px;">
    log4j.properties 
  </div> 
  <pre># Root logger option
log4j.rootLogger=ERROR, stdout, file

# Redirect log messages to console
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.Target=System.out
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss} %-5p %c{1}:%L - %m%n

# Redirect log messages to a log file, support rolling backup file.
log4j.appender.file=org.apache.log4j.RollingFileAppender
log4j.appender.file.File=${catalina.home}/logs/mystruts2app.log
log4j.appender.file.MaxFileSize=5MB
log4j.appender.file.MaxBackupIndex=10
log4j.appender.file.layout=org.apache.log4j.PatternLayout
log4j.appender.file.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss} %-5p %c{1}:%L - %m%n</pre> 
  <h2 style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:24px;font-weight:500;"> 4. Struts2 Action 和 Logging </h2> 
  <div style="background-color:inherit;">
    一个简单的动作返回一个页面，并显示了如何来执行&nbsp;log4j&nbsp;消息日志记录。 
  </div> 
  <div style="background-color:#E6E6FC;color:#333333;font-family:Consolas, Monaco, 'Andale Mono', monospace;font-size:16px;">
    WelcomeAction.java 
  </div> 
  <pre>package com.yiibai.common.action;

import org.apache.log4j.Logger;
import com.opensymphony.xwork2.ActionSupport;

public class WelcomeAction extends ActionSupport {

	private static final long serialVersionUID = 1L;

	//get log4j
	private static final Logger logger = Logger.getLogger(WelcomeAction.class);

	public String execute() throws Exception {

		// logs debug message
		if (logger.isDebugEnabled()) {
			logger.debug("execute()!");
		}

		// logs exception
		logger.error("This is Error message", new Exception("Testing"));

		return SUCCESS;

	}
}</pre> 
  <h2 style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:24px;font-weight:500;"> 5. Struts2配置 </h2> 
  <div style="background-color:inherit;">
    Struts2 的配置和JSP页面，如果想了解的话。 
  </div> 
  <div style="background-color:#E6E6FC;color:#333333;font-family:Consolas, Monaco, 'Andale Mono', monospace;font-size:16px;">
    struts.xml 
  </div> 
  <pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE struts PUBLIC
"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
"http://struts.apache.org/dtds/struts-2.0.dtd"&gt;

&lt;struts&gt;
	&lt;constant name="struts.devMode" value="true" /&gt;

	&lt;package name="welcome" namespace="/" extends="struts-default"&gt;

		&lt;action name="welcome" class="com.yiibai.common.action.WelcomeAction"&gt;
			&lt;result name="success"&gt;pages/success.jsp&lt;/result&gt;
		&lt;/action&gt;

	&lt;/package&gt;

&lt;/struts&gt;</pre> 
  <div style="background-color:#E6E6FC;color:#333333;font-family:Consolas, Monaco, 'Andale Mono', monospace;font-size:16px;">
    web.xml 
  </div>   
  <pre>&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee 
	http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
	version="2.5"&gt;

	&lt;display-name&gt;Struts 2 Web Application&lt;/display-name&gt;

	&lt;filter&gt;
		&lt;filter-name&gt;struts2&lt;/filter-name&gt;
		&lt;filter-class&gt;
			org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter
		&lt;/filter-class&gt;
	&lt;/filter&gt;

	&lt;filter-mapping&gt;
		&lt;filter-name&gt;struts2&lt;/filter-name&gt;
		&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
	&lt;/filter-mapping&gt;

&lt;/web-app&gt;</pre> 
  <div style="background-color:#E6E6FC;color:#333333;font-family:Consolas, Monaco, 'Andale Mono', monospace;font-size:16px;">
    pages/success.jsp 
  </div> 
  <pre>&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt;
&lt;html&gt;
&lt;head&gt;
&lt;/head&gt;
 
&lt;body&gt;
&lt;h1&gt;Struts 2 + Log4j integration example&lt;/h1&gt;

&lt;/body&gt;
&lt;/html&gt;</pre> 
  <h2> 6. 实例测试 </h2> 
  <div>
    运行Struts&nbsp;2的Web应用程序，并访问welcome的动作。 
  </div> 
  <p> 在浏览器中打开 URL : http://localhost:8888/struts2log4j/welcome </p> 
  <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <em>6.1</em>&nbsp;<span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">所有日志消息将显示在控制台中。</span> </p> 
  <div style="background-color:#F9F9F9;color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;text-align:center;"> 
   <img src="/uploads/tutorial/20151202/1-151202221643144.png" alt=""> 
  </div> 
  <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <em>Figure : Eclipse 终端</em> </p> 
  <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <em>6.2</em>&nbsp;<span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">此外，日志文件将在Tomcat 的日志文件夹中被创建。</span> </p> 
  <div style="background-color:#F9F9F9;color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;text-align:center;"> 
   <img src="/uploads/tutorial/20151202/1-151202221F5O1.png" alt=""> 
  </div> 
  <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <em>图片: C:\mystruts2app.log</em> </p> 
  <div style="background-color:inherit;color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;">
    下载代码 –&nbsp;
   <a target="_blank" href="http://www.yiibai.com/wp-content/uploads/2010/07/Log4jAndStruts2Example.zip">http://pan.baidu.com/s/1nt7yVep</a> 
  </div> 
 </div>
 <br>      
</div></body></html>
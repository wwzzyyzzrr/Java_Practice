<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Struts2+Spring集成实例</h1><div style="width:100%;float:left;" class="article-content">   
 <div style="font-family:微软雅黑;font-size:14px;background-color:#FFFFFF;"> 
  <div style="background-color:inherit;"> 
   <span style="font-family:'Microsoft Yahei',  Helvetica, font-size:16px;line-height:1.5;">在本教程中，我们来学习Struts2和Spring的集成。<br> <img src="/uploads/tutorial/20151202/1-151202211A2360.png" alt=""><br> </span> 
  </div> 
 </div> 
 <p> <br> </p> 
 <h2> 1. 工程结构 </h2> 
 <div>
   下面的图是本教程的项目文件夹结构。
  <br> 
  <img src="/uploads/tutorial/20151202/1-151202211G3633.png" alt="">
  <br> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/88550de3a4d349c0b6a521d544935f4b/clipboard.png"> 
 </div> 
 <h2> 2. Spring监听器 </h2> 
 <p> 配置Spring监听器&nbsp;“org.springframework.web.context.ContextLoaderListener” 到&nbsp;web.xml&nbsp;文件中。 </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>web.xml</strong> </p> 
 <pre>&lt;!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Struts 2 Web Application&lt;/display-name&gt;
  
  &lt;filter&gt;
	&lt;filter-name&gt;struts2&lt;/filter-name&gt;
	&lt;filter-class&gt;
         org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter
        &lt;/filter-class&gt;
  &lt;/filter&gt;
  
  &lt;filter-mapping&gt;
	&lt;filter-name&gt;struts2&lt;/filter-name&gt;
	&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
 
  &lt;listener&gt;
    &lt;listener-class&gt;
      org.springframework.web.context.ContextLoaderListener
    &lt;/listener-class&gt;
  &lt;/listener&gt;
  
&lt;/web-app&gt;</pre> 
 <h2> 3. 注册Spring Bean </h2> 
 <p> 注册所有的Spring&nbsp;Beans&nbsp;配置在 applicationContext.xml 文件中,&nbsp;Spring监听器会自动找到这个&nbsp;XML&nbsp;文件。 </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>applicationContext.xml</strong> </p> 
 <pre>&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;
 
	&lt;bean id="userBo" class="com.yiibai.user.bo.impl.UserBoImpl" /&gt;
	
	&lt;bean id="userSpringAction" class="com.yiibai.user.action.UserSpringAction"&gt;
		&lt;property name="userBo" ref="userBo" /&gt;	
	&lt;/bean&gt;
 
&lt;/beans&gt;</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>UserBo.java</strong> </p> 
 <pre>package com.yiibai.user.bo;

public interface UserBo{

	public void printUser();
	
}</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>UserBoImpl.java</strong> </p> 
 <pre>package com.yiibai.user.bo.impl;

import com.yiibai.user.bo.UserBo;

public class UserBoImpl implements UserBo{

	public void printUser(){
		System.out.println("printUser() is executed...");
	}
	
}</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>UserSpringAction.java</strong> </p> 
 <pre>package com.yiibai.user.action;

import com.yiibai.user.bo.UserBo;

public class UserSpringAction{

	//DI via Spring
	UserBo userBo;
	
	public UserBo getUserBo() {
		return userBo;
	}

	public void setUserBo(UserBo userBo) {
		this.userBo = userBo;
	}

	public String execute() throws Exception {
		
		userBo.printUser();
		return "success";
		
	}
}</pre> 
 <h2> 4. Struts.xml </h2> 
 <div style="background-color:inherit;">
   在此声明的所有关系。 
 </div> 
 <pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE struts PUBLIC
"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
"http://struts.apache.org/dtds/struts-2.0.dtd"&gt;
 
&lt;struts&gt;
 	&lt;constant name="struts.devMode" value="true" /&gt;
 	
	&lt;package name="default" namespace="/" extends="struts-default"&gt;
		
		&lt;action name="userAction" 
			class="com.yiibai.user.action.UserAction" &gt;
			&lt;result name="success"&gt;pages/user.jsp&lt;/result&gt;
		&lt;/action&gt;
		
		&lt;action name="userSpringAction" 
			class="userSpringAction" &gt;
			&lt;result name="success"&gt;pages/user.jsp&lt;/result&gt;
		&lt;/action&gt;
		
	&lt;/package&gt;
	
&lt;/struts&gt;</pre> 
 <h2> 5. 示例 </h2> 
 <div>
   现在，所有的Struts2和Spring的集成工作已经完成，现在看到下面的用例来访问&nbsp;Spring&nbsp;的&nbsp;“userBo”&nbsp;Bean。 
 </div> 
 <ul> 
  <li> 用例 1 :&nbsp;让&nbsp;Spring&nbsp;充当&nbsp;Struts2的Action类，并访问Spring的Bean。 </li> 
  <li> 用例 2 :&nbsp;在Struts2的Action类中访问Spring的Bean。 </li> 
 </ul> 
 <h2> 用例1 </h2> 
 <div>
   在这个例子中，userSpringAction充当Struts2的Action类，也可以使用普通Spring的方式注入Spring的userBo。 
 </div> 
 <pre>//struts.xml
&lt;action name="userSpringAction" 
	class="userSpringAction" &gt;
	&lt;result name="success"&gt;pages/user.jsp&lt;/result&gt;
&lt;/action&gt;

//applicationContext.xml
&lt;bean id="userSpringAction" class="com.yiibai.user.action.UserSpringAction"&gt;
	&lt;property name="userBo" ref="userBo" /&gt;	
&lt;/bean&gt;&nbsp;</pre> 
 <p> 要访问此操作，请使用网址：&nbsp;<a target="_blank" href="http://localhost:8080/struts2spring/userSpringAction.action">http://localhost:8080/struts2spring/userSpringAction.action</a> </p> 
 <h2> 用例 2 </h2> 
 <p> 默认情况下，Spring监听器启用&nbsp;“通过匹配bean的名字自动装配“。&nbsp;因此，它会通过setUserBo自动传递Spring&nbsp;“userBo”&nbsp;Bean&nbsp;到UserAction。请参阅下面的Struts2动作： </p> 
 <div style="background-color:#E6E6FC;color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> 
  <span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">Spring的自动装配功能可以修改为</span>&nbsp;
  <strong>name</strong>(默认),&nbsp;
  <strong>type</strong>,&nbsp;
  <strong>auto</strong>&nbsp;或&nbsp;
  <strong>constructor</strong>,&nbsp;
  <span style="line-height:1.5;">可能需要参考&nbsp;<a target="_blank" href="http://struts.apache.org/docs/spring-plugin.html">Struts2的Spring插件文档</a>。</span> 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>UserAction.java</strong> </p>   
 <pre>package com.yiibai.user.action;

import com.yiibai.user.bo.UserBo;
import com.opensymphony.xwork2.ActionSupport;
 
public class UserAction extends ActionSupport{

	//DI via Spring
	UserBo userBo;
	
	public UserBo getUserBo() {
		return userBo;
	}

	public void setUserBo(UserBo userBo) {
		this.userBo = userBo;
	}

	public String execute() throws Exception {
		
		userBo.printUser();
		return SUCCESS;
		
	}
}</pre> 
 <p> 要访问此操作，请使用网址：&nbsp;http://localhost:8080/struts2spring/userAction.action </p> 
 <p> <img src="/uploads/tutorial/20151202/1-151202211Q5V4.png" alt=""> </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/6c8fd5e6776f4788bd5386dad2af6f06/clipboard.png"> </p> 
 <div style="background-color:#E6E6FC;color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> 
  <strong>WebApplicationContextUtils</strong>
  <br> 
  <span style="line-height:1.5;">另外，也可以使用Spring 通用</span>&nbsp;
  <strong>WebApplicationContextUtils</strong>&nbsp;
  <span style="line-height:1.5;">类来直接获得Spring的bean。</span> 
  <pre>package com.yiibai.user.action;

import org.apache.struts2.ServletActionContext;
import org.springframework.web.context.WebApplicationContext;
import org.springframework.web.context.support.WebApplicationContextUtils;

import com.yiibai.user.bo.UserBo;
import com.opensymphony.xwork2.ActionSupport;
 
public class UserAction extends ActionSupport{

	public String execute() throws Exception {
		
		WebApplicationContext context =
			WebApplicationContextUtils.getRequiredWebApplicationContext(
                                    ServletActionContext.getServletContext()
                        );
		
		UserBo userBo1 = (UserBo)context.getBean("userBo");
		userBo1.printUser();

		return SUCCESS;
		
	}
}</pre> 
 </div> 
 <div>
   这是一个又长又臭的文章(包教不包会)，请下载完整的项目并按照源代码去一步步实现。 
 </div> 
 <h2> 参考 </h2> 
 <ol> 
  <li> <a target="_blank" href="http://struts.apache.org/2.x/docs/spring-plugin.html">Struts2 Spring 插件文档</a> </li> 
  <li> <a target="_blank" href="http://www.yiibai.com/struts/struts-spring-integration-example/">Struts + Spring 集成实例</a> </li> 
 </ol> 
 <div>
   代码下载 -&nbsp;
  <a target="_blank" href="http://pan.baidu.com/s/1dDhqQ5b">http://pan.baidu.com/s/1dDhqQ5b</a> 
 </div>
 <br>      
</div></body></html>
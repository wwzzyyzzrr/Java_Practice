<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Struts2 execAndWait拦截器例子</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    在Struts2中附带一个名为“execAndWait”一个非常有趣的“执行和等待”拦截器，这是一个非常方便的拦截器长时间运行操作在后台，显示用户的自定义的等待页面。在本教程中，它显示了一个完整的使用 Struts2&nbsp;execAndWait 拦截器的例子。 
  </div> 
 </div> 
 <h2> 1. 动作 </h2> 
 <div>
   一个普通的动作类，有一个长时间运行进程，证明了execAndWait效果。 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>LongProcessAction.java</strong> </p> 
 <pre>package com.yiibai.common.action;

import com.opensymphony.xwork2.ActionSupport;
 
public class LongProcessAction extends ActionSupport{

	public String execute() throws Exception {
	
		//it should be delay few seconds, 
		//unless you have a super powerful computer.
		for(int i =0; i&lt;1000000; i++){
			System.out.println(i);
		}
		return SUCCESS;
		
	}
}</pre> 
 <h2> 2. JSP页面 </h2> 
 <div>
   创建两个页面： 
 </div> 
 <ol> 
  <li> wait.jsp&nbsp;-&nbsp;显示给用户，长时间运行的进程。 </li> 
  <li> success.jsp&nbsp;-&nbsp;显示给用户的过程完成之后。 </li> 
 </ol> 
 <div>
   HTML meta refresh
  <br> 记得把元刷新的等待页面顶部;&nbsp;否则，该网页将不重定向到成功页面，即使该过程完成。 
 </div> 
 <p> 在这个wait.jsp，元刷新设置在每5秒网页重新加载，如果该过程完成后，将重定向到&nbsp;success.jsp,&nbsp;否则留在同一个页面。 </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>wait.jsp</strong> </p> 
 <pre class="prettyprint lang-html">&lt;%@ page contentType="text/html; charset=UTF-8"%&gt;
&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Struts 2 execAndWait 示例&lt;/title&gt;
&lt;meta http-equiv="refresh" content="5;url=&lt;s:url includeParams="all" /&gt;"/&gt;
&lt;/head&gt;
 
&lt;body&gt;
&lt;h1&gt;Struts 2 execAndWait 示例&lt;/h1&gt;

&lt;h3&gt;Please wait while we process your request...&lt;/h3&gt;

&lt;/body&gt;
&lt;/html&gt;</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>success.jsp</strong> </p> 
 <pre class="prettyprint lang-html">&lt;%@ page contentType="text/html; charset=UTF-8"%&gt;
&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Struts 2 execAndWait 示例&lt;/title&gt;
&lt;/head&gt;
 
&lt;body&gt;
&lt;h1&gt;Struts 2 execAndWait 示例&lt;/h1&gt;

&lt;h3&gt;Done&lt;/h3&gt;

&lt;/body&gt;
&lt;/html&gt;</pre> 
 <h2> 3.&nbsp;执行和等待拦截器 </h2> 
 <div>
   链接动作类并声明“execAndWait”拦截器。 
 </div> 
 <div>
   execAndWait 参数 
  <ol> 
   <li> delay (optional)&nbsp;:&nbsp;以毫秒为单位初始延迟显示在wait.jsp。默认是没有延迟的。 </li> 
   <li> delaySleepInterval (optional)&nbsp;:&nbsp;时间间隔是以毫秒为单位来检查后台进程<span>是否</span>已经完成，默认值是100毫秒。 </li> 
  </ol> 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>struts.xml</strong> </p> 
 <pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE struts PUBLIC
"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
"http://struts.apache.org/dtds/struts-2.0.dtd"&gt;
 
&lt;struts&gt;
 	&lt;constant name="struts.devMode" value="true" /&gt;
	&lt;package name="default" namespace="/" extends="struts-default"&gt;
		&lt;action name="longProcessAction" 
			class="com.yiibai.common.action.LongProcessAction" &gt;
			
			&lt;interceptor-ref name="execAndWait"&gt;
		        &lt;param name="delay"&gt;1000&lt;/param&gt;
		        &lt;param name="delaySleepInterval"&gt;500&lt;/param&gt;
		    &lt;/interceptor-ref&gt;
		    
		    &lt;result name="wait"&gt;/pages/wait.jsp&lt;/result&gt;
		    &lt;result name="success"&gt;/pages/success.jsp&lt;/result&gt;
		&lt;/action&gt;
	
	&lt;/package&gt;
&lt;/struts&gt;&nbsp;</pre> 
 <p> 在这种情况下，将延迟1秒显示至wait.jsp，并检查后台进程是否在每500毫秒完成。即使这个过程完成后，它仍然需要等待 wait.jsp 元刷新来触发页面重载。 </p> 
 <h2> 4. 示例 </h2> 
 <p> 访问网址：&nbsp;http://localhost:8080/struts2execandwait/longProcessAction.action </p> 
 <p> <img src="/uploads/tutorial/20151113/1-151113202450104.png" alt=""> </p> 
 <div>
   延时1秒，显示在 wait.jsp 。 
 </div> 
 <div style="text-align:center;"> 
  <img title="Struts2-ExecAndWait-Interceptor-Example1" src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/dd77c69324f243068f16f6e1b1010dd6/or-example1.jpeg" alt="Struts 2 ExecAndWait interceptor example" width="721" height="288" style="height:auto;"> 
 </div> 
 <p> 当该过程完成时，自动显示在 success.jsp。 </p> 
 <p> <img src="/uploads/tutorial/20151113/1-15111320250HL.png" alt=""><span style="line-height:1.5;"></span> </p> 
 <p style="text-align:center;"> <img title="Struts2-ExecAndWait-Interceptor-Example2" src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/8ae6869143564698bd767257c5e0108d/or-example2.jpeg" alt="Struts 2 ExecAndWait interceptor example" width="700" height="267" style="height:auto;"> </p> 代码下载：
 <a target="_blank" href="http://pan.baidu.com/s/1o62BHGY">http://pan.baidu.com/s/1o62BHGY</a> 
 <h2> 参考 </h2> 
 <ol> 
  <li> <a target="_blank" href="http://struts.apache.org/2.1.8/docs/execute-and-wait-interceptor.html">Struts2 execAndWait拦截器文档</a> </li> 
  <li> <a target="_blank" href="http://en.wikipedia.org/wiki/Meta_refresh">HTML Meta Refresh</a> </li> 
 </ol>
 <br>      
</div></body></html>
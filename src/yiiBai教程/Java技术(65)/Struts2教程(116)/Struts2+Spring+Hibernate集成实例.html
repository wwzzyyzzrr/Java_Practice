<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Struts2+Spring+Hibernate集成实例</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    在本教程中，它显示的集成&nbsp;“Struts2 + Spring + Hibernate“，请务必检查以下之前继续学习教程。 
  </div> 
 </div> 
 <ol> 
  <li> <a target="_blank" href="http://www.yiibai.com/struts2/struts-2-hibernate-integration-example/">Struts2 + Hibernate集成实例</a> </li> 
  <li> <a target="_blank" href="http://www.yiibai.com/struts2/struts-2-spring-integration-example/">Struts2 + Spring 集成实例</a> </li> 
 </ol> 
 <div>
   参见集成步骤总结： 
 </div> 
 <ol> 
  <li> 
   <div>
     获取所有的依赖库(很多)。 
   </div> </li> 
  <li> 
   <div>
     注册 Spring 的 ContextLoaderListener 来整合 Struts2 和 Spring。 
   </div> </li> 
  <li> 
   <div>
     使用 Spring 的 LocalSessionFactoryBean 来集成 Spring 和 Hibernate。 
   </div> </li> 
  <li> 
   <div>
     完成所有连接。 
   </div> </li> 
 </ol> 
 <div>
   请参阅它们之的关系： 
 </div> 
 <pre>Struts 2 &lt;-- (ContextLoaderListener) --&gt; Spring &lt;-- (LocalSessionFactoryBean) --&gt; Hibernate</pre> 
 <div> 
  <div>
    这将是一个很长的教程，相关解释并不是很多，请务必阅读上述2篇文章的详细情况说明以方面学习。 
  </div> 
 </div> 
 <p> 这将要创建一个客户页面，以添加客户和列表的自定义函数。前端使用Struts2显示，Spring作为依赖注入引擎，而&nbsp;Hibernate&nbsp;用来执行数据库操作。让我们开始... </p> 
 <h2> 1. 工程文件夹结构 </h2> 
 <p> 在本章中，我们创建一个 ssh 的web工程，工程的目录结构如下图所示：<br> <img src="/uploads/tutorial/20151202/1-151202215919193.png" alt=""> </p> 
 <p> <img src="/uploads/tutorial/20151202/1-151202215935412.png" alt=""> </p> 
 <div style="text-align:center;"> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/e1a14940f4a64fc3a4820e9db05e906d/clipboard.png"> 
 </div> 
 <div style="text-align:center;"> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/ab803bd8602747fc9d84cf896bce3083/clipboard.png"> 
 </div> 
 <h2> 2. MySQL表结构结构 </h2> 
 <div>
   客户(customer)表脚本。 
 </div> 
 <pre>DROP TABLE IF EXISTS `yiibai`.`customer`;
CREATE TABLE  `yiibai`.`customer` (
  `CUSTOMER_ID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `NAME` varchar(45) NOT NULL,
  `ADDRESS` varchar(255) NOT NULL,
  `CREATED_DATE` datetime NOT NULL,
  PRIMARY KEY (`CUSTOMER_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=17 DEFAULT CHARSET=utf8;</pre> 
 <h2> 3. Hibernate相关配置 </h2> 
 <div>
   只有模型和映射文件是必需的，因为这里要用Spring处理Hibernate配置。 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>Customer.java</strong>&nbsp;–&nbsp;<span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">创建客户表对应的一个类。</span> </p> 
 <pre>package com.yiibai.customer.model;

import java.util.Date;

public class Customer implements java.io.Serializable {

	private Long customerId;
	private String name;
	private String address;
	private Date createdDate;

	//getter and setter methods
}</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>Customer.hbm.xml</strong>&nbsp;–&nbsp;<span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">Hibernate的客户映射文件。</span> </p> 
 <pre>&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;
&lt;!-- Generated 20 Julai 2010 11:40:18 AM by Hibernate Tools 3.2.5.Beta --&gt;
&lt;hibernate-mapping&gt;
    &lt;class name="com.yiibai.customer.model.Customer" 
		table="customer" catalog="yiibai"&gt;
        &lt;id name="customerId" type="java.lang.Long"&gt;
            &lt;column name="customer_id" /&gt;
            &lt;generator class="identity" /&gt;
        &lt;/id&gt;
        &lt;property name="name" type="string"&gt;
            &lt;column name="name" length="45" not-null="true" /&gt;
        &lt;/property&gt;
        &lt;property name="address" type="string"&gt;
            &lt;column name="address" not-null="true" /&gt;
        &lt;/property&gt;
        &lt;property name="createdDate" type="timestamp"&gt;
            &lt;column name="create_date" length="19" not-null="true" /&gt;
        &lt;/property&gt;
    &lt;/class&gt;
&lt;/hibernate-mapping&gt;</pre> 
 <h2> 5. Struts2相关 </h2> 
 <p> 实现了 Bo 和 DAO 设计模式。所有Bo和DAO将由Spring&nbsp;Spring&nbsp;bean配置文件注入。在DAO中，让它扩展Spring的HibernateDaoSupport来集成 Spring 和 Hibernate。 </p> 
 <p> <strong>CustomerBo.java</strong> </p> 
 <pre>package com.yiibai.customer.bo;

import java.util.List;
import com.yiibai.customer.model.Customer;
 
public interface CustomerBo{
	
	void addCustomer(Customer customer);
	List&lt;Customer&gt; listCustomer();
	
}</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>CustomerBoImpl.java</strong> </p> 
 <pre>package com.yiibai.customer.bo.impl;

import java.util.List;
import com.yiibai.customer.bo.CustomerBo;
import com.yiibai.customer.dao.CustomerDAO;
import com.yiibai.customer.model.Customer;
 
public class CustomerBoImpl implements CustomerBo{
	
	CustomerDAO customerDAO;
	//DI via Spring
	public void setCustomerDAO(CustomerDAO customerDAO) {
		this.customerDAO = customerDAO;
	}

	//call DAO to save customer
	public void addCustomer(Customer customer){
		customerDAO.addCustomer(customer);
	}
	
	//call DAO to return customers
	public List&lt;Customer&gt; listCustomer(){
		return customerDAO.listCustomer();
	}
}</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>CustomerDAO.java</strong> </p> 
 <pre>package com.yiibai.customer.dao;

import java.util.List;
import com.yiibai.customer.model.Customer;
 
public interface CustomerDAO{
	
	void addCustomer(Customer customer);
	List&lt;Customer&gt; listCustomer();	
	
}</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>CustomerDAOImpl.java</strong> </p> 
 <pre>package com.yiibai.customer.dao.impl;

import java.util.List;
import org.springframework.orm.hibernate3.support.HibernateDaoSupport;
import com.yiibai.customer.dao.CustomerDAO;
import com.yiibai.customer.model.Customer;
 
public class CustomerDAOImpl extends HibernateDaoSupport 
    implements CustomerDAO{
	
	//add the customer
	public void addCustomer(Customer customer){
		getHibernateTemplate().save(customer);
	}
	
	//return all the customers in list
	public List&lt;Customer&gt; listCustomer(){
		return getHibernateTemplate().find("from Customer");		
	}
	
}</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>CustomerAction.java</strong>&nbsp;–&nbsp;<span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">Struts2 的动作不再需要扩展ActionSupport，它将由 Spring 来处理。</span> </p> 
 <pre>package com.yiibai.customer.action;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import com.yiibai.customer.bo.CustomerBo;
import com.yiibai.customer.model.Customer;
import com.opensymphony.xwork2.ModelDriven;
 
public class CustomerAction implements ModelDriven{

	Customer customer = new Customer();
	List&lt;Customer&gt; customerList = new ArrayList&lt;Customer&gt;();
	
	CustomerBo customerBo;
	//DI via Spring
	public void setCustomerBo(CustomerBo customerBo) {
		this.customerBo = customerBo;
	}

	public Object getModel() {
		return customer;
	}
	
	public List&lt;Customer&gt; getCustomerList() {
		return customerList;
	}

	public void setCustomerList(List&lt;Customer&gt; customerList) {
		this.customerList = customerList;
	}

	//save customer
	public String addCustomer() throws Exception{
		
		//save it
		customer.setCreatedDate(new Date());
		customerBo.addCustomer(customer);
	 
		//reload the customer list
		customerList = null;
		customerList = customerBo.listCustomer();
		
		return "success";
	
	}
	
	//list all customers
	public String listCustomer() throws Exception{
		
		customerList = customerBo.listCustomer();
		
		return "success";
	
	}
	
}</pre> 
 <h2> 6. Spring相关配置 </h2> 
 <div>
   几乎所有的配置都是在这里完成是由Spring专门来整合。 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>CustomerBean.xml</strong>&nbsp;–&nbsp;<span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">声明 Spring 的 bean：Action,&nbsp;BO&nbsp;和&nbsp;DAO.</span> </p> 
 <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;
 
 	&lt;bean id="customerAction" class="com.yiibai.customer.action.CustomerAction"&gt;
		&lt;property name="customerBo" ref="customerBo" /&gt;	
	&lt;/bean&gt;

	&lt;bean id="customerBo" class="com.yiibai.customer.bo.impl.CustomerBoImpl" &gt;
		&lt;property name="customerDAO" ref="customerDAO" /&gt;
	&lt;/bean&gt;
	
   	&lt;bean id="customerDAO" class="com.yiibai.customer.dao.impl.CustomerDAOImpl" &gt;
		&lt;property name="sessionFactory" ref="sessionFactory" /&gt;
	&lt;/bean&gt;
 
&lt;/beans&gt;</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>database.properties</strong>&nbsp;– 声明数据库详细信息 </p> 
 <pre>jdbc.driverClassName=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/yiibai
jdbc.username=root
jdbc.password=password</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>DataSource.xml</strong>&nbsp;– 创建一个数据库源的Bean&nbsp; </p> 
 <pre>&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;
 
 &lt;bean 
   class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt;
   &lt;property name="location"&gt;
     &lt;value&gt;WEB-INF/classes/config/database/properties/database.properties&lt;/value&gt;
   &lt;/property&gt;
&lt;/bean&gt;
 
  &lt;bean id="dataSource" 
         class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;
	&lt;property name="driverClassName" value="${jdbc.driverClassName}" /&gt;
	&lt;property name="url" value="${jdbc.url}" /&gt;
	&lt;property name="username" value="${jdbc.username}" /&gt;
	&lt;property name="password" value="${jdbc.password}" /&gt;
  &lt;/bean&gt;
 
&lt;/beans&gt;</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>HibernateSessionFactory.xml</strong>&nbsp;–&nbsp;<span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">创建一个SessionFactory Bean来集成Spring和Hibernate。</span> </p>   
 <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;
 
&lt;!-- Hibernate session factory --&gt;
&lt;bean id="sessionFactory" 
    class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
 
    &lt;property name="dataSource"&gt;
      &lt;ref bean="dataSource"/&gt;
    &lt;/property&gt;
 
    &lt;property name="hibernateProperties"&gt;
       &lt;props&gt;
         &lt;prop key="hibernate.dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/prop&gt;
         &lt;prop key="hibernate.show_sql"&gt;true&lt;/prop&gt;
       &lt;/props&gt;
    &lt;/property&gt;
 
    &lt;property name="mappingResources"&gt;
		&lt;list&gt;
          &lt;value&gt;com/yiibai/customer/hibernate/Customer.hbm.xml&lt;/value&gt;
		&lt;/list&gt;
    &lt;/property&gt;	
 
&lt;/bean&gt;
&lt;/beans&gt;</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>SpringBeans.xml</strong>&nbsp;–&nbsp;<span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">创建一个核心 Spring 的 bean 配置文件，作为中央的 bean 管理层。</span> </p> 
 <pre>&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;
	
	&lt;!-- Database Configuration --&gt;
	&lt;import resource="config/spring/DataSource.xml"/&gt;
	&lt;import resource="config/spring/HibernateSessionFactory.xml"/&gt;
 
	&lt;!-- Beans Declaration --&gt;
	&lt;import resource="com/yiibai/customer/spring/CustomerBean.xml"/&gt;
 
&lt;/beans&gt;</pre> 
 <h2> 7. JSP 页面 </h2> 
 <div>
   JSP页面来显示使用 Struts2 标签的元素。 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>customer.jsp</strong> </p> 
 <pre>&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt;
&lt;html&gt;
&lt;head&gt;
&lt;/head&gt;
 
&lt;body&gt;
&lt;h1&gt;Struts 2 + Spring + Hibernate integration example&lt;/h1&gt;

&lt;h2&gt;Add Customer&lt;/h2&gt;
&lt;s:form action="addCustomerAction" &gt;
  &lt;s:textfield name="name" label="Name" value="" /&gt;
  &lt;s:textarea name="address" label="Address" value="" cols="50" rows="5" /&gt;
  &lt;s:submit /&gt;
&lt;/s:form&gt;

&lt;h2&gt;All Customers&lt;/h2&gt;

&lt;s:if test="customerList.size() &gt; 0"&gt;
&lt;table border="1px" cellpadding="8px"&gt;
	&lt;tr&gt;
		&lt;th&gt;Customer Id&lt;/th&gt;
		&lt;th&gt;Name&lt;/th&gt;
		&lt;th&gt;Address&lt;/th&gt;
		&lt;th&gt;Created Date&lt;/th&gt;
	&lt;/tr&gt;
	&lt;s:iterator value="customerList" status="userStatus"&gt;
		&lt;tr&gt;
			&lt;td&gt;&lt;s:property value="customerId" /&gt;&lt;/td&gt;
			&lt;td&gt;&lt;s:property value="name" /&gt;&lt;/td&gt;
			&lt;td&gt;&lt;s:property value="address" /&gt;&lt;/td&gt;
			&lt;td&gt;&lt;s:date name="createdDate" format="dd/MM/yyyy" /&gt;&lt;/td&gt;
		&lt;/tr&gt;
	&lt;/s:iterator&gt;
&lt;/table&gt;
&lt;/s:if&gt;
&lt;br/&gt;
&lt;br/&gt;

&lt;/body&gt;
&lt;/html&gt;</pre> 
 <h2 style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:24px;font-weight:500;"> 8. struts.xml </h2> 
 <pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE struts PUBLIC
"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
"http://struts.apache.org/dtds/struts-2.0.dtd"&gt;
 
&lt;struts&gt;
 	&lt;constant name="struts.devMode" value="true" /&gt;
 	
	&lt;package name="default" namespace="/" extends="struts-default"&gt;
		
		&lt;action name="addCustomerAction" 
			class="customerAction" method="addCustomer" &gt;
		    &lt;result name="success"&gt;pages/customer.jsp&lt;/result&gt;
		&lt;/action&gt;
	
		&lt;action name="listCustomerAction"
			class="customerAction" method="listCustomer" &gt;
		    &lt;result name="success"&gt;pages/customer.jsp&lt;/result&gt;
		&lt;/action&gt;
		
	&lt;/package&gt;
	
&lt;/struts&gt;</pre> 
 <h2> 9. Struts 2 + Spring </h2> 
 <p> 要集成Struts2和Spring，只需注册ContextLoaderListener监听器类，定义一个“contextConfigLocation”参数要求Spring容器来解析“SpringBeans.xml”，而不使用默认的“applicationContext.xml”。 </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>web.xml</strong> </p> 
 <pre>&lt;!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Struts 2 Web Application&lt;/display-name&gt;
  
  &lt;filter&gt;
	&lt;filter-name&gt;struts2&lt;/filter-name&gt;
	&lt;filter-class&gt;
	  org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter
	&lt;/filter-class&gt;
  &lt;/filter&gt;
  
  &lt;filter-mapping&gt;
	&lt;filter-name&gt;struts2&lt;/filter-name&gt;
	&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
 
  &lt;context-param&gt;
	&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
	&lt;param-value&gt;/WEB-INF/classes/SpringBeans.xml&lt;/param-value&gt;
  &lt;/context-param&gt;
  
  &lt;listener&gt;
    &lt;listener-class&gt;
      org.springframework.web.context.ContextLoaderListener
    &lt;/listener-class&gt;
  &lt;/listener&gt;
  
&lt;/web-app&gt;</pre> 
 <h2> 10. 运行实例 </h2> 
 <p> 在浏览器中打开网址 :&nbsp;http://localhost:8080/ssh/listCustomerAction.action<br> <img src="/uploads/tutorial/20151202/1-151202215R1409.png" alt=""> </p> 
 <p> <img src="/uploads/tutorial/20151202/1-151202215T43D.png" alt=""> </p> 
 <h2> 参考 </h2> 
 <ol> 
  <li> <a target="_blank" href="http://www.yiibai.com/struts2/struts-2-hibernate-integration-example/">Struts2 + Hibernate集成实例</a> </li> 
  <li> <a target="_blank" href="http://www.yiibai.com/struts2/struts-2-spring-integration-example/">Struts2 + Spring集成实例</a> </li> 
  <li> <a target="_blank" href="http://www.yiibai.com/struts2/struts-2-hibernate-integration-with-full-hibernate-plugin/">Struts2 + Hibernate 使用 Full Hibernate Plugin插件集成</a> </li> 
 </ol> 
 <div>
   代码下载 -&nbsp;
  <a target="_blank" href="http://pan.baidu.com/s/1mgzt1Xm">http://pan.baidu.com/s/1mgzt1Xm</a>&nbsp;(含ssh相关类库，详见 lib 目录，文件大小约：18M)。 
 </div>
 <br>      
</div></body></html>
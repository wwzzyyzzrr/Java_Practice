<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Struts2的ActionError＆ActionMessage示例</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    本教程显示使用Struts2的 ActionError 和 ActionMessage 类。 
  </div> 
 </div> 
 <p> 1.&nbsp;ActionError&nbsp;–&nbsp;是用来发送错误信息反馈给用户&nbsp;- 通过&nbsp;&lt;s:actionerror/&gt;&nbsp;来显示。 </p> 
 <pre>&lt;s:if test="hasActionErrors()"&gt;
   &lt;div class="errors"&gt;
      &lt;s:actionerror/&gt;
   &lt;/div&gt;
&lt;/s:if&gt;</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> 2.&nbsp;<strong>ActionMessage</strong>&nbsp;–&nbsp;<span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">用于发送信息的反馈消息给用户，</span><span style="line-height:1.5;"><span style="font-family:微软雅黑;font-size:14px;">通过&nbsp;</span></span><strong>&lt;s:actionmessage/&gt;&nbsp;</strong><span style="line-height:1.5;">来显示。</span> </p> 
 <pre>&lt;s:if test="hasActionMessages()"&gt;
   &lt;div class="welcome"&gt;
      &lt;s:actionmessage/&gt;
   &lt;/div&gt;
&lt;/s:if&gt;&nbsp;</pre> 
 <p> 这里有一个简单的登录表单，如果用户名不等于“yiibai.com”将显示错误消息(actionerror)，否则重定向到另一个页面，显示欢迎信息(ActionMessage)。此外，所有的标签和错误消息检索来自资源包(属性文件)。 </p> 
 <h2> 1. 文件夹结构 </h2> 
 <p> 在MyEclipse中创建一个web工程，名称为：struts2-errormsg，看这个项目结构，如下图： </p> 
 <p> <img src="/uploads/tutorial/20151113/1-1511130G55DT.png" alt=""> </p> 
 <div> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/a7e99685221b47a2b7fc7bd9b9813267/clipboard.png"> 
 </div> 
 <h2> 2.&nbsp;属性文件 </h2> 
 <div>
   一共有两个属性文件用来存储信息，其中 LoginAction.properties 文件放在&nbsp;com.yiibai.user.action 包下。 
 </div> 
 <p> LoginAction.properties </p> 
 <pre class="prettyprint">#Welcome messages
welcome.hello = 你好
#error message
username.required = 用户名不可以为空
password.required = 密码不可以为空</pre> 
 <p> global.properties </p> 
 <pre class="prettyprint">#Global messages
global.username = 用户名
global.password = 密码
global.submit = 提交
global.reset = 重置</pre> 
 <h2> 3. 动作-Action </h2> 
 <p> 一个经典的动作类，做一个简单的检查，以确认用户名是否等于“yiibai.com"，并使用&nbsp;addActionError()设置错误信息或addActionMessage()设置成功的消息。 </p> 
 <pre>package com.yiibai.user.action;

import com.opensymphony.xwork2.ActionSupport;

public class LoginAction extends ActionSupport{

	private String username;
	private String password;
	 
	public String getPassword() {
		return password;
	}

	public void setPassword(String password) {
		this.password = password;
	}

	public String getUsername() {
		return username;
	}

	public void setUsername(String username) {
		this.username = username;
	}

	//business logic
	public String execute() {

		return "SUCCESS";

	}

	//simple validation
	public void validate(){
		if("yiibai.com".equals(getUsername())){
			addActionMessage("You are valid user!");
		}else{
			addActionError("I don't know you, dont try to hack me!");
		}
	}
}</pre> 
 <h2> 4. JSP页面视图 </h2> 
 <div>
   两个简单的JSP页面以及CSS样式自定义错误消息。 
 </div> 
 <p> login.jsp </p> 
 <pre class="prettyprint lang-html">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Struts2 ActionError &amp; ActionMessage 示例&lt;/title&gt;
&lt;style type="text/css"&gt;
.errors {
    background-color:#FFCCCC;
    border:1px solid #CC0000;
    width:400px;
    margin-bottom:8px;
}
.errors li{ 
    list-style: none; 
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Struts2 ActionError &amp; ActionMessage 示例&lt;/h1&gt;
&lt;s:if test="hasActionErrors()"&gt;
   &lt;div class="errors"&gt;
      &lt;s:actionerror/&gt;
   &lt;/div&gt;
&lt;/s:if&gt;
&lt;s:form action="validateUser"&gt;
    &lt;s:textfield key="global.username" name="username"/&gt;
    &lt;s:password key="global.password" name="password"/&gt;
    &lt;s:submit key="global.submit" name="submit"/&gt;
&lt;/s:form&gt;
&lt;/body&gt;
&lt;/html&gt;</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>welcome.jsp</strong> </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong> </strong> </p> 
 <pre class="prettyprint lang-html"><strong>&lt;%@ page contentType="text/html; charset=UTF-8"%&gt;
&lt;%@ taglib prefix="s" uri="/struts-tags"%&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Struts2 ActionError &amp; ActionMessage 示例&lt;/title&gt;
&lt;style type="text/css"&gt;
.welcome {
    background-color: #DDFFDD;
    border: 1px solid #009900;
    width: 200px;
}
.welcome li {
    list-style: none;
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Struts 2 ActionError &amp; ActionMessage示例&lt;/h1&gt;
    &lt;s:if test="hasActionMessages()"&gt;
        &lt;div class="welcome"&gt;
            &lt;s:actionmessage /&gt;
        &lt;/div&gt;
    &lt;/s:if&gt;
    &lt;h4&gt;
        &lt;s:property value="getText('welcome.hello')" /&gt;
        &lt;s:property value="username" /&gt;
    &lt;/h4&gt;
&lt;/body&gt;
&lt;/html&gt;</strong></pre> 
 <h2> 5. struts.xml </h2> 
 <p> 链接所有的在一起 </p>   
 <pre class="prettyprint lang-xml">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE struts PUBLIC
"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
"http://struts.apache.org/dtds/struts-2.0.dtd"&gt;

&lt;struts&gt;
  &lt;constant name="struts.custom.i18n.resources" value="global" /&gt;

  &lt;package name="user" namespace="/user" extends="struts-default"&gt;
     &lt;action name="login"&gt;
	 &lt;result&gt;/pages/login.jsp&lt;/result&gt;
     &lt;/action&gt;
     &lt;action name="validateUser" class="com.yiibai.user.action.LoginAction"&gt;
	 &lt;result name="SUCCESS"&gt;/pages/welcome.jsp&lt;/result&gt;
	 &lt;result name="input"&gt;/pages/login.jsp&lt;/result&gt;
     &lt;/action&gt;
   &lt;/package&gt;
	
&lt;/struts&gt;</pre> 
 <div> 
  <div>
    在Struts2，ActionError和ActionMessage功能和用法与Struts1非常相似。 
  </div> 
 </div> 
 <h2> 6. 运行并测试 </h2> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <em>http://localhost:8080/struts2-errormsg/user/login.action</em> </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <em><img src="/uploads/tutorial/20151113/1-1511130GUA01.png" alt=""><br> </em> </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">用户名是无效的，显示错误信息：</span>&lt;s:actionerror/&gt; </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <img src="/uploads/tutorial/20151113/1-1511130G93Na.png" alt=""> </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">用户名是有效的，显示欢迎信息：</span>&lt;s:actionmessage/&gt; </p> 
 <p> <img src="/uploads/tutorial/20151113/1-1511130H011408.png" alt=""> </p> 
 <p> <span><br> </span> </p> 
 <p> <span>源代码下载 –&nbsp;</span><a target="_blank" href="http://pan.baidu.com/s/1pJkYCPH">Struts2-ActionError-ActionMessage.zip</a> </p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Struts2文件上传例子</h1><div style="width:100%;float:left;" class="article-content">   
 <p> 在Struts2， &lt;s:file&gt; 标签用于创建一个HTML文件上传组件，允许用户从本地磁盘选择文件，并将其上传到服务器。在本教程中，您将创建与文件上传组件JSP页面，设置最大大小和允许上传文件的内容类型，并显示上传文件的详细信息。 </p> 
 <p> <span style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;line-height:22px;background-color:#FFFFFF;">这里创建一个Web工程：strut2uploadfile，来演示</span><span style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;line-height:22px;background-color:#FFFFFF;">在多个复选框</span><span style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;line-height:22px;background-color:#FFFFFF;">如何设置的默认值，整个项目的结构如下图所示：</span> </p> 
 <p> <img src="/uploads/tutorial/20151115/1-15111514191U01.png" alt=""> </p> 
 <h2> 1. 动作类 </h2> 
 <p> Action类的文件上传，声明“File”变量来存储用户上传的文件，两个字符串变量以存储文件名和内容类型。“文件上传拦截器”通过设置“X”的ContentType()，并设置“X”FileName()会自动注入上传的文件细节，确保方法名拼写正确。 </p> 
 <p> P.S X是以存储上传的文件中的变量。 </p> 
 <div class="note" style="border:1px solid #D1D1E8;padding:20px;margin:20px 0px;color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#E6E6FC;">
   文件上传功能是依赖于“文件上传拦截器”，确保将其纳入行动的堆栈。幸运的是，默认的堆栈已经包含了“文件上传拦截器”。 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> <strong>FileUploadAction.java</strong> </p> 
 <pre>package com.yiibai.common.action;

import java.io.File;

import com.opensymphony.xwork2.ActionSupport;

public class FileUploadAction extends ActionSupport{

	private File fileUpload;
	private String fileUploadContentType;
	private String fileUploadFileName;

	public String getFileUploadContentType() {
		return fileUploadContentType;
	}

	public void setFileUploadContentType(String fileUploadContentType) {
		this.fileUploadContentType = fileUploadContentType;
	}

	public String getFileUploadFileName() {
		return fileUploadFileName;
	}

	public void setFileUploadFileName(String fileUploadFileName) {
		this.fileUploadFileName = fileUploadFileName;
	}

	public File getFileUpload() {
		return fileUpload;
	}

	public void setFileUpload(File fileUpload) {
		this.fileUpload = fileUpload;
	}

	public String execute() throws Exception{
		
		return SUCCESS;
		
	}
	
	public String display() {
		return NONE;
	}
	
}</pre> 
 <h2> 2. 结果页面 </h2> 
 <p> 使用&lt;s:file&gt;标签来渲染一个文件上传组件，并设置表单的enctype类型为：“multipart/form-data”。 </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> <strong>fileupload.jsp</strong> </p> 
 <pre>&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt;
&lt;html&gt;
&lt;head&gt;
&lt;s:head /&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;h1&gt;Struts 2 &lt;s:file&gt; file upload example&lt;/h1&gt;

&lt;s:form action="resultAction" namespace="/" 
method="POST" enctype="multipart/form-data"&gt;

&lt;s:file name="fileUpload" label="Select a File to upload" size="40" /&gt;

&lt;s:submit value="submit" name="submit" /&gt;
	
&lt;/s:form&gt;

&lt;/body&gt;
&lt;/html&gt;</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> <strong>result.jsp</strong> </p> 
 <pre>&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt;
&lt;html&gt;

&lt;body&gt;
&lt;h1&gt;Struts 2 &lt;s:file&gt; file upload example&lt;/h1&gt;

&lt;div&gt;&lt;div class="ads-in-post hide_if_width_less_800"&gt;
&lt;script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"&gt;&lt;/script&gt;
&lt;!-- 728x90 - After2ndH4 --&gt;
&lt;ins class="adsbygoogle hide_if_width_less_800" 
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-2836379775501347"
     data-ad-slot="3642936086"
	 data-ad-region="yiibairegion"&gt;&lt;/ins&gt;
&lt;script&gt;
(adsbygoogle = window.adsbygoogle || []).push({});
&lt;/script&gt;
&lt;/div&gt;&lt;/div&gt;&lt;h2&gt;
   File Name : &lt;s:property value="fileUploadFileName"/&gt; 
&lt;/h2&gt; 

&lt;h2&gt;
   Content Type : &lt;s:property value="fileUploadContentType"/&gt; 
&lt;/h2&gt; 

&lt;h2&gt;
   File : &lt;s:property value="fileUpload"/&gt; 
&lt;/h2&gt; 

&lt;/body&gt;
&lt;/html&gt;</pre> 
 <h2 style="font-family:'Helvetica Neue', Helvetica,  font-weight:500;color:#333333;font-size:24px;background-color:#FFFFFF;"> 3. struts.xml </h2> 
 <pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE struts PUBLIC
"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
"http://struts.apache.org/dtds/struts-2.0.dtd"&gt;
 
&lt;struts&gt;

 	&lt;constant name="struts.devMode" value="true" /&gt;
 	&lt;constant name="struts.custom.i18n.resources" value="global" /&gt;
 	
	&lt;package name="default" namespace="/" extends="struts-default"&gt;
		
	&lt;action name="fileUploadAction" 
	    class="com.yiibai.common.action.FileUploadAction" method="display"&gt;
	    &lt;result name="none"&gt;/pages/fileupload.jsp&lt;/result&gt;
	&lt;/action&gt;
		
	&lt;action name="resultAction" class="com.yiibai.common.action.FileUploadAction"&gt;
	    &lt;interceptor-ref name="exception"/&gt;
            &lt;interceptor-ref name="i18n"/&gt;
            &lt;interceptor-ref name="fileUpload"&gt;
       		&lt;param name="allowedTypes"&gt;text/plain&lt;/param&gt;
       		&lt;param name="maximumSize"&gt;10240&lt;/param&gt;
  	    &lt;/interceptor-ref&gt; 
            &lt;interceptor-ref name="params"&gt;
                &lt;param name="excludeParams"&gt;dojo\..*,^struts\..*&lt;/param&gt;
            &lt;/interceptor-ref&gt;
            &lt;interceptor-ref name="validation"&gt;
                &lt;param name="excludeMethods"&gt;input,back,cancel,browse&lt;/param&gt;
            &lt;/interceptor-ref&gt;
            &lt;interceptor-ref name="workflow"&gt;
                &lt;param name="excludeMethods"&gt;input,back,cancel,browse&lt;/param&gt;
            &lt;/interceptor-ref&gt;
    
	    &lt;result name="success"&gt;/pages/result.jsp&lt;/result&gt;
	    &lt;result name="input"&gt;/pages/fileupload.jsp&lt;/result&gt;
			
	&lt;/action&gt;
   &lt;/package&gt;	
&lt;/struts&gt;</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> <strong>文件大小限制</strong><br> 在这个例子中，您将通过“文件上传拦截”上传文件大小的限制,&nbsp;该值以字节为单位计数。在本实例中，上载文件的最大尺寸是10KB。 </p> 
 <div class="note" style="border:1px solid #D1D1E8;padding:20px;margin:20px 0px;color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#E6E6FC;">
   注：上传文件的默认最大文件大小为2MB 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> <strong>文件类型</strong><br> 可以通过设置“文件上传拦截器”允许的文件类型。在这种情况下，上传文件只接受“text/plain”<span style="color:#333333;">的</span>类型。<span id="__kindeditor_bookmark_end_98__"></span> </p> 
 <div class="note" style="border:1px solid #D1D1E8;padding:20px;margin:20px 0px;color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#E6E6FC;">
   在Struts2中，有好几种方面做到这一点，查看
  <a target="_blank" href="http://struts.apache.org/2.0.14/docs/file-upload.html">Struts2的文件上传文档</a>。 
 </div> 
 <h2 style="font-family:'Helvetica Neue', Helvetica,  font-weight:500;color:#333333;font-size:24px;background-color:#FFFFFF;"> 4. 示例 </h2> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> <em>http://localhost:8080/Struts2Example/fileUploadAction.action</em> </p> 
 <div class="pic" style="border:1px solid #DDDDDD;margin:20px 0px;padding:20px;text-align:center;color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#F9F9F9;"> 
  <img src="/uploads/tutorial/20151115/1-1511151415163K.png" alt="">
  <br> 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> 错误信息提示，如果您上传一个文件，该文件超过10KB，或者未选文本文件。 </p> 
 <div class="pic" style="border:1px solid #DDDDDD;margin:20px 0px;padding:20px;text-align:center;color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#F9F9F9;"> 
  <img src="/uploads/tutorial/20151115/1-151115141T63W.png" alt="">
  <br> 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> 上传名为“yiibai.com.txt”<span style="color:#333333;">的文本文件</span>, 文件大小 : 5kb. </p> 
 <div class="pic" style="border:1px solid #DDDDDD;margin:20px 0px;padding:20px;text-align:center;color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#F9F9F9;"> 
  <img src="/uploads/tutorial/20151115/1-151115141G25T.png" alt="">
  <br> 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> 上传的文件将被视为一个临时文件，具有长的随机文件名，如：upload__376584a7_12981122379__8000_00000010.tmp. 请确保这个临时文件复制到其他地方。 阅读<a target="_blank" href="http://commons.apache.org/io/api-1.4/org/apache/commons/io/FileUtils.html">文件实用文档</a>复制文件。 </p> 
 <h2 style="font-family:'Helvetica Neue', Helvetica,  font-weight:500;color:#333333;font-size:24px;background-color:#FFFFFF;"> 参考 </h2> 
 <ol style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> 
  <li> <a target="_blank" href="http://struts.apache.org/2.x/docs/file.html">Struts 2 文件文档</a> </li> 
  <li> <a target="_blank" href="http://struts.apache.org/2.0.14/docs/file-upload.html">http://struts.apache.org/2.0.14/docs/file-upload.html</a> </li> 
  <li> <a target="_blank" href="http://struts.apache.org/2.0.14/docs/how-do-we-upload-files.html">http://struts.apache.org/2.0.14/docs/how-do-we-upload-files.html</a> </li> 
  <li> <a target="_blank" href="http://commons.apache.org/io/api-1.4/org/apache/commons/io/FileUtils.html">http://commons.apache.org/io/api-1.4/org/apache/commons/io/FileUtils.html</a> </li> 
 </ol> 
 <p> <br> </p> 
 <p> 下载代码 –&nbsp;<a target="_blank" href="http://pan.baidu.com/s/1eQDH07S">http://pan.baidu.com/s/1eQDH07S</a> </p>
 <br>      
</div></body></html>
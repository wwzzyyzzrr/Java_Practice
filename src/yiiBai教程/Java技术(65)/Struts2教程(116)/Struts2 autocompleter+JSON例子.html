<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Struts2 autocompleter+JSON例子</h1><div style="width:100%;float:left;" class="article-content">   
 <p> 在上一章&nbsp;<a target="_blank" href="http://www.yiibai.com/struts_2/struts-2-autocompleter-example.html">Struts2 autocompleter 例子</a>，已经了解如何通过Java列表，ONGL表达生成 autocompleter 选择选项组件列表。另外，也有可能产生通过JSON数据选择的选择也是如此。 </p> 
 <p> <span style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;line-height:22px;background-color:#FFFFFF;">这里创建一个Web工程：strut2<span style="color:#333333;">autocompleterjson</span>，来演示</span><span style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;line-height:22px;background-color:#FFFFFF;">在多个复选框</span><span style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;line-height:22px;background-color:#FFFFFF;">如何设置的默认值，整个项目的结构如下图所示：</span> </p> 
 <p> <img src="/uploads/tutorial/20151116/1-151116142220V0.png" alt=""> </p> 在开始之前，请确保您了解autocompleter组件和JSON插件的基本用法。阅读下面的文章。 
 <ol> 
  <li> <a target="_blank" href="http://www.yiibai.com/struts_2/struts-2-autocompleter-example.html">Struts2 AutoCompleter示例</a> </li> 
  <li> <a target="_blank" href="http://www.yiibai.com/struts_2/struts-2-and-json-example.html">Struts2 JSON示例</a> </li> 
 </ol> 
 <h2 style="font-family:'Helvetica Neue', Helvetica,  font-weight:500;color:#333333;font-size:24px;background-color:#FFFFFF;"> Struts2 autocompleter + JSON 示例 </h2> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> 在本教程中，将使用Struts2的JSON插件将对象转换成JSON格式，并把它传递给autocompleter组件。 </p> 
 <h2 style="font-family:'Helvetica Neue', Helvetica,  font-weight:500;color:#333333;font-size:24px;background-color:#FFFFFF;"> 1. 动作 </h2> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> 一个类用来转换成JSON格式，提供autocompleter组件列表的<span style="color:#333333;">选择选项</span>。 </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> <strong>DatabaseJSON.java</strong> </p> 
 <pre>package com.yiibai.common.action;

import java.util.HashMap;
import java.util.Map;

import com.opensymphony.xwork2.Action;

public class DatabaseJSON{
	
	private Map&lt;String, String&gt; databases = new HashMap&lt;String, String&gt;();
	
	public DatabaseJSON(){
		databases.put("MySQL", "MySQL");
		databases.put("Oracle", "Oracle");
		databases.put("PostgreSQL", "PostgreSQL");
		databases.put("Microsoft SQL Server", "Microsoft SQL Server");
		databases.put("DB2", "DB2");
		databases.put("Others", "Others");
	}

	public String execute() {
                return Action.SUCCESS;
	}
	
	public Map&lt;String, String&gt; getDatabases() {
		return databases;
	}

	public void setDatabases(Map&lt;String, String&gt; databases) {
		this.databases = databases;
	}
}</pre> 
 <p> 一个正常的Action类，只是在做重定向工作和存储autocompleter值。<br> <strong>AutoCompleterAction.java</strong> </p> 
 <pre>package com.yiibai.common.action;
 
import com.opensymphony.xwork2.ActionSupport;
 
public class AutoCompleterAction extends ActionSupport{
 
	private String yourDatabase;
	
	public String display() {
		return NONE;
	}

	public String getYourDatabase() {
		return yourDatabase;
	}

	public void setYourDatabase(String yourDatabase) {
		this.yourDatabase = yourDatabase;
	}

}</pre> 
 <h2> 3. 结果 </h2> 
 <p> 有点棘手在这里，用“s:url”标签指向一个“databaseJSON”的动作，这将返回JSON格式的选项的列表。并经由href=”%{databaseList}”链接到autocompleter组件。 </p> 
 <pre>&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt;
&lt;%@ taglib prefix="sx" uri="/struts-dojo-tags" %&gt;
 
&lt;html&gt;
&lt;head&gt;
&lt;sx:head /&gt;
&lt;/head&gt;
 
&lt;body&gt;
&lt;h1&gt;Struts 2 autocompleter + JSON example&lt;/h1&gt;
 
&lt;s:form action="resultAction" namespace="/" method="POST" &gt;

&lt;s:url id="databaseList" action="databaseJSON" /&gt;

&lt;sx:autocompleter label="What's your favorite Database Server?" 
href="%{databaseList}" name="yourFavDatabase" /&gt;
 
&lt;s:submit value="submit" name="submit" /&gt;
 
&lt;/s:form&gt;
 
&lt;/body&gt;
&lt;/html&gt;</pre> 
 <h2 style="font-family:'Helvetica Neue', Helvetica,  font-weight:500;color:#333333;font-size:24px;background-color:#FFFFFF;"> 4. struts.xml </h2> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> 配置操作和JSON提供如下： </p> 
 <div class="note" style="border:1px solid #D1D1E8;padding:20px;margin:20px 0px;color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#E6E6FC;"> 
  <strong>&lt;param name=”root”&gt;databases&lt;/param&gt;</strong>
  <br> 这意味着，转换DatabaseJSON的数据库属性成JSON格式，而是整个对象。 
 </div>   
 <pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE struts PUBLIC
"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
"http://struts.apache.org/dtds/struts-2.0.dtd"&gt;
 
&lt;struts&gt;

 	&lt;constant name="struts.devMode" value="true" /&gt;
	
	&lt;package name="json" namespace="/" extends="json-default"&gt;
     	    &lt;action name="databaseJSON" 
     		class="com.yiibai.common.action.DatabaseJSON"&gt;
       	 	&lt;result type="json" &gt;
       	 		&lt;param name="root"&gt;databases&lt;/param&gt;
       	 	&lt;/result&gt;
     	    &lt;/action&gt;
  	&lt;/package&gt;
	
	&lt;package name="default" namespace="/" extends="struts-default"&gt;
	    &lt;action name="autoCompleterAction" 
		class="com.yiibai.common.action.AutoCompleterAction" 
	        method="display"&gt;
		&lt;result name="none"&gt;/pages/autocompleter-json.jsp&lt;/result&gt;
	    &lt;/action&gt;
		 
	    &lt;action name="resultAction" 
	        class="com.yiibai.common.action.AutoCompleterAction" &gt;
		&lt;result name="success"&gt;/pages/result.jsp&lt;/result&gt;
	    &lt;/action&gt;
	&lt;/package&gt;
		
&lt;/struts&gt;</pre> 
 <h2> 4. 例子 </h2> 
 <p> 访问URL的动作，现在 autocompleter 选择选项是由JSON数据提供。 </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> <em>http://localhost:8080/strut2autocompleterjson/autoCompleterAction.action</em> </p> 
 <div class="pic" style="border:1px solid #DDDDDD;margin:20px 0px;padding:20px;text-align:center;color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#F9F9F9;"> 
  <img src="/uploads/tutorial/20151115/1-151115203Z3149.png" alt=""> 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> 或者，可以通过以下网址直接访问JSON数据<br> <em>http://localhost:8080/strut2autocompleterjson/databaseJSON.action</em> </p> 
 <pre>{
   "PostgreSQL":"PostgreSQL",
   "MySQL":"MySQL",
   "Others":"Others",
   "Oracle":"Oracle",
   "Microsoft SQL Server":"Microsoft SQL Server",
   "DB2":"DB2"
}</pre> 
 <h2> 参数 </h2> 
 <ol> 
  <li> <a target="_blank" href="http://struts.apache.org/2.1.8.1/docs/json-plugin.html">Struts 2 JSON 插件</a> </li> 
  <li> <a target="_blank" href="http://www.json.org/">JSON 官方文档</a> </li> 
  <li> <a target="_blank" href="http://www.yiibai.com/struts_2/struts-2-autocompleter-example.html">Struts 2 autocompleter示例</a> </li> 
  <li> <a target="_blank" href="http://www.yiibai.com/struts_2/struts-2-and-json-example.html">Struts 2 JSON 示例</a> </li> 
 </ol> 
 <br> 代码下载：
 <a target="_blank" href="http://pan.baidu.com/s/1i3o8QzF">http://pan.baidu.com/s/1i3o8QzF</a>
 <br>      
</div></body></html>
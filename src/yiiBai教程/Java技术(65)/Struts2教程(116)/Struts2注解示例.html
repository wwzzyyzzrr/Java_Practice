<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Struts2注解示例</h1><div style="width:100%;float:left;" class="article-content">   
 <div>
   在这个教程，我们重复使用以前 STRUST2 &nbsp;Hello&nbsp;World(XML版本)的例子，并将其转换成注解版本。 
 </div> 
 <h2> Struts2&nbsp;注解概念 </h2> 
 <div>
   Struts2注解是由Struts&nbsp;2的约定插件的支持，所以，必须要了解其背后的“扫描方法”和“命名转换”机制的魔力。 
 </div> 
 <h2> 1.&nbsp;扫描方法 </h2> 
 <div>
   许多Struts&nbsp;2的文章或书籍说，可以配置过滤器的“init-param”或“struts.convention.action.packages”告诉Struts2，其中扫描注解的类。&nbsp;例如， 
 </div> 
 <p> <strong>web.xml</strong> </p> 
 <pre class="prettyprint lang-xml">&lt;filter&gt;
  &lt;filter-name&gt;struts2&lt;/filter-name&gt;
  &lt;filter-class&gt;org.apache.struts2.dispatcher.FilterDispatcher&lt;/filter-class&gt;
  &lt;init-param&gt;
	&lt;param-name&gt;actionPackages&lt;/param-name&gt;
	&lt;param-value&gt;com.yiibai.common&lt;/param-value&gt;
  &lt;/init-param&gt;
&lt;/filter&gt;</pre> 
 <p> 从测试(Struts22.1.6和2.1.8版本)，这是不正确的，不管你把在“param-value”还是&nbsp;“struts.convention.action.packages“,&nbsp;在Struts&nbsp;2会忽略它，并只扫描指定的文件夹命名：struts,&nbsp;struts2,&nbsp;action&nbsp;或&nbsp;actions&nbsp;。 </p> 
 <div>
   下面是扫描工作 
 </div> 
 <ol> 
  <li> 扫描其位于包的命名注解的类&nbsp;“struts, struts2, action 或 actions“. </li> 
  <li> 
   <div>
     接着，扫描相匹配下列任一条件的文件： 
   </div> 
   <ul> 
    <li> 实例了&nbsp;com.opensymphony.xwork2.Action&nbsp;接口。 </li> 
    <li> 扩展了&nbsp;com.opensymphony.xwork2.ActionSupport&nbsp;类 </li> 
    <li> 
     <div>
       文件名用动作(例如：UserAction，LoginAction)结束 
     </div> </li> 
   </ul> </li> 
 </ol> 
 <p> 详细请查看这里<a target="_blank" href="http://struts.apache.org/docs/convention-plugin.html#ConventionPlugin-Codebehindhelloworld">Struts 2&nbsp;约定插件文件</a> </p> 
 <h2> 2.&nbsp;命名转换器 </h2> 
 <div>
   Struts&nbsp;2的约定插件将所有的注解操作文件名转换为指定的格式。 
 </div> 
 <p> 例如 :&nbsp;LoginAction.java </p> 
 <ol> 
  <li> 
   <div>
     首先，去掉“Action”字符在文件名的末尾，如果存在的话。 
   </div> </li> 
  <li> 
   <div>
     其次，转换文件名的第一个字母为小写。 
   </div> </li> 
 </ol> 
 <div>
   因此，去除结束并转换第一个字母为小写后，LoginAction.action 将变为 login.action。 
 </div> 
 <div>
   Struts2约定插件的“扫描方法”和“命名转换”特性真正带来了很多的便利和好处，只有当你的Struts2项目正确下面的命名约定才会带来好处; 否则，这将是一场灾难。 
 </div> 
 <h2> Struts 2&nbsp;注解例子 </h2> 
 <div>
   现在是时候开始转换过程了，我们使用MyEclipse 10 创建一个工程为：struts2example。 
 </div> 
 <h2> <p> 最终的项目结构 </p> <p> <img src="/uploads/tutorial/20151111/1-15111120113SE.png" alt=""> </p> </h2> 
 <h2> 2. LoginAction </h2> 
 <p> 扩展ActionSupport并创建了LoginAction，什么也不做，ActionSupport&nbsp;默认返回 “success” 字符串,这将匹配&nbsp;@Result 并重定位到 “pages/login.jsp“. </p> 
 <p> <strong>注解版本</strong> </p> 
 <pre class="prettyprint lang-java">package com.yiibai.user.action;

import org.apache.struts2.convention.annotation.Namespace;
import org.apache.struts2.convention.annotation.Result;
import org.apache.struts2.convention.annotation.ResultPath;

import com.opensymphony.xwork2.ActionSupport;

@Namespace("/User")
@ResultPath(value="/")
@Result(name="success",location="/login.jsp")
public class LoginAction extends ActionSupport{

}</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> <strong>XML 实现版本</strong> </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> <strong> </strong> </p> 
 <pre class="prettyprint lang-xml"><strong>&lt;package name="user" namespace="/User" extends="struts-default"&gt;
	&lt;action name="Login"&gt;
		&lt;result&gt;/login.jsp&lt;/result&gt;
	&lt;/action&gt;
&lt;/package&gt;</strong></pre> 
 <h2> 3. WelcomeUserAction </h2> 
 <p> 重写execute()方法并指定&nbsp;@Action 和 @Result 注解。 </p> 
 <p> <strong>注解版本</strong> </p> 
 <pre class="prettyprint lang-java">package com.yiibai.user.action;

import org.apache.struts2.convention.annotation.Action;
import org.apache.struts2.convention.annotation.Namespace;
import org.apache.struts2.convention.annotation.Result;
import org.apache.struts2.convention.annotation.ResultPath;

import com.opensymphony.xwork2.ActionSupport;

@Namespace("/User")
@ResultPath(value="/")
public class WelcomeUserAction extends ActionSupport{

	private String username;
	 
	public String getUsername() {
		return username;
	}

	public void setUsername(String username) {
		this.username = username;
	}

	@Action(value="Welcome", results={
		@Result(name="success",location="welcome_user.jsp")
	})
	public String execute() {

		return SUCCESS;

	}
}</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> <strong><strong>XML 实现版本</strong></strong> </p> 
 <pre class="prettyprint lang-xml">&lt;package name="user" namespace="/User" extends="struts-default"&gt;
   &lt;action name="Welcome" class="com.yiibai.user.action.WelcomeUserAction"&gt;
	&lt;result name="SUCCESS"&gt;/welcome_user.jsp&lt;/result&gt;
   &lt;/action&gt;
&lt;/package&gt;</pre> 
 <div>
   Struts 2 注解 –&nbsp;@Action,&nbsp;@Result&nbsp;和&nbsp;@Namespace&nbsp;不言自明，可以将它与XML比较。@ResultPath&nbsp;可能需要一点点的解释，请参阅本&nbsp;
  <a target="_blank" href="http://www.yiibai.com/struts2/struts-2-resultpath-annotation-example/">@ResultPath示例</a> 
 </div> 
 <h2> 4. JSP视图页面 </h2> 
 <div>
   普通JSP视图页面来接受用户名和密码后点击提交按钮，并重定向到一个欢迎页面。 
 </div> 
 <p> <strong>login.jsp</strong> </p>   
 <pre class="prettyprint lang-html">&lt;%@ page contentType="text/html; charset=UTF-8"%&gt;
&lt;%@ taglib prefix="s" uri="/struts-tags"%&gt;
&lt;html&gt;
&lt;head&gt;&lt;/head&gt;
&lt;body&gt;
	&lt;h1&gt;Struts 2 注解示例&lt;/h1&gt;

	&lt;s:form action="Welcome"&gt;
		&lt;s:textfield name="username" label="用户名" /&gt;
		&lt;s:password name="password" label="密码" /&gt;
		&lt;s:submit value="提交"/&gt;
	&lt;/s:form&gt;

&lt;/body&gt;
&lt;/html&gt;</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  background-color:#FFFFFF;"> <strong>welcome_user.jsp</strong> </p> 
 <pre class="prettyprint lang-html">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt;
&lt;html&gt;
&lt;head&gt;&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Struts 2 注解示例&lt;/h1&gt;

&lt;h4&gt;您好, &lt;s:property value="username"/&gt;&lt;/h4&gt;

&lt;/body&gt;
&lt;/html&gt;</pre> 
 <h2> 5. struts.xml </h2> 
 <div>
   所有类注解无需创建 struts.xml 文件。 
 </div> 
 <h2> 6. web.xml </h2> 
 <p> 只要创建一个典型的web.xml文件，并声明FilterDispatcher过滤器标准。 </p> 
 <pre class="prettyprint lang-xml">&lt;!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Struts 2 Web Application&lt;/display-name&gt;
  
  &lt;filter&gt;
	&lt;filter-name&gt;struts2&lt;/filter-name&gt;
	&lt;filter-class&gt;org.apache.struts2.dispatcher.FilterDispatcher&lt;/filter-class&gt;
  &lt;/filter&gt;
  
  &lt;filter-mapping&gt;
	&lt;filter-name&gt;struts2&lt;/filter-name&gt;
	&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
  
&lt;/web-app&gt;</pre> 
 <h2> 7. 运行测试 </h2> 
 <div>
   LoginAction.action 改为 login.action，请参阅上面的“命名转换器”。 
 </div> 
 <p> <a target="_blank" href="http://localhost:8080/struts2example/User/login.action">http://localhost:8080/struts2example/User/login.action</a> </p> 
 <p> <img src="/uploads/tutorial/20151111/1-151111200153Y1.png" alt=""> </p> 
 <div> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/3168b154cffb49249e4769b21020a0e5/clipboard.png"> 
 </div> 
 <p> 提交到&nbsp;<a target="_blank" href="http://localhost:8080/Struts2Example/User/Welcome.action">http://localhost:8080/Struts2Example/User/Welcome.action</a>&nbsp;后显示： </p> 
 <p> <img src="/uploads/tutorial/20151111/1-151111200213542.png" alt=""> </p> 
 <h2> 参考 </h2> 
 <ol> 
  <li> <a target="_blank" href="http://struts.apache.org/2.1.8/docs/convention-plugin.html">Struts 2 约定插件文档</a> </li> 
  <li> <a target="_blank" href="http://www.yiibai.com/struts_2/struts-2-hello-world-example.html">Strust 2 Hello World (XML 版本)</a> </li> 
 </ol>
 <br>      
</div></body></html>
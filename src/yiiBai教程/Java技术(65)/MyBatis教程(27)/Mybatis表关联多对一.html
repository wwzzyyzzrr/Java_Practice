<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Mybatis表关联多对一</h1><div style="width:100%;float:left;" class="article-content">   
 <p style="color:#535B60;"> 在上章的 一对多 中，我们已经学习如何在 Mybatis 中关联多表，但在实际项目中也是经常使用 多对一 的情况，这些查询是如何处理的呢，在这一节中我们来学习它。多表映射的多对一关系要用到 mybitis 的 association 来加以实现。这篇介绍的是多表中的多对一表关联查询。 </p> 
 <p style="color:#535B60;"> <span style="font-weight:700;">应用场景：</span>首先根据帖子 ID 读取一个帖子信息，然后再读取这个帖子所属的用户信息。 </p> 
 <h3 style="font-size:14pt;color:#53555C;"> 1、先做一些准备工作 </h3> 
 <span style="color:#535B60;line-height:22px;background-color:#FFFFFF;">我们首先在创建一个 java 工程，工程名称为：mybatis05-many2one(</span>下载
 <span style="color:#535B60;line-height:22px;background-color:#FFFFFF;">)，还需要创建两张表，它们分别是用户表 user，和帖子表 post，一个户用户可以有多个帖子。</span> 
 <p> <span style="font-weight:700;color:#535B60;line-height:22px;"><span style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;font-weight:700;color:#535B60;line-height:22px;">user表的结构和数据：</span><span style="color:#535B60;font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;line-height:22px;background-color:#FFFFFF;"></span> </span> </p> 
 <pre class="prettyprint">-- ----------------------------
-- Table structure for `user`
-- ----------------------------
CREATE TABLE `user` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `username` varchar(64) NOT NULL DEFAULT '',
  `mobile` int(10) unsigned NOT NULL DEFAULT '0',
  `created` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of user
-- ----------------------------
INSERT INTO `user` VALUES ('1', 'yiibai', '100', '2015-09-23 20:11:23');</pre> 
 <p style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;"> <span><span style="font-weight:700;">帖子表 post 的结构和数据：</span></span> </p> 
 <pre class="prettyprint">-- ----------------------------
-- Table structure for `post`
-- ----------------------------
CREATE TABLE `post` (
  `post_id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `userid` int(10) unsigned NOT NULL,
  `title` varchar(254) NOT NULL DEFAULT '',
  `content` text,
  `created` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  PRIMARY KEY (`post_id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of post
-- ----------------------------
INSERT INTO `post` VALUES ('1', '1', 'MyBatis关联数据查询', '在实际项目中，经常使用关联表的查询，比如：多对一，一对多等。这些查询是如何处理的呢，这一讲就讲这个问题。我们首先创建一个 post 表，并初始化数据.', '2015-09-23 21:40:17');
INSERT INTO `post` VALUES ('2', '1', 'MyBatis开发环境搭建', '为了方便学习，这里直接建立java 工程，但一般都是开发 Web 项目。', '2015-09-23 21:42:14');
INSERT INTO `post` VALUES ('3', '2', '这个是别人发的', 'content,内容...', '0000-00-00 00:00:00');<span style="font-family:'Microsoft Yahei', Arial, Helvetica, sans-serif;font-size:16px;line-height:1.5;">&nbsp;&nbsp;</span></pre> 
 <p style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;"> 从上面应该看出，这几个帖子对应的 userid 都是1，所以需要用户表 user 里面有 id=1 的数据。可以修改成满足自己条件的数据，按照 orm 的规则，表肯定需要一个对象与之对应，所以我们增加一个 Post 类。 </p> 
 <h3 style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;font-size:14pt;color:#53555C;"> 2、创建表对应的 JavaBean 对象 </h3> 
 <p style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;"> 这个例子中，我们需要在包 com.yiibai.pojo 下创建两个类，它们分别是： User.java 和 Post.java，我们一个一个地来看它们的代码，User.java 类的代码如下： </p> 
 <pre class="prettyprint lang-java">package com.yiibai.pojo;

import java.io.Serializable;
import java.util.Date;
import java.util.List;

public class User implements Serializable{
	private int id;
	private String username;
	private String mobile;
	private List&lt;Post&gt; posts;

	public int getId() {
		return id;
	}

	public void setId(int id) {
		this.id = id;
	}

	public String getUsername() {
		return username;
	}

	public void setUsername(String username) {
		this.username = username;
	}

	public String getMobile() {
		return mobile;
	}

	public void setMobile(String mobile) {
		this.mobile = mobile;
	}

	public List&lt;Post&gt; getPosts() {
		return posts;
	}
	public void setPosts(List&lt;Post&gt; posts) {
		this.posts = posts;
	}

	@Override
	public String toString() {
		return "User [id=" + id + ", name=" + username + "]";
	}

}</pre> 
 <span style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;line-height:22px;">Post.java 类的代码如下：</span>
 <span style="color:#535B60;font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;line-height:22px;background-color:#FFFFFF;"></span> 
 <pre class="prettyprint lang-java">package com.yiibai.pojo;

import java.io.Serializable;

public class Post implements Serializable{
	private int id;
	private User user;
	private String title;
	private String content;

	public int getId() {
		return id;
	}

	public void setId(int id) {
		this.id = id;
	}

	public User getUser() {
		return user;
	}

	public void setUser(User user) {
		this.user = user;
	}

	public String getTitle() {
		return title;
	}

	public void setTitle(String title) {
		this.title = title;
	}

	public String getContent() {
		return content;
	}

	public void setContent(String content) {
		this.content = content;
	}
}</pre> 
 <h3 style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;font-size:14pt;color:#53555C;"> <span style="font-size:16px;">3、配置文件</span> </h3> 
 <p style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;"> 在这一章节中，要用到的配置文件有两个，一个是 mybatis 的主配置文件：src/config/Configure.xml 和 User.java对应的配置文件 User.xml，我们先来看看&nbsp;<span>src/config/Configure.xml，其详细配置信息如下：</span> </p> 
 <p style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;"> <span></span> </p> 
 <pre class="prettyprint lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;
&lt;configuration&gt;
	&lt;typeAliases&gt;
		&lt;typeAlias alias="User" type="com.yiibai.pojo.User" /&gt;
		&lt;typeAlias alias="Post" type="com.yiibai.pojo.Post" /&gt;
	&lt;/typeAliases&gt;

	&lt;environments default="development"&gt;
		&lt;environment id="development"&gt;
			&lt;transactionManager type="JDBC" /&gt;
			&lt;dataSource type="POOLED"&gt;
				&lt;property name="driver" value="com.mysql.jdbc.Driver" /&gt;
				&lt;property name="url" value="jdbc:mysql://127.0.0.1:3306/yiibai" /&gt;
				&lt;property name="username" value="root" /&gt;
				&lt;property name="password" value="" /&gt;
			&lt;/dataSource&gt;
		&lt;/environment&gt;
	&lt;/environments&gt;

	&lt;mappers&gt;
		&lt;!-- // power by http://www.yiibai.com --&gt;
		&lt;mapper resource="com/yiibai/pojo/User.xml" /&gt;
	&lt;/mappers&gt;
&lt;/configuration&gt;</pre> 
 <span style="color:#535B60;font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;line-height:22px;background-color:#FFFFFF;">这里需要注意的是&nbsp;&lt;typeAliases&gt; 这个标签内容，它就是用于定义一个 JavaBean 类的别名，如将&nbsp;com.yiibai.pojo.User 简写为 User，可以认为&nbsp;</span>
 <span style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;line-height:22px;">&nbsp;</span>
 <span style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;line-height:22px;"></span>
 <span style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;line-height:22px;">com.yiibai.pojo.User 就是 User，User 就是&nbsp;<span>&nbsp;</span><span></span><span>com.yiibai.pojo.User 。</span></span>
 <span style="color:#535B60;font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;line-height:22px;background-color:#FFFFFF;"></span> 
 <p style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;"> <span>另外一个配置文件 User.xml 的内容如下：</span> </p> 
 <p style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;"> <span> </span> </p>   
 <pre class="prettyprint lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;

&lt;mapper namespace="com.yiibai.userMaper"&gt;
	&lt;!-- User 级联文章查询 方法配置 (多个文章对一个用户)  --&gt;
	
	&lt;resultMap type="Post" id="resultPostsMap"&gt;
		&lt;result property="id" column="post_id" /&gt;
		&lt;result property="title" column="title" /&gt;
		&lt;result property="content" column="content" /&gt;
		&lt;association property="user" javaType="User"&gt;  
	        &lt;id property="id" column="userid"/&gt;   
	        &lt;result property="username" column="username"/&gt;   
	        &lt;result property="mobile" column="mobile"/&gt;   
        &lt;/association&gt; 
	&lt;/resultMap&gt;

	&lt;select id="getPosts" resultMap="resultPostsMap" parameterType="int"&gt;
		SELECT u.*,p.*
		FROM user u, post p
		WHERE u.id=p.userid AND p.post_id=#{post_id} 
  &lt;/select&gt;

&lt;/mapper&gt;</pre> 
 <p> <strong>注：</strong>在上面的配置文件中，使用到了一个 &lt;association&gt;标签，关联对应的 User 类。 </p> 
 <h3 style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;font-size:14pt;color:#53555C;"> 4、测试程序运行 </h3> 
 <p style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;color:#535B60;"> 到这里，整个工作准备得已经差不多了，我们创建一个主类来测试上面程序，在 src 下创建一个 Main.java，代码如下： </p> 
 <pre class="prettyprint lang-java">import java.io.Reader;
import java.text.MessageFormat;
import java.util.List;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import com.yiibai.pojo.Post;
import com.yiibai.pojo.User;


public class Main {
	private static SqlSessionFactory sqlSessionFactory;
	private static Reader reader;

	static {
		try {
			reader = Resources.getResourceAsReader("config/Configure.xml");
			sqlSessionFactory = new SqlSessionFactoryBuilder().build(reader);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	public static SqlSessionFactory getSession() {
		return sqlSessionFactory;
	}

	/**
	 * @param args
	 */
	public static void main(String[] args) {
		// TODO Auto-generated method stub
		SqlSession session = sqlSessionFactory.openSession();
		try {
			int postId = 1;
			Post post = session.selectOne("com.yiibai.userMaper.getPosts", postId); 
			System.out.println("title: "+post.getTitle());
			System.out.println("userName: "+post.getUser().getUsername());
		} finally {
			session.close();
		}
	}

}</pre> 
 <p> <span style="color:#535B60;font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;line-height:22px;background-color:#FFFFFF;">输出结果如下：</span> </p> 
 <p> <span style="color:#535B60;font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;line-height:22px;background-color:#FFFFFF;"> </span> </p> 
 <pre class="prettyprint lang-java">title: MyBatis关联数据查询
userName: yiibai</pre> 
 <p> <br> </p> 
 <p> <span style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;font-weight:700;color:#535B60;line-height:22px;">附工程目录结构图如下：</span> </p> 
 <p> <span style="font-family:Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, sans-serif, sans-serif;font-weight:700;color:#535B60;line-height:22px;"><img src="/uploads/tutorial/201509/1-1509240H13E34.png" alt=""><br> </span> </p> 
 <p> <br> </p>
 <br>      
</div></body></html>
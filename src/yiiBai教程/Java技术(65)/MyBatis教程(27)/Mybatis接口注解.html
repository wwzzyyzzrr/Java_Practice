<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Mybatis接口注解</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在上一章中，我们已经搭建了 myeclipse,mybatis,mysql 的开发环境，并且实现了 mybatis 的一个简单的查询。要注意的是，这种方式是用 <code>SqlSession</code> 实例来直接执行在<code>User.xml</code>文件中映射的 SQL 语句：<br><code>session.selectOne("com.yiibai.mybatis.models.UserMapper.getUserByID", 1)</code>，但是还有比这更简单的方法，使用合理描述参数和SQL语句返回值的接口(比如：<code>IUser.class</code>)，这样现在就可以不使用类似<code>User.xml</code>配置文件，至此更简单，代码更安全，不容易发生的字符串文字和转换的错误，下面是项目创建的详细过程:</p> 
 <h2 id="h2-1-iuser-"><a name="1、创建一个接口：IUser，并在其中声明对应的操作方法" class="reference-link"></a><span class="header-link octicon octicon-link"></span>1、创建一个接口：IUser，并在其中声明对应的操作方法</h2>
 <p>在 <code>src</code> 源码目录下创建一个包：<code>com.yiibai.mybatis.dao</code>，并建立接口类 <code>IUser</code> 及一个方法, 在方法上面，我们使用了一个SQL注释，内容如下：</p> 
 <pre><code class="lang-java">package com.yiibai.mybatis.dao;

import org.apache.ibatis.annotations.Select;

import com.yiibai.mybatis.models.User;
/**
 * @author yiibai.com
 */
public interface IUser {
     @Select("select * from user where id= #{id}")
     public User getUserByID(int id);
}
</code></pre> 
 <p>请注意，这里面代码有一个方法名 <code>getUserByID</code> 必须与 <code>User.xml</code> 里面配置的 <code>select</code> 的 <code>id</code> 对应(<code>&lt;select id="getUserByID"&gt;</code>)同名，虽使用注解映射不需要<code>User.xml</code>。</p> 
 <h2 id="h2-2-sql-"><a name="2、创建对应映射接口 SQL 语句" class="reference-link"></a><span class="header-link octicon octicon-link"></span>2、创建对应映射接口 SQL 语句</h2>
 <p>首先配置 MyBatis 所需的数据连接文件，这里创建一个文件： <code>src/config/Configure.xml</code> ，其内容如下：</p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;
&lt;configuration&gt;
    &lt;typeAliases&gt;
        &lt;typeAlias alias="User" type="com.yiibai.mybatis.models.User" /&gt;
    &lt;/typeAliases&gt;

    &lt;environments default="development"&gt;
        &lt;environment id="development"&gt;
            &lt;transactionManager type="JDBC" /&gt;
            &lt;dataSource type="POOLED"&gt;
                &lt;property name="driver" value="com.mysql.jdbc.Driver" /&gt;
                &lt;property name="url" value="jdbc:mysql://127.0.0.1:3306/testdb" /&gt;
                &lt;property name="username" value="root" /&gt;
                &lt;property name="password" value="123456" /&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;

    &lt;mappers&gt;
        &lt;!-- // power by http://www.yiibai.com 注释掉咯...
        &lt;mapper resource="com/yiibai/mybatis/models/User.xml" /&gt;--&gt;
    &lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre> 
 <p>在包：<code>com.yiibai.mybatis.models</code> 下创建一个<code>User.java</code> 类文件，与上一节中 <code>User</code> 类代码相同，这里只是拷贝过来，<code>User.java</code>具体的代码内容如下：</p> 
 <pre><code class="lang-java">package com.yiibai.mybatis.models;

public class User {
    private int id;
    private String name;
    private String dept;
    private String phone;
    private String website;

    public String getWebsite() {
        return website;
    }
    public void setWebsite(String website) {
        this.website = website;
    }
    public int getId() {
        return id;
    }
    public void setId(int id) {
        this.id = id;
    }
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public String getDept() {
        return dept;
    }
    public void setDept(String dept) {
        this.dept = dept;
    }
    public String getPhone() {
        return phone;
    }
    public void setPhone(String phone) {
        this.phone = phone;
    }

}
</code></pre> 
 <p>与 <code>User.java</code> 对应的 XML 配置文件：<code>User.xml</code> 可以少省略，不用创建，本节讲解的就是如何消灭类似于<code>User.xml</code>的配置文件。</p> 
 <h2 id="h2-3-"><a name="3、测试接口映射" class="reference-link"></a><span class="header-link octicon octicon-link"></span>3、测试接口映射</h2>
 <p>我们在 <code>src</code> 这个目录下创建一个类：<code>Main.java</code>，用来测试整个配置和程序运行结果，有关 <code>Main.java</code> 的代码详细内容如下：</p>   
 <pre><code class="lang-java">import java.io.Reader;
import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;
import com.yiibai.mybatis.dao.IUser;
import com.yiibai.mybatis.models.User;

public class Main {
    private static SqlSessionFactory sqlSessionFactory;
    private static Reader reader;
    static {
        try {
            reader = Resources.getResourceAsReader("config/Configure.xml");
            sqlSessionFactory = new SqlSessionFactoryBuilder().build(reader);
            sqlSessionFactory.getConfiguration().addMapper(IUser.class);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public static SqlSessionFactory getSession() {
        return sqlSessionFactory;
    }

    public static void main(String[] args) {
        SqlSession session = sqlSessionFactory.openSession();
        try {
            IUser iuser = session.getMapper(IUser.class);
            User user = iuser.getUserByID(1);
            System.out.println("名字："+user.getName());
            System.out.println("所属部门："+user.getDept());
            System.out.println("主页："+user.getWebsite());
        } finally {
            session.close();
        }
    }
}
</code></pre> 
 <p>运行上面示例代码，得到以下结果 - </p> 
 <pre><code class="lang-shell">名字：New name, 所属部门：Tech, 主页：http://www.yiibai.com
</code></pre> 
 <p>最后补充，整个项目 <em>mybatis-interface-02</em> 的结构如下图所示：</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201709/1309/485180908_73393.png" alt=""></p>
 <br>      
</div></body></html>
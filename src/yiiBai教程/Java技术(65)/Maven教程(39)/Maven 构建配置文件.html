<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Maven 构建配置文件</h1><div style="width:100%;float:left;" class="article-content">   
 <h2> 什么是构建配置文件? </h2> 
 <p> 生成配置文件是一组可以用来设置或覆盖 Maven 构建配置值的默认值。使用生成配置文件，你可以针对不同的环境，如：生产V/S开发环境<span>自定义构建</span>。 </p> 
 <p> 配置文件中指定 pom.xml 文件使用其配置文件/配置文件元素和多种方式来触发。配置文件修改 POM 后，在编译的时候是用来给不同的目标环境参数（例如，开发，测试和生产环境的<span>数据库服务器的路径</span>）。 </p> 
 <h2> 生成配置文件的类型 </h2> 
 <p> 创建配置文件的文件主要有三种类型： </p> 
 <table class="src" style="margin:8px 0px;padding:0px;width:560px;border-collapse:collapse;background-color:#F7F7F7;color:#000000;font-family:Helvetica, Arial, sans-serif;"> 
  <tbody> 
   <tr> 
    <th style="background-color:#EEEEEE;"> 类型 </th> 
    <th style="background-color:#EEEEEE;"> 定义位置 </th> 
   </tr> 
   <tr> 
    <td> Per Project </td> 
    <td> 在项目中定义的POM文件, pom.xml </td> 
   </tr> 
   <tr> 
    <td> Per User </td> 
    <td> 定义在&nbsp;Maven&nbsp;中的设置&nbsp;XML&nbsp;文件(%USER_HOME%/.m2/settings.xml) </td> 
   </tr> 
   <tr> 
    <td> Global </td> 
    <td> 定义在&nbsp;Maven 中的全局设置 xml 文件 (%M2_HOME%/conf/settings.xml) </td> 
   </tr> 
  </tbody> 
 </table> 
 <h2> 配置文件激活 </h2> 
 <p> Maven&nbsp;构建配置文件的文件，可以使用以下几种方式来激活。 </p> 
 <ul> 
  <li> <p> 明确使用命令从控制台输入。 </p> </li> 
  <li> <p> 通过&nbsp;Maven&nbsp;设置。 </p> </li> 
  <li> <p> 基于环境变量（用户/系统变量）。 </p> </li> 
  <li> <p> OS设置（例如，Windows系列）。 </p> </li> 
  <li> <p> 呈现/丢失的文件。 </p> </li> 
 </ul> 
 <h2> 配置文件的文件激活的例子 </h2> 
 <p> 我们假设你的项目如下的目录结构： </p> 
 <img alt="Maven Build Profile" src="/uploads/allimg/131116/21121332H-0.png" style="border:0px;height:auto;"> 
 <p> 现在下<em>src/main/resources</em>&nbsp;有三个特定的文件： </p> 
 <table class="src" style="margin:8px 0px;padding:0px;width:560px;border-collapse:collapse;background-color:#F7F7F7;color:#000000;font-family:Helvetica, Arial, sans-serif;"> 
  <tbody> 
   <tr> 
    <th style="background-color:#EEEEEE;"> 文件名称 </th> 
    <th style="background-color:#EEEEEE;"> 描述 </th> 
   </tr> 
   <tr> 
    <td> env.properties </td> 
    <td> 如果没有配置文件关联则使用默认配置 </td> 
   </tr> 
   <tr> 
    <td> env.test.properties </td> 
    <td> 当测试配置文件用于测试配置 </td> 
   </tr> 
   <tr> 
    <td> env.prod.properties </td> 
    <td> 生产配置时，prod信息被使用<br> </td> 
   </tr> 
  </tbody> 
 </table> 
 <h2> 显式配置文件激活 </h2> 
 <p> 在下面的例子中，我们会附加上maven-antrun-plugin:run&nbsp;插件：运行测试阶段目标。这将使我们能够为不同的配置文件调用文本消息。将在 pom.xml 中定义不同的配置文件，并在命令控制台使用 maven&nbsp;命令将配置文件<span>启</span><span>动</span>。 </p> 
 <p> 假设，我们建立如下的&nbsp;pom.xml&nbsp;在&nbsp;C:\MVN\project&nbsp;文件夹。&nbsp; </p> 
 <pre class="prettyprint lang-xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
   http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
   &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
   &lt;groupId&gt;com.companyname.projectgroup&lt;/groupId&gt;
   &lt;artifactId&gt;project&lt;/artifactId&gt;
   &lt;version&gt;1.0&lt;/version&gt;
   &lt;profiles&gt;
      &lt;profile&gt;
      &lt;id&gt;test&lt;/id&gt;
      &lt;build&gt;
      &lt;plugins&gt;
         &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
            &lt;version&gt;1.1&lt;/version&gt;
            &lt;executions&gt;
               &lt;execution&gt;
                  &lt;phase&gt;test&lt;/phase&gt;
                  &lt;goals&gt;
                     &lt;goal&gt;run&lt;/goal&gt;
                  &lt;/goals&gt;
                  &lt;configuration&gt;
                  &lt;tasks&gt;
                     &lt;echo&gt;Using env.test.properties&lt;/echo&gt;
            &lt;copy file="src/main/resources/env.test.properties" tofile
		    ="${project.build.outputDirectory}/env.properties"/&gt;
                  &lt;/tasks&gt;
                  &lt;/configuration&gt;
               &lt;/execution&gt;
            &lt;/executions&gt;
         &lt;/plugin&gt;
      &lt;/plugins&gt;
      &lt;/build&gt;
      &lt;/profile&gt;
   &lt;/profiles&gt;
   &lt;dependencies&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;junit&lt;/groupId&gt;
         &lt;artifactId&gt;junit&lt;/artifactId&gt;
         &lt;version&gt;3.8.1&lt;/version&gt;
         &lt;scope&gt;test&lt;/scope&gt;
      &lt;/dependency&gt;
   &lt;/dependencies&gt;
&lt;/project&gt;</pre> 
 <p style="text-align:justify;font-family:Verdana, Geneva, Tahoma, Arial, Helvetica, sans-serif;font-size:15px !important;"> <i>env.properties</i> </p> 
 <pre class="prettyprint notranslate prettyprinted"><span class="pln">environment</span><span class="pun">=</span><span class="pln">debug</span></pre> 
 <p style="text-align:justify;font-family:Verdana, Geneva, Tahoma, Arial, Helvetica, sans-serif;font-size:15px !important;"> <i>env.test.properties</i> </p> 
 <pre class="prettyprint notranslate prettyprinted"><span class="pln">environment</span><span class="pun">=</span><span class="pln">test</span></pre> 
 <p style="text-align:justify;font-family:Verdana, Geneva, Tahoma, Arial, Helvetica, sans-serif;font-size:15px !important;"> <i>env.prod.properties</i> </p> 
 <pre class="prettyprint notranslate prettyprinted"><span class="pln">environment</span><span class="pun">=</span><span class="pln">prod</span></pre> 
 <p style="text-align:justify;"> <span>现在，打开命令控制台，进入到包含 pom.xml 的</span><span>文</span><span>件</span><span>夹</span><span>并执行以下&nbsp;mvn&nbsp;命令。通过配置文件名作为参数可使用&nbsp;-P&nbsp;选项。</span> </p> 
 <pre class="result">C:\MVN\project&gt;mvn test -P test<span style="font-family:&quot;font-size:16px;line-height:1.5;"></span></pre> Maven会开始处理并显示构建配置文件的
 <span>测</span>
 <span>试</span>
 <span>结</span>
 <span>果</span>。 
 <pre class="result">[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------
[INFO] Building Unnamed - com.companyname.projectgroup:project:jar:1.0
[INFO]    task-segment: [test]
[INFO] ------------------------------------------------------------------
[INFO] [resources:resources {execution: default-resources}]
[WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources,
i.e. build is platform dependent!
[INFO] Copying 3 resources
[INFO] [compiler:compile {execution: default-compile}]
[INFO] Nothing to compile - all classes are up to date
[INFO] [resources:testResources {execution: default-testResources}]
[WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources,
i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory C:MVNprojectsrc	est
esources
[INFO] [compiler:testCompile {execution: default-testCompile}]
[INFO] Nothing to compile - all classes are up to date
[INFO] [surefire:test {execution: default-test}]
[INFO] Surefire report directory: C:MVNproject	argetsurefire-reports

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
There are no tests to run.

Results :

Tests run: 0, Failures: 0, Errors: 0, Skipped: 0

[INFO] [antrun:run {execution: default}]
[INFO] Executing tasks
     [echo] Using env.test.properties
[INFO] Executed tasks
[INFO] ------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------
[INFO] Total time: 1 second
[INFO] Finished at: Sun Jul 08 14:55:41 IST 2012
[INFO] Final Memory: 8M/64M
[INFO] ------------------------------------------------------------------</pre> 
 <p> <strong><span>现在，作为一个练习，可以做以下步骤：</span></strong> </p> 
 <ul> 
  <li> <p> 在另一个配置文件pom.xml&nbsp;<span>添加元素</span>（复制现有的配置文件元素&nbsp;profiles，并将其粘贴轮廓元素结束）。 </p> </li> 
  <li> <p> 更新在此档案中元素的&nbsp;ID 并测试正常。 </p> </li> 
  <li> <p> 更新任务部分使用&nbsp;env.properties 并将&nbsp;env.properties&nbsp;复制到目标目录 </p> </li> 
  <li> <p> 再次重复上述三个步骤，更新&nbsp;ID&nbsp;和&nbsp;env.prod.properties </p> </li> 
  <li> <p> 现在准备建立配置文件文件（正常/测试/产品）。 </p> </li> 
 </ul> 
 <p> 现在，打开命令控制台，进入到该文件夹包含的&nbsp;pom.xml 并执行以下&nbsp;mvn&nbsp;命令。通过配置文件名作为参数使用&nbsp;-P&nbsp;选项。 </p>   
 <pre class="result">C:\MVN\project&gt;mvn test -Pnormal</pre> 
 <pre class="result">C:\MVN\project&gt;mvn test -Pprod</pre> 
 <p> <span>建立检查输出看到</span><span>它们的</span><span>差别了</span> </p> 
 <h2> 配置文件通过Maven设置激活 </h2> 
 <p> 打开&nbsp;Maven&nbsp;的&nbsp;settings.xml&nbsp;文件，可在&nbsp;%USER_HOME%/.m2&nbsp;目录，％USER_HOME％&nbsp;表示用户的主目录。 settings.xml 文件如果不存在，那么就创建一个新的。 </p> 
 <p> 添加测试配置文件作为使用activeProfiles节点主动配置文件，示例如下所示： </p> 
 <pre class="prettyprint lang-xml">&lt;settings xmlns="http://maven.apache.org/POM/4.0.0"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
   http://maven.apache.org/xsd/settings-1.0.0.xsd"&gt;
   &lt;mirrors&gt;
      &lt;mirror&gt;
         &lt;id&gt;maven.dev.snaponglobal.com&lt;/id&gt;
         &lt;name&gt;Internal Artifactory Maven repository&lt;/name&gt;
         &lt;url&gt;http://repo1.maven.org/maven2/&lt;/url&gt;
         &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
      &lt;/mirror&gt;
   &lt;/mirrors&gt;
   &lt;activeProfiles&gt;
      &lt;activeProfile&gt;test&lt;/activeProfile&gt;
   &lt;/activeProfiles&gt;
&lt;/settings&gt;</pre> 
 <p> 现在，打开命令控制台，进入到该文件夹包含 pom.xml 并执行以下 mvn 命令。不要通过使用&nbsp;-P 选项。Maven会显示结果，测试配置文件是一个活跃的配置文件。 </p> 
 <pre class="result">C:\MVN\project&gt;mvn test</pre> 
 <h2> 通过系统环境变量配置文件 </h2> 
 <p> <span>现在从 Maven&nbsp;的&nbsp;settings.xml 配置文件删除和更新 pom.xml 中提到的测试配置文件。 </span><span style="background-color:;">profile 元素添加 activation&nbsp;元素，如下所示。</span> </p> 
 <p> 当系统属性 “env” 的值设置为 “test” 时指定的测试配置文件将被触发。<br> 创建一个环境变量 “env”，并设置其值为 “test” 。 </p> 
 <pre class="prettyprint lang-xml">&lt;profile&gt;
   &lt;id&gt;test&lt;/id&gt;
   &lt;activation&gt;
      &lt;property&gt;
         &lt;name&gt;env&lt;/name&gt;
         &lt;value&gt;test&lt;/value&gt;
      &lt;/property&gt;
   &lt;/activation&gt;
&lt;/profile&gt;</pre> 
 <p> 打开命令控制台，进入到包含&nbsp;pom.xml 文件的<span>文件夹下</span>并执行以下&nbsp;mvn&nbsp;命令。 </p> 
 <pre class="result">C:\MVN\project&gt;mvn test</pre> 
 <h2> 通过操作系统激活配置文件 </h2> 
 <p> activation 元素包括 os 细节，如下所示。测试配置文件文件时，将触发的系统是 windows XP。 </p> 
 <pre class="prettyprint lang-xml">&lt;profile&gt;
   &lt;id&gt;test&lt;/id&gt;
   &lt;activation&gt;
      &lt;os&gt;
         &lt;name&gt;Windows XP&lt;/name&gt;
         &lt;family&gt;Windows&lt;/family&gt;
         &lt;arch&gt;x86&lt;/arch&gt;
         &lt;version&gt;5.1.2600&lt;/version&gt;
      &lt;/os&gt;
   &lt;/activation&gt;
&lt;/profile&gt;</pre> 
 <p> 现在，打开命令控制台，进入到文件夹包含 pom.xml 并执行以下 mvn 命令。不要通过使用选项 -P 配置文件名称。 Maven 会显示结果： </p> 
 <pre class="result">C:\MVN\project&gt;mvn test</pre> 
 <h2> 配置文件激活通过现状/丢失文件 </h2> 
 <p> 载入 <span style="font-family:Verdana, Geneva, Tahoma, Arial, Helvetica, sans-serif;font-size:15px;background-color:#FFFFFF;">activation&nbsp;</span>元件包括 os 的细节，如下所示。<span style="font-family:Verdana, Geneva, Tahoma, Arial, Helvetica, sans-serif;font-size:15px;background-color:#FFFFFF;">test</span>配置文件将因 target/generated-sources/axistools/wsdl2java/com/companyname/group <span>缺少</span><span>触发</span>。 </p> 
 <pre class="prettyprint lang-xml">&lt;profile&gt;
   &lt;id&gt;test&lt;/id&gt;
   &lt;activation&gt;
      &lt;file&gt;
         &lt;missing&gt;target/generated-sources/axistools/wsdl2java/
		 com/companyname/group&lt;/missing&gt;
      &lt;/file&gt;
   &lt;/activation&gt;
&lt;/profile&gt;</pre> 
 <p style="text-align:justify;"> 现在，打开命令控制台，进入到包含 pom.xml 的<span>文件夹</span>并执行以下 mvn 命令。<span id="__kindeditor_bookmark_start_43__"></span>不要<span>使</span><span>用选项 -P</span><span id="__kindeditor_bookmark_start_30__"></span>传递<span>配置文件名称</span><span>&nbsp;</span>。 Maven 会显示结果，test 配置文件是一个 活动配置文件。 </p> 
 <pre class="result">C:\MVN\project&gt;mvn test</pre>
 <br>      
</div></body></html>
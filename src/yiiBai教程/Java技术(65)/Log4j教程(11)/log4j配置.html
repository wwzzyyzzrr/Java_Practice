<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">log4j配置</h1><div style="width:100%;float:left;" class="article-content">   
 <p> 上一章介绍log4j的核心组件。本章介绍如何使用配置文件来配置这些核心组件。配置log4j涉及分配级别，定义追加程序，并在配置文件中指定布局的对象。</p> 
 <p> log4j.properties文件是一个键 - 值对保存 log4j 配置属性文件。默认情况下，日志管理在CLASSPATH 查找一个名为 log4j.properties 的文件。</p> 
 <ul> 
  <li> <p> 根日志记录器的级别定义为DEBUG并连接附加器命名为X到它</p> </li> 
  <li> <p> 设置名为X的附加目的地是一个有效的appender</p> </li> 
  <li> <p> 设置布局的附加器X</p> </li> 
 </ul> 
 <h2> log4j.properties 语法:</h2> 
 <p> 以下是 log4j.properties 文件的一个appender X的语法：</p> 
 <pre class="prettyprint" style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; font-size: 12px; overflow: auto;">
# Define the root logger with appender X
log4j.rootLogger = DEBUG, X

# Set the appender named X to be a File appender
log4j.appender.X=org.apache.log4j.FileAppender

# Define the layout for X appender
log4j.appender.X.layout=org.apache.log4j.PatternLayout
log4j.appender.X.layout.conversionPattern=%m%n</pre> 
 <h2> log4j.properties 示例:</h2> 
 <p> 使用上面的语法，我们定义 log4j.properties 文件如下：</p> 
 <ul> 
  <li> <p> 根日志记录器(logger)的级别定义为DEBUG并连接附加器命名为FILE</p> </li> 
  <li> <p> 附加器(appender)File是定义为org.apache.log4j.FileAppender并写入到一个名为“log.out”位于日志log目录下</p> </li> 
  <li> <p> 定义的布局模式是%m%n，这意味着每打印日志消息之后，将加上一个换行符</p> </li> 
 </ul> 
 <pre class="prettyprint" style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; font-size: 12px; overflow: auto;">
# Define the root logger with appender file
log4j.rootLogger = DEBUG, FILE

# Define the file appender
log4j.appender.FILE=org.apache.log4j.FileAppender
log4j.appender.FILE.File=${log}/log.out

# Define the layout for file appender
log4j.appender.FILE.layout=org.apache.log4j.PatternLayout
log4j.appender.FILE.layout.conversionPattern=%m%n</pre> 
 <p style="margin: 0.8em 0px 1em; padding: 0px; text-align: justify; color: rgb(0, 0, 0); "> 需要注意的是log4j支持UNIX风格的变量替换，如 ${variableName}.</p> 
 <h2> 调试级别：</h2> 
 <p> 使用DEBUG两个追加程序。所有可能的选项有：</p> 
 <ul> 
  <li> <p> TRACE</p> </li> 
  <li> <p> DEBUG</p> </li> 
  <li> <p> INFO</p> </li> 
  <li> <p> WARN</p> </li> 
  <li> <p> ERROR</p> </li> 
  <li> <p> FATAL</p> </li> 
  <li> <p> ALL</p> </li> 
 </ul> 
 <p> 这些级别将在&nbsp;<a target="_blank" href="http://www.yiibai.com/log4j/log4j_logging_levels.html">Log4j调试级别</a>&nbsp;这一文章中解释</p> 
 <h2 style="margin: 0.2em 0.2em 0.2em 0px; padding: 0px; font-size: 1.6em; line-height: 1.5em; font-weight: normal; text-shadow: rgb(204, 204, 204) 1px 1px 2px; color: rgb(0, 0, 0); "> Appenders:</h2> 
 <p style="margin: 0.8em 0px 1em; padding: 0px; text-align: justify; color: rgb(0, 0, 0); "> Apache的log4j提供Appender对象主要负责打印日志消息到不同的目的地，如控制台，文件，sockets，NT事件日志等等。</p> 
 <p style="margin: 0.8em 0px 1em; padding: 0px; text-align: justify; color: rgb(0, 0, 0); "> 每个Appender对象具有与之相关联的不同的属性，并且这些属性表明对象的行为</p> 
 <table class="src" style="margin: 8px 0px; padding: 0px;  border-color: rgb(214, 214, 214); width: 560px; border-collapse: collapse; vertical-align: top; color: rgb(0, 0, 0);  background-color: rgb(247, 247, 247);"> 
  <tbody style="margin: 0px; padding: 0px;"> 
   <tr style="margin: 0px; padding: 0px;"> 
    <th style="margin: 0px; padding: 5px; border-collapse: collapse;  border-color: rgb(214, 214, 214); width: 129px; background-color: rgb(238, 238, 238);"> 属性</th> 
    <th style="margin: 0px; padding: 5px; border-collapse: collapse;  border-color: rgb(214, 214, 214); background-color: rgb(238, 238, 238);"> 描述</th> 
   </tr> 
   <tr style="margin: 0px; padding: 0px;"> 
    <td style="margin: 0px; padding: 5px; border-collapse: collapse;  border-color: rgb(214, 214, 214);"> layout</td> 
    <td style="margin: 0px; padding: 5px; border-collapse: collapse;  border-color: rgb(214, 214, 214);"> Appender使用布局Layout&nbsp;对象和与之相关的格式化的日志记录信息转换模式</td> 
   </tr> 
   <tr style="margin: 0px; padding: 0px;"> 
    <td style="margin: 0px; padding: 5px; border-collapse: collapse;  border-color: rgb(214, 214, 214);"> target</td> 
    <td style="margin: 0px; padding: 5px; border-collapse: collapse;  border-color: rgb(214, 214, 214);"> 目标可以是一个控制台，一个文件，或根据附加器的另一个项目</td> 
   </tr> 
   <tr style="margin: 0px; padding: 0px;"> 
    <td style="margin: 0px; padding: 5px; border-collapse: collapse;  border-color: rgb(214, 214, 214);"> level</td> 
    <td style="margin: 0px; padding: 5px; border-collapse: collapse;  border-color: rgb(214, 214, 214);"> 级别是必需的，以控制日志消息的过滤</td> 
   </tr> 
   <tr style="margin: 0px; padding: 0px;"> 
    <td style="margin: 0px; padding: 5px; border-collapse: collapse;  border-color: rgb(214, 214, 214);"> threshold</td> 
    <td style="margin: 0px; padding: 5px; border-collapse: collapse;  border-color: rgb(214, 214, 214);"> Appender可以有与之独立的记录器级别相关联的级别阈值水平。Appender忽略具有级别低于阈级别的任何日志消息</td> 
   </tr> 
   <tr style="margin: 0px; padding: 0px;"> 
    <td style="margin: 0px; padding: 5px; border-collapse: collapse;  border-color: rgb(214, 214, 214);"> filter</td> 
    <td style="margin: 0px; padding: 5px; border-collapse: collapse;  border-color: rgb(214, 214, 214);"> Filter 对象可以分析超出级别的匹配记录信息，并决定是否记录的请求应该由一个特定&nbsp;Appender&nbsp;或忽略处理</td> 
   </tr> 
  </tbody> 
 </table> 
 <p> 可以通过包括以下方法的配置文件中的下面设置一个 Appender 对象添加到记录器：</p>   
 <pre class="prettyprint" style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; font-size: 12px; overflow: auto;">
log4j.logger.[logger-name]=level, appender1,appender..n</pre> 
 <p> 可以编写以XML格式相同的结构如下：</p> 
 <pre class="prettyprint" style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; font-size: 12px; overflow: auto;">
&lt;logger name="com.apress.logging.log4j" additivity="false"&gt;
   &lt;appender-ref ref="appender1"/&gt;
   &lt;appender-ref ref="appender2"/&gt;
&lt;/logger&gt;</pre> 
 <p> 如果想要添加Appender对象到程序，那么可以使用下面的方法：</p> 
 <pre class="prettyprint" style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; font-size: 12px; overflow: auto;">
public void addAppender(Appender appender);</pre> 
 <p> addAppender()方法添加一个appender到Logger对象。作为示例配置演示，可以添加很多Appender对象到记录器在逗号分隔的列表，每个打印日志信息分离目的地。</p> 
 <p> 我们仅使用一个附加目的地FileAppender在我们上面的例子。所有可能的附加目的地选项有：</p> 
 <ul> 
  <li> <p> AppenderSkeleton</p> </li> 
  <li> <p> AsyncAppender</p> </li> 
  <li> <p> ConsoleAppender</p> </li> 
  <li> <p> DailyRollingFileAppender</p> </li> 
  <li> <p> ExternallyRolledFileAppender</p> </li> 
  <li> <p> FileAppender</p> </li> 
  <li> <p> JDBCAppender</p> </li> 
  <li> <p> JMSAppender</p> </li> 
  <li> <p> LF5Appender</p> </li> 
  <li> <p> NTEventLogAppender</p> </li> 
  <li> <p> NullAppender</p> </li> 
  <li> <p> RollingFileAppender</p> </li> 
  <li> <p> SMTPAppender</p> </li> 
  <li> <p> SocketAppender</p> </li> 
  <li> <p> SocketHubAppender</p> </li> 
  <li> <p> SyslogAppender</p> </li> 
  <li> <p> TelnetAppender</p> </li> 
  <li> <p> WriterAppender</p> </li> 
 </ul> 
 <p> 我们将涵盖&nbsp;<a target="_blank" href="http://www.yiibai.com/log4j/log4j_logging_files.html">FileAppender文件</a>&nbsp;和 JDBCAppender 记录将被包括<a target="_blank" href="http://www.yiibai.com/log4j/log4j_logging_database.html">记录在数据库</a></p> 
 <h2> Layout:</h2> 
 <p> 我们使用的PatternLayout 使用 appender。所有可能的选项有：</p> 
 <ul> 
  <li> DateLayout</li> 
  <li> HTMLLayout</li> 
  <li> PatternLayout</li> 
  <li> SimpleLayout</li> 
  <li> XMLLayout</li> 
 </ul> 
 <p> 使用HTMLLayout和XMLLayout，可以在HTML和XML格式和生成日志。</p> 
 <h2> 布局格式：</h2> 
 <p> 如何在章节格式的日志信息：<a target="_blank" href="http://www.yiibai.com/log4j/log4j_log_formatting.html">Log格式</a></p> 
 <br>      
</div></body></html>
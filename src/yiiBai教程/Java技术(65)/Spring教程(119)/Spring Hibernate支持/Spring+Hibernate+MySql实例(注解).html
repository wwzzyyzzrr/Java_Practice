<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring+Hibernate+MySql实例(注解)</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    在上一篇教程中，我们创建一个简单的Java项目结构，并演示如何使用Hibernate在Spring框架来在&nbsp;MySQL数据库进行数据处理工作(插入，选择，更新和删除)。在本教程中，将学习如何使用Spring做同样的事情，只不过这一次我们使用 Hibernate 的注解方式。 
  </div> 
 </div> 
 <p> <br> </p> 
 <h2> 
  <div>
    最终项目结构 
  </div> </h2> 
 <div>
   最终的项目文件结构看起来应该就像下面的图所示：
  <br> 
  <img src="/uploads/tutorial/20151227/1-15122H20102V3.png" alt="">
  <br> 
 </div> 
 <div style="text-align:center;"> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/948c5a4d9875422d9bcf57f6ba725640/clipboard.png"> 
 </div> 
 <h2> 
  <div>
    1.创建表 
  </div> </h2> 
 <div>
   在MySQL数据库中创建一张“stock”表。&nbsp;SQL语句如下： 
 </div> 
 <pre>CREATE TABLE  `yiibai`.`stock` (
  `STOCK_ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `STOCK_CODE` varchar(10) NOT NULL,
  `STOCK_NAME` varchar(20) NOT NULL,
  PRIMARY KEY (`STOCK_ID`) USING BTREE,
  UNIQUE KEY `UNI_STOCK_NAME` (`STOCK_NAME`),
  UNIQUE KEY `UNI_STOCK_ID` (`STOCK_CODE`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8;</pre> 
 <h2> 2. Model &amp; BO &amp; DAO </h2> 
 <div>
   模型中，业务对象(BO)和数据访问对象(DAO)模式是有助于清楚地识别层，以避免弄乱项目结构。 
 </div> 
 <h5> Stock Model (Annotation) </h5> 
 <div>
   Stock模型注解类来存储库存数据。 
 </div> 
 <pre>package com.yiibai.stock.model;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import static javax.persistence.GenerationType.IDENTITY;
import javax.persistence.Id;
import javax.persistence.Table;
import javax.persistence.UniqueConstraint;

@Entity
@Table(name = "stock", catalog = "yiibai", uniqueConstraints = {
		@UniqueConstraint(columnNames = "STOCK_NAME"),
		@UniqueConstraint(columnNames = "STOCK_CODE") })
public class Stock implements java.io.Serializable {

	private Integer stockId;
	private String stockCode;
	private String stockName;

	public Stock() {
	}

	public Stock(String stockCode, String stockName) {
		this.stockCode = stockCode;
		this.stockName = stockName;
	}

	@Id
	@GeneratedValue(strategy = IDENTITY)
	@Column(name = "STOCK_ID", unique = true, nullable = false)
	public Integer getStockId() {
		return this.stockId;
	}

	public void setStockId(Integer stockId) {
		this.stockId = stockId;
	}

	@Column(name = "STOCK_CODE", unique = true, nullable = false, length = 10)
	public String getStockCode() {
		return this.stockCode;
	}

	public void setStockCode(String stockCode) {
		this.stockCode = stockCode;
	}

	@Column(name = "STOCK_NAME", unique = true, nullable = false, length = 20)
	public String getStockName() {
		return this.stockName;
	}

	public void setStockName(String stockName) {
		this.stockName = stockName;
	}

	@Override
	public String toString() {
		return "Stock [stockCode=" + stockCode + ", stockId=" + stockId
				+ ", stockName=" + stockName + "]";
	}
}</pre> 
 <h5> Stock Business Object (BO)) </h5> 
 <div>
   Stock&nbsp;业务对象(BO)接口和实现，它是用来存储项目的业务功能，真正的数据库操作(CRUD)的工作不参与这一个类，而是用一个DAO(StockDao)类来做到这一点。 
 </div> 
 <pre>package com.yiibai.stock.bo;

import com.yiibai.stock.model.Stock;

public interface StockBo {
	
	void save(Stock stock);
	void update(Stock stock);
	void delete(Stock stock);
	Stock findByStockCode(String stockCode);
}</pre> 
 <div>
   使这个类中的 Spring&nbsp;IoC容器的 bean“stockBo”自动装配库存DAO类。 
 </div> 
 <pre>package com.yiibai.stock.bo.impl;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.yiibai.stock.bo.StockBo;
import com.yiibai.stock.dao.StockDao;
import com.yiibai.stock.model.Stock;

@Service("stockBo")
public class StockBoImpl implements StockBo{
	
	@Autowired
	StockDao stockDao;
	
	public void setStockDao(StockDao stockDao) {
		this.stockDao = stockDao;
	}

	public void save(Stock stock){
		stockDao.save(stock);
	}
	
	public void update(Stock stock){
		stockDao.update(stock);
	}
	
	public void delete(Stock stock){
		stockDao.delete(stock);
	}
	
	public Stock findByStockCode(String stockCode){
		return stockDao.findByStockCode(stockCode);
	}
}</pre> 
 <h5> Stock Data Access Object </h5> 
 <p> Stock&nbsp;DAO接口和实现。在上一个教程中，DAO类是直接扩展“HibernateDaoSupport“。但注释方式不可能做到这一点，因为没有办法从DAO类会话到工厂bean自动装配。解决方法是创建一个自定义类(CustomHibernateDaoSupport)，并扩展了“HibernateDaoSupport”和自动装配会话工厂，DAO类扩展了这个类。 </p> 
 <pre>package com.yiibai.stock.dao;

import com.yiibai.stock.model.Stock;

public interface StockDao {
	
	void save(Stock stock);
	void update(Stock stock);
	void delete(Stock stock);
	Stock findByStockCode(String stockCode);

}</pre> 
 <pre>package com.yiibai.util;

import org.hibernate.SessionFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.orm.hibernate3.support.HibernateDaoSupport;

public abstract class CustomHibernateDaoSupport extends HibernateDaoSupport
{    
    @Autowired
    public void anyMethodName(SessionFactory sessionFactory)
    {
        setSessionFactory(sessionFactory);
    }
}</pre> 
 <pre>package com.yiibai.stock.dao.impl;

import java.util.List;

import org.springframework.stereotype.Repository;

import com.yiibai.stock.dao.StockDao;
import com.yiibai.stock.model.Stock;
import com.yiibai.util.CustomHibernateDaoSupport;

@Repository("stockDao")
public class StockDaoImpl extends CustomHibernateDaoSupport implements StockDao{
	
	public void save(Stock stock){
		getHibernateTemplate().save(stock);
	}
	
	public void update(Stock stock){
		getHibernateTemplate().update(stock);
	}
	
	public void delete(Stock stock){
		getHibernateTemplate().delete(stock);
	}
	
	public Stock findByStockCode(String stockCode){
		List list = getHibernateTemplate().find(
                     "from Stock where stockCode=?",stockCode
                );
		return (Stock)list.get(0);
	}

}</pre> 
 <h2> 
  <div>
    5.资源配置 
  </div> </h2> 
 <div>
   建立一个目录resources在“project_name/main/java/'，它将用于存储Spring，Hibernate等配置文件。 
 </div> 
 <h5> Spring Configuration </h5> 
 <p> 数据库关联…. </p> 
 <p> 创建一个属性文件(database.properties)来存放数据库的详细信息，把它放到“resources/properties”文件夹中。&nbsp;一个很好的做法是将数据库信息和Spring&nbsp;bean配置在不同的文件。 </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>database.properties</strong> </p> 
 <pre>jdbc.driverClassName=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/yiibai
jdbc.username=root
jdbc.password=password</pre> 
 <div>
   创建一个“dataSource”&nbsp;bean配置文件(DataSource.xml)存放数据库信息，并从database.properties导入的属性，把它放到“resources/database”文件夹中。 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>DataSource.xml</strong> </p> 
 <pre>&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;
	
&lt;bean 
class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt;
	&lt;property name="location"&gt;
		&lt;value&gt;properties/database.properties&lt;/value&gt;
	&lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="dataSource" 
         class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;
	&lt;property name="driverClassName" value="${jdbc.driverClassName}" /&gt;
	&lt;property name="url" value="${jdbc.url}" /&gt;
	&lt;property name="username" value="${jdbc.username}" /&gt;
	&lt;property name="password" value="${jdbc.password}" /&gt;
&lt;/bean&gt;

&lt;/beans&gt;</pre> 
 <p> Hibernate related…. </p> 
 <p> 创建一个会话工厂bean的配置文件(Hibernate.xml)，把它放到“resources/database”文件夹中。在注释必须使用AnnotationSessionFactoryBean&nbsp;来代替&nbsp;LocalSessionFactoryBean，并注明您的注解模型类在“annotatedClasses”属性，而不是'mappingResources'属性。 </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>Hibernate.xml</strong> </p>   
 <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;
    
&lt;!-- Hibernate session factory --&gt;
&lt;bean id="sessionFactory" 
class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean"&gt;

    &lt;property name="dataSource"&gt;
      &lt;ref bean="dataSource"/&gt;
    &lt;/property&gt;

    &lt;property name="hibernateProperties"&gt;
       &lt;props&gt;
         &lt;prop key="hibernate.dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/prop&gt;
         &lt;prop key="hibernate.show_sql"&gt;true&lt;/prop&gt;
       &lt;/props&gt;
    &lt;/property&gt;
    	
    &lt;property name="annotatedClasses"&gt;
	&lt;list&gt;
		&lt;value&gt;com.yiibai.stock.model.Stock&lt;/value&gt;
	&lt;/list&gt;
    &lt;/property&gt;

    &lt;/bean&gt;
&lt;/beans&gt;</pre> 
 <div>
   导入所有的&nbsp;Spring&nbsp;bean&nbsp;配置文件合并为一个文件(BeanLocations.xml)，把它放到“resources/config”文件夹。 
 </div> 
 <p> BeanLocations.xml </p> 
 <div>
   导入Spring数据库配置并使用&nbsp;Spring自动扫描功能。 
 </div> 
 <pre>&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:context="http://www.springframework.org/schema/context"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
http://www.springframework.org/schema/context
http://www.springframework.org/schema/context/spring-context-2.5.xsd"&gt;

	&lt;!-- Database Configuration --&gt;
	&lt;import resource="../database/DataSource.xml"/&gt;
	&lt;import resource="../database/Hibernate.xml"/&gt;
	
	&lt;!-- Auto scan the components --&gt;
	&lt;context:component-scan 
		base-package="com.yiibai.stock" /&gt;
	
&lt;/beans&gt;</pre> 
 <h2> 6. 运行它 </h2> 
 <div>
   把所有的文件和配置整合，运行它。 
 </div> 
 <pre>package com.yiibai.common;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

import com.yiibai.stock.bo.StockBo;
import com.yiibai.stock.model.Stock;

public class App 
{
    public static void main( String[] args )
    {
    	ApplicationContext appContext = 
    	  new ClassPathXmlApplicationContext("spring/config/BeanLocations.xml");
	
    	StockBo stockBo = (StockBo)appContext.getBean("stockBo");
    	
    	/** insert **/
    	Stock stock = new Stock();
    	stock.setStockCode("7668");
    	stock.setStockName("HAIO");
    	stockBo.save(stock);
    	
    	/** select **/
    	Stock stock2 = stockBo.findByStockCode("7668");
    	System.out.println(stock2);
    	
    	/** update **/
    	stock2.setStockName("HAIO-1");
    	stockBo.update(stock2);
    	
    	/** delete **/
    	stockBo.delete(stock2);
    	
    	System.out.println("Done");
    }
}</pre> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> 输出结果: </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <br> </p> 
 <pre class="prettyprint lang-bsh">Hibernate: insert into yiibai.stock (STOCK_CODE, STOCK_NAME) values (?, ?)
Hibernate: select stock0_.STOCK_ID as STOCK1_0_, stock0_.STOCK_CODE as STOCK2_0_, stock0_.STOCK_NAME as STOCK3_0_ from yiibai.stock stock0_ where stock0_.STOCK_CODE=?
Stock [stockCode=7667, stockId=3, stockName=HAIO]
Hibernate: update yiibai.stock set STOCK_CODE=?, STOCK_NAME=? where STOCK_ID=?
Hibernate: delete from yiibai.stock where STOCK_ID=?
Done</pre> 
 <p> <br> </p> 
 <h2> 总结 </h2> 
 <p> 所有的Spring，Hibernate相关类和配置文件都进行注解，它只是保留在XML文件中的数据库的详细信息。就个人而言，我不使用太多的注释功能，因为在某种程度上可能需要一些解决方法，像上面的“CustomHibernateDaoSupport'扩展'HibernateDaoSupport”。&nbsp;在Spring和Hibernate的XML文件的成熟是一个更优的选择。 </p> 
 <div>
   代码下载 &nbsp;-&nbsp;
  <a target="_blank" href="http://pan.baidu.com/s/1bewLiu">http://pan.baidu.com/s/1bewLiu</a> 
 </div>
 <br>      
</div></body></html>
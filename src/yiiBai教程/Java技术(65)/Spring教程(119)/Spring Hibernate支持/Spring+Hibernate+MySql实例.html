<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring+Hibernate+MySql实例</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    这个例子将创建一个简单的 Java 项目结构，并演示如何使用 Hibernate 在Spring框架进行&nbsp;MySQL 数据库的数据处理工作(插入，选择，更新和删除)。 
  </div> 
 </div> 
 <p> <br> </p> 
 <h2> 
  <div>
    最终项目结构 
  </div> </h2> 
 <div>
   最终的项目文件结构应该看起来如下面的图中显示。
  <br> 
  <img src="/uploads/tutorial/20151227/1-15122H15H25C.png" alt="">
  <br> 
 </div> 
 <div style="text-align:center;"> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/dcfa8bc998424beaace87ed1d66a7a30/clipboard.png"> 
 </div> 
 <h2> 
  <div>
    1.创建表 
  </div> </h2> 
 <div>
   在MySQL数据库中创建一张&nbsp;“stock”表。&nbsp;SQL语句如下： 
 </div> 
 <pre>CREATE TABLE  `yiibai`.`stock` (
  `STOCK_ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `STOCK_CODE` varchar(10) NOT NULL,
  `STOCK_NAME` varchar(20) NOT NULL,
  PRIMARY KEY (`STOCK_ID`) USING BTREE,
  UNIQUE KEY `UNI_STOCK_NAME` (`STOCK_NAME`),
  UNIQUE KEY `UNI_STOCK_ID` (`STOCK_CODE`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</pre> 
 <h2> 2. Model &amp; BO &amp; DAO </h2> 
 <div>
   模型中，业务对象(BO)和数据访问对象(DAO)模式是有助于清楚地识别层，以避免弄乱项目结构。 
 </div> 
 <h5> Stock Model </h5> 
 <div>
   Stock&nbsp;模型类以后用于存储库存数据。 
 </div> 
 <pre>package com.yiibai.stock.model;

import java.io.Serializable;

public class Stock implements Serializable {

	private static final long serialVersionUID = 1L;

	private Long stockId;
	private String stockCode;
	private String stockName;

	//getter and setter methods...
}</pre> 
 <h5> Stock Business Object (BO)) </h5> 
 <div>
   Stock&nbsp;业务对象(BO)接口和实现，它是用来存储项目的业务功能，真正的数据库操作(CRUD)的工作不应该参与这一个类，而是有一个DAO(StockDao)类来做到这一点。 
 </div> 
 <pre>package com.yiibai.stock.bo;

import com.yiibai.stock.model.Stock;

public interface StockBo {
	
	void save(Stock stock);
	void update(Stock stock);
	void delete(Stock stock);
	Stock findByStockCode(String stockCode);
}</pre> 
 <pre>package com.yiibai.stock.bo.impl;

import com.yiibai.stock.bo.StockBo;
import com.yiibai.stock.dao.StockDao;
import com.yiibai.stock.model.Stock;

public class StockBoImpl implements StockBo{
	
	StockDao stockDao;
	
	public void setStockDao(StockDao stockDao) {
		this.stockDao = stockDao;
	}

	public void save(Stock stock){
		stockDao.save(stock);
	}
	
	public void update(Stock stock){
		stockDao.update(stock);
	}
	
	public void delete(Stock stock){
		stockDao.delete(stock);
	}
	
	public Stock findByStockCode(String stockCode){
		return stockDao.findByStockCode(stockCode);
	}
}</pre> 
 <h5> Stock Data Access Object </h5> 
 <p> Stock&nbsp;DAO接口和实现，DAO实现类扩展了 Spring 的“HibernateDaoSupport”，以使Spring框架支持Hibernate。&nbsp;现在，你可以通过getHibernateTemplate()执行 Hibernate 功能。 </p> 
 <pre>package com.yiibai.stock.dao;

import com.yiibai.stock.model.Stock;

public interface StockDao {
	
	void save(Stock stock);
	void update(Stock stock);
	void delete(Stock stock);
	Stock findByStockCode(String stockCode);

}</pre> 
 <pre>package com.yiibai.stock.dao.impl;

import java.util.List;

import org.springframework.orm.hibernate3.support.HibernateDaoSupport;

import com.yiibai.stock.dao.StockDao;
import com.yiibai.stock.model.Stock;

public class StockDaoImpl extends HibernateDaoSupport implements StockDao{
	
	public void save(Stock stock){
		getHibernateTemplate().save(stock);
	}
	
	public void update(Stock stock){
		getHibernateTemplate().update(stock);
	}
	
	public void delete(Stock stock){
		getHibernateTemplate().delete(stock);
	}
	
	public Stock findByStockCode(String stockCode){
		List list = getHibernateTemplate().find(
                      "from Stock where stockCode=?",stockCode
                );
		return (Stock)list.get(0);
	}

}</pre> 
 <h2> 
  <div>
    5.资源配置 
  </div> </h2> 
 <div>
   用于存储 Spring，Hibernate 等配置文件。 
 </div> 
 <h5> Hibernate Configuration </h5> 
 <div>
   创建&nbsp;Hibernate&nbsp;映射文件(Stock.hbm.xml)的 Stock 表，把它放在“resources/hibernate/”文件夹中。 
 </div> 
 <pre>&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;

&lt;hibernate-mapping&gt;
    &lt;class name="com.yiibai.stock.model.Stock" table="stock" catalog="yiibai"&gt;
        &lt;id name="stockId" type="java.lang.Long"&gt;
            &lt;column name="STOCK_ID" /&gt;
            &lt;generator class="identity" /&gt;
        &lt;/id&gt;
        &lt;property name="stockCode" type="string"&gt;
            &lt;column name="STOCK_CODE" length="10" not-null="true" unique="true" /&gt;
        &lt;/property&gt;
        &lt;property name="stockName" type="string"&gt;
            &lt;column name="STOCK_NAME" length="20" not-null="true" unique="true" /&gt;
        &lt;/property&gt;
    &lt;/class&gt;
&lt;/hibernate-mapping&gt;</pre> 
 <h5> Spring Configuration </h5> 
 <p> Database related…. </p> 
 <p> 创建一个属性文件(database.properties)数据库的详细信息，把它放在“resources/properties”&nbsp;文件夹中。这是很好的做法，不同于数据库细节并将 Spring&nbsp;bean 配置成不同的文件。 </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>database.properties</strong> </p> 
 <pre>jdbc.driverClassName=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/yiibai
jdbc.username=root
jdbc.password=password</pre> 
 <div>
   为你的数据库创建一个“dataSource”&nbsp;bean配置文件(DataSource.xml)，并从database.properties导入的属性，把它放入到&nbsp;“resources/database”&nbsp;文件夹中。 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>DataSource.xml</strong> </p> 
 <pre>&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;
	
&lt;bean 
class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt;
	&lt;property name="location"&gt;
		&lt;value&gt;properties/database.properties&lt;/value&gt;
	&lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="dataSource" 
         class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;
	&lt;property name="driverClassName" value="${jdbc.driverClassName}" /&gt;
	&lt;property name="url" value="${jdbc.url}" /&gt;
	&lt;property name="username" value="${jdbc.username}" /&gt;
	&lt;property name="password" value="${jdbc.password}" /&gt;
&lt;/bean&gt;

&lt;/beans&gt;</pre> 
 <p> Hibernate 关联…. </p> 
 <p> 创建一个会话工厂&nbsp;bean&nbsp;配置文件(Hibernate.xml)，把它放入&nbsp;“resources/database”&nbsp;文件夹中。这个&nbsp;LocalSessionFactoryBean&nbsp;中设置一个共享的&nbsp;Hibernate&nbsp;SessionFactory&nbsp;在一个&nbsp;Spring&nbsp;应用程序上下文。 </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>Hibernate.xml</strong> </p>   
 <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;
    
&lt;!-- Hibernate session factory --&gt;
&lt;bean id="sessionFactory" 
     class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;

    &lt;property name="dataSource"&gt;
      &lt;ref bean="dataSource"/&gt;
    &lt;/property&gt;

    &lt;property name="hibernateProperties"&gt;
       &lt;props&gt;
         &lt;prop key="hibernate.dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/prop&gt;
         &lt;prop key="hibernate.show_sql"&gt;true&lt;/prop&gt;
       &lt;/props&gt;
     &lt;/property&gt;
    	
     &lt;property name="mappingResources"&gt;
	&lt;list&gt;
           &lt;value&gt;/hibernate/Stock.hbm.xml&lt;/value&gt;
	&lt;/list&gt;
      &lt;/property&gt;	

    &lt;/bean&gt;
&lt;/beans&gt;</pre> 
 <p> Spring beans related…. </p> 
 <p> 创建一个bean配置文件(Stock.xml)的BO和DAO类，把它放入&nbsp;“resources/spring”&nbsp;文件夹中。依赖的 DAO(stockDao)bean&nbsp;注入到&nbsp;bo(stockBo)bean;&nbsp;SessionFactory&nbsp;的&nbsp;bean&nbsp;成stockDao。 </p> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>Stock.xml</strong> </p> 
 <pre>&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;

    &lt;!-- Stock business object --&gt;
   &lt;bean id="stockBo" class="com.yiibai.stock.bo.impl.StockBoImpl" &gt;
   		&lt;property name="stockDao" ref="stockDao" /&gt;
   &lt;/bean&gt;
 
   &lt;!-- Stock Data Access Object --&gt;
   &lt;bean id="stockDao" class="com.yiibai.stock.dao.impl.StockDaoImpl" &gt;
   		&lt;property name="sessionFactory" ref="sessionFactory"&gt;&lt;/property&gt;
   &lt;/bean&gt;
   
&lt;/beans&gt;</pre> 
 <div>
   导入所有的Spring&nbsp;bean配置文件合并为一个文件(BeanLocations.xml)，把它变成了“resources/config”文件夹。 
 </div> 
 <p style="color:#333333;font-family:'Helvetica Neue', Helvetica,  font-size:16px;"> <strong>BeanLocations.xml</strong> </p> 
 <pre>&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;

	&lt;!-- Database Configuration --&gt;
	&lt;import resource="../database/DataSource.xml"/&gt;
	&lt;import resource="../database/Hibernate.xml"/&gt;
	
	&lt;!-- Beans Declaration --&gt;
	&lt;import resource="../beans/Stock.xml"/&gt;
	
&lt;/beans&gt;</pre> 
 <h2> 6. 运行它 </h2> 
 <div>
   把所有的文件和配置，运行它。 
 </div> 
 <pre>package com.yiibai.common;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

import com.yiibai.stock.bo.StockBo;
import com.yiibai.stock.model.Stock;

public class App 
{
    public static void main( String[] args )
    {
    	ApplicationContext appContext = 
    	  new ClassPathXmlApplicationContext("spring/config/BeanLocations.xml");
	
    	StockBo stockBo = (StockBo)appContext.getBean("stockBo");
    	
    	/** insert **/
    	Stock stock = new Stock();
    	stock.setStockCode("7668");
    	stock.setStockName("HAIO");
    	stockBo.save(stock);
    	
    	/** select **/
    	Stock stock2 = stockBo.findByStockCode("7668");
    	System.out.println(stock2);
    	
    	/** update **/
    	stock2.setStockName("HAIO-1");
    	stockBo.update(stock2);
    	
    	/** delete **/
    	stockBo.delete(stock2);
    	
    	System.out.println("Done");
    }
}</pre> 
 <p> 输出结果： </p> 
 <p> <br> </p> 
 <pre class="prettyprint lang-bsh">Hibernate: insert into yiibai.stock (STOCK_CODE, STOCK_NAME) values (?, ?)
Hibernate: select stock0_.STOCK_ID as STOCK1_0_, stock0_.STOCK_CODE as STOCK2_0_, stock0_.STOCK_NAME as STOCK3_0_ from yiibai.stock stock0_ where stock0_.STOCK_CODE=?
Stock [stockCode=7667, stockId=1, stockName=HAIO]
Hibernate: update yiibai.stock set STOCK_CODE=?, STOCK_NAME=? where STOCK_ID=?
Done</pre> 
 <p> <br> </p> 
 <div>
   下载代码 –&nbsp;
  <a target="_blank" href="http://pan.baidu.com/s/1i4f40tB">http://pan.baidu.com/s/1i4f40tB</a> 
 </div> 
 <div> 
 </div> 
 <p> <br> </p>
 <br>      
</div></body></html>
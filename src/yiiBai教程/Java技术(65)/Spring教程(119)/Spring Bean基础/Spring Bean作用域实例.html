<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring Bean作用域实例</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    在Spring中，bean作用域用于确定哪种类型的 bean 实例应该从Spring容器中返回给调用者。bean支持的5种范围域： 
  </div> 
 </div> 
 <div> 
  <ol> 
   <li> 
    <div>
      单例&nbsp;-&nbsp;每个Spring&nbsp;IoC 容器返回一个bean实例 
    </div> </li> 
   <li> 
    <div>
      原型-&nbsp;当每次请求时返回一个新的bean实例 
    </div> </li> 
   <li> 
    <div>
      请求&nbsp;-&nbsp;返回每个HTTP请求的一个Bean实例 
    </div> </li> 
   <li> 
    <div>
      会话&nbsp;-&nbsp;返回每个HTTP会话的一个bean实例 
    </div> </li> 
   <li> 
    <div>
      全局会话-&nbsp;返回全局HTTP会话的一个bean实例 
    </div> </li> 
  </ol> 
  <div>
    在大多数情况下，可能只处理了 Spring 的核心作用域&nbsp;-&nbsp;单例和原型，默认作用域是单例。 
  </div> 
  <div>
    注：意味着只有在一个基于web的Spring&nbsp;ApplicationContext情形下有效！ 
  </div> 
  <h2> 
   <div>
     单例VS原型 
   </div> </h2> 
  <div>
    这里有一个例子来说明，bean的作用域单例和原型之间的不同： 
  </div> 
  <pre>package com.yiibai.customer.services;

public class CustomerService 
{
	String message;
	
	public String getMessage() {
		return message;
	}

	public void setMessage(String message) {
		this.message = message;
	}
}</pre> 
  <h2> 
   <div>
     1.单例例子 
   </div> </h2> 
  <div>
    如果 bean 配置文件中没有指定 bean 的范围，默认为单例。 
  </div> 
  <pre>&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;

       &lt;bean id="customerService" 
            class="com.yiibai.customer.services.CustomerService" /&gt;
		
&lt;/beans&gt;</pre> 
  <p> 执行结果： </p> 
  <pre>package com.yiibai.common;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

import com.yiibai.customer.services.CustomerService;

public class App 
{
    public static void main( String[] args )
    {
    	ApplicationContext context = 
    	 new ClassPathXmlApplicationContext(new String[] {"Spring-Customer.xml"});

    	CustomerService custA = (CustomerService)context.getBean("customerService");
    	custA.setMessage("Message by custA");
    	System.out.println("Message : " + custA.getMessage());
    	
    	//retrieve it again
    	CustomerService custB = (CustomerService)context.getBean("customerService");
    	System.out.println("Message : " + custB.getMessage());
    }
}</pre> 
  <p> 输出结果 </p> 
  <pre>Message : Message by custA
Message : Message by custA&nbsp;</pre> 
  <p> 由于&nbsp;bean&nbsp;的&nbsp;“CustomerService'&nbsp;是单例作用域，第二个通过提取”custB“将显示消息由&nbsp;”custA'&nbsp;设置，即使它是由一个新的&nbsp;getBean()方法来提取。在单例中，每个Spring&nbsp;IoC容器只有一个实例，无论多少次调用 getBean()方法获取它，它总是返回同一个实例。 </p> 
  <h2> 
   <div>
     2.原型例子 
   </div> </h2> 
  <div>
    如果想有一个新的 “CustomerService”bean 实例，每次调用它的时候，需要使用原型(prototype)来代替。 
  </div>   
  <pre>&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;

   &lt;bean id="customerService" class="com.yiibai.customer.services.CustomerService" 
         scope="prototype"/&gt;
		
&lt;/beans&gt;</pre> 
  <p> 运行-执行 </p> 
  <pre>Message : Message by custA
Message : null</pre> 
  <div>
    在原型作用域，必须为每个 getBean()方法中调用返回一个新的实例。 
  </div> 
  <h2> 
   <div>
     3.&nbsp;Bean作用域注释 
   </div> </h2> 
  <div>
    还可以使用注释来定义 bean 的作用域。 
  </div> 
  <pre>package com.yiibai.customer.services;

import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Service;

@Service
@Scope("prototype")
public class CustomerService 
{
	String message;
	
	public String getMessage() {
		return message;
	}

	public void setMessage(String message) {
		this.message = message;
	}
}</pre> 
  <div>
    启用自动组件扫描 
  </div> 
  <pre>&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
	http://www.springframework.org/schema/context
	http://www.springframework.org/schema/context/spring-context-2.5.xsd"&gt;

       &lt;context:component-scan base-package="com.yiibai.customer" /&gt;
		
&lt;/beans&gt;</pre> 
  <div>
    下载代码 – 
   <a target="_blank" href="http://pan.baidu.com/s/1o7jxMrg">http://pan.baidu.com/s/1o7jxMrg</a> 
  </div> 
 </div>
 <br>      
</div></body></html>
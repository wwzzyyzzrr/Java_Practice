<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring JdbcTemplate batchUpdate() 实例</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    在某些情况下，可能需要将一批记录插入到数据库中。如果你对每条记录调用一个插件的方法，SQL语句将被重复编译，造成系统缓慢进行。 
  </div> 
 </div> 
 <div> 
  <div>
    在上述情况下，你可以使用 JdbcTemplate&nbsp;BATCHUPDATE()方法来执行批量插入操作。用这种方法，该语句只被编译一次，执行多次。 
  </div> 
  <div>
    详见&nbsp;JdbcTemplate&nbsp;类的&nbsp;BATCHUPDATE()示例。 
  </div> 
  <pre>//insert batch example
public void insertBatch(final List&lt;Customer&gt; customers){
		
  String sql = "INSERT INTO CUSTOMER " +
	"(CUST_ID, NAME, AGE) VALUES (?, ?, ?)";
			
  getJdbcTemplate().batchUpdate(sql, new BatchPreparedStatementSetter() {
			
	@Override
	public void setValues(PreparedStatement ps, int i) throws SQLException {
		Customer customer = customers.get(i);
		ps.setLong(1, customer.getCustId());
		ps.setString(2, customer.getName());
		ps.setInt(3, customer.getAge() );
	}
			
	@Override
	public int getBatchSize() {
		return customers.size();
	}
  });
}</pre> 
  <div>
    或者，可以直接执行SQL。 
  </div> 
  <pre>//insert batch example with SQL
public void insertBatchSQL(final String sql){
		
	getJdbcTemplate().batchUpdate(new String[]{sql});
		
}</pre> 
  <div>
    Spring 的 bean 配置文件 
  </div> 
  <pre>&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;

	&lt;bean id="customerDAO" class="com.yiibai.customer.dao.impl.JdbcCustomerDAO"&gt;
		&lt;property name="dataSource" ref="dataSource" /&gt;
	&lt;/bean&gt;
	
	&lt;bean id="dataSource" 
        class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;

		&lt;property name="driverClassName" value="com.mysql.jdbc.Driver" /&gt;
		&lt;property name="url" value="jdbc:mysql://localhost:3306/yiibaijava" /&gt;
		&lt;property name="username" value="root" /&gt;
		&lt;property name="password" value="password" /&gt;
	&lt;/bean&gt;
	
&lt;/beans&gt;</pre> 
  <p> 执行它 </p>   
  <pre>package com.yiibai.common;

import java.util.ArrayList;
import java.util.List;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import com.yiibai.customer.dao.CustomerDAO;
import com.yiibai.customer.model.Customer;

public class App 
{
    public static void main( String[] args )
    {
    	ApplicationContext context = 
    		new ClassPathXmlApplicationContext("Spring-Customer.xml");
    	 
        CustomerDAO customerDAO = (CustomerDAO) context.getBean("customerDAO");
        Customer customer1 = new Customer(1, "yiibai1",21);
        Customer customer3 = new Customer(2, "yiibai2",22);
        Customer customer2 = new Customer(3, "yiibai3",23);
  
        List&lt;Customer&gt;customers = new ArrayList&lt;Customer&gt;();
        customers.add(customer1);
        customers.add(customer2);
        customers.add(customer3);
        
        customerDAO.insertBatch(customers);

        String sql = "UPDATE CUSTOMER SET NAME ='BATCHUPDATE'";
        customerDAO.insertBatchSQL(sql);
      
    }
}</pre> 
  <div>
    在本例中，插入三条顾客的记录，并批量更新所有客户的名字。 
  </div> 
  <div> 
   <br> 
  </div> 
  <div>
    下载代码 –&nbsp;
   <a target="_blank" href="http://pan.baidu.com/s/1jGTXfgi">http://pan.baidu.com/s/1jGTXfgi</a> 
  </div> 
  <div> 
  </div> 
 </div>
 <br>      
</div></body></html>
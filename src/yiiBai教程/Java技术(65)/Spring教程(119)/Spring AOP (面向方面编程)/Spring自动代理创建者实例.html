<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring自动代理创建者实例</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在上一篇 Spring AOP实例 – <a target="_blank" href="http://www.yiibai.com/spring/spring-aop-examples-advice.html" title="advice">advice</a>, <a target="_blank" href="http://www.yiibai.com/spring/spring-aop-example-pointcut-advisor.html" title="pointcut 和 advisor">pointcut 和 advisor</a>, 必须手动创建一个代理bean(ProxyFactryBean)，对每个Bean需要AOP支持。<br>这不是一种有效的方式，例如，如果想在客户模块，所有的DAO类实现SQL日志支持(提醒)的AOP功能，那么必须手动创建很多代理工厂bean，因此在 bean配置文件可能会泛滥代理类。<br>幸运的是，Spring有两个自动代理创建者来自动创建代理bean。</p> 
 <h2 id="h2-1-beannameautoproxycreator-"><a name="1. BeanNameAutoProxyCreator示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>1. BeanNameAutoProxyCreator示例</h2>
 <p>在此之前，必须手动创建一个代理bean(ProxyFactryBean)。</p> 
 <pre><code class="lang-xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;

    &lt;bean id="customerService" class="com.yiibai.customer.services.CustomerService"&gt;
        &lt;property name="name" value="Yiibai Mook Kim" /&gt;
        &lt;property name="url" value="http://www.yiibai.com" /&gt;
    &lt;/bean&gt;

    &lt;bean id="hijackAroundMethodBeanAdvice" class="com.yiibai.aop.HijackAroundMethod" /&gt;

    &lt;bean id="customerServiceProxy" 
        class="org.springframework.aop.framework.ProxyFactoryBean"&gt;

        &lt;property name="target" ref="customerService" /&gt;

        &lt;property name="interceptorNames"&gt;
            &lt;list&gt;
                &lt;value&gt;customerAdvisor&lt;/value&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="customerAdvisor"
        class="org.springframework.aop.support.NameMatchMethodYiibaicutAdvisor"&gt;
        &lt;property name="mappedName" value="printName" /&gt;
        &lt;property name="advice" ref="hijackAroundMethodBeanAdvice" /&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre> 
 <p>使用代理名称“customerServiceProxy”来获得 bean。</p> 
 <pre><code class="lang-java">CustomerService cust = (CustomerService)appContext.getBean("customerServiceProxy");
</code></pre> 
 <p>在自动代理机制，只需要创建一个的 BeanNameAutoProxyCreator，并包含所有你的bean(通过bean的名字，或正则表达式名)和“advisor” 作为一个单位。</p> 
 <pre><code class="lang-xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;

    &lt;bean id="customerService" class="com.yiibai.customer.services.CustomerService"&gt;
        &lt;property name="name" value="Yiibai Mook Kim" /&gt;
        &lt;property name="url" value="http://www.yiibai.com" /&gt;
    &lt;/bean&gt;

    &lt;bean id="hijackAroundMethodBeanAdvice" class="com.yiibai.aop.HijackAroundMethod" /&gt;

    &lt;bean id="customerAdvisor"
        class="org.springframework.aop.support.NameMatchMethodYiibaicutAdvisor"&gt;
        &lt;property name="mappedName" value="printName" /&gt;
        &lt;property name="advice" ref="hijackAroundMethodBeanAdvice" /&gt;
    &lt;/bean&gt;

    &lt;bean
        class="org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"&gt;
        &lt;property name="beanNames"&gt;
            &lt;list&gt;
                &lt;value&gt;*Service&lt;/value&gt;
            &lt;/list&gt;
        &lt;/property&gt;
        &lt;property name="interceptorNames"&gt;
            &lt;list&gt;
                &lt;value&gt;customerAdvisor&lt;/value&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre> 
 <p>现在，可以通过“CustomerService”的原始名称获取bean, 如果知道这个bean已经代理。</p>   
 <pre><code class="lang-java">CustomerService cust = (CustomerService)appContext.getBean("customerService");
</code></pre> 
 <h2 id="h2-2-defaultadvisorautoproxycreator-"><a name="2. DefaultAdvisorAutoProxyCreator示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>2. DefaultAdvisorAutoProxyCreator示例</h2>
 <p>这个 <code>DefaultAdvisorAutoProxyCreator</code> 是非常强大的，如果有 bean 相关连，Spring会自动创建一个代理。</p> 
 <pre><code class="lang-xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;

    &lt;bean id="customerService" class="com.yiibai.customer.services.CustomerService"&gt;
        &lt;property name="name" value="Yiibai Mook Kim" /&gt;
        &lt;property name="url" value="http://www.yiibai.com" /&gt;
    &lt;/bean&gt;

    &lt;bean id="hijackAroundMethodBeanAdvice" class="com.yiibai.aop.HijackAroundMethod" /&gt;

    &lt;bean id="customerAdvisor"
        class="org.springframework.aop.support.NameMatchMethodYiibaicutAdvisor"&gt;
        &lt;property name="mappedName" value="printName" /&gt;
        &lt;property name="advice" ref="hijackAroundMethodBeanAdvice" /&gt;
    &lt;/bean&gt;

       &lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator" /&gt;

&lt;/beans&gt;
</code></pre> 
 <p>不用管使用什么代理方法， Spring 都会有最适合处理方式。</p> 
 <p>下载代码 – <a target="_blank" href="http://pan.baidu.com/s/1pKdqtjt">http://pan.baidu.com/s/1pKdqtjt</a></p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring Boot将WAR文件部署到Tomcat</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在本文中，将演示如何将<strong>Spring Boot WAR</strong>文件部署到<strong>Tomcat servlet</strong>容器中。</p> 
 <p>对于<strong>Spring Boot WAR</strong>部署，需要执行三个步骤：</p> 
 <ol> 
  <li>扩展<code>SpringBootServletInitializer</code></li>
  <li>根据提供标记嵌入式servlet容器。</li>
  <li>更新包装为 <code>War</code> </li>
 </ol> 
 <p>测试工具：</p> 
 <ul> 
  <li>Spring Boot 1.4.2.RELEASE</li>
  <li>Tomcat 8.5.9</li>
  <li>Maven 3</li>
 </ul> 
 <blockquote> 
  <p>注意<br>在Spring Boot中，具有嵌入服务器解决方案的最终可执行<code>JAR</code>文件可能不适合所有生产环境，特别是部署团队(具有良好的服务器优化和监控技能知识，但缺乏开发经验的团队)，他们希望完全控制服务器，并且不能接触代码。</p> 
 </blockquote> 
 <p><strong>1. 推展 SpringBootServletInitializer</strong></p> 
 <p>使现有的 <code><a target="_blank" href="https://github.com/SpringBootApplication" title="@SpringBootApplication" class="at-link">@SpringBootApplication</a></code> 类扩展 <code>SpringBootServletInitializer</code><br><strong>1.1 </strong>- 经典<strong>Spring Boot JAR</strong>部署(更新此文件以支持WAR部署)。</p> 
 <p><code>SpringBootWebApplication.java</code> 文件的内容如下 -</p> 
 <pre><code class="lang-java">import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class SpringBootWebApplication {

    public static void main(String[] args) throws Exception {
        SpringApplication.run(SpringBootWebApplication.class, args);
    }

}
</code></pre> 
 <p><strong>1.2 Spring Boot WAR 部署</strong> </p> 
 <p><code>SpringBootWebApplication.java</code> 文件的内容如下 -</p> 
 <pre><code class="lang-java">import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.builder.SpringApplicationBuilder;
import org.springframework.boot.web.support.SpringBootServletInitializer;

@SpringBootApplication
public class SpringBootWebApplication extends SpringBootServletInitializer {

    @Override
    protected SpringApplicationBuilder configure(SpringApplicationBuilder application) {
        return application.sources(SpringBootWebApplication.class);
    }

    public static void main(String[] args) throws Exception {
        SpringApplication.run(SpringBootWebApplication.class, args);
    }

}

/*@SpringBootApplication
public class SpringBootWebApplication {

    public static void main(String[] args) throws Exception {
        SpringApplication.run(SpringBootWebApplication.class, args);
    }

}*/
</code></pre> 
 <p>如果要为部署创建了一个额外的<code>SpringBootWebApplication</code>类，请确保告诉<strong>Spring Boot</strong>要从哪个主类开始启动程序：</p> 
 <p>在 <code>pom.xml</code> 文件中增加以下内容指定 - </p> 
 <pre><code class="lang-xml">&lt;properties&gt;
      &lt;start-class&gt;com.yiibai.NewSpringBootWebApplicationForWAR&lt;/start-class&gt;
&lt;/properties&gt;
</code></pre> 
 <p><strong>2.提供标记嵌入式servlet容器</strong></p> 
 <p>在 <code>pom.xml</code> 文件中增加以下内容指定 - </p> 
 <pre><code class="lang-xml">&lt;dependencies&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!-- marked the embedded servlet container as provided --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
        &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;

&lt;/dependencies&gt;
</code></pre> 
 <p><strong>3.更新包装为War</strong><br>在 <code>pom.xml</code> 文件中增加以下内容指定 - </p> 
 <pre><code class="lang-xml">&lt;packaging&gt;war&lt;/packaging&gt;
</code></pre> 
 <p>完成，<code>mvn</code>打包并将<code>$project/target/xxx.war</code>复制到<code>Tomcat</code>发布目录进行部署。</p> 
 <p><strong>4. 完整的Spring Boot WAR + Tomcat部署</strong></p> 
 <p><strong>4.1</strong> - 以<code>Spring Boot Thymeleaf</code>为例，更新它并手动部署到Tomcat。<br><strong>4.2</strong> - 更新现有的<code>SpringBootWebApplication</code>并让它扩展<code>SpringBootServletInitializer</code>类。</p> 
 <p><code>SpringBootWebApplication.java</code>文件的完整代码如下所示 - </p> 
 <pre><code class="lang-java">package com.yiibai;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.builder.SpringApplicationBuilder;
import org.springframework.boot.web.support.SpringBootServletInitializer;

@SpringBootApplication
public class SpringBootWebApplication extends SpringBootServletInitializer {

    @Override
    protected SpringApplicationBuilder configure(SpringApplicationBuilder application) {
        return application.sources(SpringBootWebApplication.class);
    }

    public static void main(String[] args) throws Exception {
        SpringApplication.run(SpringBootWebApplication.class, args);
    }

}
</code></pre> 
 <p><strong>4.3 </strong>- 更新打包包，并按提供的标记<code>spring-boot-starter-tomcat</code>。<br><code>pom.xml</code>文件的完整代码如下所示 - </p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;spring-boot-web-thymeleaf&lt;/artifactId&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;name&gt;Spring Boot Web Thymeleaf Example&lt;/name&gt;
    &lt;description&gt;Spring Boot Web Thymeleaf Example&lt;/description&gt;
    &lt;url&gt;http://www.yiibai.com&lt;/url&gt;
    &lt;version&gt;1.0&lt;/version&gt;

    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;1.4.2.RELEASE&lt;/version&gt;
    &lt;/parent&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- marked the embedded servlet container as provided --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;!-- hot swapping, disable cache for template, enable live reload --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;!-- Optional, for bootstrap --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;bootstrap&lt;/artifactId&gt;
            &lt;version&gt;3.3.7&lt;/version&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;!-- Package as an executable jar/war --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre> 
 <p><strong>4.4 </strong>- 这是可选的，将<code>contextPath</code>更新为<code>/yiibai</code>以方便稍后作为演示。准备好<code>WAR</code>部署文件。</p> 
 <p><code>application.properties</code> 文件的完整内容如下所示 - </p>   
 <pre><code class="lang-bash">welcome.message: Hello Yiibai

server.contextPath=/yiibai
</code></pre> 
 <p><strong>4.5</strong> - 获取Tomcat并部署WAR文件，执行以下命令 - </p> 
 <pre><code class="lang-bash">F:\worksp\springboot\spring-boot-war-tomcat&gt;mvn clean package
[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building Spring Boot Web Thymeleaf Example 1.0
[INFO] ------------------------------------------------------------------------
Downloading: http://repo.maven.apache.org/maven2/org/springframework/boot/spring-boot-starter-thymeleaf/1.4.2.RELEASE/spring-boot-starter-thymeleaf-1.4.2.RELEASE.pom
Downloaded: http://repo.maven.apache.org/maven2/org/springframework/boot/spring-boot-starter-thymeleaf/1.4.2.RELEASE/spring-boot-starter-thymeleaf-1.4.2.RELEASE.pom (2 KB at 0.7 KB/sec)
Downloading: http://repo.maven.apache.org/maven2/org/thymeleaf/thymeleaf-spring4/2.1.5.RELEASE/thymeleaf-spring4-2.1.5.RELEASE.pom
....
.... ...
</code></pre> 
 <p>将生成的 <code>spring-boot-web-thymeleaf-1.0.war</code> 拷贝到 Tomcat 发布目录下 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201701/2301/483140140_42849.png" alt=""></p> 
 <p>例如，写本文章时，Tomcat 发布目录使用的是 - <code>F:\worksp\springmvc\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\webapps</code> </p> 
 <p><strong>4.6</strong> - 现在启动 Tomcat，访问：<a target="_blank" href="http://localhost:8080/yiibai/">http://localhost:8080/yiibai/</a> ，程序没有错误问题，应该会看到以下结果 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201701/2301/542140148_44281.png" alt=""></p>
 <br>      
</div></body></html>
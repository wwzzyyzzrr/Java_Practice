<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">PDFBox加密PDF文档</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在前一章中，我们已经看到了如何在PDF文档中插入图像。 在本章中，我们将学习如何加密PDF文档。</p> 
 <h2 id="h2--pdf-"><a name="加密PDF文档" class="reference-link"></a><span class="header-link octicon octicon-link"></span>加密PDF文档</h2>
 <p>使用<code>StandardProtectionPolicy</code>和<code>AccessPermission</code>类提供的方法加密PDF文档。</p> 
 <p><code>AccessPermission</code>类用于通过为其分配访问权限来保护PDF文档。 使用此教程，您可以限制用户执行以下操作。</p> 
 <ul> 
  <li>打印文档</li>
  <li>修改文档的内容</li>
  <li>复制或提取文档的内容</li>
  <li>添加或修改注释</li>
  <li>填写交互式表单域</li>
  <li>提取文字和图形以便视障人士使用</li>
  <li>汇编文件</li>
  <li>打印质量下降</li>
 </ul> 
 <p><code>StandardProtectionPolicy</code>类用于向文档添加基于密码的保护。</p> 
 <p>以下是对现有PDF文档进行加密的步骤。</p> 
 <p><strong>第1步:加载现有的PDF文档</strong></p> 
 <p>使用<code>PDDocument</code>类的静态方法<code>load()</code>加载现有的PDF文档。 此方法接受一个文件对象作为参数，因为这是一个静态方法，可以使用类名称调用它，如下所示。</p> 
 <pre><code class="lang-java">File file = new File("path of the document") 
PDDocument document = PDDocument.load(file);
</code></pre> 
 <p><strong>第2步:创建访问权限对象</strong></p> 
 <p>实例化<code>AccessPermission</code>类，如下所示。</p> 
 <pre><code class="lang-java">AccessPermission accessPermission = new AccessPermission();
</code></pre> 
 <p><strong>第3步:创建StandardProtectionPolicy对象</strong></p> 
 <p>通过传递所有者密码，用户密码和<code>AccessPermission</code>对象来实例化<code>StandardProtectionPolicy</code>类，如下所示。</p> 
 <pre><code class="lang-java">StandardProtectionPolicy spp = new StandardProtectionPolicy("1234","1234",accessPermission);
</code></pre> 
 <p><strong>第4步:设置加密密钥的长度</strong></p> 
 <p>使用<code>setEncryptionKeyLength()</code>方法设置加密密钥长度，如下所示。</p> 
 <pre><code class="lang-java">spp.setEncryptionKeyLength(128);
</code></pre> 
 <p><strong>第5步:设置权限</strong></p> 
 <p>使用<code>StandardProtectionPolicy</code>类的<code>setPermissions()</code>方法设置权限。 该方法接受一个<code>AccessPermission</code>对象作为参数。</p> 
 <pre><code class="lang-java">spp.setPermissions(accessPermission);
</code></pre> 
 <p><strong>第6步:保护文档</strong></p> 
 <p>可以使用<code>PDDocument</code>类的<code>protect()</code>方法保护文档，如下所示。 将<code>StandardProtectionPolicy</code>对象作为参数传递给此方法。</p> 
 <pre><code class="lang-java">document.protect(spp);
</code></pre> 
 <p><strong>第7步:保存文档</strong></p> 
 <p>在添加所需内容后，使用<code>PDDocument</code>类的<code>save()</code>方法保存PDF文档，如以下代码块所示。</p> 
 <pre><code class="lang-java">document.save("Path");
</code></pre> 
 <p><strong>第8步:关闭文件</strong></p> 
 <p>最后，使用<code>PDDocument</code>类的<code>close()</code>方法关闭文档，如下所示。</p> 
 <pre><code class="lang-java">document.close();
</code></pre> 
 <h2 id="h2-u793Au4F8B"><a name="示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>示例</h2>
 <p>假设有一个PDF文档:<em>sample.pdf</em>，所在目录为:<em>F:\worksp\pdfbox</em>，其空页如下所示。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201803/1103/791090321_61163.png" alt=""></p> 
 <p>这个例子演示了如何加密上面提到的PDF文档。 在这里，将加载名称为<em>sample.pdf</em> 的PDF文档并对其进行加密。 将此代码保存在<code>EncriptingPDF.java</code>文件中。</p>   
 <pre><code class="lang-java">package com.yiibai;

import java.io.File;

import org.apache.pdfbox.pdmodel.PDDocument;
import org.apache.pdfbox.pdmodel.encryption.AccessPermission;
import org.apache.pdfbox.pdmodel.encryption.StandardProtectionPolicy;
public class EncriptingPDF {

   public static void main(String args[]) throws Exception {
      //Loading an existing document
      File file = new File("F:/worksp/pdfbox/sample.pdf");
      PDDocument document = PDDocument.load(file);

      //Creating access permission object
      AccessPermission ap = new AccessPermission();         

      //Creating StandardProtectionPolicy object
      StandardProtectionPolicy spp = new StandardProtectionPolicy("123456", "123456", ap);

      //Setting the length of the encryption key
      spp.setEncryptionKeyLength(128);

      //Setting the access permissions
      spp.setPermissions(ap);

      //Protecting the document
      document.protect(spp);

      System.out.println("Document encrypted");

      //Saving the document
      document.save("F:/worksp/pdfbox/sample-encript.pdf");
      //Closing the document
      document.close();

   }
}
</code></pre> 
 <p>执行时，上述程序会加密显示以下消息的给定PDF文档。</p> 
 <pre><code class="lang-shell">Document encrypted
</code></pre> 
 <p>如果尝试打开文档<em>sample-encript.pdf</em>，则它会提示输入密码以打开文档，因为它是加密的，如下所示。<br><img src="http://www.yiibai.com/uploads/images/201803/1103/648090325_96678.png" alt=""></p> 
 <p>在输入密码后，文档应该可以正确打开。</p>
 <br>      
</div></body></html>
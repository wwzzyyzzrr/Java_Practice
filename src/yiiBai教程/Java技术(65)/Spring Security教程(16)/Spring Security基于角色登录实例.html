<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring Security基于角色登录实例</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    本教程介绍了Spring&nbsp;Security的基于角色登录。这意味着程序可根据自己分配的角色在登录时将用户重定向到不同的URL。 
  </div> 
 </div> 
 <div> 
  <p> 最基本的，我们要做的是创建一个自定义的成功处理程序来负责根据登录用户的角色重定向到相应的URL。Spring&nbsp;Security中已经提供了&nbsp;SimpleUrlAuthenticationSuccessHandler，它包含了成功处理程序的逻辑。我们只是用自己的重定向逻辑扩展它来实现我们的目标。 </p> 
  <div>
    当这个处理程序成功，我们将通过注册&nbsp;formLogin()&nbsp;或&nbsp;loginPage()。完整的例子如下所示。 
  </div> 
  <hr> 
  <div> 
  </div> 
 </div> 
 <div> 
  <span style="line-height:1.5;">需要用到的技术，如下所示 -&nbsp;</span> 
 </div> 
 <div> 
  <blockquote> 
   <ul> 
    <li> Spring 4.1.6.RELEASE </li> 
    <li> Spring Security 4.0.1.RELEASE </li> 
    <li> Maven 3 </li> 
    <li> JDK 1.8 </li> 
    <li> Tomcat 7 </li> 
    <li> Eclipse JUNO Service Release 2 </li> 
   </ul> 
  </blockquote> 
  <p> 让我们现在就开始，建议您按照以下步骤一起来实践。 </p> 
  <h4> 步骤1: 工程目录结构 </h4> 
  <div>
    现在，让我们解释在上面添加的结构每个细节提及的内容。 
  </div> 
  <h4> 
   <div>
     第2步：更新pom.xml，包括所需依懒 
   </div> </h4> 
  <pre>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;groupId&gt;com.yiibai.springsecurity&lt;/groupId&gt;
  &lt;artifactId&gt;SpringSecurityRoleBasedLogin&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  &lt;packaging&gt;war&lt;/packaging&gt;

  &lt;name&gt;SpringSecurityRoleBasedLogin&lt;/name&gt;

	&lt;properties&gt;
		&lt;springframework.version&gt;4.1.6.RELEASE&lt;/springframework.version&gt;
		&lt;springsecurity.version&gt;4.0.1.RELEASE&lt;/springsecurity.version&gt;
	&lt;/properties&gt;

	&lt;dependencies&gt;
		&lt;!-- Spring --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-core&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-web&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
			&lt;version&gt;${springframework.version}&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;!-- Spring Security --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
			&lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;
			&lt;version&gt;${springsecurity.version}&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
			&lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;
			&lt;version&gt;${springsecurity.version}&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
			&lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
			&lt;version&gt;3.1.0&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;
			&lt;artifactId&gt;javax.servlet.jsp-api&lt;/artifactId&gt;
			&lt;version&gt;2.3.1&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
			&lt;artifactId&gt;jstl&lt;/artifactId&gt;
			&lt;version&gt;1.2&lt;/version&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;build&gt;
		&lt;pluginManagement&gt;
			&lt;plugins&gt;
				&lt;plugin&gt;
					&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
					&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
					&lt;version&gt;3.2&lt;/version&gt;
					&lt;configuration&gt;
						&lt;source&gt;1.7&lt;/source&gt;
						&lt;target&gt;1.7&lt;/target&gt;
					&lt;/configuration&gt;
				&lt;/plugin&gt;
				&lt;plugin&gt;
					&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
					&lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
					&lt;version&gt;2.4&lt;/version&gt;
					&lt;configuration&gt;
						&lt;warSourceDirectory&gt;src/main/webapp&lt;/warSourceDirectory&gt;
						&lt;warName&gt;SpringSecurityRoleBasedLoginExample&lt;/warName&gt;
						&lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;
					&lt;/configuration&gt;
				&lt;/plugin&gt;
			&lt;/plugins&gt;
		&lt;/pluginManagement&gt;
		&lt;finalName&gt;SpringSecurityRoleBasedLogin&lt;/finalName&gt;
	&lt;/build&gt;
&lt;/project&gt;</pre> 
  <h4> 步骤3: 添加Spring Security配置类 </h4> 
  <p> 这里最重要一个步骤，在我们的应用程序中添加 Spring Security 是来创建Spring&nbsp;Security的Java配置。&nbsp;这个结构将创建用来负责应用程序内所有安全(保护应用程序的URL，验证提交用户名和密码，重定向到日志中的形式等等)的springSecurityFilterChain&nbsp;Servlet过滤程序。 </p> 
  <pre>package com.yiibai.springsecurity.configuration;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;

@Configuration
@EnableWebSecurity
public class SecurityConfiguration extends WebSecurityConfigurerAdapter {

	@Autowired
	CustomSuccessHandler customSuccessHandler;

	@Autowired
	public void configureGlobalSecurity(AuthenticationManagerBuilder auth) throws Exception {
		auth.inMemoryAuthentication().withUser("yiibai").password("123456").roles("USER");
		auth.inMemoryAuthentication().withUser("admin").password("123456").roles("ADMIN");
		auth.inMemoryAuthentication().withUser("dba").password("123456").roles("ADMIN","DBA");
	}

	@Override
	protected void configure(HttpSecurity http) throws Exception {
	  http.authorizeRequests()
	  	.antMatchers("/", "/home").access("hasRole('USER')")
	  	.antMatchers("/admin/**").access("hasRole('ADMIN')")
	  	.antMatchers("/db/**").access("hasRole('ADMIN') and hasRole('DBA')")
	  	.and().formLogin().loginPage("/login").successHandler(customSuccessHandler)
	  	.usernameParameter("ssoId").passwordParameter("password")
	  	.and().csrf()
	  	.and().exceptionHandling().accessDeniedPage("/Access_Denied");
	}

}</pre> 
  <p> 这个类是类似的，只不过有一些重要区别于之前教程文章：<br> formLogin().loginPage("/login").successHandler(customSuccessHandler). 现在来看看 successHandler。<span style="line-height:1.5;">这个类[如下所示]负责基于自定义逻辑的重定向，这对我们来说是根据他的角色[USER&nbsp;/&nbsp;ADMIN&nbsp;/&nbsp;DBA]用户重定向[</span><span style="line-height:1.5;">&nbsp;</span><span style="line-height:1.5;">home/admin/db]</span><span style="line-height:1.5;">。</span><span style="line-height:1.5;">&nbsp;</span> </p> 
  <div>
    以上的安全配置使用XML配置格式如下所示： 
  </div> 
  <pre>&lt;beans:beans xmlns="http://www.springframework.org/schema/security"
    xmlns:beans="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd
    http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-4.0.xsd"&gt;
     
    &lt;http auto-config="true" &gt;
        &lt;intercept-url pattern="/" access="hasRole('USER')" /&gt;
        &lt;intercept-url pattern="/home" access="hasRole('USER')" /&gt;
        &lt;intercept-url pattern="/admin**" access="hasRole('ADMIN')" /&gt;
        &lt;intercept-url pattern="/dba**" access="hasRole('ADMIN') and hasRole('DBA')" /&gt;
        &lt;form-login  login-page="/login" 
                     username-parameter="ssoId" 
                     password-parameter="password" 
                     authentication-success-handler-ref="customSuccessHandler"
                     authentication-failure-url="/Access_Denied" /&gt;
        &lt;csrf/&gt;
    &lt;/http&gt;
 
    &lt;authentication-manager &gt;
        &lt;authentication-provider&gt;
            &lt;user-service&gt;
                &lt;user name="yiibai"  password="123456"  authorities="ROLE_USER" /&gt;
                &lt;user name="admin" password="123456" authorities="ROLE_ADMIN" /&gt;
                &lt;user name="dba"   password="123456" authorities="ROLE_ADMIN,ROLE_DBA" /&gt;
            &lt;/user-service&gt;
        &lt;/authentication-provider&gt;
    &lt;/authentication-manager&gt;
     
    &lt;beans:bean id="customSuccessHandler" class="com.websystique.springsecurity.configuration.CustomSuccessHandler" /&gt;
    
&lt;/beans:beans&gt;</pre> 
  <p> 下面是上面提及成功处理的类，如下图的所示 -&nbsp; </p> 
  <pre>package com.websystique.springsecurity.configuration;

import java.io.IOException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.security.core.Authentication;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.web.DefaultRedirectStrategy;
import org.springframework.security.web.RedirectStrategy;
import org.springframework.security.web.authentication.SimpleUrlAuthenticationSuccessHandler;
import org.springframework.stereotype.Component;

@Component
public class CustomSuccessHandler extends SimpleUrlAuthenticationSuccessHandler {

	private RedirectStrategy redirectStrategy = new DefaultRedirectStrategy();

	@Override
	protected void handle(HttpServletRequest request, HttpServletResponse response, Authentication authentication)
			throws IOException {
		String targetUrl = determineTargetUrl(authentication);

		if (response.isCommitted()) {
			System.out.println("Can't redirect");
			return;
		}

		redirectStrategy.sendRedirect(request, response, targetUrl);
	}

	/*
	 * This method extracts the roles of currently logged-in user and returns
	 * appropriate URL according to his/her role.
	 */
	protected String determineTargetUrl(Authentication authentication) {
		String url = "";

		Collection&lt;? extends GrantedAuthority&gt; authorities = authentication.getAuthorities();

		List&lt;String&gt; roles = new ArrayList&lt;String&gt;();

		for (GrantedAuthority a : authorities) {
			roles.add(a.getAuthority());
		}

		if (isDba(roles)) {
			url = "/db";
		} else if (isAdmin(roles)) {
			url = "/admin";
		} else if (isUser(roles)) {
			url = "/home";
		} else {
			url = "/accessDenied";
		}

		return url;
	}

	private boolean isUser(List&lt;String&gt; roles) {
		if (roles.contains("ROLE_USER")) {
			return true;
		}
		return false;
	}

	private boolean isAdmin(List&lt;String&gt; roles) {
		if (roles.contains("ROLE_ADMIN")) {
			return true;
		}
		return false;
	}

	private boolean isDba(List&lt;String&gt; roles) {
		if (roles.contains("ROLE_DBA")) {
			return true;
		}
		return false;
	}

	public void setRedirectStrategy(RedirectStrategy redirectStrategy) {
		this.redirectStrategy = redirectStrategy;
	}

	protected RedirectStrategy getRedirectStrategy() {
		return redirectStrategy;
	}

}&nbsp;</pre> 
  <div>
    注意：看看如何扩展&nbsp;SimpleUrlAuthenticationSuccessHandler类和overridinghandle()方法，这个方法简单地使用配置RedirectStrategy[默认在这种情况下]调用重定向，由用户定义determineTargetUrl方法返回URL。此方法提取当前认证对象用户记录的角色，然后构造基于角色有相应的URL。最后RedirectStrategy，这是负责&nbsp;Spring&nbsp;Security&nbsp;框架内的所有重定向，请求重定向到指定的URL。 
  </div> 
  <div>
    以下步骤：其余的都是和之前教程文章中的内容相同了。 
  </div> 
  <h4> 
   <div>
     第4步：使用war注册springSecurityFilter 
   </div> </h4> 
  <div>
    下面指定的初始化类使用应用程序&nbsp;war&nbsp;[步骤3中创建]&nbsp;来注册springSecurityFilter&nbsp;。 
  </div> 
  <pre>package com.websystique.springsecurity.configuration;

import org.springframework.security.web.context.AbstractSecurityWebApplicationInitializer;

public class SecurityWebApplicationInitializer extends AbstractSecurityWebApplicationInitializer {

}</pre> 
  <div>
    上面在XML配置格式中的设置为： 
  </div> 
  <pre>&lt;filter&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;</pre> 
  <h4> 第5步: 添加控制器 </h4> 
  <pre>package com.yiibai.springsecurity.controller;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler;
import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

@Controller
public class HelloWorldController {

	
	@RequestMapping(value = { "/", "/home" }, method = RequestMethod.GET)
	public String homePage(ModelMap model) {
		model.addAttribute("user", getPrincipal());
		return "welcome";
	}

	@RequestMapping(value = "/admin", method = RequestMethod.GET)
	public String adminPage(ModelMap model) {
		model.addAttribute("user", getPrincipal());
		return "admin";
	}
	
	@RequestMapping(value = "/db", method = RequestMethod.GET)
	public String dbaPage(ModelMap model) {
		model.addAttribute("user", getPrincipal());
		return "dba";
	}

	@RequestMapping(value = "/Access_Denied", method = RequestMethod.GET)
	public String accessDeniedPage(ModelMap model) {
		model.addAttribute("user", getPrincipal());
		return "accessDenied";
	}

	@RequestMapping(value = "/login", method = RequestMethod.GET)
	public String loginPage() {
		return "login";
	}

	@RequestMapping(value="/logout", method = RequestMethod.GET)
	public String logoutPage (HttpServletRequest request, HttpServletResponse response) {
		Authentication auth = SecurityContextHolder.getContext().getAuthentication();
		if (auth != null){    
			new SecurityContextLogoutHandler().logout(request, response, auth);
		}
		return "redirect:/login?logout";
	}

	private String getPrincipal(){
		String userName = null;
		Object principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();

		if (principal instanceof UserDetails) {
			userName = ((UserDetails)principal).getUsername();
		} else {
			userName = principal.toString();
		}
		return userName;
	}

}</pre> 
  <h4> 第6步: 添加SpringMVC配置类 </h4> 
  <pre>package com.spring.springsecurity.configuration;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.ViewResolver;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.view.InternalResourceViewResolver;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;
import org.springframework.web.servlet.view.JstlView;

@Configuration
@EnableWebMvc
@ComponentScan(basePackages = "com.yiibai.springsecurity")
public class HelloWorldConfiguration extends WebMvcConfigurerAdapter{
	
	@Bean
	public ViewResolver viewResolver() {
		InternalResourceViewResolver viewResolver = new InternalResourceViewResolver();
		viewResolver.setViewClass(JstlView.class);
		viewResolver.setPrefix("/WEB-INF/views/");
		viewResolver.setSuffix(".jsp");

		return viewResolver;
	}

     /*
     * Configure ResourceHandlers to serve static resources like CSS/ Javascript etc...
     */
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/static/**").addResourceLocations("/static/");
    }
}</pre> 
  <h4> 第7步: 添加初始化类 </h4>   
  <pre>package com.yiibai.springsecurity.configuration;

import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;

public class SpringMvcInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

	@Override
	protected Class&lt;?&gt;[] getRootConfigClasses() {
		return new Class[] { HelloWorldConfiguration.class };
	}
 
	@Override
	protected Class&lt;?&gt;[] getServletConfigClasses() {
		return null;
	}
 
	@Override
	protected String[] getServletMappings() {
		return new String[] { "/" };
	}

}</pre> 
  <h4> 第8步: 添加视图 </h4> 
  <p> login.jsp </p> 
  <div>
    这个视图中还包含了用于登录面板布局CSS。 
  </div> 
  <pre>&lt;%@ page language="java" contentType="text/html; charset=ISO-8859-1" pageEncoding="ISO-8859-1"%&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%&gt;
&lt;html&gt;
	&lt;head&gt;
		&lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
		&lt;title&gt;Login page&lt;/title&gt;
		&lt;link href="&lt;c:url value='/static/css/bootstrap.css' /&gt;"  rel="stylesheet"&gt;&lt;/link&gt;
		&lt;link href="&lt;c:url value='/static/css/app.css' /&gt;" rel="stylesheet"&gt;&lt;/link&gt;
		&lt;link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.css" /&gt;
	&lt;/head&gt;

	&lt;body&gt;
		&lt;div id="mainWrapper"&gt;
			&lt;div class="login-container"&gt;
				&lt;div class="login-card"&gt;
					&lt;div class="login-form"&gt;
						&lt;c:url var="loginUrl" value="/login" /&gt;
						&lt;form action="${loginUrl}" method="post" class="form-horizontal"&gt;
							&lt;c:if test="${param.error != null}"&gt;
								&lt;div class="alert alert-danger"&gt;
									&lt;p&gt;Invalid username and password.&lt;/p&gt;
								&lt;/div&gt;
							&lt;/c:if&gt;
							&lt;c:if test="${param.logout != null}"&gt;
								&lt;div class="alert alert-success"&gt;
									&lt;p&gt;You have been logged out successfully.&lt;/p&gt;
								&lt;/div&gt;
							&lt;/c:if&gt;
							&lt;div class="input-group input-sm"&gt;
								&lt;label class="input-group-addon" for="username"&gt;&lt;i class="fa fa-user"&gt;&lt;/i&gt;&lt;/label&gt;
								&lt;input type="text" class="form-control" id="username" name="ssoId" placeholder="Enter Username" required&gt;
							&lt;/div&gt;
							&lt;div class="input-group input-sm"&gt;
								&lt;label class="input-group-addon" for="password"&gt;&lt;i class="fa fa-lock"&gt;&lt;/i&gt;&lt;/label&gt; 
								&lt;input type="password" class="form-control" id="password" name="password" placeholder="Enter Password" required&gt;
							&lt;/div&gt;
							&lt;input type="hidden" name="${_csrf.parameterName}"  value="${_csrf.token}" /&gt;
								
							&lt;div class="form-actions"&gt;
								&lt;input type="submit"
									class="btn btn-block btn-primary btn-default" value="Log in"&gt;
							&lt;/div&gt;
						&lt;/form&gt;
					&lt;/div&gt;
				&lt;/div&gt;
			&lt;/div&gt;
		&lt;/div&gt;

	&lt;/body&gt;
&lt;/html&gt;</pre> 
  <div>
    正如在之前的教程文章提到的还有，
   <a target="_blank" href="http://docs.spring.io/spring-security/site/docs/3.2.x/reference/htmlsingle/#csrf">CSRF</a>关联上述JSP行： 
  </div> 
  <pre>&lt;input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" /&gt;&lt;/strong&gt;</pre> 
  <p> 这是需要用来防止跨站请求伪造攻击。正如您所看到的，CSRF参数可在JSP&nbsp;EL表达式访问，还可以通过添加以下到JSP的顶部来强行执行EL表达式计算： </p> 
  <pre>&lt;%@ page isELIgnored="false"%&gt;</pre> 
  <p> welcome.jsp </p> 
  <pre>&lt;%@ page language="java" contentType="text/html; charset=ISO-8859-1" pageEncoding="ISO-8859-1"%&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
	&lt;title&gt;Welcome page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	Dear &lt;strong&gt;${user}&lt;/strong&gt;, Welcome to Home Page.
	&lt;a href="&lt;c:url value="/logout" /&gt;"&gt;Logout&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</pre> 
  <p> admin.jsp </p> 
  <pre>&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
	&lt;title&gt;Admin page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	Dear &lt;strong&gt;${user}&lt;/strong&gt;, Welcome to Admin Page.
	&lt;a href="&lt;c:url value="/logout" /&gt;"&gt;Logout&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</pre> 
  <p> dba.jsp </p> 
  <pre>&lt;%@ page language="java" contentType="text/html; charset=ISO-8859-1" pageEncoding="ISO-8859-1"%&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
	&lt;title&gt;DBA page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	Dear &lt;strong&gt;${user}&lt;/strong&gt;, Welcome to DBA Page.
	&lt;a href="&lt;c:url value="/logout" /&gt;"&gt;Logout&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</pre> 
  <p> accessDenied.jsp </p> 
  <pre>&lt;%@ page language="java" contentType="text/html; charset=ISO-8859-1" pageEncoding="ISO-8859-1"%&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
	&lt;title&gt;AccessDenied page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	Dear &lt;strong&gt;${user}&lt;/strong&gt;, You are not authorized to access this page
	&lt;a href="&lt;c:url value="/logout" /&gt;"&gt;Logout&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</pre> 
  <div>
    这里是快速一个CSS布局，只是大概进行美化，当然你也可以做得更漂亮一些。 
  </div> 
  <p> app.css </p> 
  <pre>html{
	background-color:#2F2F2F;
}

body, #mainWrapper {
	height: 100%;
}

body, #mainWrapper, .form-control{
	font-size:14px!important;
}

#mainWrapper {
	height: 100vh; 
	padding-left:10px;
	padding-right:10px;
	padding-bottom:10px;
}

#authHeaderWrapper{
	clear:both;
	width: 100%;
	height:3%;
	padding-top:5px;
	padding-bottom:5px;
}

.login-container {
    margin-top: 100px;
    background-color: floralwhite;
    width: 40%;
    left: 30%;
    position: absolute;
}

.login-card {
    width: 80%;
    margin: auto;
}
.login-form {
    padding: 10%;
}</pre> 
  <h4> 
   <div>
     第9步：构建和部署应用程序 
   </div> </h4> 
  <p> 现在构造&nbsp;war(通过&nbsp;eclipse/m2eclipse)或通过Maven的命令行(mvn&nbsp;clean&nbsp;install)。部署WAR文件到Servlet3.0容器。由于这里我使用的是在&nbsp;eclipse&nbsp;中配置&nbsp;Tomcat，可以直接发布到&nbsp;Tomcat&nbsp;服务容器中。如果不知道怎么使用，可以参考：<a target="_blank" href="http://www.yiibai.com/maven/create-a-maven-web-project-with-eclipse.html">http://www.yiibai.com/maven/create-a-maven-web-project-with-eclipse.html</a> </p> 
  <div>
    运行应用程序 
  </div> 
  <div>
    打开浏览器，然后访问：
   <a target="_blank" href="http://localhost:8080/SpringSecurityRoleBasedLogin">http://localhost:8080/SpringSecurityRoleBasedLogin</a>&nbsp;，如果没有任何错误，将提示登录&nbsp;-&nbsp; 
  </div> 
  <p> <img src="/uploads/tutorial/20160820/160r0121158_1_606.png" alt=""> </p> 
  <div>
    DBA提供的凭据(用户名和密码登录)，如下所示： 
  </div> 
  <p> <img src="/uploads/tutorial/20160820/160r0121214_1_a6.png" alt=""> </p> 
  <p> 提交，您将会被跳转到 /db 页面，作为登录的用户具有DBA角色(基于角色的登录)。如下图中所示 -&nbsp; </p> 
  <p> <img src="/uploads/tutorial/20160820/160r0121241_1_933.png" alt=""> </p> 
  <p> 现在注销，并填写用户(yiibai)角色的凭据(使用用户名和密码)登录。 </p> 
  <p> <img src="/uploads/tutorial/20160820/160r0121258_1_3q.png" alt=""> </p> 
  <p> 首先提供一个错误的密码，然后点击登录 -&nbsp; </p> 
  <p> <img src="/uploads/tutorial/20160820/160r0121317_1_g8.png" alt=""> </p> 
  <div>
    提供正确的用户角色的凭据，您将被重定向到主页。 
  </div> 
  <p> <img src="/uploads/tutorial/20160820/160r0121349_1_4f.png" alt=""> </p> 
  <div>
    现在尝试访问管理页面。您应该看到拒绝访问页面。 
  </div> 
  <p> <img src="/uploads/tutorial/20160820/160r0121415_1_161.png" alt=""> </p> 
  <p> 现在，注销并使用管理员凭据登录，您将会被重向到URL：/admin 。如下图中所示 -&nbsp; </p> 
  <p> <img src="/uploads/tutorial/20160820/160r0121431_1_t3.png" alt=""> </p> 
  <p> 用户 admin 登录成功后的页面，如下所示 -&nbsp;<br> <img src="/uploads/tutorial/20160820/160r0121448_1_252.png" alt=""><br> 到这里就结束了。在下一篇文章中将学习使用<a target="_blank" href="http://websystique.com/spring-security/spring-security-4-hibernate-annotation-example.html">基于Hibernate的注解方法的Spring&nbsp;Security数据库认证</a>。 </p> 
  <h4> 下载源代码<br> <br> <a target="_blank" href="http://share.weiyun.com/4ea1b774b5adf4521d222693a281368b">07-SpringSecurityRoleBasedLogin.zip</a><br> </h4> 
  <h4> 参考 </h4> 
  <ul> 
   <li> <a target="_blank" href="http://projects.spring.io/spring-security/">Spring Security 4 工程</a> </li> 
   <li> <a target="_blank" href="http://docs.spring.io/spring-security/site/docs/4.0.1.RELEASE/reference/htmlsingle/">Spring Security 4 参考手册</a> </li> 
  </ul> 
  <div> 
  </div> 
 </div>
 <br>      
</div></body></html>
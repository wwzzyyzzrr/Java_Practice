<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">JavaFX绑定</h1><div style="width:100%;float:left;" class="article-content">   
 <p><strong>JavaFX</strong>绑定同步两个值：当依赖变量更改时，其他变量更改。</p> 
 <p>要将属性绑定到另一个属性，请调用bind()方法，该方法在一个方向绑定值。 例如，当属性<strong>A</strong>绑定到属性<strong>B</strong>时，属性<strong>B</strong>的更改将更新属性<strong>A</strong>，但不可以反过来。</p> 
 <h2 id="h2-u7ED1u5B9Au9009u9879"><a name="绑定选项" class="reference-link"></a><span class="header-link octicon octicon-link"></span>绑定选项</h2>
 <p>JavaFX提供了许多绑定选项，以便在域对象和GUI控件中的属性之间进行同步。</p> 
 <p>我们可以在JavaFX的<strong>Properties API</strong>中使用以下三种绑定策略：</p> 
 <ul> 
  <li><strong>Java Bean</strong>上的双向绑定</li>
  <li>与<strong>Fluent API</strong>的高级绑定</li>
  <li>使用<code>javafx.beans.binding</code>定义绑定对象进行低级绑定。</li>
 </ul> 
 <h2 id="h2-u53CCu5411u7ED1u5B9A"><a name="双向绑定" class="reference-link"></a><span class="header-link octicon octicon-link"></span>双向绑定</h2>
 <p>双向绑定绑定相同类型的属性，并同步两侧的值。当使用<code>bindBidirectional()</code>方法双向绑定时，需要两个属性都必须是可读/写的。<br>以下代码显示如何在<code>firstName</code>属性和字符串属性变量之间进行双向绑定</p> 
 <pre><code class="lang-java">import javafx.beans.property.SimpleStringProperty;
import javafx.beans.property.StringProperty;

public class Main {
    public static void main(String[] args) {
        User contact = new User("Jame", "Bind");
        StringProperty fname = new SimpleStringProperty();
        fname.bindBidirectional(contact.firstNameProperty());

        contact.firstNameProperty().set("new value");
        fname.set("新绑定名称值");

        System.out.println("firstNameProperty = " + contact.firstNameProperty().get());
        System.out.println("fname = " + fname.get());

    }// @ W WW .yI iB  AI.c  o M
}

class User {

    private SimpleStringProperty firstName = new SimpleStringProperty();
    private SimpleStringProperty lastName = new SimpleStringProperty();

    public User(String fn, String ln) {
        firstName.setValue(fn);
        lastName.setValue(ln);
    }

    public final String getFirstName() {
        return firstName.getValue();
    }

    public StringProperty firstNameProperty() {
        return firstName;
    }

    public final void setFirstName(String firstName) {
        this.firstName.setValue(firstName);
    }

    public final String getLastName() {
        return lastName.getValue();
    }

    public StringProperty lastNameProperty() {
        return lastName;
    }

    public final void setLastName(String lastName) {
        this.lastName.setValue(lastName);
    }
}
</code></pre> 
 <p>上面的代码生成以下结果。</p> 
 <pre><code class="lang-java">firstNameProperty = 新绑定名称值
fname = 新绑定名称值
</code></pre> 
 <h2 id="h2-u9AD8u7EA7u522Bu7ED1u5B9A"><a name="高级别绑定" class="reference-link"></a><span class="header-link octicon octicon-link"></span>高级别绑定</h2>
 <p>我们也可以使用JavaFX流利的API来绑定属性。<strong>API</strong>使用类似英语的方法名称对属性执行操作。 例如，<code>multiply()</code>，<code>divide()</code>，<code>subtract()</code>，<code>isEqualTo()</code>，<code>isNotEqualTo()</code>，<code>concat()</code>。 请注意，方法名称中没有<code>get</code>或<code>set</code>。当链接<strong>API</strong>在一起时可以写代码，就像类似于写英文句子，例如，<code>width().multiply(height()).divide(2)</code>。</p> 
 <p>以下代码显示如何创建表示计算矩形面积的公式的属性。</p> 
 <p>它通过使用<code>javafx.beans.binding.IntegerExpression</code>接口中的<strong>fluent API</strong>来执行高级绑定。</p> 
 <p>该代码使用<code>multiply()</code>方法，该方法返回包含计算值 - <code>NumberBinding</code>。</p> 
 <p>这个绑定是延迟评估求值的，这意味着乘法不会执行计算，除非通过<code>get()</code>或<code>getValue()</code>方法调用属性的值。</p> 
 <pre><code class="lang-java">import javafx.beans.binding.NumberBinding;
import javafx.beans.property.IntegerProperty;
import javafx.beans.property.SimpleIntegerProperty;

public class Main {
  public static void main(String[] args) {
    // Area = width * height
    IntegerProperty width = new SimpleIntegerProperty(10);
    IntegerProperty height = new SimpleIntegerProperty(10);
    NumberBinding area = width.multiply(height);
    System.out.println(area.getValue());
  }
}
</code></pre> 
 <p>上面的代码生成以下结果。</p> 
 <pre><code class="lang-java">100
</code></pre> 
 <h2 id="h2-u4F4Eu7EA7u522Bu7ED1u5B9A"><a name="低级别绑定" class="reference-link"></a><span class="header-link octicon octicon-link"></span>低级别绑定</h2>
 <p>当对<code>NumberBinding</code>类进行子类化时，使用低级别绑定，例如<code>Double</code>类型的<code>DoubleBinding</code>类。</p> 
 <p>在<code>DoubleBinding</code>类的子类中，我们覆盖它的<code>computeValue()</code>方法，以便可以使用运算符(例如<code>*</code>和 <code>-</code> )来制定复杂的数学方程计算。<br>高级绑定使用如<code>multiply()</code>，<code>subtract()</code>等方法，而低级绑定使用诸如<code>*</code>和 <code>-</code> 等运算符。</p> 
 <p>以下代码显示如何为公式创建低级别绑定，来计算矩形的面积。</p> 
 <pre><code class="lang-java">import javafx.beans.binding.DoubleBinding;
import javafx.beans.property.DoubleProperty;
import javafx.beans.property.SimpleDoubleProperty;

public class Main {
  public static void main(String[] args) {
    DoubleProperty width = new SimpleDoubleProperty(2);
    DoubleProperty height = new SimpleDoubleProperty(2);
    DoubleBinding area = new DoubleBinding() {
      {
        super.bind(width, height); // initial bind
      }

      @Override
      protected double computeValue() {
        return width.get() * height.get();
      }
    };
    System.out.println(area.get());
  }
}
</code></pre> 
 <p>上面的代码生成以下结果。</p> 
 <pre><code class="lang-java">4.0
</code></pre> 
 <h2 id="h2-ui-"><a name="UI控件和域模型之间的绑定" class="reference-link"></a><span class="header-link octicon octicon-link"></span>UI控件和域模型之间的绑定</h2>
 <p>在JavaFX中，UI控件和域模型之间的数据绑定很容易。以下代码显示如何创建登录对话框并绑定用户域对象。<br>首先，我们定义域对象，它是描述用户名和密码的<strong>JavaFX JavaBean</strong>。</p> 
 <pre><code class="lang-java">class User {
   private final ReadOnlyStringWrapper userName;
   private StringProperty password;
   public User() {
       userName = new ReadOnlyStringWrapper(this, "userName", "ABC");
       password = new SimpleStringProperty(this, "password", "");
   }

   public final String getUserName() {
       return userName.get();
   }
   public ReadOnlyStringProperty userNameProperty() {
       return userName.getReadOnlyProperty();
   }

   public final String getPassword() {
       return password.get();
   }
   public StringProperty passwordProperty() {
       return password;
   }
}
</code></pre> 
 <p>我们创建了两个UI控件，一个用于使用<code>Text</code>控件显示用户名，另一个是 <code>PasswordField</code> 字段控件，它将输入值绑定到域对象(<code>User</code>)中的 <code>password</code> 字段。</p>   
 <pre><code class="lang-java">Text userName = new Text();
userName.textProperty().bind(user.userNameProperty());

PasswordField passwordField = new PasswordField();
passwordField.setPromptText("Password");
user.passwordProperty().bind(passwordField.textProperty());
</code></pre> 
 <p>在更改侦听器中为<code>passwordField</code>字段文本值属性设置<code>BooleanProperty</code>访问权限。</p> 
 <pre><code class="lang-java">passwordField.textProperty().addListener((obs, ov, nv) -&gt; {
    boolean granted = passwordField.getText().equals(MY_PASS);
    accessGranted.set(granted);
    if (granted) {
        primaryStage.setTitle("");
    }
});
</code></pre> 
 <p>在<strong>enter</strong>键点击事件中访问<code>BooleanProperty accessGranted</code>。</p> 
 <pre><code class="lang-java">        // user hits the enter key
        passwordField.setOnAction(actionEvent -&gt; {
            if (accessGranted.get()) {
                System.out.println("granted access:"+ user.getUserName());
                System.out.println("password:"+ user.getPassword());
                Platform.exit();
            } else {
              primaryStage.setTitle("no access"); 
            }
        });
</code></pre> 
 <p>完整的源代码如下所示。</p> 
 <pre><code class="lang-java">import javafx.application.Application;
import javafx.application.Platform;
import javafx.beans.property.BooleanProperty;
import javafx.beans.property.ReadOnlyStringProperty;
import javafx.beans.property.ReadOnlyStringWrapper;
import javafx.beans.property.SimpleBooleanProperty;
import javafx.beans.property.SimpleStringProperty;
import javafx.beans.property.StringProperty;
import javafx.scene.Group;
import javafx.scene.Scene;
import javafx.scene.control.PasswordField;
import javafx.scene.layout.VBox;
import javafx.scene.text.Text;
import javafx.stage.Stage;

// @  w  Ww .yi  iB  A i. C o M
public class Main extends Application {
    private final static String MY_PASS = "passwd";// 初始密码
    private final static BooleanProperty accessGranted = new SimpleBooleanProperty(false);

    @Override
    public void start(Stage primaryStage) {
        User user = new User();
        Group root = new Group();
        Scene scene = new Scene(root, 320, 100);
        primaryStage.setScene(scene);

        Text userName = new Text();
        userName.textProperty().bind(user.userNameProperty());

        PasswordField passwordField = new PasswordField();
        passwordField.setPromptText("Password");
        user.passwordProperty().bind(passwordField.textProperty());

        // user hits the enter key
        passwordField.setOnAction(actionEvent -&gt; {
            if (accessGranted.get()) {
                System.out.println("granted access:" + user.getUserName());
                System.out.println("password:" + user.getPassword());
                Platform.exit();
            } else {// @  WW  w .yIIB  A  i.c OM
                primaryStage.setTitle("no access");
            }
        });

        passwordField.textProperty().addListener((obs, ov, nv) -&gt; {
            boolean granted = passwordField.getText().equals(MY_PASS);
            accessGranted.set(granted);
            if (granted) {
                primaryStage.setTitle("");
            }
        });
        VBox formLayout = new VBox(4);
        formLayout.getChildren().addAll(userName, passwordField);
        formLayout.setLayoutX(12);
        formLayout.setLayoutY(12);

        root.getChildren().addAll(formLayout);
        primaryStage.show();
    }

    public static void main(String[] args) {
        launch(args);
    }
}

class User {
    private final ReadOnlyStringWrapper userName;
    private StringProperty password;

    public User() {
        userName = new ReadOnlyStringWrapper(this, "userName", "ABC");
        password = new SimpleStringProperty(this, "password", "");
    }

    public final String getUserName() {
        return userName.get();
    }

    public ReadOnlyStringProperty userNameProperty() {
        return userName.getReadOnlyProperty();
    }

    public final String getPassword() {
        return password.get();
    }

    public StringProperty passwordProperty() {
        return password;
    }
}
</code></pre> 
 <p>上面的代码生成以下结果。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201701/12/647100147_78006.png" alt=""></p> 
 <p>在上面的输入框中输入密码：<code>passwd</code> 完成后，得到以下输出结果 - </p> 
 <pre><code class="lang-java">granted access:ABC
password:passwd
</code></pre>
 <br>      
</div></body></html>
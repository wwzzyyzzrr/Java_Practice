<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Hibernate集合映射</h1><div style="width:100%;float:left;" class="article-content">   
 <p>可以在Hibernate中映射持久类的集合元素。 您需要从以下类型之一声明持久类中的集合类型：</p> 
 <ul> 
  <li>java.util.List</li>
  <li>java.util.Set</li>
  <li>java.util.SortedSet</li>
  <li>java.util.Map</li>
  <li>java.util.SortedMap</li>
  <li>java.util.Collection</li>
  <li>或写入<code>org.hibernate.usertype.UserCollectionType</code>的实现</li>
 </ul> 
 <p>持久化类应该像这样定义为<code>collection</code>元素，如下代码示例 -</p> 
 <pre><code class="lang-java">package com.yiibai;  

import java.util.List;  

public class Question {  
private int id;  
private String qname;  
private List&lt;String&gt; answers;//List can be of any type  

//getters and setters  

}
</code></pre> 
 <h2 id="h2-u6620u5C04u6587u4EF6u4E2Du7684u6620u5C04u96C6u5408"><a name="映射文件中的映射集合" class="reference-link"></a><span class="header-link octicon octicon-link"></span>映射文件中的映射集合</h2>
 <p>有很多<code>&lt;class&gt;</code>元素的子元素用来映射集合。 它们是<code>&lt;list&gt;</code>，<code>&lt;bag&gt;</code>，<code>&lt;set&gt;</code>和<code>&lt;map&gt;</code>。 下面来看看看如何实现上述类的列表：</p> 
 <pre><code class="lang-xml">&lt;class name="com.yiibai.Question" table="q100"&gt;  
&lt;id name="id"&gt;  
&lt;generator class="increment"&gt;&lt;/generator&gt;  
&lt;/id&gt;  
&lt;property name="qname"&gt;&lt;/property&gt;  

&lt;list name="answers" table="ans100"&gt;  
&lt;key column="qid"&gt;&lt;/key&gt;  
&lt;index column="type"&gt;&lt;/index&gt;  
&lt;element column="answer" type="string"&gt;&lt;/element&gt;  
&lt;/list&gt;  

&lt;/class&gt;
</code></pre> 
 <p>列表中使用了三个子元素：</p> 
 <ul> 
  <li><code>&lt;key</code>&gt;元素用于根据<code>Question</code>类标识符定义该表中的外键。</li>
  <li><code>&lt;index&gt;</code>元素用于标识类型。<code>List</code> 和 <code>Map</code>是索引集合。</li>
  <li><code>&lt;element&gt;</code>用于定义集合的元素。</li>
 </ul> 
 <p>这是集合存储字符串对象的映射。 但是如果集合存储实体引用(另一个类对象)，我们需要定义<code>&lt;one-to-many&gt;</code>或<code>&lt;many-to-many&gt;</code>元素。 现在，持久化类将如下所示：</p> 
 <pre><code class="lang-java">package com.yiibai;  

import java.util.List;  

public class Question {  
private int id;  
private String qname;  
private List&lt;Answer&gt; answers;//Here, List stores the objects of Answer class  

//getters and setters  

}
</code></pre> 
 <p><strong>Answer类代码示例如下 -</strong></p> 
 <pre><code class="lang-java">package com.yiibai;  
import java.util.List;  
public class Answer {  
private int id;  
private String answer;  
private String posterName;  
//getters and setters  
}
</code></pre> 
 <p>现在映射文件将是：</p> 
 <pre><code class="lang-xml">&lt;class name="com.yiibai.Question" table="q100"&gt;  
    &lt;id name="id"&gt;  
        &lt;generator class="increment"&gt;&lt;/generator&gt;  
    &lt;/id&gt;  
    &lt;property name="qname"&gt;&lt;/property&gt;  

    &lt;list name="answers" &gt;  
        &lt;key column="qid"&gt;&lt;/key&gt;  
        &lt;index column="type"&gt;&lt;/index&gt;  
        &lt;one-to-many class="com.yiibai.Answer" /&gt;  
    &lt;/list&gt;  

&lt;/class&gt;
</code></pre> 
 <p>这里，列表被一对多关系映射。 在这种情况下，一个问题可以有很多答案。</p> 
 <h2 id="h2-key-"><a name="key元素" class="reference-link"></a><span class="header-link octicon octicon-link"></span>key元素</h2>
 <p><code>key</code>元素用于根据原始身份在连接的表中定义外键。 外键元素默认为空。 所以对于不可空的外键，需要指定<code>not-null</code>属性，如：</p>   
 <pre><code class="lang-xml">&lt;key column="qid" not-null="true" &gt;&lt;/key&gt;
</code></pre> 
 <p><code>key</code>元素的属性是<code>column</code>，<code>on-delete</code>，<code>property-ref</code>，<code>not-null</code>，<code>update</code>和<code>unique</code>。</p> 
 <pre><code class="lang-xml">&lt;key  
    column="columnname"  
    on-delete="noaction|cascade"  
    not-null="true|false"  
    property-ref="propertyName"  
    update="true|false"  
    unique="true|false"  
/&gt;
</code></pre> 
 <h2 id="h2-u7D22u5F15u96C6u5408"><a name="索引集合" class="reference-link"></a><span class="header-link octicon octicon-link"></span>索引集合</h2>
 <p>集合元素可以分为两种形式：</p> 
 <ul> 
  <li>索引，和</li>
  <li>非索引</li>
 </ul> 
 <p><code>List</code> 和 <code>Map</code>集合都可被索引，而集合和行集合是非索引的。 这里，索引收集 <code>List</code> 和 <code>Map</code>需要一个额外的元素<code>&lt;index&gt;</code>。</p> 
 <h2 id="h2-u96C6u5408u5143u7D20"><a name="集合元素" class="reference-link"></a><span class="header-link octicon octicon-link"></span>集合元素</h2>
 <p>集合元素可以具有值或实体引用(另一个类对象)。可以使用<code>4</code>个元素之一。</p> 
 <ul> 
  <li><code>element</code></li>
  <li><code>component-element</code></li>
  <li><code>one-to-many</code>, 或</li>
  <li><code>many-to-many</code></li>
 </ul> 
 <p><code>element</code> 和 <code>component-element</code> 用于正常值，例如<code>string</code>，<code>int</code>等，而一对多和多对多用于映射实体引用。</p> 
 <p>在接下来的文章，我们将学习集合映射。</p> 
 <p><a target="_blank" href="http://www.yiibai.com/hibernate/mapping-list-in-collection-mapping.html" title="映射列表(List)">映射列表(List)</a><br>在这个例子中，我们将映射<code>List</code>元素。</p> 
 <p><a target="_blank" href="http://www.yiibai.com/hibernate/mapping-bag-in-collection-mapping.html" title="映射Bag">映射Bag</a><br>在这个例子中，我们将使用Hibernate框架的包集合。</p> 
 <p><a target="_blank" href="http://www.yiibai.com/hibernate/mapping-set-in-collection-mapping.html" title="映射集合">映射集合(Set)</a><br>在这里，我们将映射Set的集合元素。</p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Hibernate使用注释</h1><div style="width:100%;float:left;" class="article-content">   
 <p>可以使用注释创建hibernate应用程序。 有许多注释可用于创建hibernate应用程序，如<a target="_blank" href="https://github.com/Entity" title="@Entity" class="at-link">@Entity</a>，<a target="_blank" href="https://github.com/Id" title="@Id" class="at-link">@Id</a>，<a target="_blank" href="https://github.com/Table" title="@Table" class="at-link">@Table</a>等。</p> 
 <p>Hibernate注释基于JPA 2规范，并支持所有功能。<br>所有JPA注释都在<code>javax.persistence.*</code>包中定义。 Hibernate EntityManager实现由JPA规范定义的接口和生命周期。</p> 
 <p>使用hibernate注释的核心优点是我们不需要创建映射(<code>*.hbm.xml</code>)文件直接创建对象关联。 在这里，hibernate注释用于提供元数据。</p> 
 <p>完整的项目结构图如下 -<br><img src="http://www.yiibai.com/uploads/images/201703/2303/600110305_91496.png" alt=""></p> 
 <h2 id="h2--hibernate-"><a name="使用注释创建hibernate应用程序的示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用注释创建hibernate应用程序的示例</h2>
 <p>创建具有注释的hibernate应用程序有<code>4</code>个步骤。分别如下 -</p> 
 <ul> 
  <li>为MySQL添加连接驱动程序的jar文件(如果数据库是MySQL)和注释</li>
  <li>创建持久化类</li>
  <li>在配置文件中添加持久化类的映射</li>
  <li>创建检索或存储持久对象的类</li>
 </ul> 
 <h2 id="h2-1-mysql-jar-"><a name="1. 为MySQL和注释添加jar文件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>1. 为MySQL和注释添加jar文件</h2>
 <p>对于MySQL，您需要添加<code>mysql-connector-java-5.1.40-bin.jar</code>文件，以及 hibernate5的核心类库，如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201703/2303/758100355_98072.png" alt=""></p> 
 <h2 id="h2-2-"><a name="2. 创建持久化类" class="reference-link"></a><span class="header-link octicon octicon-link"></span>2. 创建持久化类</h2>
 <p>在这里，我们创建一个持久化类: <code>Employee</code> 。 并使用注释完成与数据库表：<code>tb_employee</code> 的映射关联。</p> 
 <p><code><a target="_blank" href="https://github.com/Entity" title="@Entity" class="at-link">@Entity</a></code>注释将此类标记为实体。<br><code><a target="_blank" href="https://github.com/Table" title="@Table" class="at-link">@Table</a></code>注释指定要保留此实体的数据的表名。 如果不使用<code><a target="_blank" href="https://github.com/Table" title="@Table" class="at-link">@Table</a></code>注释，hibernate将使用类名作为表名称<code>bydefault</code>。<br><code><a target="_blank" href="https://github.com/Id" title="@Id" class="at-link">@Id</a></code>注释标记此实体的标识符。<br><code><a target="_blank" href="https://github.com/Column" title="@Column" class="at-link">@Column</a></code>注释指定此属性或字段的列的详细信息。如果未指定<code><a target="_blank" href="https://github.com/Column" title="@Column" class="at-link">@Column</a></code>注释，则属性名称将用作列名称<code>bydefault</code>。</p> 
 <p><em>Employee.java</em> 文件的代码如下 -</p> 
 <pre><code class="lang-java">package com.yiibai;

import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;

@Entity
@Table(name = "tb_employee")
public class Employee {
    @Id
    private int id;
    private String firstName, lastName;

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getFirstName() {
        return firstName;
    }

    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }

    public String getLastName() {
        return lastName;
    }

    public void setLastName(String lastName) {
        this.lastName = lastName;
    }

}
</code></pre> 
 <h2 id="h2-3-"><a name="3. 在配置文件中添加持久化类的映射" class="reference-link"></a><span class="header-link octicon octicon-link"></span>3. 在配置文件中添加持久化类的映射</h2>
 <p>打开<code>hibernate.cfg.xml</code>文件，并添加如下的映射资源条目：</p> 
 <pre><code class="lang-xml">&lt;mapping class="com.yiibai.Employee"/&gt;
</code></pre> 
 <p>现在完整的配置文件: <code>hibernate.cfg.xml</code>，将如下所示：</p> 
 <pre><code class="lang-xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;!DOCTYPE hibernate-configuration PUBLIC
          "-//Hibernate/Hibernate Configuration DTD 3.0//EN"
          "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"&gt;

&lt;!-- Generated by MyEclipse Hibernate Tools. --&gt;
&lt;hibernate-configuration&gt;

    &lt;session-factory&gt;

        &lt;property name="connection.driver_class"&gt;com.mysql.jdbc.Driver&lt;/property&gt;
        &lt;property name="connection.url"&gt;jdbc:mysql://localhost:3306/test&lt;/property&gt;
        &lt;property name="connection.username"&gt;root&lt;/property&gt;
        &lt;property name="connection.password"&gt;123456&lt;/property&gt;
        &lt;property name="dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;
        &lt;property name="show_sql"&gt;true&lt;/property&gt;

        &lt;mapping class="com.yiibai.Employee"/&gt;

    &lt;/session-factory&gt;

&lt;/hibernate-configuration&gt;
</code></pre> 
 <h2 id="h2-4-"><a name="4. 创建检索或存储持久对象的类" class="reference-link"></a><span class="header-link octicon octicon-link"></span>4. 创建检索或存储持久对象的类</h2>
 <p>在这个类中，我们只是将<code>Employee</code>类的对象存储到数据库中。 在这里，我们使用<code>StandardServiceRegistryBuilder</code>类和<code>MetadataSources</code>类从持久化类获取映射的信息。</p> 
 <p><code>Test.java</code> 测试类代码如下 -</p>   
 <pre><code class="lang-java">package com.yiibai;

import org.hibernate.*;
import org.hibernate.boot.MetadataSources;
import org.hibernate.boot.registry.StandardServiceRegistry;
import org.hibernate.boot.registry.StandardServiceRegistryBuilder;
import org.hibernate.cfg.*;

public class Test {
    public static void main(String[] args) {
        //Session session = new AnnotationConfiguration().configure().buildSessionFactory().openSession();
        final StandardServiceRegistry registry = new StandardServiceRegistryBuilder().configure("hibernate.cfg.xml")
                .build();
        // 2. 根据服务注册类创建一个元数据资源集，同时构建元数据并生成应用一般唯一的的session工厂
        SessionFactory sessionFactory = new MetadataSources(registry).buildMetadata().buildSessionFactory();

        /**** 上面是配置准备，下面开始我们的数据库操作 ******/
        Session session = sessionFactory.openSession();// 从会话工厂获取一个session
        Transaction t = session.beginTransaction();

        Employee e1 = new Employee();
        e1.setId(1001);
        e1.setFirstName("Yii");
        e1.setLastName("Bai");

        Employee e2 = new Employee();
        e2.setId(1002);
        e2.setFirstName("Min");
        e2.setLastName("Su");

        session.persist(e1);
        session.persist(e2);

        t.commit();
        session.close();
        System.out.println("successfully saved");
    }
}
</code></pre> 
 <p>运行上面(Test.java)示例，得到以下结果 -</p> 
 <pre><code class="lang-shell">... ...
INFO: HHH000400: Using dialect: org.hibernate.dialect.MySQLDialect
Hibernate: insert into tb_employee (firstName, lastName, id) values (?, ?, ?)
Hibernate: insert into tb_employee (firstName, lastName, id) values (?, ?, ?)
successfully saved
</code></pre> 
 <p>查看数据库表 <code>tb_employee</code> 中的数据，应该会看到以下结果 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201703/2303/611110304_48593.png" alt=""></p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Web应用程序使用Hibernate</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在本文中，我们将学习使用hibernate创建一个Web应用程序。 对于创建Web应用程序，我们使用JSP表示逻辑层，使用Bean类表示数据，以及使用DAO类操作数据库。<br>在hibernate中创建简单的应用程序时，不需要在hibernate中执行额外的操作来创建Web应用程序。 在这个示例中，我们使用JSP文件获取用户的值。</p> 
 <p>首先打开 MyEclipse ，创建一个动态Web项目：<code>web-application-with-hibernate</code>，其结果如下 -<br><img src="http://www.yiibai.com/uploads/images/201703/2403/479150317_41005.png" alt=""></p> 
 <h2 id="h2--hibernate-web-"><a name="使用hibernate创建Web应用程序的示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用hibernate创建Web应用程序的示例</h2>
 <p>在这个例子中，我们将在数据库中插入用户的记录。它只是实现一个简单的注册表单的处理，即：从表单获取用户的输入信息，并将数据插入到对应的数据表中。</p> 
 <p><strong>index.jsp</strong></p> 
 <p>该页面用于从用户获取输入，并使用<code>post</code>方法将其发送到<code>register.jsp</code>文件。</p> 
 <pre><code class="lang-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;注册表单&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action="register.jsp" method="post"&gt;
        &lt;h2&gt;用户注册表单&lt;/h2&gt;
        &lt;hr/&gt;
        Name:&lt;input type="text" name="name" /&gt;&lt;br&gt;
        &lt;br /&gt; Password:&lt;input type="password" name="password" /&gt;&lt;br&gt;
        &lt;br /&gt; Email:&lt;input type="text" name="email" /&gt;&lt;br&gt;
        &lt;br /&gt; &lt;input type="submit" value="注册" /&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p><strong>register.jsp</strong></p> 
 <p>这个文件获取所有请求参数，并将此信息存储到<code>User</code>类的对象中。 此外，它调用<code>UserDao</code>类的 <code>register()</code> 方法传递<code>User</code>类对象。</p> 
 <pre><code class="lang-jsp">&lt;%@page import="com.yiibai.UserDao"%&gt;
&lt;jsp:useBean id="obj" class="com.yiibai.User"&gt;&lt;/jsp:useBean&gt;
&lt;jsp:setProperty property="*" name="obj" /&gt;

&lt;%
    int i = UserDao.save(obj);
    if (i &gt; 0) {
        out.print("You are successfully registered");
    }
%&gt;
</code></pre> 
 <p><strong>User.java</strong></p> 
 <p>它是在<code>hibernate</code>中表示持久类的简单<code>bean</code>类。</p> 
 <pre><code class="lang-java">package com.yiibai;

public class User {
    private int id;
    private String name, password, email;

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

}
</code></pre> 
 <p><strong>user.hbm.xml</strong></p> 
 <p>它用于与<code>User</code>类与数据库的表映射。</p> 
 <pre><code class="lang-xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC
          "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
          "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;

&lt;hibernate-mapping&gt;
    &lt;class name="com.yiibai.User" table="tb_user"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="increment"&gt;&lt;/generator&gt;
        &lt;/id&gt;
        &lt;property name="name"&gt;&lt;/property&gt;
        &lt;property name="password"&gt;&lt;/property&gt;
        &lt;property name="email"&gt;&lt;/property&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;
</code></pre> 
 <p><strong>UserDao.java</strong></p> 
 <p>一个Dao类，包含存储User类的实例的方法。</p> 
 <pre><code class="lang-java">package com.yiibai;

import org.hibernate.*;
import org.hibernate.boot.MetadataSources;
import org.hibernate.boot.registry.StandardServiceRegistry;
import org.hibernate.boot.registry.StandardServiceRegistryBuilder;
import org.hibernate.cfg.*;


public class UserDao {

    public static int save(User u) {
        int i = 0;

        final StandardServiceRegistry registry = new StandardServiceRegistryBuilder()
                .configure("hibernate.cfg.xml").build();
        // 2. 根据服务注册类创建一个元数据资源集，同时构建元数据并生成应用一般唯一的的session工厂
        SessionFactory sessionFactory = new MetadataSources(registry)
                .buildMetadata().buildSessionFactory();


        Session session = sessionFactory.openSession();// 从会话工厂获取一个session
        Transaction t = session.beginTransaction();
        i = (Integer) session.save(u);
        t.commit();
        session.close();

        System.out.println(u.getName());
        return i;
    }
}
</code></pre> 
 <p><strong>创建数据库表</strong></p> 
 <p>创建一个与持久化<code>User</code>类对象关联的表：<code>tb_user</code> ， 其结构和创建语句如下 -</p>   
 <pre><code class="lang-sql">CREATE TABLE `tb_user` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(32) NOT NULL DEFAULT '',
  `password` varchar(32) NOT NULL DEFAULT '',
  `email` varchar(32) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
</code></pre> 
 <p><strong>hibernate.cfg.xml</strong></p> 
 <p>它是一个配置文件，其中包含有关数据库和映射文件的信息。</p> 
 <pre><code class="lang-xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;!DOCTYPE hibernate-configuration PUBLIC
          "-//Hibernate/Hibernate Configuration DTD 3.0//EN"
          "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"&gt;

&lt;!-- Generated by MyEclipse Hibernate Tools.                   --&gt;
&lt;hibernate-configuration&gt;

    &lt;session-factory&gt;
        &lt;property name="hbm2ddl.auto"&gt;update&lt;/property&gt;
        &lt;property name="connection.driver_class"&gt;com.mysql.jdbc.Driver&lt;/property&gt;
        &lt;property name="connection.url"&gt;jdbc:mysql://localhost:3306/test&lt;/property&gt;
        &lt;property name="connection.username"&gt;root&lt;/property&gt;
        &lt;property name="connection.password"&gt;123456&lt;/property&gt;
        &lt;property name="dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;
        &lt;property name="show_sql"&gt;true&lt;/property&gt;
        &lt;mapping resource="user.hbm.xml"/&gt;
    &lt;/session-factory&gt;

&lt;/hibernate-configuration&gt;
</code></pre> 
 <p>发布上面的工程到 Tomcat Sever中，打开浏览器访问URL：<a target="_blank" href="http://localhost:8080/web-application-with-hibernate/">http://localhost:8080/web-application-with-hibernate/</a> , 没有错误应该会看到下面界面并写入相关内容 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201703/2403/125150320_15053.png" alt=""></p> 
 <p>提交后，看到以下结果 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201703/2403/281150322_34084.png" alt=""></p> 
 <p>MyEclipse终端输出结果如下 -<br><img src="http://www.yiibai.com/uploads/images/201703/2403/386150323_41187.png" alt=""></p> 
 <p>打开数据库，查看 <code>tb_user</code> 表应该会看到刚才插入的数据。</p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">TestNG + Selenium负载测试</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在本教程中，我们将演示如何使用<code><a target="_blank" href="https://github.com/Test" title="@Test" class="at-link">@Test</a></code>属性<code>invocationCount</code>和<code>threadPoolSize</code>在网站上执行负载测试或压力测试。</p> 
 <p>使用的工具 ：</p> 
 <ul> 
  <li>TestNG 6.8.7</li>
  <li>Selenium 2.39.0</li>
  <li>Maven 3</li>
 </ul> 
 <p>我们使用<code>Selenium</code>库自动化浏览器来访问网站。创建一个用于测试的Maven项目：<strong>TestngSelenium</strong> 。</p> 
 <h2 id="h2-1-"><a name="1. 项目依赖文件配置" class="reference-link"></a><span class="header-link octicon octicon-link"></span>1. 项目依赖文件配置</h2>
 <p>获取TestNG和<code>Selenium</code>库。如下 <code>pom.xml</code> 所示 -</p> 
 <pre><code class="lang-xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.yiibai&lt;/groupId&gt;
    &lt;artifactId&gt;TestngSelenium&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;

    &lt;name&gt;TestngSelenium&lt;/name&gt;
    &lt;url&gt;http://maven.apache.org&lt;/url&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;testng.version&gt;6.8.7&lt;/testng.version&gt;
        &lt;selenium.version&gt;3.4.0&lt;/selenium.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.testng&lt;/groupId&gt;
            &lt;artifactId&gt;testng&lt;/artifactId&gt;
            &lt;version&gt;${testng.version}&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.seleniumhq.selenium&lt;/groupId&gt;
            &lt;artifactId&gt;selenium-java&lt;/artifactId&gt;
            &lt;version&gt;${selenium.version}&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre> 
 <h2 id="h2-2-test-invocationcount-"><a name="2. @Test(invocationCount =？)" class="reference-link"></a><span class="header-link octicon octicon-link"></span>2. <a target="_blank" href="https://github.com/Test" title="@Test" class="at-link">@Test</a>(invocationCount =？)</h2>
 <p>这个<code>invocationCount</code>确定TestNG应该运行这个测试方法的次数。</p> 
 <p><strong>示例 2.1</strong></p> 
 <pre><code class="lang-java">package com.yiibai;


import org.testng.annotations.Test;

public class TestRepeatThis {

    @Test(invocationCount = 10)
    public void repeatThis() {
        System.out.println("repeatThis " );
    }
}
</code></pre> 
 <p>输出 - <code>repeatThis()</code>方法将运行<code>10</code>次，结果如下所示 -</p> 
 <pre><code class="lang-shell">[TestNG] Running:
  C:\Users\Administrator\AppData\Local\Temp\testng-eclipse-1220889222\testng-customsuite.xml

repeatThis 
repeatThis 
repeatThis 
repeatThis 
repeatThis 
repeatThis 
repeatThis 
repeatThis 
repeatThis 
repeatThis 
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis

===============================================
    Default test
    Tests run: 10, Failures: 0, Skips: 0
===============================================


===============================================
Default suite
Total tests run: 10, Failures: 0, Skips: 0
===============================================

[TestNG] Time taken by org.testng.reporters.XMLReporter@6442b0a6: 32 ms
[TestNG] Time taken by org.testng.reporters.JUnitReportReporter@22f71333: 15 ms
[TestNG] Time taken by org.testng.reporters.SuiteHTMLReporter@57829d67: 63 ms
[TestNG] Time taken by [FailedReporter passed=0 failed=0 skipped=0]: 0 ms
[TestNG] Time taken by org.testng.reporters.jq.Main@3d24753a: 109 ms
[TestNG] Time taken by org.testng.reporters.EmailableReporter2@6108b2d7: 0 ms
</code></pre> 
 <p><strong>示例2.2</strong> - 使用Selenium打开Firefox浏览器并加载“yiibai.com”。 此测试是确保页面标题始终为“<strong>易百教程™ - 专注于IT教程和实例</strong>”。</p> 
 <p>创建一个类文件：<strong>TestMultipleThreads.java</strong>，其代码如下所示：</p> 
 <pre><code class="lang-java">package com.yiibai;

import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.firefox.FirefoxDriver;
import org.testng.Assert;
import org.testng.AssertJUnit;
import org.testng.annotations.Test;

public class TestMultipleThreads {

    @Test(invocationCount = 3)
    public void loadTestThisWebsite() {

        //System.setProperty("webdriver.chrome.driver", "chromedriver.exe");
        //WebDriver driver = new ChromeDriver();
//        System.setProperty("webdriver.firefox.bin", "D:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe");
        WebDriver driver = new FirefoxDriver();  
        driver.get("http://www.yiibai.com");
        System.out.println("Page Title is " + driver.getTitle());
        AssertJUnit.assertEquals("Google", driver.getTitle());
        driver.quit();

    }
}
</code></pre> 
 <p>输出结果如下 - 您会注意到Firefox浏览器将提示关闭<code>3</code>次。</p> 
 <pre><code class="lang-shell">[TestNG] Running:
  C:\Users\Administrator\AppData\Local\Temp\testng-eclipse-1220889222\testng-customsuite.xml

repeatThis 
repeatThis 
repeatThis 
repeatThis 
repeatThis 
repeatThis 
repeatThis 
repeatThis 
repeatThis 
repeatThis 
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis
PASSED: repeatThis

===============================================
    Default test
    Tests run: 10, Failures: 0, Skips: 0
===============================================


===============================================
Default suite
Total tests run: 10, Failures: 0, Skips: 0
===============================================

[TestNG] Time taken by org.testng.reporters.XMLReporter@6442b0a6: 32 ms
[TestNG] Time taken by org.testng.reporters.JUnitReportReporter@22f71333: 15 ms
[TestNG] Time taken by org.testng.reporters.SuiteHTMLReporter@57829d67: 63 ms
[TestNG] Time taken by [FailedReporter passed=0 failed=0 skipped=0]: 0 ms
[TestNG] Time taken by org.testng.reporters.jq.Main@3d24753a: 109 ms
[TestNG] Time taken by org.testng.reporters.EmailableReporter2@6108b2d7: 0 ms
</code></pre> 
 <h2 id="h2-3-test-invocationcount-threadpoolsize-"><a name="3. @Test(invocationCount = ?, threadPoolSize = ?)" class="reference-link"></a><span class="header-link octicon octicon-link"></span>3. <a target="_blank" href="https://github.com/Test" title="@Test" class="at-link">@Test</a>(invocationCount = ?, threadPoolSize = ?)</h2>
 <p><code>threadPoolSize</code>属性告诉TestNG创建一个线程池以通过多个线程运行测试方法。 使用线程池，会大大降低测试方法的运行时间。</p> 
 <p><strong>示例3.1 </strong>- 启动一个包含<code>3</code>个线程的线程池，并运行测试方法<code>3</code>次。</p> 
 <pre><code class="lang-java">package com.yiibai;

import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.firefox.FirefoxDriver;
import org.testng.Assert;
import org.testng.AssertJUnit;
import org.testng.annotations.Test;

public class TestMultipleThreads2 {

    @Test(invocationCount = 3, threadPoolSize = 3)
    public void testThreadPools() {

        System.out.printf("Thread Id : %s%n", Thread.currentThread().getId());

    }
}
</code></pre> 
 <p>执行上面代码，输出以下结果 -</p> 
 <pre><code class="lang-shell">[TestNG] Running:
  C:\Users\Administrator\AppData\Local\Temp\testng-eclipse-103220503\testng-customsuite.xml

[ThreadUtil] Starting executor timeOut:0ms workers:3 threadPoolSize:3
Thread Id : 13
Thread Id : 11
Thread Id : 12
PASSED: testThreadPools
PASSED: testThreadPools
PASSED: testThreadPools

===============================================
    Default test
    Tests run: 3, Failures: 0, Skips: 0
===============================================


===============================================
Default suite
Total tests run: 3, Failures: 0, Skips: 0
===============================================

[TestNG] Time taken by org.testng.reporters.XMLReporter@6442b0a6: 19 ms
[TestNG] Time taken by org.testng.reporters.JUnitReportReporter@22f71333: 5 ms
[TestNG] Time taken by org.testng.reporters.SuiteHTMLReporter@57829d67: 50 ms
[TestNG] Time taken by [FailedReporter passed=0 failed=0 skipped=0]: 0 ms
[TestNG] Time taken by org.testng.reporters.jq.Main@3d24753a: 46 ms
[TestNG] Time taken by org.testng.reporters.EmailableReporter2@6108b2d7: 5 ms
</code></pre> 
 <p><strong>示例3.2 </strong>- 启动包含<code>3</code>个线程的线程池，并运行测试方法<code>10</code>次。</p>   
 <pre><code class="lang-java">package com.yiibai;

import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.firefox.FirefoxDriver;
import org.testng.Assert;
import org.testng.AssertJUnit;
import org.testng.annotations.Test;

public class TestMultipleThreads3 {

    @Test(invocationCount = 10, threadPoolSize = 3)
    public void testThreadPools() {

        System.out.printf("Thread Id : %s%n", Thread.currentThread().getId());

    }
}
</code></pre> 
 <p>执行上面代码，输出以下结果 -</p> 
 <pre><code class="lang-shell">[TestNG] Running:
  C:\Users\Administrator\AppData\Local\Temp\testng-eclipse--548867586\testng-customsuite.xml

[ThreadUtil] Starting executor timeOut:0ms workers:10 threadPoolSize:3
Thread Id : 13
Thread Id : 11
Thread Id : 12
Thread Id : 11
Thread Id : 13
Thread Id : 12
Thread Id : 13
Thread Id : 11
Thread Id : 13
Thread Id : 11
PASSED: testThreadPools
PASSED: testThreadPools
PASSED: testThreadPools
PASSED: testThreadPools
PASSED: testThreadPools
PASSED: testThreadPools
PASSED: testThreadPools
PASSED: testThreadPools
PASSED: testThreadPools
PASSED: testThreadPools

===============================================
    Default test
    Tests run: 10, Failures: 0, Skips: 0
===============================================


===============================================
Default suite
Total tests run: 10, Failures: 0, Skips: 0
===============================================

[TestNG] Time taken by org.testng.reporters.XMLReporter@6442b0a6: 18 ms
[TestNG] Time taken by org.testng.reporters.JUnitReportReporter@22f71333: 6 ms
[TestNG] Time taken by org.testng.reporters.SuiteHTMLReporter@57829d67: 39 ms
[TestNG] Time taken by [FailedReporter passed=0 failed=0 skipped=0]: 0 ms
[TestNG] Time taken by org.testng.reporters.jq.Main@3d24753a: 105 ms
[TestNG] Time taken by org.testng.reporters.EmailableReporter2@6108b2d7: 11 ms
</code></pre> 
 <h2 id="h2-4-"><a name="4. 负载测试示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>4. 负载测试示例</h2>
 <p>通过结合TestNG多线程和Selenium强大的浏览器自动化。 您可以创建一个简单而强大的负载测试，创建一个类文件：<strong>TestMultipleThreadsLoad.java</strong>，其代码如下所示：</p> 
 <pre><code class="lang-java">

</code></pre> 
 <p>输出 - 以上测试将启动一个线程池<code>5</code>，并发送<code>100</code>个URL请求到指定的网站。</p> 
 <pre><code class="lang-shell">[TestNG] Running:
  C:\Users\Administrator\AppData\Local\Temp\testng-eclipse--404588393\testng-customsuite.xml

[ThreadUtil] Starting executor timeOut:0ms workers:100 threadPoolSize:5

[START] Thread Id : 14 is started!
[START] Thread Id : 11 is started!
[START] Thread Id : 13 is started!
[START] Thread Id : 12 is started!
[START] Thread Id : 15 is started!1493821695786    geckodriver    INFO    Listening on 127.0.0.1:45272
1493821695787    geckodriver    INFO    Listening on 127.0.0.1:41719
1493821695792    geckodriver    INFO    Listening on 127.0.0.1:44078
1493821695793    geckodriver    INFO    Listening on 127.0.0.1:20291
1493821695804    geckodriver    INFO    Listening on 127.0.0.1:43472
1493821696563    mozprofile::profile    INFO    Using profile path C:\Users\ADMINI~1\AppData\Local\Temp\rust_mozprofile.1bGOSGl5q8Ao
1493821696589    mozprofile::profile    INFO    Using profile path C:\Users\ADMINI~1\AppData\Local\Temp\rust_mozprofile.5CndLuoF3lLq
1493821696589    mozprofile::profile    INFO    Using profile path C:\Users\ADMINI~1\AppData\Local\Temp\rust_mozprofile.8UhBfB3XciVW
1493821696591    mozprofile::profile    INFO    Using profile path C:\Users\ADMINI~1\AppData\Local\Temp\rust_mozprofile.kGZmelveSBLV
1493821696592    geckodriver::marionette    INFO    Starting browser C:\Program Files (x86)\Mozilla Firefox\firefox.exe
1493821696594    mozprofile::profile    INFO    Using profile path C:\Users\ADMINI~1\AppData\Local\Temp\rust_mozprofile.duSn42IvmcXK
1493821696595    geckodriver::marionette    INFO    Starting browser C:\Program Files (x86)\Mozilla Firefox\firefox.exe
1493821696596    geckodriver::marionette    INFO    Starting browser C:\Program Files (x86)\Mozilla Firefox\firefox.exe
1493821696598    geckodriver::marionette    INFO    Starting browser C:\Program Files (x86)\Mozilla Firefox\firefox.exe
1493821696624    geckodriver::marionette    INFO    Starting browser C:\Program Files (x86)\Mozilla Firefox\firefox.exe
1493821696626    geckodriver::marionette    INFO    Connecting to Marionette on localhost:56795
1493821696627    geckodriver::marionette    INFO    Connecting to Marionette on localhost:56799
1493821696628    geckodriver::marionette    INFO    Connecting to Marionette on localhost:56796
1493821696631    geckodriver::marionette    INFO    Connecting to Marionette on localhost:56798
1493821696632    geckodriver::marionette    INFO    Connecting to Marionette on localhost:56797
</code></pre> 
 <h3 id="h3-u4E00u4E9Bu95EEu9898"><a name="一些问题" class="reference-link"></a><span class="header-link octicon octicon-link"></span>一些问题</h3>
 <p><strong>问</strong>：对于使用Selenium和TestNG的负载测试，为什么一次仅提示一个浏览器？<br><strong>答</strong>：您的测试方法完成得太快，尝试放置<code>Thread.sleep(5000)</code>方法来延迟执行，现在您应该注意到多个浏览器同时提示(仅供演示用途)。</p>
 <br>      
</div></body></html>
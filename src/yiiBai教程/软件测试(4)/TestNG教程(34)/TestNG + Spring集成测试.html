<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">TestNG + Spring集成测试</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在本教程中，我们将演示如何使用TestNG测试Spring的组件。</p> 
 <p><strong>使用的工具 ：</strong></p> 
 <ul> 
  <li>TestNG 6.8.7</li>
  <li>Spring 3.2.2.RELEASE</li>
  <li>Maven 3</li>
  <li>Eclipse IDE</li>
 </ul> 
 <h2 id="h2-1-"><a name="1. 项目依赖" class="reference-link"></a><span class="header-link octicon octicon-link"></span>1. 项目依赖</h2>
 <p>为了演示，首先创建一个名称为：<strong>TestngSpringIntegration</strong> 的 Maven 项目。</p> 
 <p>要将Spring与TestNG集成，您需要<code>spring-test.jar</code>包依懒，添加以下内容：</p> 
 <p>创建文件：<em>pom.xml</em> 配置代码如下 - </p> 
 <pre><code class="lang-xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.yiibai&lt;/groupId&gt;
    &lt;artifactId&gt;TestngSpringIntegration&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;

    &lt;name&gt;TestngSpringIntegration&lt;/name&gt;
    &lt;url&gt;http://maven.apache.org&lt;/url&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;spring.version&gt;4.0.6.RELEASE&lt;/spring.version&gt;
        &lt;testng.version&gt;6.8.7&lt;/testng.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.testng&lt;/groupId&gt;
            &lt;artifactId&gt;testng&lt;/artifactId&gt;
            &lt;version&gt;${testng.version}&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;defaultGoal&gt;compile&lt;/defaultGoal&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre> 
 <h2 id="h2-2-spring-"><a name="2. Spring组件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>2. Spring组件</h2>
 <p>创建一个简单的Spring组件，稍后将使用TestNG来测试这个组件。 </p> 
 <p>创建一个Java接口文件：<em>EmailGenerator.java</em> ，代码如下 - </p> 
 <pre><code class="lang-java">package com.yiibai;

public interface EmailGenerator {

    public String generate();

}
</code></pre> 
 <p>创建一个Java类文件：<em>RandomEmailGenerator.java</em> ，代码如下 - </p> 
 <pre><code class="lang-java">package com.yiibai;

import org.springframework.stereotype.Service;

@Service
public class RandomEmailGenerator implements EmailGenerator {

    public String generate() {
        return "feedback@yiibai.com";
    }

}
</code></pre> 
 <h2 id="h2-3-testng-spring"><a name="3. TestNG + Spring" class="reference-link"></a><span class="header-link octicon octicon-link"></span>3. TestNG + Spring</h2>
 <p>在 <code>test</code> 文件夹中创建一个Spring配置文件，用于Spring组件扫描。</p> 
 <p>创建一个XML文件：<em>${project}/src/test/resources/spring-test-config.xml</em> ，代码如下 - </p> 
 <pre><code class="lang-xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
    http://www.springframework.org/schema/context
    http://www.springframework.org/schema/context/spring-context-3.2.xsd
    "&gt;

    &lt;context:component-scan base-package="com.yiibai" /&gt;

&lt;/beans&gt;
</code></pre> 
 <p>要访问TestNG中的Spring组件，扩展<code>AbstractTestNGSpringContextTests</code>，请参阅以下示例：</p> 
 <p>创建一个Java文件：<em>${project}/src/test/java/com/yiibai/TestSpring.java</em> ，代码如下 - </p>   
 <pre><code class="lang-java">package com.yiibai;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.testng.AbstractTestNGSpringContextTests;
import org.testng.Assert;
import org.testng.annotations.Test;
import com.yiibai.EmailGenerator;

@Test
@ContextConfiguration(locations = { "classpath:spring-test-config.xml" })
public class TestSpring extends AbstractTestNGSpringContextTests {

    @Autowired
    EmailGenerator emailGenerator;

    @Test()
    void testEmailGenerator() {

        String email = emailGenerator.generate();
        System.out.println(email);

        Assert.assertNotNull(email);
        Assert.assertEquals(email, "feedback@yiibai.com");


    }

}
</code></pre> 
 <p>执行上面测试代码，输出以下结果 -</p> 
 <pre><code class="lang-shell">五月 04, 2017 00:26:07 上午 org.springframework.test.context.TestContextManager retrieveTestExecutionListeners
信息: Could not instantiate TestExecutionListener [org.springframework.test.context.web.ServletTestExecutionListener]. Specify custom listener classes or make the default listener classes (and their required dependencies) available. Offending class: [javax/servlet/ServletContext]
[TestNG] Running:
  C:\Users\Administrator\AppData\Local\Temp\testng-eclipse--1855856090\testng-customsuite.xml

五月 04, 2017 00:26:07 上午 org.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions
信息: Loading XML bean definitions from class path resource [spring-test-config.xml]
五月 04, 2017 00:26:07 上午 org.springframework.context.support.GenericApplicationContext prepareRefresh
信息: Refreshing org.springframework.context.support.GenericApplicationContext@262b2c86: startup date [Thu May 04 00:26:07 CST 2017]; root of context hierarchy
feedback@yiibai.com
PASSED: testEmailGenerator

===============================================
    Default test
    Tests run: 1, Failures: 0, Skips: 0
===============================================


===============================================
Default suite
Total tests run: 1, Failures: 0, Skips: 0
===============================================

[TestNG] Time taken by [FailedReporter passed=0 failed=0 skipped=0]: 1 ms
[TestNG] Time taken by org.testng.reporters.EmailableReporter2@49e4cb85: 12 ms
[TestNG] Time taken by org.testng.reporters.JUnitReportReporter@5594a1b5: 6 ms
[TestNG] Time taken by org.testng.reporters.jq.Main@5a39699c: 80 ms
[TestNG] Time taken by org.testng.reporters.SuiteHTMLReporter@7d417077: 34 ms
[TestNG] Time taken by org.testng.reporters.XMLReporter@7c75222b: 13 ms
</code></pre>
 <br>      
</div></body></html>
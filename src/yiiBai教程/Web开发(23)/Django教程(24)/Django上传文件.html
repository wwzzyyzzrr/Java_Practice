<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Django上传文件</h1><div style="width:100%;float:left;" class="article-content">   
 <div>
   对于Web应用程序，以便能够上传文件(资料图片，歌曲，PDF格式，文字......)，它通常是很有用的。让我们在这一节中来讨论如何使用Django上传文件。 
 </div> 
 <div> 
  <h2> 
   <div>
     上传图片 
   </div> </h2> 
  <p style="text-align:justify;"> 在开始开发图片上传之前，请确保Python的图像库(PIL)已经安装。现在来说明上传图片，让我们创建一个配置文件格式，在 myapp/forms.py&nbsp;- </p> 
  <pre>#-*- coding: utf-8 -*-
from django import forms

class ProfileForm(forms.Form):
   name = forms.CharField(max_length = 100)
   picture = forms.ImageFields()&nbsp;</pre> 
  <p style="text-align:justify;"> 正如你所看到的，这里的主要区别仅仅是 forms.ImageField。ImageField字段将确保上传的文件是一个图像。如果不是，格式验证将失败。 </p> 
  <div>
    现在，让我们创建一个&nbsp;“Profile”&nbsp;模型，以保存上传的资料。在&nbsp;myapp/models.py&nbsp;- 
  </div> 
  <pre>from django.db import models

class Profile(models.Model):
   name = models.CharField(max_length = 50)
   picture = models.ImageField(upload_to = 'pictures')

   class Meta:
      db_table = "profile"&nbsp;</pre> 
  <p style="text-align:justify;"> 正如所看到的模型，ImageField&nbsp;使用强制性参数：upload_to.&nbsp;这表示硬盘驱动器，图像保存所在的地方。注意，该参数将被添加到 settings.py文件中定义的MEDIA_ROOT选项。 </p> 
  <div>
    现在我们有表单和模型，让我们来创建视图，在 myapp/&nbsp;views.py&nbsp;- 
  </div> 
  <pre>#-*- coding: utf-8 -*-
from myapp.forms import ProfileForm
from myapp.models import Profile

def SaveProfile(request):
   saved = False
   
   if request.method == "POST":
      #Get the posted form
      MyProfileForm = ProfileForm(request.POST, request.FILES)
      
      if MyProfileForm.is_valid():
         profile = Profile()
         profile.name = MyProfileForm.cleaned_data["name"]
         profile.picture = MyProfileForm.cleaned_data["picture"]
         profile.save()
         saved = True
   else:
      MyProfileForm = Profileform()
		
   return render(request, 'saved.htmll', locals())&nbsp;</pre> 
  <p style="text-align:justify;"> 这部分不要错过，创建一个ProfileForm 并做了一些修改，添加了第二个参数：request.FILES.&nbsp;如果不通过表单验证会失败，给一个消息，说该图片是空的。 </p> 
  <p style="text-align:justify;"> 现在，我们只需要saved.htmll模板和profile.htmll模板，表单和重定向页面− </p> 
  <p style="text-align:justify;"> myapp/templates/saved.htmll&nbsp;− </p> 
  <pre>&lt;html&gt;
   &lt;body&gt;
   
      {% if saved %}
         &lt;strong&gt;Your profile was saved.&lt;/strong&gt;
      {% endif %}
      
      {% if not saved %}
         &lt;strong&gt;Your profile was not saved.&lt;/strong&gt;
      {% endif %}
      
   &lt;/body&gt;
&lt;/html&gt;</pre> 
  <p style="text-align:justify;"> myapp/templates/profile.htmll&nbsp;− </p> 
  <pre>&lt;html&gt;
   &lt;body&gt;
   
      &lt;form name = "form" enctype = "multipart/form-data" 
         action = "{% url "myapp.views.SaveProfile" %}" method = "POST" &gt;{% csrf_token %}
         
         &lt;div style = "max-width:470px;"&gt;
            &lt;center&gt;  
               &lt;input type = "text" style = "margin-left:20%;" 
               placeholder = "Name" name = "name" /&gt;
            &lt;/center&gt;
         &lt;/div&gt;
			
         &lt;br&gt;
         
         &lt;div style = "max-width:470px;"&gt;
            &lt;center&gt; 
               &lt;input type = "file" style = "margin-left:20%;" 
                  placeholder = "Picture" name = "picture" /&gt;
            &lt;/center&gt;
         &lt;/div&gt;
			
         &lt;br&gt;
         
         &lt;div style = "max-width:470px;"&gt;
            &lt;center&gt; 
            
               &lt;button style = "border:0px;background-color:#4285F4; margin-top:8%; 
                  height:35px; width:80%; margin-left:19%;" type = "submit" value = "Login" &gt;
                  &lt;strong&gt;Login&lt;/strong&gt;
               &lt;/button&gt;
               
            &lt;/center&gt;
         &lt;/div&gt;
         
      &lt;/form&gt;
      
   &lt;/body&gt;
&lt;/html&gt;&nbsp;</pre> 
  <p style="text-align:justify;"> 接下来，我们需要配对网址以开始：&nbsp;myapp/urls.py </p>   
  <pre>from django.conf.urls import patterns, url
from django.views.generic import TemplateView

urlpatterns = patterns(
   'myapp.views', url(r'^profile/',TemplateView.as_view(
      template_name = 'profile.htmll')), url(r'^saved/', 'SaveProfile', name = 'saved')
)&nbsp;</pre> 
  <p style="text-align:justify;"> 当访问"/myapp/profile"，我们会得到下面 profile.htmll 模板显示&nbsp;−<br> <img src="http://www.yiibai.com/uploads/tutorial/20160130/1-160130212F3L9.jpg" alt=""> </p> 
  <p style="text-align:justify;"> 在格式提交后，已保存的模板将显示如下&nbsp;−<br> <img src="/uploads/tutorial/20160130/1-160130212R53N.jpg" alt=""> </p> 
  <div>
    这里我们只讲解图片上传示例，但如果想上传其他类型的文件，只需更换&nbsp;ImageField&nbsp;在这两个模型及 FileField 表单。 
  </div> 
  <div> 
   <br> 
  </div> 
 </div>
 <br>      
</div></body></html>
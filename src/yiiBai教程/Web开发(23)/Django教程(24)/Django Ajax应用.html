<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Django Ajax应用</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    Ajax基本上是集成到一起，以减少页负载数量的技术的组合。我们通常使用Ajax来缓解的最终用户体验。在Django使用Ajax可以直接使用Ajax库如jQuery或其它来完成。比方说，想使用jQuery，那么你需要下载并服务于库服务器通过Apache或其他服务器。然后用它在模板，就像开发一个基于Ajax的应用程序。 
  </div> 
 </div> 
 <div> 
  <p style="text-align:justify;"> Django使用 Ajax 另一种方法是使用Django的Ajax框架。&nbsp;最常用的是django-dajax，这是一个强大的工具，能够轻松异步表示逻辑和超快速开发Web应用程序，使用Python和几乎不需要 JavaScript 源代码。它支持四种最流行的js框架：Prototype,&nbsp;jQuery,&nbsp;Dojo&nbsp;和MooTools </p> 
  <h2> 使用Django-dajax </h2> 
  <p style="text-align:justify;"> 首先要做的就是安装&nbsp;django-dajax。这可以通过使用easy_install&nbsp;或&nbsp;pid&nbsp;进行− </p> 
  <pre>$ pip install django_dajax
$ easy_install django_dajax&nbsp;</pre> 
  <p style="text-align:justify;"> 这将自动安装django-dajaxice，按django-dajaxice要求。然后，我们需要配置Ajax和dajaxice。 </p> 
  <p style="text-align:justify;"> 添加 dajax 和 dajaxice 在 settings.py&nbsp;的&nbsp;INSTALLED_APPS选择项目&nbsp;− </p> 
  <pre>INSTALLED_APPS += (
   'dajaxice',
   'dajax'
)&nbsp;</pre> 
  <p style="font-family:Verdana, Geneva, Tahoma,  Helvetica, text-align:justify;font-size:15px !important;background-color:inherit;"> <span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">确保在同一个 settings.py 文件，则有以下</span>&nbsp;− </p> 
  <pre>TEMPLATE_LOADERS = (
   'django.template.loaders.filesystem.Loader',
   'django.template.loaders.app_directories.Loader',
   'django.template.loaders.eggs.Loader',
)

TEMPLATE_CONTEXT_PROCESSORS = (
   'django.contrib.auth.context_processors.auth',
   'django.core.context_processors.debug',
   'django.core.context_processors.i18n',
   'django.core.context_processors.media',
   'django.core.context_processors.static',
   'django.core.context_processors.request',
   'django.contrib.messages.context_processors.messages'
)

STATICFILES_FINDERS = (
   'django.contrib.staticfiles.finders.FileSystemFinder',
   'django.contrib.staticfiles.finders.AppDirectoriesFinder',
   'dajaxice.finders.DajaxiceFinder',
)

DAJAXICE_MEDIA_PREFIX = 'dajaxice'&nbsp;</pre> 
  <p> 现在打开&nbsp;myapp/url.py文件，确保有以下设置dajax&nbsp;URL和加载dajax静态js文件&nbsp;− </p> 
  <pre>from dajaxice.core import dajaxice_autodiscover, dajaxice_config
from django.contrib.staticfiles.urls import staticfiles_urlpatterns
from django.conf import settings

Then dajax urls:

urlpatterns += patterns('',
   url(r'^%s/' % settings.DAJAXICE_MEDIA_PREFIX, include('dajaxice.urls')),)
	
urlpatterns += staticfiles_urlpatterns()</pre> 
  <div>
    我们创建一个基于Dreamreal模型来存储它一个简单的表格，使用Ajax(指无刷新)。 
  </div> 
  <div>
    首先，我们需要在&nbsp;myapp/form.py&nbsp;的&nbsp;Dreamreal&nbsp;表单。 
  </div> 
  <pre>class DreamrealForm(forms.Form):
   website = forms.CharField(max_length = 100)
   name = forms.CharField(max_length = 100)
   phonenumber = forms.CharField(max_length = 50)
   email = forms.CharField(max_length = 100)&nbsp;</pre> 
  <p> 然后，我们需要在应用程序的ajax.py文件：&nbsp;myapp/ajax.py.&nbsp;这里是相关的逻辑，我们把将表单保存，然后返回弹出显示结果 - </p> 
  <pre>from dajaxice.utils import deserialize_form
from myapp.form import DreamrealForm
from dajax.core import Dajax
from myapp.models import Dreamreal

@dajaxice_register
def send_form(request, form):
   dajax = Dajax()
   form = DreamrealForm(deserialize_form(form))
   
   if form.is_valid():
      dajax.remove_css_class('#my_form input', 'error')
      dr = Dreamreal()
      dr.website = form.cleaned_data.get('website')
      dr.name = form.cleaned_data.get('name')
      dr.phonenumber = form.cleaned_data.get('phonenumber')
      dr.save()
      
      dajax.alert("Dreamreal Entry %s was successfully saved." % 
         form.cleaned_data.get('name'))
   else:
      dajax.remove_css_class('#my_form input', 'error')
      for error in form.errors:
         dajax.add_css_class('#id_%s' % error, 'error')
			
   return dajax.json()</pre> 
  <div>
    现在，让我们创建 dreamreal.html 模板，里面有需要的表单 - 
  </div>   
  <pre>&lt;html&gt;
   &lt;head&gt;&lt;/head&gt;
   &lt;body&gt;
   
      &lt;form action = "" method = "post" id = "my_form" accept-charset = "utf-8"&gt;
         {{ form.as_p }}
         &lt;p&gt;&lt;input type = "button" value = "Send" onclick = "send_form();"&gt;&lt;/p&gt;
      &lt;/form&gt;
      
   &lt;/body&gt;
&lt;/html&gt;&nbsp;</pre> 
  <p> 补充一点，在模板视图：myapp/views.py − </p> 
  <pre>def dreamreal(request):
   form = DreamrealForm()
   return render(request, 'dreamreal.html', locals())&nbsp;</pre> 
  <p> 添加相应的网址：myapp/urls.py − </p> 
  <pre>url(r'^dreamreal/', 'dreamreal', name = 'dreamreal'),&nbsp;</pre> 
  <p> 现在添加必要的代码在模板中，以使&nbsp;Ajax&nbsp;工作− </p> 
  <p> 在文件中顶部添加 - </p> 
  <pre>{% load static %}
{% load dajaxice_templatetags %}</pre> 
  <div>
    在dreamreal.html模板的&lt;head&gt;部分添加&nbsp;- 
  </div> 
  <p> 我们使用 JQuery 库对于本例，所以加上以下代码&nbsp;− </p> 
  <pre>&lt;script src = "{% static '/static/jquery-1.11.3.min.js' %}" 
   type = "text/javascript" charset = "utf-8"&gt;&lt;/script&gt;
&lt;script src = "{% static '/static/dajax/jquery.dajax.core.js' %}"&gt;&lt;/script&gt;&nbsp;</pre> 
  <p> 点击将会调用 Ajax 函数− </p> 
  <pre>&lt;script&gt;

   function send_form(){
      Dajaxice.myapp.send_form(Dajax.process,{'form':$('#my_form').serialize(true)});
   }
&lt;/script&gt;&nbsp;</pre> 
  <p> 请注意，需要在静态文件目录添入&nbsp;“jquery-1.11.3.min.js”，也是&nbsp;jquery.dajax.core.js。&nbsp;为了确保所有 dajax 静态文件的静态目录服务，运行&nbsp;- </p> 
  <pre>$python manage.py collectstatic</pre> 
  <div>
    注&nbsp;-&nbsp;有时 jquery.dajax.core.js 可以缺失，如果出现这种情况，只需下载源代码并把它放在静态文件夹中。 
  </div> 
  <p> 访问将能看到下面的画面，&nbsp;/myapp/dreamreal/ −<br> <img src="/uploads/tutorial/20160130/1-160130225H3201.jpg" alt=""> </p> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/de8987b6b0f5443bb0ebb94e1dd7df5d/jango_dajax.jpeg" alt="Using Django-dajax"> 
  <p> 在提交后，将得到以下显示画面&nbsp;−<br> <img src="/uploads/tutorial/20160130/1-160130225P03X.jpg" alt=""> </p> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/69446821884a4b4a85e0a1f335698c51/ax_response.jpeg" alt="Using Django-dajax Response">
  <br> 
 </div>
 <br>      
</div></body></html>
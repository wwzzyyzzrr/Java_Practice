<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">WebGL平移</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    到目前为止，我们讨论了如何绘制各种形状和使用 WebGL 应用它们的颜色。在本章中，我们将举个例子来说明如何平移一个三角形。 
  </div> 
 </div> 
 <p> <br> </p> 
 <h2> 
  <div>
    平移 
  </div> </h2> 
 <div>
   平移是由&nbsp;WebGL&nbsp;提供的仿射变换之一。使用平移，我们可以继续在XYZ平面三角形(任何对象)。假设我们有一个三角形[A，B，C]，我们想的三角形移动到的位置上是5个单位向着X轴正和3个单位向正Y轴。然后将新的顶点。将[A&nbsp;+5，B&nbsp;+3，C&nbsp;+0]。这意味着，平移三角形，我们需要添加平移距离，比方说，tx,&nbsp;ty,&nbsp;tz&nbsp;到每个顶点。 
 </div> 
 <div>
   既然是每个顶点的操作，我们可以在顶点着色器程序实现它。 
 </div> 
 <div>
   在顶点着色器，伴随着属性，坐标(持有顶点位置)，我们定义了容纳平移距离(X，Y，Z)变量。之来我们这个统一的变量添加到变量中的坐标和分配结果到gl_Position&nbsp;变量。 
 </div> 
 <div>
   注&nbsp;-&nbsp;由于顶点着色器将在每个顶点上运行，三角形的所有顶点将被平移。 
 </div> 
 <h2> </h2> 
 <h2> 转换一个三角形步骤 </h2> 
 <p> 下面的步骤是必需的，以建立一个WebGL的应用来绘制三角形，然后将其平移到一个新的位置。 </p> 
 <p> <br> </p> 
 <div> 
  <strong>第1步&nbsp;-&nbsp;准备Canvas和获取WebGL渲染上下文</strong> 
 </div> 
 <p> 在此步骤中，我们使用getContext()得到&nbsp;WebGL&nbsp;渲染上下文对象。 </p> 
 <p> <br> </p> 
 <div> 
  <strong>第2步&nbsp;-&nbsp;定义几何并将其存储在缓冲区对象</strong> 
 </div> 
 <div>
   因为我们画一个三角形，我们必须通过三角形的三个顶点，并将它们存储在缓冲区中。 
 </div> 
 <pre>var vertices = [ -0.5,0.5,0.0, -0.5,-0.5,0.0, 0.5,-0.5,0.0, ];</pre> 
 <div> 
  <strong>第3步&nbsp;-&nbsp;创建和编译着色器程序</strong> 
 </div> 
 <div>
   在这一步中，你需要编写的顶点着色器和片段着色器程序，编译它们，并通过连接这两个程序将创建一个合并程序。 
 </div> 
 <ul> 
  <li> 
   <div>
     顶点着色器&nbsp;-&nbsp;在程序的顶点着色器，我们定义一个向量属性来存储三维坐标。除了它，我们定义存储平移的距离一个统一变量，最后，我们添加这两个值并将其分配给&nbsp;gl_position&nbsp;它保存顶点的最终位置。 
   </div> </li> 
 </ul> 
 <pre>var vertCode =
   'attribute vec4 coordinates;' +
   'uniform vec4 translation;'+
   'void main(void) {' +
      ' gl_Position = coordinates + translation;' +
   '}';</pre> 
 <ul style="background-color:inherit;color:#313131;font-family:Verdana, Geneva, Tahoma,  Helvetica,;"> 
  <li> 
   <div>
     片段着色器&nbsp;-&nbsp;在片段着色器，我们只分配片段颜色变 gl_FragColor。 
   </div> </li> 
 </ul> 
 <pre>var fragCode = 'void main(void) {' +' gl_FragColor = vec4(1, 0.5, 0.0, 1);' +'}';</pre> 
 <div> 
  <strong>第4步&nbsp;-&nbsp;关联着色器程序到缓冲区对象</strong> 
 </div> 
 <p> 在这一步，我们关联着色器程序到缓冲器的对象。 </p> 
 <p> <br> </p> 
 <div> 
  <strong>第5步&nbsp;-&nbsp;绘制所需的对象</strong> 
 </div> 
 <div>
   由于我们使用索引绘制三角形，我们将使用&nbsp;drawArrays() 方法。该方法，我们必须通过被认为是对顶点/元件的数目。因为我们画一个三角形，我们将通过传递&nbsp;3&nbsp;作为一个参数。 
 </div> 
 <pre>gl.drawArrays(gl.TRIANGLES, 0, 3);</pre> 
 <h2> 
  <div>
    示例&nbsp;-&nbsp;平移三角形 
  </div> </h2> 
 <div>
   下面的例子演示了如何在&nbsp;XYZ&nbsp;平面上平移三角形。 
 </div> 
 <pre>&lt;!doctype html&gt;
&lt;html&gt;
   &lt;body&gt;
      &lt;canvas width = "300" height = "300" id = "my_Canvas"&gt;&lt;/canvas&gt;
         
      &lt;script&gt;
         
         /*=================Creating a canvas=========================*/
         var canvas = document.getElementById('my_Canvas');
         gl = canvas.getContext('experimental-webgl'); 
 
         /*===========Defining and storing the geometry==============*/
         var vertices = [
            -0.5,0.5,0.0, 	
            -0.5,-0.5,0.0, 	
            0.5,-0.5,0.0,   
         ];
            
         //Create an empty buffer object and store vertex data            
         var vertex_buffer = gl.createBuffer(); 
			
         //Create a new buffer
         gl.bindBuffer(gl.ARRAY_BUFFER, vertex_buffer);   
			
         //bind it to the current buffer			
         gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW); 
			
         // Pass the buffer data
         gl.bindBuffer(gl.ARRAY_BUFFER, null);  
            
         /*========================Shaders============================*/
            
         //vertex shader source code 
         var vertCode =
            'attribute vec4 coordinates;' + 
            'uniform vec4 translation;'+
            'void main(void) {' +
               '  gl_Position = coordinates + translation;' +
            '}';
            
         //Create a vertex shader program object and compile it              
         var vertShader = gl.createShader(gl.VERTEX_SHADER);
         gl.shaderSource(vertShader, vertCode);
         gl.compileShader(vertShader);
            
   
         //fragment shader source code
         var fragCode =
            'void main(void) {' +
               '   gl_FragColor = vec4(0.0, 0.0, 0.0, 0.1);' +
            '}';
               
         //Create a fragment shader program object and compile it            
         var fragShader = gl.createShader(gl.FRAGMENT_SHADER);
         gl.shaderSource(fragShader, fragCode);
         gl.compileShader(fragShader);
            
         //Create and use combiened shader program
         var shaderProgram = gl.createProgram();
         gl.attachShader(shaderProgram, vertShader);
         gl.attachShader(shaderProgram, fragShader);
         gl.linkProgram(shaderProgram);
   
         gl.useProgram(shaderProgram); 
   
   
         /* ===========Associating shaders to buffer objects============*/
      
         gl.bindBuffer(gl.ARRAY_BUFFER, vertex_buffer);    
         var coordinatesVar = gl.getAttribLocation(shaderProgram, "coordinates");
         gl.vertexAttribYiibaier(coordinatesVar, 3, gl.FLOAT, false, 0, 0);   
         gl.enableVertexAttribArray(coordinatesVar); 
   
         /* ==========translation======================================*/
         var Tx = 0.5, Ty = 0.5, Tz = 0.0;
         var translation = gl.getUniformLocation(shaderProgram, 'translation');
         gl.uniform4f(translation, Tx, Ty, Tz, 0.0);
 
         /*=================Drawing the riangle and transforming it========================*/ 
            
         gl.clearColor(0.5, 0.5, 0.5, 0.9);
         gl.enable(gl.DEPTH_TEST);
   
         gl.clear(gl.COLOR_BUFFER_BIT);
         gl.viewport(0,0,canvas.width,canvas.height);
         gl.drawArrays(gl.TRIANGLES, 0, 3);
               
      &lt;/script&gt;
 
    &lt;/body&gt;
 &lt;/html&gt;</pre> 
 <p> 这将产生以下结果&nbsp;- </p> 
 <p> <img src="/uploads/tutorial/20151220/1-151220215544547.png" alt=""> </p> 
 <p> <br> </p> 
 <div style="font-family:微软雅黑;font-size:14px;background-color:#FFFFFF;"> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/fc0d17bfa6c245669aebb60c0035779e/clipboard.png"> 
 </div>
 <br>      
</div></body></html>
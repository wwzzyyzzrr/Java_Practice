<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">ASP.NET服务端</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在这章中，我们研究页面生命周期以及页面如何包含各种控件。页面本身被实例化为一个控制对象。所有的Web窗体基本上都是ASP.NET <code>Page</code>类的实例。 <code>Page</code>类具有以下对应于内部对象的非常有用的属性：</p> 
 <ul> 
  <li>Session</li>
  <li>Application</li>
  <li>Cache</li>
  <li>Request</li>
  <li>Response</li>
  <li>Server</li>
  <li>User</li>
  <li>Trace</li>
 </ul> 
 <p>我们将在适当的时候讨论这些对象。在本教程中，我们将学习<code>Server</code>对象，<code>Request</code>对象和<code>Response</code>对象。</p> 
 <h2 id="h2-server-"><a name="Server对象" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Server对象</h2>
 <p>Asp.NET中的<code>Server</code>对象是<code>System.Web.HttpServerUtility</code>类的一个实例。 <code>HttpServerUtility</code>类提供了许多执行各种作业的属性和方法。</p> 
 <p><strong>服务器对象的属性和方法</strong><br><code>HttpServerUtility</code>类的方法和属性通过ASP.NET提供的内部服务器对象公开。</p> 
 <p>下表提供了属性的列表：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>属性</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>MachineName</td> 
    <td>服务器计算机的名称</td> 
   </tr> 
   <tr> 
    <td>ScriptTimeOut</td> 
    <td>获取和设置请求超时值，以秒为单位。</td> 
   </tr> 
  </tbody> 
 </table> 
 <p>下表列出了一些重要的方法：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>方法</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>CreateObject(String)</code></td> 
    <td>创建由其ProgID(编程ID)标识的COM对象的一个实例。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>CreateObject(Type)</code></td> 
    <td>创建由其类型标识的COM对象的一个实例。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>Equals(Object)</code></td> 
    <td>确定指定的对象(<code>Object</code>)是否等于当前的对象。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>Execute(String)</code></td> 
    <td>在当前请求的上下文中执行指定虚拟路径的处理程序。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>Execute(String, Boolean)</code></td> 
    <td>在当前请求的上下文中执行指定虚拟路径的处理程序，并指定是否清除<code>QueryString</code>和<code>Form</code>集合。</td> 
   </tr> 
   <tr> 
    <td>6</td> 
    <td><code>GetLastError</code></td> 
    <td>返回以前的异常。</td> 
   </tr> 
   <tr> 
    <td>7</td> 
    <td><code>GetType</code></td> 
    <td>获取当前实例的类型。</td> 
   </tr> 
   <tr> 
    <td>8</td> 
    <td><code>HtmlEncode</code></td> 
    <td>将普通字符串更改为具有合法HTML字符的字符串。</td> 
   </tr> 
   <tr> 
    <td>9</td> 
    <td><code>HtmlDecode</code></td> 
    <td>将Html字符串转换为普通字符串。</td> 
   </tr> 
   <tr> 
    <td>10</td> 
    <td><code>ToString</code></td> 
    <td>返回表示当前对象的字符串。</td> 
   </tr> 
   <tr> 
    <td>11</td> 
    <td><code>Transfer(String)</code></td> 
    <td>对于当前请求，终止当前页面的执行，并使用指定的页面URL路径开始执行新页面。</td> 
   </tr> 
   <tr> 
    <td>12</td> 
    <td><code>UrlDecode</code></td> 
    <td>将URL字符串转换为普通字符串。</td> 
   </tr> 
   <tr> 
    <td>13</td> 
    <td><code>UrlEncodeToken</code></td> 
    <td>与<code>UrlEncode</code>相同，但是在包含Base64编码数据的字节数组上。</td> 
   </tr> 
   <tr> 
    <td>14</td> 
    <td><code>UrlDecodeToken</code></td> 
    <td>与<code>UrlDecode</code>相同，但在包含Base64编码数据的字节数组上。</td> 
   </tr> 
   <tr> 
    <td>15</td> 
    <td><code>MapPath</code></td> 
    <td>返回与服务器上指定的虚拟文件路径对应的物理路径。</td> 
   </tr> 
   <tr> 
    <td>16</td> 
    <td><code>Transfer</code></td> 
    <td>将执行转移到当前应用程序中的另一个网页。</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 id="h2-httprequest-"><a name="HttpRequest对象" class="reference-link"></a><span class="header-link octicon octicon-link"></span>HttpRequest对象</h2>
 <p><code>HttpRequest</code>对象是<code>System.Web.HttpRequest</code>类的一个实例。 它表示使页面加载到浏览器中的HTTP请求的值和属性。</p> 
 <p>这个对象提供的信息被更高层次的抽象(Web控制模型)所包围。 但是，此对象有助于检查某些信息，如客户端浏览器和Cookie。</p> 
 <p><strong>请求对象的属性和方法</strong></p> 
 <p>下表提供了<code>Request</code>对象的一些值得注意的属性：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>属性</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>AcceptTypes</code></td> 
    <td>获取客户端支持的MIME接受类型的字符串数组。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>ApplicationPath</code></td> 
    <td>获取服务器上的ASP.NET应用程序的虚拟应用程序根路径。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>Browser</code></td> 
    <td>获取或设置有关请求客户端的浏览器功能的信息。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>ContentEncoding</code></td> 
    <td>获取或设置实体主体的字符集。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>ContentLength</code></td> 
    <td>指定客户端发送的内容的长度(以字节为单位)。</td> 
   </tr> 
   <tr> 
    <td>6</td> 
    <td><code>ContentType</code></td> 
    <td>获取或设置传入请求的MIME内容类型。</td> 
   </tr> 
   <tr> 
    <td>7</td> 
    <td><code>Cookies</code></td> 
    <td>获取客户端发送的Cookie的集合。</td> 
   </tr> 
   <tr> 
    <td>8</td> 
    <td><code>FilePath</code></td> 
    <td>获取当前请求的虚拟路径。</td> 
   </tr> 
   <tr> 
    <td>9</td> 
    <td><code>Files</code></td> 
    <td>获取客户端上传的文件的集合，采用多部分MIME格式。</td> 
   </tr> 
   <tr> 
    <td>10</td> 
    <td><code>Form</code></td> 
    <td>获取表单变量的集合。</td> 
   </tr> 
   <tr> 
    <td>11</td> 
    <td><code>Headers</code></td> 
    <td>获取HTTP标头的集合。</td> 
   </tr> 
   <tr> 
    <td>12</td> 
    <td><code>HttpMethod</code></td> 
    <td>获取客户端使用的HTTP数据传输方法(如<code>GET</code>，<code>POST</code>或<code>HEAD</code>)。</td> 
   </tr> 
   <tr> 
    <td>13</td> 
    <td><code>InputStream</code></td> 
    <td>获取传入的HTTP实体主体的内容。</td> 
   </tr> 
   <tr> 
    <td>14</td> 
    <td><code>IsSecureConnection</code></td> 
    <td>获取一个值，该值指示HTTP连接是否使用安全套接字(即HTTPS)。</td> 
   </tr> 
   <tr> 
    <td>15</td> 
    <td><code>QueryString</code></td> 
    <td>获取HTTP查询字符串变量的集合。</td> 
   </tr> 
   <tr> 
    <td>16</td> 
    <td><code>RawUrl</code></td> 
    <td>获取当前请求的原始URL。</td> 
   </tr> 
   <tr> 
    <td>17</td> 
    <td><code>RequestType</code></td> 
    <td>获取或设置客户端使用的HTTP数据传输方法(<code>GET</code>或<code>POST</code>)。</td> 
   </tr> 
   <tr> 
    <td>18</td> 
    <td><code>ServerVariables</code></td> 
    <td>获取Web服务器变量的集合。</td> 
   </tr> 
   <tr> 
    <td>19</td> 
    <td><code>TotalBytes</code></td> 
    <td>获取当前输入流中的字节数。</td> 
   </tr> 
   <tr> 
    <td>20</td> 
    <td><code>Url</code></td> 
    <td>获取有关当前请求的URL的信息。</td> 
   </tr> 
   <tr> 
    <td>21</td> 
    <td><code>UrlReferrer</code></td> 
    <td>获取有关链接到当前URL的客户端先前请求的URL的信息。</td> 
   </tr> 
   <tr> 
    <td>22</td> 
    <td><code>UserAgent</code></td> 
    <td>获取客户端浏览器的原始用户代理字符串。</td> 
   </tr> 
   <tr> 
    <td>23</td> 
    <td><code>UserHostAddress</code></td> 
    <td>获取远程客户端的IP主机地址。</td> 
   </tr> 
   <tr> 
    <td>24</td> 
    <td><code>UserHostName</code></td> 
    <td>获取远程客户端的DNS名称。</td> 
   </tr> 
   <tr> 
    <td>25</td> 
    <td><code>UserLanguages</code></td> 
    <td>获取客户端语言首选项的排序字符串数组。</td> 
   </tr> 
  </tbody> 
 </table> 
 <p>下表列出了一些重要的方法：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>方法</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>BinaryRead</code></td> 
    <td>对当前输入流执行指定字节数的二进制读取。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>Equals(Object)</code></td> 
    <td>确定指定的对象是否等于当前对象。 (从object继承。)</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>GetType</code></td> 
    <td>获取当前实例的类型。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>MapImageCoordinates</code></td> 
    <td>将传入的图像字段形式参数映射到适当的<code>x</code>坐标和<code>y</code>坐标值。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>MapPath(String)</code></td> 
    <td>将指定的虚拟路径映射到物理路径。</td> 
   </tr> 
   <tr> 
    <td>6</td> 
    <td><code>SaveAs</code></td> 
    <td>将HTTP请求保存到磁盘。</td> 
   </tr> 
   <tr> 
    <td>7</td> 
    <td><code>ToString</code></td> 
    <td>返回表示当前对象的字符串。</td> 
   </tr> 
   <tr> 
    <td>8</td> 
    <td><code>ValidateInput</code></td> 
    <td>对通过<code>Cookies</code>，<code>Form</code>和<code>QueryString</code>属性访问的集合进行验证。</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 id="h2-response-"><a name="Response对象" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Response对象</h2>
 <p>Response对象表示服务器对客户端请求的响应。 它是<code>System.Web.HttpResponse</code>类的一个实例。</p> 
 <p>在ASP.NET中，响应对象在向客户端发送HTML文本时不起任何重要作用，因为服务器端控件具有嵌套的，面向对象的方法来呈现自己。</p> 
 <p>但是，<code>HttpResponse</code>对象仍然提供了一些重要的功能，如<code>Cookie</code>功能和<code>Redirect()</code>方法。 <code>Response.Redirect()</code>方法允许将用户转移到另一个页面。</p> 
 <p><strong>Response对象的属性和方法</strong></p> 
 <p>下表提供了<code>Response</code>对象的一些值得注意的属性：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>属性</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>Buffer</code></td> 
    <td>获取或设置一个值，指示是否缓冲输出并在完成响应完成处理后发送。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>BufferOutput</code></td> 
    <td>获取或设置一个值，指示是否在完成页面处理完成后缓存输出并发送。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>Charset</code></td> 
    <td>获取或设置输出流的HTTP字符集。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>ContentEncoding</code></td> 
    <td>获取或设置输出流的HTTP字符集。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>ContentType</code></td> 
    <td>获取或设置输出流的HTTP MIME类型。</td> 
   </tr> 
   <tr> 
    <td>6</td> 
    <td><code>Cookies</code></td> 
    <td>获取响应cookie集合。</td> 
   </tr> 
   <tr> 
    <td>7</td> 
    <td><code>Expires</code></td> 
    <td>获取或设置在浏览器上缓存的页面到期之前的分钟数。</td> 
   </tr> 
   <tr> 
    <td>8</td> 
    <td><code>ExpiresAbsolute</code></td> 
    <td>获取或设置从缓存中删除缓存信息的绝对日期和时间。</td> 
   </tr> 
   <tr> 
    <td>9</td> 
    <td><code>HeaderEncoding</code></td> 
    <td>获取或设置一个编码对象，该对象表示当前标题输出流的编码。</td> 
   </tr> 
   <tr> 
    <td>10</td> 
    <td><code>Headers</code></td> 
    <td>获取响应标头的集合。</td> 
   </tr> 
   <tr> 
    <td>11</td> 
    <td><code>IsClientConnected</code></td> 
    <td>获取一个值，指示客户端是否仍连接到服务器。</td> 
   </tr> 
   <tr> 
    <td>12</td> 
    <td><code>Output</code></td> 
    <td>启用将文本输出到传出的HTTP响应流。</td> 
   </tr> 
   <tr> 
    <td>13</td> 
    <td><code>OutputStream</code></td> 
    <td>启用二进制输出到传出HTTP内容主体。</td> 
   </tr> 
   <tr> 
    <td>14</td> 
    <td><code>RedirectLocation</code></td> 
    <td>获取或设置Http Location标头的值。</td> 
   </tr> 
   <tr> 
    <td>15</td> 
    <td><code>Status</code></td> 
    <td>设置返回给客户端的状态行。</td> 
   </tr> 
   <tr> 
    <td>16</td> 
    <td><code>StatusCode</code></td> 
    <td>获取或设置返回给客户端的输出的HTTP状态码。</td> 
   </tr> 
   <tr> 
    <td>17</td> 
    <td><code>StatusDescription</code></td> 
    <td>获取或设置返回给客户端的输出的HTTP状态字符串。</td> 
   </tr> 
   <tr> 
    <td>18</td> 
    <td><code>SubStatusCode</code></td> 
    <td>获取或设置一个限定响应状态码的值。</td> 
   </tr> 
   <tr> 
    <td>19</td> 
    <td><code>SuppressContent</code></td> 
    <td>获取或设置一个值，指示是否向客户端发送HTTP内容。</td> 
   </tr> 
  </tbody> 
 </table> 
 <p>下表列出了一些重要的方法：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>方法</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>AddHeader</code></td> 
    <td>将HTTP标头添加到输出流。提供<code>AddHeader</code>是为了与早期版本的ASP兼容。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>AppendCookie</code></td> 
    <td>基础架构将HTTP cookie添加到内部cookie集合中。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>AppendHeader</code></td> 
    <td>将HTTP标头添加到输出流。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>AppendToLog</code></td> 
    <td>将自定义日志信息添加到InterNET信息服务(IIS)日志文件。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>BinaryWrite</code></td> 
    <td>将一串二进制字符写入HTTP输出流。</td> 
   </tr> 
   <tr> 
    <td>6</td> 
    <td><code>ClearContent</code></td> 
    <td>清除缓冲流中的所有内容输出。</td> 
   </tr> 
   <tr> 
    <td>7</td> 
    <td><code>Close</code></td> 
    <td>关闭与客户端的套接字连接。</td> 
   </tr> 
   <tr> 
    <td>8</td> 
    <td><code>End</code></td> 
    <td>将所有当前缓冲的输出发送到客户端，停止页面的执行，并引发<code>EndRequest</code>事件。</td> 
   </tr> 
   <tr> 
    <td>9</td> 
    <td><code>Equals(Object)</code></td> 
    <td>确定指定的对象(<code>Object</code>)是否等于当前对象。</td> 
   </tr> 
   <tr> 
    <td>10</td> 
    <td><code>Flush</code></td> 
    <td>将所有当前缓冲的输出发送到客户端。</td> 
   </tr> 
   <tr> 
    <td>11</td> 
    <td><code>GetType</code></td> 
    <td>获取当前实例的类型。</td> 
   </tr> 
   <tr> 
    <td>12</td> 
    <td><code>Pics</code></td> 
    <td>将HTTP PICS-Label标头附加到输出流。</td> 
   </tr> 
   <tr> 
    <td>13</td> 
    <td><code>Redirect(String)</code></td> 
    <td>将请求重定向到新的URL并指定新的URL。</td> 
   </tr> 
   <tr> 
    <td>14</td> 
    <td><code>Redirect(String, Boolean)</code></td> 
    <td>将客户端重定向到新的URL。指定新的URL以及当前页面的执行是否应该终止。</td> 
   </tr> 
   <tr> 
    <td>15</td> 
    <td><code>SetCookie</code></td> 
    <td>更新<code>cookie</code>集合中的现有cookie。</td> 
   </tr> 
   <tr> 
    <td>16</td> 
    <td><code>ToString</code></td> 
    <td>返回表示当前对象的字符串。</td> 
   </tr> 
   <tr> 
    <td>17</td> 
    <td><code>TransmitFile(String)</code></td> 
    <td>将指定的文件直接写入HTTP响应输出流，而不将其缓冲在内存中。</td> 
   </tr> 
   <tr> 
    <td>18</td> 
    <td><code>Write(Char)</code></td> 
    <td>将一个字符写入HTTP响应输出流。</td> 
   </tr> 
   <tr> 
    <td>19</td> 
    <td><code>Write(Object)</code></td> 
    <td>将对象写入HTTP响应流。</td> 
   </tr> 
   <tr> 
    <td>20</td> 
    <td><code>Write(String)</code></td> 
    <td>将一个字符串写入HTTP响应输出流。</td> 
   </tr> 
   <tr> 
    <td>21</td> 
    <td><code>WriteFile(String)</code></td> 
    <td>将指定文件的内容直接写入HTTP响应输出流作为文件块。</td> 
   </tr> 
   <tr> 
    <td>22</td> 
    <td><code>WriteFile(String, Boolean)</code></td> 
    <td>将指定文件的内容直接写入HTTP响应输出流作为内存块。</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 id="h2-u793Au4F8B"><a name="示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>示例</h2>
 <p>下面的简单例子有一个文本框控件，用户可以输入名字，一个按钮将信息发送到服务器，一个标签控件用于显示客户端的URL。</p> 
 <p>打开Visual Studio，创建一个空的网站项目：<em>ServerSide</em>，参考下图 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/0312/908111204_11616.png" alt=""></p> 
 <p>在项目名称上点击右键，并添加一个<em>Web窗体</em>文件(<em>Defualt.aspx</em>)，参考下图 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/0312/737111205_52815.png" alt=""></p> 
 <p>其内容如下：</p>   
 <pre><code class="lang-aspnet">&lt;%@ Page Language="C#" AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="_Default" %&gt;

&lt;!DOCTYPE html&gt;

&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head runat="server"&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/&gt;
    &lt;title&gt;服务器端示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form id="form1" runat="server"&gt;
        &lt;div&gt;
            &lt;asp:Label ID="Label1" runat="server" Text="请输入姓名："&gt;&lt;/asp:Label&gt;
            &lt;asp:TextBox ID="TextBox1" runat="server"&gt;&lt;/asp:TextBox&gt;
            &lt;asp:Button ID="Button1" runat="server" Text="提交" OnClick="Button1_Click" /&gt;
            &lt;br /&gt;
            &lt;br /&gt;
            &lt;asp:Label ID="Label2" runat="server"&gt;&lt;/asp:Label&gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>打开 <em>Default.cs</em>，添加<code>Button1_Click</code>事件处理的代码：</p> 
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class _Default : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {

    }

    protected void Button1_Click(object sender, EventArgs e)
    {
        if (!String.IsNullOrEmpty(TextBox1.Text))
        {

            // Access the HttpServerUtility methods through
            // the intrinsic Server object.
            Label1.Text = "欢迎您, " + Server.HtmlEncode(TextBox1.Text) + ". &lt;br/&gt; 当前 URL 是 " + Server.UrlEncode(Request.Url.ToString());
        }
    }

}
</code></pre> 
 <p>运行该项目(页面)，得到类似以下结果：</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/0312/557111212_34811.png" alt=""></p> 
 <p>输入一个名字：<em>Yiibai</em>，然后提交，得到以下结果 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/0312/841111213_79716.png" alt=""></p>
 <br>      
</div></body></html>
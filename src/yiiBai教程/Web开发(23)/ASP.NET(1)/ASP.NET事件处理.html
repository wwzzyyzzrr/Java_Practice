<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">ASP.NET事件处理</h1><div style="width:100%;float:left;" class="article-content">   
 <p>事件是一个动作或事件，如鼠标点击，按键，鼠标移动或任何系统生成的通知。 一个过程通过事件进行通信沟通。例如，中断是系统生成的事件。当事件发生时，应用程序应该能够响应并管理它。</p> 
 <p>ASP.NET中的事件在客户机上引发的，并在服务器机器上处理。 例如，用户点击浏览器中显示的按钮。则点击(<em>Click</em>)事件就会被被引发。浏览器通过将其发布到服务器，并由服务器来处理这个客户端事件。</p> 
 <p>服务器有一个子程序描述事件发生时该怎么做(处理); 它被称为事件处理程序。 因此，当事件消息被发送到服务器时，它检查点击(<em>Click</em>)事件是否具有关联的事件处理程序。 如果有，则执行事件处理程序。</p> 
 <h2 id="h2-u4E8Bu4EF6u53C2u6570"><a name="事件参数" class="reference-link"></a><span class="header-link octicon octicon-link"></span>事件参数</h2>
 <p>ASP.NET事件处理程序通常需要两个参数并返回<code>void</code>。 第一个参数表示引发事件的对象，第二个参数表示事件参数。</p> 
 <p>事件的一般语法是：</p> 
 <pre><code class="lang-csharp">private void EventName (object sender, EventArgs e);
</code></pre> 
 <h2 id="h2-u5E94u7528u7A0Bu5E8Fu548Cu4F1Au8BDDu4E8Bu4EF6"><a name="应用程序和会话事件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>应用程序和会话事件</h2>
 <p>ASP.Net中最重要的应用程序事件是：</p> 
 <ul> 
  <li><em>Application_Start</em> - 当应用程序/网站启动时引发。</li>
  <li><em>Application_End</em> - 当应用程序/网站停止时引发。</li>
 </ul> 
 <p>同样，最常用的<code>Session</code>事件是：</p> 
 <ul> 
  <li><em>Session_Start</em> - 当用户第一次请求应用程序的一个页面时引发。</li>
  <li><em>Session_End </em> - 会话结束时引发。</li>
 </ul> 
 <h2 id="h2-u9875u9762u548Cu63A7u4EF6u4E8Bu4EF6"><a name="页面和控件事件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>页面和控件事件</h2>
 <p>常见的页面和控制事件是：</p> 
 <ul> 
  <li><em>DataBinding</em> - 当控件绑定到数据源时会引发。</li>
  <li><em>Disposed</em> - 当页面或控件被释放时会引发。</li>
  <li><em>Error</em> - 这是一个页面事件，在未处理的异常时引发。</li>
  <li><em>Init</em> - 页面或控件初始化时会引发。</li>
  <li><em>Load</em> - 当页面或控件加载时会引发。</li>
  <li><em>PreRender</em> - 当页面或控件要被渲染时引发。</li>
  <li><em>Unload</em> - 页面或控件从内存中卸载时会引发。</li>
 </ul> 
 <h2 id="h2-u4F7Fu7528u63A7u4EF6u5904u7406u4E8Bu4EF6"><a name="使用控件处理事件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用控件处理事件</h2>
 <p>所有的ASP.NET控件都是以类的形式实现的，而且当用户对它们执行特定的操作时，会触发事件。 例如，当用户点击一个按钮时，<em>“Click”</em>事件就会生成(触发)。要处理事件，可使用内置的属性和事件处理程序。 事件处理程序被编码为响应一个事件，并采取适当的动作。</p> 
 <p>默认情况下，Visual Studio通过在<code>Sub</code>过程中包含<code>Handles</code>子句来创建事件处理程序。 该子句命名该过程处理的控件和事件。</p> 
 <p>按钮控件的<code>ASP</code>标签，如下：</p> 
 <pre><code class="lang-aspnet">&lt;asp:Button ID="btnCancel" runat="server" Text="Cancel" /&gt;
</code></pre> 
 <p>Click事件的事件处理程序：</p> 
 <pre><code class="lang-csharp">Protected Sub btnCancel_Click(ByVal sender As Object, ByVal e As System.EventArgs) 

   Handles btnCancel.Click

End Sub
</code></pre> 
 <p>一个事件也可以用<code>Handles</code>子句编码。 然后，必须根据控件的相应事件属性来命名处理程序。</p> 
 <p>按钮控件的ASP标签：</p> 
 <pre><code class="lang-aspnet">&lt;asp:Button ID="btnCancel" runat="server" Text="Cancel" Onclick="btnCancel_Click" /&gt;
</code></pre> 
 <p>Click事件的事件处理程序：</p> 
 <pre><code class="lang-csharp">Protected Sub btnCancel_Click(ByVal sender As Object, ByVal e As System.EventArgs)

End Sub
</code></pre> 
 <p>常见的控制事件是：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>事件</th> 
    <th>属性</th> 
    <th>控件</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td><code>Click</code></td> 
    <td><code>OnClick</code></td> 
    <td>按钮，图像按钮，链接按钮，图像映射</td> 
   </tr> 
   <tr> 
    <td><code>Command</code></td> 
    <td><code>OnCommand</code></td> 
    <td>按钮，图像按钮，链接按钮</td> 
   </tr> 
   <tr> 
    <td><code>TextChanged</code></td> 
    <td><code>OnTextChanged</code></td> 
    <td>文本框</td> 
   </tr> 
   <tr> 
    <td><code>SelectedIndexChanged</code></td> 
    <td><code>OnSelectedIndexChanged</code></td> 
    <td>下拉列表，列表框，单选按钮列表，复选框列表。</td> 
   </tr> 
   <tr> 
    <td><code>CheckedChanged</code></td> 
    <td><code>OnCheckedChanged</code></td> 
    <td>复选框，单选按钮</td> 
   </tr> 
  </tbody> 
 </table> 
 <p>有些事件会导致表单被立即回发到服务器，这些被称为回发事件。 例如，点击事件，如<code>Button.Click</code>。</p> 
 <p>某些事件不会立即回发到服务器，这些事件被称为非回发事件。</p> 
 <p>例如，更改事件或选择事件，如<code>TextBox.TextChanged</code>或<code>CheckBox.CheckedChanged</code>。 通过将其<code>AutoPostBack</code>属性设置为<code>true</code>，可以使<code>nonpostback</code>事件立即回发。</p> 
 <h2 id="h2-u9ED8u8BA4u4E8Bu4EF6"><a name="默认事件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>默认事件</h2>
 <p><code>Page</code>对象的默认事件是<code>Load</code>事件。 同样，每个控件都有一个默认事件。 例如，按钮控件的默认事件是<code>Click</code>事件。</p> 
 <p>只需在设计视图中双击控件，即可在Visual Studio中创建默认事件处理程序。 下表显示了一些常用控件的默认事件：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>控件</th> 
    <th>默认事件</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>AdRotator</td> 
    <td>AdCreated</td> 
   </tr> 
   <tr> 
    <td>BulletedList</td> 
    <td>AClick</td> 
   </tr> 
   <tr> 
    <td>Button</td> 
    <td>AClick</td> 
   </tr> 
   <tr> 
    <td>Calender</td> 
    <td>ASelectionChanged</td> 
   </tr> 
   <tr> 
    <td>CheckBox</td> 
    <td>ACheckedChanged</td> 
   </tr> 
   <tr> 
    <td>CheckBoxList</td> 
    <td>ASelectedIndexChanged</td> 
   </tr> 
   <tr> 
    <td>DataGrid</td> 
    <td>ASelectedIndexChanged</td> 
   </tr> 
   <tr> 
    <td>DataList</td> 
    <td>ASelectedIndexChanged</td> 
   </tr> 
   <tr> 
    <td>DropDownList</td> 
    <td>ASelectedIndexChanged</td> 
   </tr> 
   <tr> 
    <td>HyperLink</td> 
    <td>AClick</td> 
   </tr> 
   <tr> 
    <td>ImageButton</td> 
    <td>AClick</td> 
   </tr> 
   <tr> 
    <td>ImageMap</td> 
    <td>AClick</td> 
   </tr> 
   <tr> 
    <td>LinkButton</td> 
    <td>AClick</td> 
   </tr> 
   <tr> 
    <td>ListBox</td> 
    <td>ASelectedIndexChanged</td> 
   </tr> 
   <tr> 
    <td>Menu</td> 
    <td>AMenuItemClick</td> 
   </tr> 
   <tr> 
    <td>RadioButton</td> 
    <td>ACheckedChanged</td> 
   </tr> 
   <tr> 
    <td>RadioButtonList</td> 
    <td>ASelectedIndexChanged</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 id="h2-u793Au4F8B"><a name="示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>示例</h2>
 <p>这个例子包括一个带有标签控件和按钮控件的简单页面。 当<code>Page_Load</code>，<code>Page_Init</code>，<code>Page_PreRender</code>等页面事件发生时，它会发送一个消息，由标签控件显示。当按钮被点击时，引发<code>Button_Click</code>事件，并且还发送要在标签上显示的消息。</p> 
 <p>创建一个新的网站项目：<em>EventHandling</em>，点击<em>文件</em>-&gt;<em>新建</em>-&gt;<em>网站</em>，然后选择<em>空网站</em>， 如下 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/0312/722211242_43737.png" alt=""></p> 
 <p>在<em>解决方案资源管理器</em>中，右击项目的名称，在弹出的菜单中，选择<em>添加</em>-&gt;<em>添加新项目</em>，选择<em>Web窗体</em>，并存为<em>Default.aspx</em>，如下图所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/0312/584211246_16157.png" alt=""></p> 
 <p>并从<em>控制工具</em>箱中拖动一个标签控件和一个按钮控件。参考下图 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/0312/593211248_42320.png" alt=""></p> 
 <p>使用属性窗口，将标签控件的ID设置为 <code>lblmessage</code> ，按钮控件的ID设置为<code>btnclick</code>。 将Button控件的<code>Text</code>属性设置为 - <code>"事件按钮"</code>。</p> 
 <p>标记文件(<code>Default.aspx</code>)：</p>   
 <pre><code class="lang-aspnet">&lt;%@ Page Language="C#" AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="_Default" %&gt;

&lt;!DOCTYPE html&gt;

&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head runat="server"&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/&gt;
    &lt;title&gt;Asp.net事件处理&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form id="form1" runat="server"&gt;
        &lt;div&gt;
            &lt;asp:Label ID="lblmessage" runat="server" Text="Label"&gt;&lt;/asp:Label&gt;
            &lt;br /&gt;
            &lt;asp:Button ID="btnclick" runat="server" Text="事件按钮" OnClick="btnclick_Click" /&gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>双击设计视图移动到文件后面的代码。 <code>Page_Load</code>事件是自动创建的，没有任何代码。 编写写以下的代码行用来处理相关事件：</p> 
 <pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class _Default : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        lblmessage.Text += "Page load event handled. &lt;br /&gt;";

        if (Page.IsPostBack)
        {
            lblmessage.Text += "Page post back event handled.&lt;br/&gt;";
        }
    }

    protected void Page_Init(object sender, EventArgs e)
    {
        lblmessage.Text += "Page initialization event handled.&lt;br/&gt;";
    }

    protected void Page_PreRender(object sender, EventArgs e)
    {
        lblmessage.Text += "Page prerender event handled. &lt;br/&gt;";
    }

    protected void btnclick_Click(object sender, EventArgs e)
    {
        lblmessage.Text += "Button click event handled. &lt;br/&gt;";
    }
}
</code></pre> 
 <p>执行该页面。标签显示页面加载，页面初始化和页面预渲染事件。点击按钮看效果：</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/0312/901211252_41431.png" alt=""></p> 
 <p>点击<em>事件按钮</em>，得到以下结果 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/0312/842211254_99141.png" alt=""></p>
 <br>      
</div></body></html>
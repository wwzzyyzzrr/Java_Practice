<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">ASP.NET个性化</h1><div style="width:100%;float:left;" class="article-content">   
 <p>网站设计是为用户提供重复访问的个性化使得网站能够记住用户身份和其他信息细节，并为每个用户呈现个人化的环境。</p> 
 <p>ASP.NET提供个性化网站来为特定客户的喜好和偏好地提供服务。</p> 
 <h2 id="h2-u4E86u89E3u914Du7F6Eu6587u4EF6"><a name="了解配置文件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>了解配置文件</h2>
 <p>ASP.NET个性化服务基于用户配置文件。 用户配置文件定义了该网站所需用户的信息种类。 例如，姓名，年龄，地址，出生日期和电话号码。</p> 
 <p>此信息在应用程序的<code>web.config</code>文件中定义，ASP.NET运行时读取并使用它。这项工作是由个性化提供程序来完成的。</p> 
 <p>从用户数据中获取的用户配置文件存储在由ASP.NET创建的默认数据库中。 您可以创建自己的数据库来存储配置文件。配置文件数据定义存储在配置文件<code>web.config</code>中。</p> 
 <h2 id="h2-u793Au4F8B"><a name="示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>示例</h2>
 <p>下面创建一个ASP.Net空网站示例项目：<em>Personalization</em> ，我们希望应用程序记住用户详细信息，如姓名，地址，出生日期等。在<code>web.config</code>文件中的<code>&lt;system.web&gt;</code>元素节点下添加配置文件详细信息。</p> 
 <pre><code class="lang-xml">&lt;configuration&gt;
&lt;system.web&gt;

&lt;profile&gt;
   &lt;properties&gt;
      &lt;add name="Name" type ="String"/&gt;
      &lt;add name="Birthday" type ="System.DateTime"/&gt;

      &lt;group name="Address"&gt;
         &lt;add name="Street"/&gt;
         &lt;add name="City"/&gt;
      &lt;/group&gt;

   &lt;/properties&gt;
&lt;/profile&gt;

&lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre> 
 <p>在<code>web.config</code>文件中定义配置文件时，配置文件可以通过当前<code>HttpContext</code>中的<code>Profile</code>属性使用，也可以通过页面使用。</p> 
 <p>按照配置文件中的定义添加文本框以接受用户输入，并添加一个用于提交数据的按钮：</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201712/0712/634111203_22563.png" alt=""></p> 
 <p>更新<code>Page_load</code>事件方法以显示配置文件信息：</p> 
 <pre><code class="lang-csharp">protected void Page_Load(object sender, EventArgs e)
    {
        if (!this.IsPostBack)
        {
            ProfileCommon pc = this.Profile.GetProfile(Profile.UserName);

            if (pc != null)
            {
                this.txtname.Text = pc.Name;
                this.txtaddr.Text = pc.Address.Street;
                this.txtcity.Text = pc.Address.City;
                this.Calendar1.SelectedDate = pc.Birthday;
            }
        }
    }
</code></pre> 
 <p>为<em>提交</em>按钮编写以下处理程序，将用户数据保存到配置文件中：</p> 
 <pre><code class="lang-csharp">    protected void Button1_Click(object sender, EventArgs e)
    {
        ProfileCommon pc = this.Profile.GetProfile(Profile.UserName);

        if (pc != null)
        {
            pc.Name = this.txtname.Text;
            pc.Address.Street = this.txtaddr.Text;
            pc.Address.City = this.txtcity.Text;
            pc.Birthday = this.Calendar1.SelectedDate;

            pc.Save();
        }
    }
`
</code></pre> 
 <p>当页面首次执行时，用户需要输入信息。 但是，下次用户的详细信息会自动加载。</p> 
 <h2 id="h2-add-"><a name="add元素的属性" class="reference-link"></a><span class="header-link octicon octicon-link"></span>add元素的属性</h2>
 <p>除了已经使用的名称和类型属性之外，还有<code>&lt;add&gt;</code>元素的其他属性。下表说明了其中的一些属性：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>属性</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>name</code></td> 
    <td>属性的名称。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>type</code></td> 
    <td>默认情况下，类型是字符串，但它允许任何完全限定的类名作为数据类型。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>serializeAs</code></td> 
    <td>序列化此值时使用的格式。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>readOnly</code></td> 
    <td>只读配置文件值不能更改，默认情况下该属性为<code>false</code>。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>defaultValue</code></td> 
    <td>如果配置文件不存在或没有信息，则使用默认值。</td> 
   </tr> 
   <tr> 
    <td>6</td> 
    <td><code>allowAnonymous</code></td> 
    <td>一个布尔值，指示此属性是否可以与匿名配置文件一起使用。</td> 
   </tr> 
   <tr> 
    <td>7</td> 
    <td><code>Provider</code></td> 
    <td>应该用来管理这个属性的配置文件提供程序。</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 id="h2-u533Fu540Du4E2Au6027u5316"><a name="匿名个性化" class="reference-link"></a><span class="header-link octicon octicon-link"></span>匿名个性化</h2>
 <p>匿名个性化允许用户在识别自己之前个性化网站。 例如，Amazon.com允许用户在登录前添加购物车中的物品。要启用此功能，可以将<code>web.config</code>文件配置为：</p>   
 <pre><code class="lang-xml">&lt;anonymousIdentification enabled ="true" cookieName=".ASPXANONYMOUSUSER"
   cookieTimeout="120000" cookiePath="/" cookieRequiresSSL="false"
   cookieSlidingExpiration="true" cookieprotection="Encryption"
   coolieless="UseDeviceProfile"/&gt;
</code></pre>
 <br>      
</div></body></html>
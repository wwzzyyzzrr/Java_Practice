<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Yii数据访问对象</h1><div style="width:100%;float:left;" class="article-content">   
 <div>
   要执行一个SQL查询，应该遵循以下步骤&nbsp;- 
 </div> 
 <div> 
  <ul> 
   <li> 
    <div>
      创建一个&nbsp;yii\db\Command&nbsp;的&nbsp;SQL查询命令 
    </div> </li> 
   <li> 
    <div>
      绑定参数(非必须) 
    </div> </li> 
   <li> 
    <div>
      执行命令 
    </div> </li> 
  </ul> 
  <div>
    第1步&nbsp;-&nbsp;创建一个&nbsp;actionTestDb()方法在&nbsp;SiteController&nbsp;控制器中。 
  </div> 
  <pre>public function actionTestDb(){
   // return a set of rows. each row is an associative array of column names and values.
   // an empty array is returned if the query returned no results
   $users = Yii::$app-&gt;db-&gt;createCommand('SELECT * FROM user LIMIT 5')
      -&gt;queryAll();
   var_dump($users); echo '&lt;hr/&gt;';
   // return a single row (the first row)
   // false is returned if the query has no result
   $user = Yii::$app-&gt;db-&gt;createCommand('SELECT * FROM user WHERE id=1')
      -&gt;queryOne();
   var_dump($user);echo '&lt;hr/&gt;';
   // return a single column (the first column)
   // an empty array is returned if the query returned no results
   $userName = Yii::$app-&gt;db-&gt;createCommand('SELECT name FROM user')
      -&gt;queryColumn();
   var_dump($userName); echo '&lt;hr/&gt;';
   // return a scalar value
   // false is returned if the query has no result
   $count = Yii::$app-&gt;db-&gt;createCommand('SELECT COUNT(*) FROM user')
      -&gt;queryScalar();
   var_dump($count);
}</pre> 
  <div>
    上述例子演示从一个数据库中获取数据的几种方法。 
  </div> 
  <div>
    第2步&nbsp;-&nbsp;在浏览器打开URL地址：
   <a target="_blank" href="http://localhost:8080/index.php?r=site/test-db">http://localhost:8080/index.php?r=site/test-db</a>&nbsp;，会看到输出如下图所示。
   <br> 
   <img src="/uploads/tutorial/20160604/1-160604145540N2.png" width="724" height="451" title="Yii数据访问对象" alt="Yii数据访问对象">
   <br> 
   <h2> 
    <div>
      创建一个&nbsp;SQL命令 
    </div> </h2> 
   <div>
     要创建使用参数的&nbsp;SQL&nbsp;命令，应该始终使用绑定参数的方法来防止SQL注入攻击。 
   </div> 
   <div>
     第1步&nbsp;-&nbsp;修改&nbsp;actionTestDb()&nbsp;方法使用以以下的方式。 
   </div> 
   <pre>public function actionTestDb() {
   $firstUser = Yii::$app-&gt;db-&gt;createCommand('SELECT * FROM user WHERE id = :id')
      -&gt;bindValue(':id', 1)
      -&gt;queryOne();
   var_dump($firstUser);echo '&lt;hr/&gt;';
   $params = [':id' =&gt; 2, ':name' =&gt; 'User2'];
   $secondUser = Yii::$app-&gt;db-&gt;createCommand('SELECT * FROM user WHERE
      id = :id AND name = :name')
      -&gt;bindValues($params)
      -&gt;queryOne();
   var_dump($secondUser);echo '&lt;hr/&gt;';
      //another approach
   $params = [':id' =&gt; 3, ':name' =&gt; 'User3'];
   $thirdUser = Yii::$app-&gt;db-&gt;createCommand('SELECT * FROM user WHERE
      id = :id AND name = :name', $params)
      -&gt;queryOne();
   var_dump($thirdUser);
}</pre> 
   <p> 在上面的代码中 -&nbsp; </p> 
   <ul> 
    <li> <p style="text-align:justify;"> bindValue()&nbsp;− 绑定单个参数值 </p> </li> 
    <li> <p style="text-align:justify;"> bindValues()&nbsp;−&nbsp;绑定多个参数值 </p> </li> 
   </ul> 
   <div>
     第2步&nbsp;-&nbsp;在浏览器打开URL地址：
    <a target="_blank" href="http://localhost:8080/index.php?r=site/test-db">http://localhost:8080/index.php?r=site/test-db</a>&nbsp;，会看到输出如下图所示。
    <br> 
    <img src="/uploads/tutorial/20160604/1-160604154G5948.png" alt="">
    <br> 
   </div> 
   <h3> INSERT, UPDATE 和 DELETE 查询 </h3> 
   <div>
     对于INSERT，UPDATE和DELETE查询，可调用&nbsp;insert(),&nbsp;update()&nbsp;和&nbsp;delete()&nbsp;方法。 
   </div> 
   <div>
     第1步&nbsp;-&nbsp;修改&nbsp;actionTestDb()&nbsp;方法并使用以下代码： 
   </div>   
   <pre>public function actionTestDb() {
      // INSERT (table name, column values)
      Yii::$app-&gt;db-&gt;createCommand()-&gt;insert('user', [
         'name' =&gt; 'My New User',
         'email' =&gt; 'mynewuser@gmail.com',
      ])-&gt;execute();
      $user = Yii::$app-&gt;db-&gt;createCommand('SELECT * FROM user WHERE name = :name')
         -&gt;bindValue(':name', 'My New User')
         -&gt;queryOne();
      var_dump($user);echo '&lt;hr/&gt;';
      // UPDATE (table name, column values, condition)
      Yii::$app-&gt;db-&gt;createCommand()-&gt;update('user', ['name' =&gt; 'My New User
         Updated'], 'name = "My New User"')-&gt;execute();
      $user = Yii::$app-&gt;db-&gt;createCommand('SELECT * FROM user WHERE name = :name')
         -&gt;bindValue(':name', 'My New User Updated')
         -&gt;queryOne();
      var_dump($user);echo '&lt;hr/&gt;';
      // DELETE (table name, condition)
      Yii::$app-&gt;db-&gt;createCommand()-&gt;delete('user', 'name = "My New User
         Updated"')-&gt;execute();
      $user = Yii::$app-&gt;db-&gt;createCommand('SELECT * FROM user WHERE name = :name')
         -&gt;bindValue(':name', 'My New User Updated')
         -&gt;queryOne();
      var_dump($user);
}</pre> 
   <p style="font-family:Verdana, Geneva, Tahoma,  Helvetica, text-align:justify;font-size:15px !important;background-color:inherit;"> <strong>第2步</strong>&nbsp;-&nbsp;在浏览器打开URL地址：http://localhost:8080/index.php?r=site/test-db，会看到输出如下图所示。 </p> 
  </div> 
  <div style="font-family:微软雅黑;font-size:14px;background-color:#FFFFFF;"> 
   <img src="http://www.yiibai.com/uploads/tutorial/20160604/1-16060415463HN.png" alt="">
   <br> 
  </div> 
 </div>
 <br>      
</div></body></html>
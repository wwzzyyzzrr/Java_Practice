<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Yii数据排序</h1><div style="width:100%;float:left;" class="article-content">   
 <div>
   在显示大量的数据时，我们往往需要对数据进行排序。Yii中使用&nbsp;yii\data\Sort&nbsp;对象来表示一个排序模式。 
 </div> 
 <div> 
  <div> 
   <div>
     在动作中显示数据排序。
    <br> 
    <h2> 
     <div>
       准备数据库 
     </div> </h2> 
    <div>
      第1步-&nbsp;创建一个新的数据库。数据库可以通过以下两种方式来准备(或使用其它可视化图形界面创建数据库)。 
    </div> 
    <ul> 
     <li> <p style="text-align:justify;"> 在终端运行：&nbsp;mysql -u root -p </p> </li> 
     <li> <p style="text-align:justify;"> 创建一个新的数据库&nbsp;CREATE DATABASE mystudy CHARACTER SET utf8 COLLATE utf8_general_ci; </p> </li> 
    </ul> 
    <p> 第2步-&nbsp;在&nbsp;config/db.php&nbsp;文件配置数据库连接。目前使用的系统使用下面的配置(这里没有密码)。 </p> 
    <pre>&lt;?php
   return [
      'class' =&gt; 'yii\db\Connection',
      'dsn' =&gt; 'mysql:host = localhost;dbname = mystudy',
      'username' =&gt; 'root',
      'password' =&gt; '',
      'charset' =&gt; 'utf8',
   ];
?&gt;&nbsp;</pre> 
    <p> 第3步&nbsp;-&nbsp;在项目根文件夹执行：yii migrate/create test_table 。此命令将用于创建管理数据库数据库迁移。&nbsp;migrations文件会出现在项目的根的&nbsp;migrations&nbsp;文件夹中。<br> <img src="http://www.yiibai.com/uploads/tutorial/20160531/1-160531220T1153.png" alt=""> </p> 
    <div>
      第4步&nbsp;-&nbsp;修改迁移文件(在本示例中生成的是：m160529_014611_test_table.php )，并使用以下代码。 
    </div> 
    <pre>&lt;?php
   use yii\db\Schema;
   use yii\db\Migration;
   class m160529_014611_test_table extends Migration {
      public function up() {
         $this-&gt;createTable("user", [
            "id" =&gt; Schema::TYPE_PK,
            "name" =&gt; Schema::TYPE_STRING,
            "email" =&gt; Schema::TYPE_STRING,
         ]);
         $this-&gt;batchInsert("user", ["name", "email"], [
            ["User1", "user11@gmail.com"],
            ["User2", "user22@gmail.com"],
            ["User3", "user33@gmail.com"],
            ["User4", "user44@gmail.com"],
            ["User5", "user55@gmail.com"],
            ["User6", "user66@gmail.com"],
            ["User7", "user77@gmail.com"],
            ["User8", "user88@gmail.com"],
            ["User9", "user99@gmail.com"],
            ["User10", "user1010@gmail.com"],
            ["User11", "user1111@gmail.com"],
         ]);
      }
      public function down() {
         //$this-&gt;dropTable('user');
      }
   }
?&gt;&nbsp;</pre> 
    <p> 上述迁移创建了用户表的这些字段：&nbsp;id, name 和 email.&nbsp;它还增加了一些演示用户。 </p> 
    <div>
      第5步&nbsp;-&nbsp;在项目的根目录内运行：&nbsp;yii&nbsp;migrate&nbsp; 来迁移应用到数据库。执行结果如下图所示：
     <br> 
     <img src="http://www.yiibai.com/uploads/tutorial/20160531/1-160531220ZYN.png" width="628" height="345" title="Yii数据排序" alt="Yii数据排序">
     <br> 
    </div> 
    <p> 第6步-现在，我们需要为user表创建模型。为了简便起见，我们将使用GII代码生成工具。在浏览器中打开&nbsp;url:&nbsp;<a target="_blank" href="http://localhost:8080/index.php?r=gii">http://localhost:8080/index.php?r=gii</a>&nbsp;。<br> 然后，点击&nbsp;“Model&nbsp;generator”&nbsp;下的&nbsp;“Start”按钮。&nbsp;填写表名(“user”)和模型类(“MyUser”)，单击“Preview”按钮，最后点击&nbsp;“Generate”&nbsp;按钮。 </p> 
    <img src="http://www.yiibai.com/uploads/tutorial/20160531/1-16053122093W50.png" alt="">
    <br> 向下拉到底，如下图所示：
    <br> 
    <div style="font-family:&quot;color:#535B60;"> 
     <img src="http://www.yiibai.com/uploads/tutorial/20160531/1-160531221153961.png" alt="">
     <br> MyUser 文件忆经生成在&nbsp;models&nbsp;目录。 
    </div> 
    <br> 
   </div> 
   <h2> 
    <div>
      在动中的排序 
    </div> </h2> 
   <div>
     第1步&nbsp;-&nbsp;添加&nbsp;actionSorting&nbsp;方法到 SiteController。 
   </div>   
   <pre>public function actionSorting() {
   //declaring the sort object
   $sort = new Sort([
      'attributes' =&gt; ['id', 'name', 'email'], 
   ]);
   //retrieving all users
   $models = MyUser::find()
      -&gt;orderBy($sort-&gt;orders)
      -&gt;all();
   return $this-&gt;render('sorting', [
      'models' =&gt; $models,
      'sort' =&gt; $sort,
   ]);
}</pre> 
   <div>
     第2步&nbsp;-&nbsp;在文件夹&nbsp;views/site&nbsp;内创建一个&nbsp;sorting.php&nbsp;视图文件。 
   </div> 
   <pre>&lt;?php
   // display links leading to sort actions
   echo $sort-&gt;link('id') . ' | ' . $sort-&gt;link('name') . ' | ' . $sort-&gt;link('email');
?&gt;&lt;br/&gt;
&lt;?php foreach ($models as $model): ?&gt;
   &lt;?= $model-&gt;id; ?&gt;
   &lt;?= $model-&gt;name; ?&gt;
   &lt;?= $model-&gt;email; ?&gt;
   &lt;br/&gt;
&lt;?php endforeach; ?&gt;</pre> 
   <div>
     第3步&nbsp;-&nbsp;现在打开浏览器访问URL：
    <a target="_blank" href="http://localhost:8080/index.php?r=site/sorting">http://localhost:8080/index.php?r=site/sorting</a>&nbsp;，可以看到ID，名称和电子邮件字段的排序如下图所示。 
   </div> 
  </div> 
  <div> 
   <img src="/uploads/tutorial/20160531/1-160531221QaQ.png" width="649" height="496" title="Yii数据排序" alt="Yii数据排序">
   <br> 
  </div> 
 </div>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Yii授权</h1><div style="width:100%;float:left;" class="article-content">   
 <div>
   验证的用户具有足够的权限做一些事情的过程称为授权。Yii 提供了ACF(访问控制过滤器)，一个授权方法它实现了&nbsp;yii\filters\AccessControl。 
 </div> 
 <div> 
  <div>
    修改&nbsp;SiteController&nbsp;中的&nbsp;behaviors()&nbsp;函数，如下实现代码 - 
  </div> 
  <pre>public function behaviors() {
   return [
      'access' =&gt; [
         'class' =&gt; AccessControl::className(),
         'only' =&gt; ['about', 'contact'],
         'rules' =&gt; [
            [
               'allow' =&gt; true,
               'actions' =&gt; ['about'],
               'roles' =&gt; ['?'],
            ],
            [
               'allow' =&gt; true,
               'actions' =&gt; ['contact', 'about'],
               'roles' =&gt; ['@'],
            ],
         ],
      ],
   ];
}</pre> 
  <div>
    在上面的代码中，ACF被连接作为一个行为。只有属性指定ACF应该只适用于&nbsp;about&nbsp;和&nbsp;contact&nbsp;的动作。其他动作不会受到访问控制。rules&nbsp;属性列出访问的规则。所有游客用户(使用&nbsp;“?”&nbsp;角色)将被允许访问&nbsp;about&nbsp;动作(方法)。 
  </div> 
  <div>
    所有身份验证的用户(使用&nbsp;“@”&nbsp;角色)将被允许访问&nbsp;contact&nbsp;和&nbsp;about&nbsp;动作。 
  </div> 
  <div>
    如果打开URL：
   <a target="_blank" href="http://localhost:8080/index.php?r=site/about">http://localhost:8080/index.php?r=site/about</a>&nbsp;，会看到关于页面； 
  </div> 
  <div>
    如果打开URL：&nbsp;
   <a target="_blank" href="http://localhost:8080/index.php?r=site/contact">http://localhost:8080/index.php?r=site/contact</a>&nbsp;， 
  </div> 
  <div>
    将会被重定向到登录页面，因为只有合法的用户才能访问&nbsp;contact&nbsp;方法(动作)。 
  </div> 
  <div>
    访问规则支持以下选项&nbsp;-&nbsp; 
  </div> 
  <ul> 
   <li> <p style="text-align:justify;"> allow&nbsp;−&nbsp;定义是否是一个"allow" 或 "deny"规则 </p> </li> 
   <li> <p style="text-align:justify;"> actions&nbsp;−&nbsp;定义此规则匹配哪些动作 </p> </li> 
   <li> <p style="text-align:justify;"> controllers&nbsp;−&nbsp;定义此规则匹配哪些控制器 </p> </li> 
   <li> <p style="text-align:justify;"> roles&nbsp;−&nbsp;定义用户角色匹配此规则。两个特殊角色被识别 - </p> 
    <ul> 
     <li> <p style="text-align:justify;"> ?&nbsp;−&nbsp;guest用户相匹配 </p> </li> 
     <li> <p style="text-align:justify;"> @&nbsp;−&nbsp;通过认证的用户相匹配 </p> </li> 
    </ul> </li> 
   <li> <p style="text-align:justify;"> ips&nbsp;−&nbsp;定义此规则匹配 IP 地址 </p> </li> 
   <li> <p style="text-align:justify;"> verbs&nbsp;−&nbsp;定义请求方法(POST，GET，PUT等)的规则匹配 </p> </li> 
   <li> <p style="text-align:justify;"> matchCallback&nbsp;−&nbsp;定义一个PHP回调函数调用以检查是否应适用于这一规则 </p> </li> 
   <li> <p style="text-align:justify;"> denyCallback&nbsp;−&nbsp;定义一个PHP回调函数，此规则拒绝访问时调用 </p> </li> 
  </ul> 
  <h2> 密码 </h2> 
  <div>
    第1步&nbsp;-&nbsp;Yii 使用密码时提供以下处理方法，如下代码所示： 
  </div>   
  <pre>public function actionAuth() {

   $password = "123456";
   
   //generates password hasg
   $hash = Yii::$app-&gt;getSecurity()-&gt;generatePasswordHash($password);
   var_dump($hash);echo '&lt;br/&gt;';
   
   //validates password hash
   if (Yii::$app-&gt;getSecurity()-&gt;validatePassword($password, $hash)) {
      echo "correct password";
   } else {
      echo "incorrect password";
   }
   
   //generate a token
   $key = Yii::$app-&gt;getSecurity()-&gt;generateRandomString();
   var_dump($key);echo '&lt;br/&gt;';
   
   //encrypt data with a secret key
   $encryptedData = Yii::$app-&gt;getSecurity()-&gt;encryptByPassword("mydata", $key);
   var_dump($encryptedData);
   
   //decrypt data with a secret key
   $data = Yii::$app-&gt;getSecurity()-&gt;decryptByPassword($encryptedData, $key);
   var_dump($data);echo '&lt;br/&gt;';
   
   //hash data with a secret key
   $data = Yii::$app-&gt;getSecurity()-&gt;hashData("mygenuinedata", $key);
   var_dump($data); echo '&lt;br/&gt;';
   
   //validate data with a secret key
   $data = Yii::$app-&gt;getSecurity()-&gt;validateData($data, $key);
   var_dump($data);
}</pre> 
  <div>
    第2步&nbsp;-&nbsp;输入URL&nbsp;
   <a target="_blank" href="http://localhost:8080/index.php?r=site/auth">http://localhost:8080/index.php?r=site/auth</a>&nbsp;，&nbsp;会看到下面结果：
   <br> 
   <img src="/uploads/tutorial/20160606/1-160606203315510.png" width="625" height="292" title="Yii授权" alt="Yii授权">
   <br> 
  </div> 
 </div>
 <br>      
</div></body></html>
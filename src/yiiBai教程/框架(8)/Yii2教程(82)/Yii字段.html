<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Yii字段</h1><div style="width:100%;float:left;" class="article-content">   
 <div>
   通过覆盖&nbsp;fields()&nbsp;和&nbsp;extraFields()&nbsp;方法，可以定义一些数据放入回应中。这两种方法之间的差别在于，前者定义了默认设置的字段，包函在响应中；而后者如果最终用户的请求通过扩展查询参数，之后可以在响应包函附加字段。 
 </div> 
 <div> 
  <div>
    第1步&nbsp;-&nbsp;修改 models/MyUser.php 并使用以下代码： 
  </div> 
  <pre>&lt;?php
   namespace app\models;
   use app\components\UppercaseBehavior;
   use Yii;
   /**
   * This is the model class for table "user".
   *@property integer $id
   * @property string $name
   * @property string $email
   */
   class MyUser extends \yii\db\ActiveRecord {
      public function fields() {
         return [
            'id',
            'name',
            //PHP callback
            'datetime' =&gt; function($model) {
               return date("Y-m-d H:i:s");
            }
         ];
      }
      /**
      * @inheritdoc
      */
      public static function tableName() {
         return 'user';
      }
      /**
      * @inheritdoc
      */
      public function rules() {
         return [
            [['name', 'email'], 'string', 'max' =&gt; 255]
         ];
      }
      /**
      * @inheritdoc
      */
      public function attributeLabels() {
         return [
            'id' =&gt; 'ID',
            'name' =&gt; 'Name',
            'email' =&gt; 'Email',
         ];
      }
   }
?&gt;</pre> 
  <div>
    除了默认的字段：id 和 name，这增加了一个自定义字段&nbsp;-&nbsp;datetime。 
  </div> 
  <div>
    第2步&nbsp;-&nbsp;在&nbsp;Postman，运行通过URL&nbsp;：
   <a target="_blank" href="http://localhost:8080/users">http://localhost:8080/users</a>&nbsp; 
  </div> 
  <img src="/uploads/tutorial/20160604/1-16060421192S48.png" width="863" height="641" title="Yii字段" alt="Yii字段">
  <br> 
  <div>
    第3步&nbsp;-&nbsp;现在，修改用户模型：models/MyUser.php 并使用以下代码： 
  </div> 
  <pre>&lt;?php
   namespace app\models;
   use app\components\UppercaseBehavior;
   use Yii;
   /**
   * This is the model class for table "user".
   *
   * @property integer $id
   * @property string $name
   * @property string $email
   */
   class MyUser extends \yii\db\ActiveRecord {
      public function fields() {
         return [
            'id',
            'name',
         ];
      }
      public function extraFields() {
         return ['email'];
      }
      /**
      * @inheritdoc
      */
      public static function tableName() {
         return 'user';
      }
      /**
      * @inheritdoc
      */
      public function rules() { 
         return [
            [['name', 'email'], 'string', 'max' =&gt; 255]
         ];
      }
      /**
      * @inheritdoc
      */
      public function attributeLabels() { 
         return [
            'id' =&gt; 'ID',
            'name' =&gt; 'Name',
            'email' =&gt; 'Email',
         ];
      }
   } 
?&gt;</pre> 
  <div>
    请注意，email&nbsp;字段是由&nbsp;extraFields()方法返回。 
  </div> 
  <div>
    第4步&nbsp;-&nbsp;要获取此字段的数据，运行：
   <a target="_blank" href="http://localhost:8080/users?expand=email">http://localhost:8080/users?expand=email</a>&nbsp;如下结果： 
  </div> 
  <img src="/uploads/tutorial/20160604/1-160604212004611.png" alt="">
  <br> 
  <h2> 自定义操作 </h2> 
  <div>
    yii\rest\ActiveController&nbsp;类提供了以下操作(动作)&nbsp;- 
  </div> 
  <ul> 
   <li> <p style="text-align:justify;"> Index&nbsp;−&nbsp;逐页列出资源 </p> </li> 
   <li> <p style="text-align:justify;"> View&nbsp;−&nbsp;返回指定资源的详细信息 </p> </li> 
   <li> <p style="text-align:justify;"> Create&nbsp;− 创建一个新的资源 </p> </li> 
   <li> <p style="text-align:justify;"> Update&nbsp;−&nbsp;更新一个已存在的资源 </p> </li> 
   <li> <p style="text-align:justify;"> Delete&nbsp;−&nbsp;删除指定的资源 </p> </li> 
   <li> <p style="text-align:justify;"> Options&nbsp;−&nbsp;返回支持的HTTP方法 </p> </li> 
  </ul> 
  <div>
    以上所有动作在&nbsp;method()&nbsp;方法中声明。 
  </div> 
  <div>
    要禁用&nbsp;“delete”&nbsp;和&nbsp;“create”&nbsp;的动作，修改&nbsp;UserController.php&nbsp;并使用以下代码&nbsp;- 
  </div>   
  <pre>&lt;?php
   namespace app\controllers;
   use yii\rest\ActiveController;
   class UserController extends ActiveController {
      public $modelClass = 'app\models\MyUser';
      public function actions() {
         $actions = parent::actions();
         // disable the "delete" and "create" actions
         unset($actions['delete'], $actions['create']);
         return $actions;
      }
   }
?&gt;</pre> 
  <h2> 错误处理 </h2> 
  <div>
    当获得一个RESTful&nbsp;API请求，如果该请求错误或出现一些意想不到的东西在服务器上发生，可以简单地抛出一个异常。 
  </div> 
  <div>
    如果能找出错误的原因，应该使用一个适当的&nbsp;HTTP&nbsp;状态码来抛出异常。&nbsp; 
  </div> 
  <div>
    Yii&nbsp;REST&nbsp;使用以下状态&nbsp;- 
  </div> 
  <ul> 
   <li> <p style="text-align:justify;"> 200&nbsp;− OK/正常完成 </p> </li> 
   <li> <p style="text-align:justify;"> 201&nbsp;−&nbsp;一个资源成功创建用来响应POST请求。&nbsp;Location头包含一个指向新创建资源的URL。 </p> </li> 
   <li> <p style="text-align:justify;"> 204&nbsp;−&nbsp;请求被成功处理并响应但不包含内容 </p> </li> 
   <li> <p style="text-align:justify;"> 304&nbsp;−&nbsp;资源没有被修改 </p> </li> 
   <li> <p style="text-align:justify;"> 400&nbsp;−&nbsp;错误的请求 </p> </li> 
   <li> <p style="text-align:justify;"> 401&nbsp;−&nbsp;验证失败 </p> </li> 
   <li> <p style="text-align:justify;"> 403&nbsp;−&nbsp;通过身份验证的用户不允许访问指定的API端点 </p> </li> 
   <li> <p style="text-align:justify;"> 404&nbsp;−&nbsp;资源不存在 </p> </li> 
   <li> <p style="text-align:justify;"> 405&nbsp;−&nbsp;不被允许的方法 </p> </li> 
   <li> <p style="text-align:justify;"> 415&nbsp;−&nbsp;不支持的媒体类型 </p> </li> 
   <li> <p style="text-align:justify;"> 422&nbsp;−&nbsp;数据验证失败 </p> </li> 
   <li> <p style="text-align:justify;"> 429&nbsp;−&nbsp;过多的请求 </p> </li> 
   <li> <p style="text-align:justify;"> 500&nbsp;−&nbsp;内部服务器错误 </p> </li> 
  </ul> 
 </div>
 <br>      
</div></body></html>
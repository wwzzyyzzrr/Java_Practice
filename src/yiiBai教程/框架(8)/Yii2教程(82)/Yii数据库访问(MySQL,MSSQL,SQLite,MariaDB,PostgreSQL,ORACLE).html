<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Yii数据库访问(MySQL,MSSQL,SQLite,MariaDB,PostgreSQL,ORACLE)</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    Yii&nbsp;DAO(数据库访问对象)提供了访问数据库的API。Yii可访问
   <span>数据库</span>(MySQL,MSSQL,SQLite,MariaDB,PostgreSQL,ORACLE)。它也可作为其他数据库访问方法的基础：活动记录和查询生成器。 
  </div> 
 </div> 
 <div> 
  <div>
    Yii&nbsp;DAO支持以下数据库&nbsp;- 
  </div> 
  <ul> 
   <li> MySQL </li> 
   <li> MSSQL </li> 
   <li> SQLite </li> 
   <li> MariaDB </li> 
   <li> PostgreSQL </li> 
   <li> ORACLE </li> 
   <li> CUBRID </li> 
  </ul> 
  <h2> 
   <div>
     创建数据库连接 
   </div> </h2> 
  <div>
    第1步&nbsp;-&nbsp;创建一个数据库连接，需要创建&nbsp;yii\db\Connection&nbsp;类的一个实例。 
  </div> 
  <pre>$mydb = new yii\db\Connection([
   'dsn' =&gt; 'mysql:host=localhost;dbname=mydb',
   'username' =&gt; 'username',
   'password' =&gt; 'password',
   'charset' =&gt; 'utf8',
]);</pre> 
  <div style="background-color:inherit;">
    一般的做法是在应用程序组件内部配置数据库连接。例如，在基本的应用程序模板数据库连接配置位于&nbsp;config/db.php&nbsp;文件中，如下面的代码。 
  </div> 
  <pre>&lt;?php
   return [
      'class' =&gt; 'yii\db\Connection',
      'dsn' =&gt; 'mysql:host = localhost;dbname = helloworld',
      'username' =&gt; 'vladimir',
      'password' =&gt; '123574896',
      'charset' =&gt; 'utf8',
   ];
?&gt;</pre> 
  <div style="background-color:inherit;">
    第2步&nbsp;-&nbsp;可以使用这个表达式访问数据库连接。 
  </div> 
  <pre>Yii::$app-&gt;db</pre> 
  <div>
    要配置数据库连接，则应该通过&nbsp;DSN&nbsp;属性来指定其&nbsp;DSN(数据源名称)。DSN格式是根据不同的数据库而不同的&nbsp;- 
  </div> 
  <ul> 
   <li> <p style="text-align:justify;"> <strong>MySQL, MariaDB</strong>&nbsp;− mysql:host = localhost;dbname = mydb </p> </li> 
   <li> <p style="text-align:justify;"> <strong>PostgreSQL</strong>&nbsp;− pgsql:host = localhost;port = 5432;dbname = mydb </p> </li> 
   <li> <p style="text-align:justify;"> <strong>SQLite</strong>&nbsp;− sqlite:/path/to/db/file </p> </li> 
   <li> <p style="text-align:justify;"> MS SQL Server (via sqlsrv driver)&nbsp;− sqlsrv:Server = localhost;Database = mydb </p> </li> 
   <li> <p style="text-align:justify;"> MS SQL Server (via mssql driver)&nbsp;− mssql:host = localhost;dbname = mydb </p> </li> 
   <li> <p style="text-align:justify;"> MS SQL Server (via dblib driver)&nbsp;− dblib:host = localhost;dbname = mydb </p> </li> 
   <li> <p style="text-align:justify;"> CUBRID&nbsp;− cubrid:dbname = mydb;host = localhost;port = 33000 </p> </li> 
   <li> <p style="text-align:justify;"> Oracle&nbsp;− oci:dbname = //localhost:1521/mydb </p> </li> 
  </ul> 
  <div>
    要在动作中使用数据库查询操作，我们需要准备一些数据。
   <br> 
   <h2> 
    <div>
      准备数据库 
    </div> </h2> 
   <div>
     第1步&nbsp;-&nbsp;创建一个新的数据库。数据库可以通过以下两种方式进行。 
   </div> 
   <ul> 
    <li> <p style="text-align:justify;"> 在终端运行&nbsp;mysql -u root –p </p> </li> 
    <li> <p style="text-align:justify;"> 登录数据后，通过执行&nbsp;CREATE DATABASE mystudy CHARACTER SET utf8 COLLATE utf8_general_ci;&nbsp;创建一个新的数据库; </p> </li> 
   </ul> 
   <div>
     第2步&nbsp;-&nbsp;在&nbsp;config/db.php&nbsp;文件中配置数据库连接。下面的配置可根据自己的实际情况配置。 
   </div> 
   <pre>&lt;?php
   return [
      'class' =&gt; 'yii\db\Connection',
      'dsn' =&gt; 'mysql:host = localhost;dbname = mystudy',
      'username' =&gt; 'root',
      'password' =&gt; '',
      'charset' =&gt; 'utf8',
   ];
?&gt;</pre> 
   <p> 第3步&nbsp;-&nbsp;在项目根文件夹执行：yii migrate/create test_table 。此命令将用于创建管理数据库数据库迁移。&nbsp;migrations文件会出现在项目的根的&nbsp;migrations&nbsp;文件夹中。<br> <img src="http://www.yiibai.com/uploads/tutorial/20160602/1-160602230AQ34.png" width="658" height="233" title="Yii数据库访问" alt="Yii数据库访问"> </p> 
   <div>
     第4步&nbsp;-&nbsp;修改迁移文件(在本示例中生成的是：m160529_014611_test_table.php)，并使用以下这些代码。 
   </div>   
   <pre>&lt;?php
   use yii\db\Schema;
   use yii\db\Migration;
   class m160529_014611_test_table extends Migration {
      public function up() {
         $this-&gt;createTable("user", [
            "id" =&gt; Schema::TYPE_PK,
            "name" =&gt; Schema::TYPE_STRING,
            "email" =&gt; Schema::TYPE_STRING,
         ]);
         $this-&gt;batchInsert("user", ["name", "email"], [
            ["User1", "user11@gmail.com"],
            ["User2", "user22@gmail.com"],
            ["User3", "user33@gmail.com"],
            ["User4", "user44@gmail.com"],
            ["User5", "user55@gmail.com"],
            ["User6", "user66@gmail.com"],
            ["User7", "user77@gmail.com"],
            ["User8", "user88@gmail.com"],
            ["User9", "user99@gmail.com"],
            ["User10", "user1010@gmail.com"],
            ["User11", "user1111@gmail.com"],
         ]);
      }
      public function down() {
         //$this-&gt;dropTable('user');
      }
   }
?&gt;</pre> 
   <div>
     上述迁移创建用户表，它包含了以下这些字段：id,&nbsp;name,&nbsp;和&nbsp;email。它还增加了一些演示用户帐号。 
   </div> 
   <div>
     第5步&nbsp;-&nbsp;在项目的根目录内运行：&nbsp;yii&nbsp;migrate&nbsp; 来迁移应用到数据库。执行结果如下图所示：
    <br> 
   </div> 
   <img src="http://www.yiibai.com/uploads/tutorial/20160602/1-160602230J42A.png" alt="">
   <br> 
   <p> 第6步-现在，我们需要为user表创建模型。为了简便起见，我们将使用GII代码生成工具。在浏览器中打开&nbsp;url:&nbsp;<a target="_blank" href="http://localhost:8080/index.php?r=gii">http://localhost:8080/index.php?r=gii</a>&nbsp;。<br> 然后，点击&nbsp;“Model&nbsp;generator”&nbsp;下的&nbsp;“Start”按钮。&nbsp;填写表名(“user”)和模型类(“MyUser”)，单击“Preview”按钮，最后点击&nbsp;“Generate”&nbsp;按钮。 </p> 
   <img src="http://www.yiibai.com/uploads/tutorial/20160602/1-160602230R6155.png" alt="">
   <br> 
   <div> 
    <img src="http://www.yiibai.com/uploads/tutorial/20160602/1-160602230T3554.png" alt="">
    <br> MyUser 文件忆经生成在&nbsp;models&nbsp;目录。 
   </div> 
   <br> 
  </div> 
 </div>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Yii控制器</h1><div style="width:100%;float:left;" class="article-content">   
 <div>
   控制器负责处理请求和产生响应。用户请求后，控制器将分析请求数据，将它们传递到模型，模型中获得的结果插入的视图中，并且产生一个响应。 
 </div> 
 <div> 
  <h2> 
   <div>
     理解动作 
   </div> </h2> 
  <p style="text-align:justify;"> 控制器包函动作。它们是用户请求执行的基本单位。一个控制器中可以有一个或几个动作。 </p> 
  <div>
    让我们看一下基本的应用程序&nbsp;SiteController&nbsp;的模板&nbsp;- 
  </div> 
  <pre>&lt;?php 
   namespace app\controllers; 
   use Yii; 
   use yii\filters\AccessControl; 
   use yii\web\Controller; 
   use yii\filters\VerbFilter; 
   use app\models\LoginForm; 
   use app\models\ContactForm; 
   class SiteController extends Controller { 
      public function behaviors() { 
         return [ 
            'access' =&gt; [ 
               'class' =&gt; AccessControl::className(), 
               'only' =&gt; ['logout'], 
               'rules' =&gt; [ 
                  [ 
                     'actions' =&gt; ['logout'], 
                     'allow' =&gt; true, 
                     'roles' =&gt; ['@'], 
                  ], 
               ], 
            ], 
            'verbs' =&gt; [
               'class' =&gt; VerbFilter::className(), 
               'actions' =&gt; [ 
                  'logout' =&gt; ['post'], 
               ], 
            ], 
         ]; 
      } 
      public function actions() { 
         return [ 
            'error' =&gt; [ 
               'class' =&gt; 'yii\web\ErrorAction', 
            ], 
            'captcha' =&gt; [ 
               'class' =&gt; 'yii\captcha\CaptchaAction', 
               'fixedVerifyCode' =&gt; YII_ENV_TEST ? 'testme' : null, 
            ], 
         ]; 
      } 
      public function actionIndex() { 
         return $this-&gt;render('index'); 
      } 
      public function actionLogin() { 
         if (!\Yii::$app-&gt;user-&gt;isGuest) { 
            return $this-&gt;goHome(); 
         } 
         $model = new LoginForm(); 
         if ($model-&gt;load(Yii::$app-&gt;request-&gt;post()) &amp;&amp; $model-&gt;login()) { 
            return $this-&gt;goBack(); 
         } 
         return $this-&gt;render('login', [ 
            'model' =&gt; $model, 
         ]); 
      }
      public function actionLogout() { 
         Yii::$app-&gt;user-&gt;logout();  
         return $this-&gt;goHome(); 
      } 
      public function actionContact() { 
         //load ContactForm model 
         $model = new ContactForm(); 
         //if there was a POST request, then try to load POST data into a model 
         if ($model-&gt;load(Yii::$app-&gt;request-&gt;post()) &amp;&amp; $model&gt;contact(Yii::$app-&gt;params
            ['adminEmail'])) { 
            Yii::$app-&gt;session-&gt;setFlash('contactFormSubmitted');  
            return $this-&gt;refresh(); 
         } 
         return $this-&gt;render('contact', [ 
            'model' =&gt; $model, 
         ]); 
      } 
      public function actionAbout() { 
         return $this-&gt;render('about'); 
      } 
      public function actionSpeak($message = "default message") { 
         return $this-&gt;render("speak",['message' =&gt; $message]); 
      } 
   } 
?&gt;&nbsp;</pre> 
  <p style="text-align:justify;"> 使用PHP内置服务器运行基本的应用程序模板，并在Web浏览器打开地址：<em>http://localhost:8080/index.php?r=site/contact</em>.&nbsp;您将看到以下页面输出 -<br> <img src="/uploads/tutorial/20160518/1-16051P63I0U8.png" width="799" height="556" title="Yii控制器" alt="Yii控制器"> </p> 
  <p style="text-align:justify;"> 当您打开这个页面，执行&nbsp;SiteController&nbsp;控制器的&nbsp;contact&nbsp;动作。代码首先加载&nbsp;ContactForm&nbsp;模型。然后，它会传递模型进去并渲染&nbsp;contact&nbsp;视图。 </p> 
  <img src="/uploads/tutorial/20160518/1-16051P63K3443.png" alt="">
  <br> 
  <div>
    如果您填写表格，然后点击提交按钮，将看到如下&nbsp;-
   <br> 
   <img src="/uploads/tutorial/20160518/1-16051P63SE10.png" alt="">
   <br> 
  </div> 
  <div>
    注意，提交后这一次是执行以下代码&nbsp;- 
  </div>   
  <pre>if ($model-&gt;load(Yii::$app-&gt;request-&gt;post()) &amp;&amp; $model-&gt;contact(Yii::$app&gt;params ['adminEmail'])) { 
   Yii::$app-&gt;session-&gt;setFlash('contactFormSubmitted'); 
   return $this-&gt;refresh(); 
} &nbsp;</pre> 
  <p style="text-align:justify;"> 如果有一个POST请求，我们分配POST数据到模型，并尝试发送电子邮件。如果成功的话，我们设置了快闪的消息并使用文本<span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">“<span style="color:#3C763D;font-family:'Helvetica Neue', Helvetica,  background-color:#DFF0D8;">Thank you for contacting us. We will respond to you as soon as possible.</span>“</span>并刷新页面。 </p> 
  <h2> 
   <div>
     理解路由 
   </div> </h2> 
  <p style="text-align:justify;"> 在上面的例子中，在URL =&gt;&nbsp;http://localhost:8080/index.php?r=site/contact,&nbsp;路由是&nbsp;site/contact.&nbsp;在SiteController&nbsp;中的&nbsp;contact&nbsp;动作(actionContact)将被执行。 </p> 
  <div>
    根由以下部分组成─ 
  </div> 
  <ul> 
   <li> <p style="text-align:justify;"> moduleID&nbsp;−&nbsp;如果控制器属于一个模块，则路由的模板ID这一部分会存在。 </p> </li> 
   <li> <p style="text-align:justify;"> controllerID&nbsp;(在上面的例子的 site) −&nbsp;唯一字符串标识，在同一个模块或应用程序的所有控制器中的这个名称是唯一的。 </p> </li> 
   <li> <p style="text-align:justify;"> actionID&nbsp;(在上面的例子中的 contact) −&nbsp;唯一字符串标识，在同一个控制器中的所有动作名称唯一(即类中的方法名称)。 </p> </li> 
  </ul> 
  <p style="text-align:justify;"> 路由的格式是=&gt;controllerID/actionID.&nbsp;如果控制器属于一个模块，那么它具有以下格式：moduleID/controllerID/actionID. </p> 
  <p style="text-align:justify;"> <br> </p> 
 </div>
 <br>      
</div></body></html>
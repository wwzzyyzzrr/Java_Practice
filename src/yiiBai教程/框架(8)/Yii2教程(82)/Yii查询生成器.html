<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Yii查询生成器</h1><div style="width:100%;float:left;" class="article-content">   
 <div>
   查询生成器允许以编程的方式来创建&nbsp;SQL&nbsp;查询。&nbsp;QueryBuilder帮助您编写更加易读的&nbsp;SQL&nbsp;相关的代码。 
 </div> 
 <div> 
  <div>
    要使用查询生成器，应该遵循以下步骤&nbsp;- 
  </div> 
  <ul> 
   <li> 
    <div>
      构造一个&nbsp;yii\db\Query&nbsp;对象. 
    </div> </li> 
   <li> 
    <div>
      执行&nbsp;query()&nbsp;方法 
    </div> </li> 
  </ul> 
  <div>
    要构建立一个&nbsp;yii\db\Query&nbsp;对象，应该调用不同的查询生成器函数来定义&nbsp;SQL&nbsp;查询的不同部分。 
  </div> 
  <div>
    第1步&nbsp;-&nbsp;要演示查询生成器的典型用法，修改&nbsp;actionTestDb()&nbsp;方法使用以下代码。 
  </div> 
  <pre>public function actionTestDb() {
   //generates "SELECT id, name, email FROM user WHERE name = 'User10';"
   $user = (new \yii\db\Query())
      -&gt;select(['id', 'name', 'email'])
      -&gt;from('user')
      -&gt;where(['name' =&gt; 'User10'])
      -&gt;one();
   var_dump($user);
}</pre> 
  <div>
    第2步&nbsp;-&nbsp;在浏览器打开URL地址：
   <a target="_blank" href="http://localhost:8080/index.php?r=site/test-db">http://localhost:8080/index.php?r=site/test-db</a>&nbsp;，会看到输出如下图所示。
   <br> 
   <img src="/uploads/tutorial/20160604/1-160604154931456.png" width="573" height="300" title="Yii查询生成器" alt="Yii查询生成器">
   <br> 
  </div> 
  <h2> Where()函数 </h2> 
  <div>
    在&nbsp;where()&nbsp;函数定义了一个查询的&nbsp;WHERE&nbsp;段。要指定&nbsp;WHERE&nbsp;条件，可以使用以下三种格式： 
  </div> 
  <ul> 
   <li> <p style="text-align:justify;"> string 格式&nbsp;− 'name = User10' </p> </li> 
   <li> <p style="text-align:justify;"> hash 格式&nbsp;− ['name' =&gt; 'User10', 'email =&gt; user10@gmail.com'] </p> </li> 
   <li> <p style="text-align:justify;"> operator 格式&nbsp;− ['like', 'name', 'User'] </p> </li> 
  </ul> 
  <h3> 
   <div>
     字符串格式的示例 
   </div> </h3> 
  <pre>public function actionTestDb() {
   $user = (new \yii\db\Query())
      -&gt;select(['id', 'name', 'email'])
      -&gt;from('user')
      -&gt;where('name = :name', [':name' =&gt; 'User11'])
      -&gt;one();
   var_dump($user);
}</pre> 
  <div>
    输出结果如下图所示：
   <br> 
   <img src="/uploads/tutorial/20160604/1-160604155011J1.png" width="573" height="300" title="Yii查询生成器" alt="Yii查询生成器">
   <br> 
  </div> 
  <h3> 
   <div>
     哈希格式的例子 
   </div> </h3> 
  <pre>public function actionTestDb() {
   $user = (new \yii\db\Query())
      -&gt;select(['id', 'name', 'email'])
      -&gt;from('user')
      -&gt;where([
         'name' =&gt; 'User5',
         'email' =&gt; 'user55@gmail.com'
      ])
      -&gt;one();
   var_dump($user);
}</pre> 
  <p> 输出结果如下图所示：<br> <img src="/uploads/tutorial/20160604/1-160604155133435.png" alt=""> </p> 
  <div>
    运算符格式化允许定义任意条件的格式如下&nbsp;- 
  </div> 
  <pre>[operator, operand1, operand2]</pre> 
  <div>
    操作符可以是&nbsp;- 
  </div> 
  <ul style="background-color:inherit;color:#313131;font-family:Verdana, Geneva, Tahoma,  Helvetica,;"> 
   <li style="background-color:inherit;color:#000000;"> <p style="text-align:justify;font-size:15px !important;background-color:inherit;"> <b>and</b>&nbsp;− ['and', 'id = 1', 'id = 2'] 会产生类似： id = 1 AND id = 2 </p> </li> 
   <li style="background-color:inherit;color:#000000;"> <p style="text-align:justify;font-size:15px !important;background-color:inherit;"> <b>between</b>&nbsp;− ['between', 'id', 1, 15]&nbsp;会产生类似：id BETWEEN 1 AND 15 </p> </li> 
   <li style="background-color:inherit;color:#000000;"> <p style="text-align:justify;font-size:15px !important;background-color:inherit;"> <b>not between</b>&nbsp;−&nbsp;类似&nbsp;between 操作符, 但是 BETWEEN&nbsp;<span style="background-color:inherit;font-size:14px;line-height:1.5;">被替换为</span><span style="background-color:inherit;line-height:1.5;">&nbsp;NOT BETWEEN</span> </p> </li> 
   <li style="background-color:inherit;color:#000000;"> <p style="text-align:justify;font-size:15px !important;background-color:inherit;"> <b>in</b>&nbsp;− ['in', 'id', [5,10,15]]&nbsp;会产生类似：&nbsp;IN (5,10,15) </p> </li> 
   <li style="background-color:inherit;color:#000000;"> <p style="text-align:justify;font-size:15px !important;background-color:inherit;"> <b>not in</b>&nbsp;−&nbsp;类似&nbsp;&nbsp;in&nbsp;操作符,但是&nbsp;IN&nbsp;<span style="font-size:14px;">被替换为</span>&nbsp;NOT IN </p> </li> 
   <li style="background-color:inherit;color:#000000;"> <p style="text-align:justify;font-size:15px !important;background-color:inherit;"> <b>like</b>&nbsp;− ['like', 'name', 'user']&nbsp;会产生类似：&nbsp;name LIKE '%user%' </p> </li> 
   <li style="background-color:inherit;color:#000000;"> <p style="text-align:justify;font-size:15px !important;background-color:inherit;"> <b>or like</b>&nbsp;−&nbsp;类似&nbsp;<span style="background-color:inherit;">&nbsp;like&nbsp;</span>操作符,<span style="background-color:inherit;">&nbsp;</span>但是&nbsp;<span style="background-color:inherit;font-size:14px;line-height:1.5;">OR&nbsp;用来分割&nbsp;LIKE&nbsp;谓词</span> </p> </li> 
   <li style="background-color:inherit;color:#000000;"> <p style="text-align:justify;font-size:15px !important;background-color:inherit;"> <b>not like</b>&nbsp;−&nbsp;<span style="background-color:inherit;font-size:14px;line-height:1.5;">类似于&nbsp;like&nbsp;操作符,&nbsp;但是&nbsp;LIKE&nbsp;被&nbsp;NOT&nbsp;LIKE&nbsp;替代；&nbsp;</span> </p> </li> 
   <li style="background-color:inherit;color:#000000;"> <p style="text-align:justify;font-size:15px !important;background-color:inherit;"> <b>or not like</b>&nbsp;−&nbsp;<span style="background-color:inherit;font-size:14px;line-height:1.5;">类似&nbsp;not&nbsp;like&nbsp;运算符，但或用来连接&nbsp;NOT&nbsp;LIKE&nbsp;谓词</span> </p> </li> 
   <li style="background-color:inherit;color:#000000;"> <p style="text-align:justify;font-size:15px !important;background-color:inherit;"> <b>exists</b>&nbsp;−&nbsp;<span style="background-color:inherit;font-size:14px;line-height:1.5;">要求一个操作数必须是&nbsp;yii\db\Query&nbsp;类的一个实例</span> </p> </li> 
   <li style="background-color:inherit;color:#000000;"> <p style="text-align:justify;font-size:15px !important;background-color:inherit;"> <b>not exists</b>&nbsp;−&nbsp;<span style="background-color:inherit;font-size:14px;line-height:1.5;">类似&nbsp;exists&nbsp;操作符，但是构建了一个NOT&nbsp;EXISTS(子查询)的表达式</span> </p> </li> 
   <li style="background-color:inherit;color:#000000;"> <p style="text-align:justify;font-size:15px !important;background-color:inherit;"> <b>&lt;, &lt;=, &gt;, &gt;=,</b>&nbsp;<span style="background-color:inherit;font-size:14px;line-height:1.5;">或任何其他数据库操作符</span><span style="background-color:inherit;line-height:1.5;">: ['&lt;', 'id', 10]&nbsp;</span><span style="line-height:1.5;">会产生类似：</span><span style="background-color:inherit;line-height:1.5;">&nbsp;id&lt;10</span> </p> </li> 
  </ul> 
  <h3> 
   <div>
     操作符格式示例&nbsp;- 
   </div> </h3>   
  <pre>public function actionTestDb() {
   $users = (new \yii\db\Query())
      -&gt;select(['id', 'name', 'email'])
      -&gt;from('user')
      -&gt;where(['between', 'id', 5, 7])
      -&gt;all();
   var_dump($users);
}</pre> 
  <p> 输出结果如下图所示：<br> <img src="/uploads/tutorial/20160604/1-1606041552054T.png" alt=""> </p> 
  <h2> OrderBy()函数 </h2> 
  <div>
    在 orderBy() 函数中定义了&nbsp;ORDER&nbsp;BY&nbsp;段。 
  </div> 
  <p> 如下示例&nbsp;− </p> 
  <pre>public function actionTestDb() {
   $users = (new \yii\db\Query())
      -&gt;select(['id', 'name', 'email'])
      -&gt;from('user')
      -&gt;orderBy('name DESC')
      -&gt;all();
   var_dump($users);
}</pre> 
  <p> 输出结果如下图所示：<br> <img src="/uploads/tutorial/20160604/1-16060415522HC.png" alt=""> </p> 
  <h2> groupBy()函数 </h2> 
  <div>
    groupBy()函数定义了&nbsp;GROUP&nbsp;BY&nbsp;段，having()方法指定&nbsp;HAVING&nbsp;段。 
  </div> 
  <p> 如下示例&nbsp;− </p> 
  <pre>public function actionTestDb() {
   $users = (new \yii\db\Query())
      -&gt;select(['id', 'name', 'email'])
      -&gt;from('user')
      -&gt;groupBy('name')
      -&gt;having('id &lt; 5')
      -&gt;all();
   var_dump($users);
}</pre> 
  <p> 输出结果如下图所示：<br> <img src="/uploads/tutorial/20160604/1-1606041553041Q.png" alt=""> </p> 
  <div>
    limit()&nbsp;和&nbsp;offset()&nbsp;方法定义了&nbsp;LIMIT&nbsp;和&nbsp;OFFSET&nbsp;段。 
  </div> 
  <p> 如下示例&nbsp;− </p> 
  <pre>public function actionTestDb() {
   $users = (new \yii\db\Query())
      -&gt;select(['id', 'name', 'email'])
      -&gt;from('user')
      -&gt;limit(5)
      -&gt;offset(5)
      -&gt;all();
   var_dump($users);
}</pre> 
  <p> 输出结果如下图所示：<br> <img src="/uploads/tutorial/20160604/1-1606041553261Y.png" alt=""> </p> 
  <div>
    yii\db\Query&nbsp;类提供了一组用于不同的目的的方法&nbsp;- 
  </div> 
  <ul> 
   <li> <p style="text-align:justify;"> all()&nbsp;−&nbsp;返回一行为名称-值对的数组。 </p> </li> 
   <li> <p style="text-align:justify;"> one()&nbsp;− 返回第一行 </p> </li> 
   <li> <p style="text-align:justify;"> column()&nbsp;− 返回第一列 </p> </li> 
   <li> <p style="text-align:justify;"> scalar()&nbsp;−&nbsp;返回结果的第一行和第一列的标量值。 </p> </li> 
   <li> <p style="text-align:justify;"> exists()&nbsp;−&nbsp;返回指示查询是否包含任何结果值 </p> </li> 
   <li> <p style="text-align:justify;"> count()&nbsp;返回COUNT查询结果 </p> </li> 
   <li> 
    <div>
      其他聚集查询方法&nbsp;-&nbsp;包括：sum($q),&nbsp;average($q),&nbsp;max($q),&nbsp;min($q)。$q&nbsp;参数可以是列名&nbsp;或&nbsp;DB&nbsp;表达式。 
    </div> </li> 
  </ul> 
 </div>
 <br>      
</div></body></html>
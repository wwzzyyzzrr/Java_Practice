<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Yii响应</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    当一个Web应用程序处理请求时，它会产生一个响应对象，其中包含HTTP头，body，HTTP状态代码。在大多数情况下使用响应应用程序组件。默认情况下，它是&nbsp;yii\web\Response&nbsp;的一个实例。 
  </div> 
 </div> 
 <div> 
  <p style="text-align:justify;"> 要管理响应HTTP状态代码，使用yii\web\Response::$statusCode&nbsp;属性。yii\web\Response::$statusCode的默认值是200。 </p> 
  <div>
    第1步&nbsp;-&nbsp;添加一个 actionTestResponse 方法在 SiteController&nbsp;控制器中。 
  </div> 
  <pre>public function actionTestResponse() {
   Yii::$app-&gt;response-&gt;statusCode = 201;
}&nbsp;</pre> 
  <p style="text-align:justify;"> 第2步&nbsp;-&nbsp;在浏览器打开&nbsp;http://localhost:8080/index.php?r=site/test-response,&nbsp;应该注意到了创建响应HTTP状态为201。 </p> 
  <img src="/uploads/tutorial/20160530/1-16053021424bW.png" width="904" height="259" title="Yii响应" alt="Yii响应">
  <br> 
  <div>
    如果想表示请求不成功，可抛出下面预定义的HTTP异常 - 
  </div> 
  <ul> 
   <li> <p style="text-align:justify;"> yii\web\BadRequestHttpException&nbsp;− 状态码 400. </p> </li> 
   <li> <p style="text-align:justify;"> yii\web\UnauthorizedHttpException&nbsp;−&nbsp;状态码&nbsp;&nbsp;401. </p> </li> 
   <li> <p style="text-align:justify;"> yii\web\ForbiddenHttpException&nbsp;−&nbsp;状态码&nbsp;&nbsp;403. </p> </li> 
   <li> <p style="text-align:justify;"> yii\web\NotFoundHttpException&nbsp;−&nbsp;状态码&nbsp;&nbsp;404. </p> </li> 
   <li> <p style="text-align:justify;"> yii\web\MethodNotAllowedHttpException&nbsp;−&nbsp;状态码&nbsp;&nbsp;405. </p> </li> 
   <li> <p style="text-align:justify;"> yii\web\NotAcceptableHttpException&nbsp;−&nbsp;状态码&nbsp;406. </p> </li> 
   <li> <p style="text-align:justify;"> yii\web\ConflictHttpException&nbsp;−&nbsp;状态码&nbsp;&nbsp;409. </p> </li> 
   <li> <p style="text-align:justify;"> yii\web\GoneHttpException&nbsp;−&nbsp;状态码&nbsp;&nbsp;410. </p> </li> 
   <li> <p style="text-align:justify;"> yii\web\UnsupportedMediaTypeHttpException&nbsp;−&nbsp;状态码&nbsp;&nbsp;415. </p> </li> 
   <li> <p style="text-align:justify;"> yii\web\TooManyRequestsHttpException&nbsp;−&nbsp;状态码&nbsp;&nbsp;429. </p> </li> 
   <li> <p style="text-align:justify;"> yii\web\ServerErrorHttpException&nbsp;−&nbsp;状态码&nbsp;&nbsp;500. </p> </li> 
  </ul> 
  <div>
    第3步&nbsp;-&nbsp;修改&nbsp;actionTestResponse&nbsp;函数，如下面的代码。 
  </div> 
  <pre>public function actionTestResponse() {
   throw new \yii\web\GoneHttpException;
}&nbsp;</pre> 
  <p> 第4步&nbsp;-&nbsp;在Web浏览器的地址栏中输入URL&nbsp;<a target="_blank" href="http://localhost:8080/index.php?r=site/test-response">http://localhost:8080/index.php?r=site/test-response</a>&nbsp;，可以看到如下面图中的410响应HTTP状态。<br> <img src="/uploads/tutorial/20160530/1-16053021430aL.png" alt=""> </p> 
  <p> 第5步&nbsp;- 可以通过修改响应组件的标头属性发送HTTP标头。若要将新标题添加到响应，修改&nbsp;actionTestResponse&nbsp;函数如下面给出的代码。 </p> 
  <pre>public function actionTestResponse() {
   Yii::$app-&gt;response-&gt;headers-&gt;add('Pragma', 'no-cache');
}</pre> 
  <div>
    第6步&nbsp;-&nbsp;访问&nbsp;
   <a target="_blank" href="http://localhost:8080/index.php?r=site/test-response">http://localhost:8080/index.php?r=site/test-response</a>，你会看到&nbsp;Pragma&nbsp;已经包函在头中了。
   <br> 
   <img src="/uploads/tutorial/20160530/1-16053021432Y33.png" alt="">
   <br> 
  </div> 
  <div>
    Yii 支持以下响应格式&nbsp;- 
  </div> 
  <ul> 
   <li> <p style="text-align:justify;"> HTML&nbsp;− 由 yii\web\HtmlResponseFormatter 实现 </p> </li> 
   <li> <p style="text-align:justify;"> XML&nbsp;−&nbsp;&nbsp;由&nbsp;yii\web\XmlResponseFormatter&nbsp;实现 </p> </li> 
   <li> <p style="text-align:justify;"> JSON&nbsp;−&nbsp;&nbsp;由&nbsp;yii\web\JsonResponseFormatter&nbsp;实现 </p> </li> 
   <li> <p style="text-align:justify;"> JSONP&nbsp;− 由 yii\web\JsonResponseFormatter&nbsp;实现 </p> </li> 
   <li> <p style="text-align:justify;"> RAW&nbsp;−&nbsp;不带任何格式的响应 </p> </li> 
  </ul> 
  <div>
    第7步&nbsp;-&nbsp;要以&nbsp;JSON 格式响应，修改&nbsp;actionTestResponse&nbsp;函数。 
  </div>   
  <pre>public function actionTestResponse() {
   \Yii::$app-&gt;response-&gt;format = \yii\web\Response::FORMAT_JSON;
   return [
      'id' =&gt; '1',
      'name' =&gt; 'Hippo',
      'age' =&gt; 28,
      'country' =&gt; 'China',
      'city' =&gt; 'Hainan'
   ];
}&nbsp;</pre> 
  <p> 第8步&nbsp;-&nbsp;现在输入URL =&gt;&nbsp;http://localhost:8080/index.php?r=site/test-response&nbsp;,&nbsp;可以看到下面的JSON响应。<br> <img src="/uploads/tutorial/20160530/1-160530214349136.png" alt=""> </p> 
  <p> Yii通过发送定位HTTP头实现了一个浏览器重定向。可以调用&nbsp;yii\web\Response::redirect()&nbsp;方法将用户浏览器重定向到URL。 </p> 
  <div>
    第9步&nbsp;-&nbsp;修改&nbsp;actionTestResponse&nbsp;函数如下方式。 
  </div> 
  <pre>public function actionTestResponse() {
   return $this-&gt;redirect('http://www.yiibai.com/');
}</pre> 
  <p> 现在在浏览器中打开：http://localhost:8080/index.php?r=site/test-response,&nbsp;&nbsp;浏览器将被重定向到&nbsp;<a target="_blank" href="http://www.yiibai.com/">www.yiibai.com</a>&nbsp;。 </p> 
  <h2> 
   <div>
     发送文件 
   </div> </h2> 
  <div>
    Yii提供以下方法来支持文件发送&nbsp;- 
  </div> 
  <ul> 
   <li> <p style="text-align:justify;"> yii\web\Response::sendFile()&nbsp;−&nbsp;发送现有文件 </p> </li> 
   <li> <p style="text-align:justify;"> yii\web\Response::sendStreamAsFile()&nbsp;−&nbsp;发送一个现有文件流作为文件 </p> </li> 
   <li> <p style="text-align:justify;"> yii\web\Response::sendContentAsFile()&nbsp;−&nbsp;发送一个文本字符串作为文件 </p> </li> 
  </ul> 
  <div>
    修改&nbsp;actionTestResponse&nbsp;函数使用以下方式&nbsp;- 
  </div> 
  <pre>public function actionTestResponse() {
   return \Yii::$app-&gt;response-&gt;sendFile('favicon.ico');
}</pre> 
  <p> 输入http://localhost:8080/index.php?r=site/test-response,&nbsp;将会看到 favicon.ico 文件下载的对话框窗口&nbsp;-<br> <img src="/uploads/tutorial/20160530/1-160530214413N6.png" alt=""> </p> 
  <p> 响应不会发送，直到yii\web\Response::send()&nbsp;函数被调用。默认情况下，该方法在&nbsp;yii\base\Application::run()&nbsp;方法结束后被调用。 </p> 
  <p> 要发送一个响应，yii\web\Response::send()方法的步骤如下&nbsp;- </p> 
  <ul> 
   <li> 触发 yii\web\Response::EVENT_BEFORE_SEND 事件 </li> 
   <li> 调用 yii\web\Response::prepare() 方法 </li> 
   <li> 触发&nbsp;&nbsp;yii\web\Response::EVENT_AFTER_PREPARE 事件 </li> 
   <li> 调用&nbsp;yii\web\Response::sendHeaders()&nbsp;方法 </li> 
   <li> 调用&nbsp;yii\web\Response::sendContent()&nbsp;方法 </li> 
   <li> 触发&nbsp;&nbsp;yii\web\Response::EVENT_AFTER_SEND&nbsp;事件 </li> 
  </ul> 
 </div>
 <br>      
</div></body></html>
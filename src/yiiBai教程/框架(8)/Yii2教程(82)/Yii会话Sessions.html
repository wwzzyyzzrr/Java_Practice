<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Yii会话Sessions</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    会话使数据可在不同页面之间访问。会话创建服务器上的临时目录文件中，所有会话变量都会被存储。这个数据是提供给所有特定用户在访问您的网站的网页期间使用。 
  </div> 
 </div> 
 <div> 
  <div>
    当一个会话开始时，会发生以下情况&nbsp;- 
  </div> 
  <ul> 
   <li> 
    <div>
      PHP创建特定会话的唯一ID。 
    </div> </li> 
   <li> 
    <div>
      有一个&nbsp;PHPSESSID&nbsp;的&nbsp;cookie&nbsp;要发送到客户端(浏览器)。 
    </div> </li> 
   <li> 
    <div>
      创建在所有会话变量都保存在临时文件夹中的文件。 
    </div> </li> 
   <li> <p style="text-align:justify;"> 当服务器想要从会话变量检索一个值，PHP自动获得&nbsp;cookie&nbsp;来自PHPSESSID的唯一会话ID。然后，它会在临时目录查找所需的文件。 </p> </li> 
  </ul> 
  <p style="text-align:justify;"> 要启动一个会话，应该调用 session_start()函数。要启动一个会话，应该调用在&nbsp;session_start()函数。&nbsp;也可以使用使用 isset()函数来检查会话变量是否已设置&nbsp;- </p> 
  <pre>&lt;?php
   session_start();
   if( isset( $_SESSION['number'] ) ) {
      $_SESSION['number'] += 1;
   }else {
      $_SESSION['number'] = 1;
   }
   $msg = "This page was visited ".  $_SESSION['number'];
   $msg .= "in this session.";
   echo $msg;
?&gt;&nbsp;</pre> 
  <p style="text-align:justify;"> 要销毁会话，应该调用&nbsp;session_destroy()&nbsp;函数。要销毁单个会话变量调用 isset()函数 - </p> 
  <pre>&lt;?php
   unset($_SESSION['number']);
   session_destroy();
?&gt;</pre> 
  <h2> 
   <div>
     在Yii中使用会话 
   </div> </h2> 
  <p style="text-align:justify;"> 会话允许数据在整个用户请求会被持久化。在PHP中，可以通过 $_SESSION 变量来访问它们。在Yii中，可以通过会话应用程序组件来访问会话。 </p> 
  <div>
    第1步&nbsp;-&nbsp;将&nbsp;actionOpenAndCloseSession()方法添加到&nbsp;SiteController。 
  </div> 
  <pre>public function actionOpenAndCloseSession() {
   $session = Yii::$app-&gt;session;
   // open a session
   $session-&gt;open();
   // check if a session is already opened
   if ($session-&gt;isActive) echo "session is active";
   // close a session
   $session-&gt;close();
   // destroys all data registered to a session
   $session-&gt;destroy();
}</pre> 
  <div>
    在上面的代码中，我们获取会话应用程序组件，打开一个会话，检查它是否处于活动状态，关闭会话，并最终销毁它。 
  </div> 
  <div>
    第2步&nbsp;-&nbsp;在Web浏览器的地址栏输入访问：
   <a target="_blank" href="http://localhost:8080/index.php?r=site/open-and-close-session">http://localhost:8080/index.php?r=site/open-and-close-session</a>，会看到以下内容：
   <br> 
   <img src="/uploads/tutorial/20160531/1-1605310HK9410.png" alt="Yii会话Sessions" title="Yii会话Sessions">
   <br> 
  </div> 
  <div>
    要访问会话变量，可以使用&nbsp;set()&nbsp;和&nbsp;get()&nbsp;方法。 
  </div> 
  <div>
    第3步&nbsp;-&nbsp;添加&nbsp;actionAccessSession()方法到&nbsp;SiteController。 
  </div>   
  <pre>public function actionAccessSession() {

   $session = Yii::$app-&gt;session;
	
   // set a session variable
   $session-&gt;set('language', 'Chinese');
	
   // get a session variable
   $language = $session-&gt;get('language');
   var_dump($language);
		  
   // remove a session variable
   $session-&gt;remove('language');
		  
   // check if a session variable exists
   if (!$session-&gt;has('language')) echo "language is not set";
		  
   $session['captcha'] = [
      'value' =&gt; 'Yiibai',
      'lifetime' =&gt; 7200,
   ];
   var_dump($session['captcha']);
}</pre> 
  <div>
    第4步&nbsp;-&nbsp;访问&nbsp;
   <a target="_blank" href="http://localhost:8080/index.php?r=site/access-session">http://localhost:8080/index.php?r=site/access-session</a>，会看到以下内容：
   <br> 
   <img src="/uploads/tutorial/20160531/1-1605310HQX05.png" alt="">
   <br> 
  </div> 
 </div>
 <br>      
</div></body></html>
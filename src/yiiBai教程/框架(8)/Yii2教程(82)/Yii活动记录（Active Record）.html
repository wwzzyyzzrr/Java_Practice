<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Yii活动记录（Active Record）</h1><div style="width:100%;float:left;" class="article-content">   
 <div>
   活动记录提供了用于访问数据库的面向对象的API。Active&nbsp;Record类与数据库表关联。 
 </div> 
 <div> 
  <div>
    Yii提供了以下关系数据库活动记录支持&nbsp;- 
  </div> 
  <ul> 
   <li> MySQL 4.1 + </li> 
   <li> SQLite 2 和 3: </li> 
   <li> PostgreSQL 7.3 + </li> 
   <li> Microsoft SQL Server 2008 + </li> 
   <li> CUBRID 9.3 + </li> 
   <li> Oracle </li> 
   <li> ElasticSearch </li> 
   <li> Sphinx </li> 
  </ul> 
  <div>
    此外，Active&nbsp;Record 类支持下面 NoSQL 数据库&nbsp;- 
  </div> 
  <ul> 
   <li> Redis 2.6.12+ </li> 
   <li> MongoDB 1.3.0+ </li> 
  </ul> 
  <div>
    (在本例中的模型是&nbsp;MyUser)为一个单独的数据库表声明一个Active&nbsp;Record类之后，应该按照以下步骤来查询数据&nbsp;- 
  </div> 
  <ul> 
   <li> 
    <div>
      创建一个新的查询对象，使用&nbsp;yii\db\ActiveRecord::find()&nbsp;方法。 
    </div> </li> 
   <li> 
    <div>
      构建查询对象 
    </div> </li> 
   <li> 
    <div>
      调用一个jquery方法来检索数据 
    </div> </li> 
  </ul> 
  <div>
    第1步&nbsp;-&nbsp;修改&nbsp;actionTestDb()&nbsp;方法，使用以下代码。 
  </div> 
  <pre>public function actionTestDb() {
   // return a single user whose ID is 1
   // SELECT * FROM `user` WHERE `id` = 1
   $user = MyUser::find()
      -&gt;where(['id' =&gt; 1])
      -&gt;one();
   var_dump($user);echo '&lt;hr/&gt;';
   // return the number of users
   // SELECT COUNT(*) FROM `user`
   $users = MyUser::find()
      -&gt;count();
   var_dump($users);echo '&lt;hr/&gt;';
   // return all users and order them by their IDs
   // SELECT * FROM `user` ORDER BY `id`
   $users = MyUser::find()
      -&gt;orderBy('id')
      -&gt;all();
   var_dump($users);
}</pre> 
  <div>
    上面给出的代码演示了如何使用&nbsp;ActiveQuery&nbsp;来查询数据。 
  </div> 
  <div>
    第2步&nbsp;-&nbsp;在浏览器打开URL地址：
   <a target="_blank" href="http://localhost:8080/index.php?r=site/test-db">http://localhost:8080/index.php?r=site/test-db</a>&nbsp;，会看到输出如下图所示。
   <br> 
   <img src="/uploads/tutorial/20160604/1-160604205533935.png" alt="Yii活动记录">
   <br> 
  </div> 
  <div>
    一个共同的任务是通过主键值查询或一组列的值，这就是为什么&nbsp;Yii&nbsp;提供以下方法&nbsp;- 
  </div> 
  <ul> 
   <li> <p style="text-align:justify;"> yii\db\ActiveRecord::findOne()&nbsp;−&nbsp;返回一个活动记录(Active&nbsp;Record)实例 </p> </li> 
   <li> <p style="text-align:justify;"> yi\db\ActiveRecord::findAll()&nbsp;−&nbsp;返回 ActiveRecord 的实例数组 </p> </li> 
  </ul> 
  <p> 如下实例&nbsp;− </p> 
  <pre>public function actionTestDb() {
   // returns a single customer whose ID is 1
   // SELECT * FROM `user` WHERE `id` = 1
   $user = MyUser::findOne(1);
   var_dump($user);
   // returns customers whose ID is 1,2,3, or 4
   // SELECT * FROM `user` WHERE `id` IN (1,2,3,4)
   $users = MyUser::findAll([1, 2, 3, 4]);
   var_dump($users);
   // returns a user whose ID is 5
   // SELECT * FROM `user` WHERE `id` = 5
   $user = MyUser::findOne([
      'id' =&gt; 5
   ]);
   var_dump($user);
}</pre> 
  <h2> 
   <div>
     将数据保存到数据库 
   </div> </h2> 
  <div>
    将数据保存到数据库中，应该调用&nbsp;yii\db\ActiveRecord::save()方法。 
  </div> 
  <div>
    第1步&nbsp;-&nbsp;修改&nbsp;actionTestDb()&nbsp;方法，并使用以下代码。 
  </div>   
  <pre>public function actionTestDb() {
   // insert a new row of data
   $user = new MyUser();
   $user-&gt;name = 'MyCustomUser2';
   $user-&gt;email = 'mycustomuser@gmail.com';
   $user-&gt;save();
   var_dump($user-&gt;attributes);
   
   // update an existing row of data
   $user = MyUser::findOne(['name' =&gt; 'MyCustomUser2']);
   $user-&gt;email = 'newemail@gmail.com';
   $user-&gt;save();
   var_dump($user-&gt;attributes);
}</pre> 
  <div>
    第2步&nbsp;-&nbsp;在浏览器打开URL地址：
   <a target="_blank" href="http://localhost:8080/index.php?r=site/test-db">http://localhost:8080/index.php?r=site/test-db</a>&nbsp;，会看到输出如下图所示。
   <br> 
   <img src="/uploads/tutorial/20160604/1-1606042056015Z.png" alt="">
   <br> 
  </div> 
  <div>
    要删除单行数据，应该&nbsp;- 
  </div> 
  <ul> 
   <li> 
    <div>
      检索活动记录(Active&nbsp;Record)实例 
    </div> </li> 
   <li> <p style="text-align:justify;"> 调用&nbsp;yii\db\ActiveRecord::delete()&nbsp;方法 </p> </li> 
  </ul> 
  <div>
    第1步&nbsp;-&nbsp;修改&nbsp;actionTestDb()&nbsp;方法，并使用以下代码。 
  </div> 
  <pre>public function actionTestDb() {
   $user = MyUser::findOne(2);
   if($user-&gt;delete()) {
      echo "User ID =&gt; 2 is deleted";
   } 
}</pre> 
  <div>
    第2步&nbsp;-&nbsp;在浏览器打开URL地址：
   <a target="_blank" href="http://localhost:8080/index.php?r=site/test-db">http://localhost:8080/index.php?r=site/test-db</a>&nbsp;，会看到输出如下图所示。
   <br> 
   <img src="/uploads/tutorial/20160604/1-160604205622X0.png" alt="Yii活动记录">
   <br> 
  </div> 
  <div>
    第3步&nbsp;-&nbsp;也可以调用&nbsp;yii\db\ActiveRecord::deleteAll()&nbsp;方法删除多行数据，例如。 
  </div> 
  <pre>public function actionTestDb() {
    MyUser::deleteAll('id &gt;= 20');
}</pre> 
 </div>
 <br>      
</div></body></html>
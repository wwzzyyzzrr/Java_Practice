<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Yii文件上传</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    可以使用&nbsp;&nbsp;yii\web\UploadedFile&nbsp;、模型和&nbsp;yii\widgets\ActiveForm&nbsp;轻松地实现文件上传功能。 
  </div> 
 </div> 
 <div> 
  <p style="text-align:justify;"> 在根文件夹创建一个“uploads” 的上传目录。这个目录将保存所有上传的图片。要上传一个文件，需要创建一个模型和模型上传文件实例的属性。还应该验证文件上传。 </p> 
  <div>
    第1步&nbsp;-&nbsp;在&nbsp;models&nbsp;文件夹中，创建一个&nbsp;UploadImageForm.php&nbsp;文件并使用以下代码内容。 
  </div> 
  <pre>&lt;?php
   namespace app\models;
   use yii\base\Model;
   class UploadImageForm extends Model {
      public $image;
      public function rules() {
         return [
            [['image'], 'file', 'skipOnEmpty' =&gt; false, 'extensions' =&gt; 'jpg, png'],
         ];
      }
      public function upload() {
         if ($this-&gt;validate()) {
            $this-&gt;image-&gt;saveAs('../uploads/' . $this-&gt;image-&gt;baseName . '.' .
               $this-&gt;image-&gt;extension);
            return true;
         } else {
            return false;
         }
      }
   }
?&gt;&nbsp;</pre> 
  <p style="text-align:justify;"> &nbsp;image&nbsp;属性用于保持文件的实例。这里文件验证规则是确保文件有一个&nbsp;PNG&nbsp;或&nbsp;JPG&nbsp;格式扩展名。upload()函数验证该文件并将其保存在服务器上。 </p> 
  <div>
    第2步&nbsp;-&nbsp;现在，添加&nbsp;actionLoadImage()&nbsp;方法到&nbsp;SiteController。 
  </div> 
  <pre>public function actionUploadImage() {
   $model = new UploadImageForm();
   if (Yii::$app-&gt;request-&gt;isPost) {
      $model-&gt;image = UploadedFile::getInstance($model, 'image');
      if ($model-&gt;upload()) {
         // file is uploaded successfully
         echo "File successfully uploaded";
         return;
      }
   }
   return $this-&gt;render('upload', ['model' =&gt; $model]);
}&nbsp;</pre> 
  <p style="text-align:justify;"> 第3步&nbsp;-&nbsp;当表单提交，调用yii\web\UploadedFile::getInstance()函数来表示上传的文件作为&nbsp;UploadedFile&nbsp;的实例。然后，我们验证文件并将其保存在服务器上。 </p> 
  <div>
    第4步&nbsp;-&nbsp;接下来，在&nbsp;views/site&nbsp;目录内创建一个视图文件&nbsp;upload.php&nbsp;。 
  </div>   
  <pre>&lt;?php
   use yii\widgets\ActiveForm;
?&gt;
&lt;?php $form = ActiveForm::begin(['options' =&gt; ['enctype' =&gt; 'multipart/form-data']])?&gt;
&lt;?= $form-&gt;field($model, 'image')-&gt;fileInput() ?&gt;
   &lt;button&gt;Submit&lt;/button&gt;
&lt;?php ActiveForm::end() ?&gt;&nbsp;</pre> 
  <p style="text-align:justify;"> 记住上传文件时表单头需要添加&nbsp;enctype&nbsp;选项。fileInput()&nbsp;方法输出以下HTML代码- </p> 
  <pre>&lt;input type = "file"&gt;</pre> 
  <div>
    上面的HTML代码，允许用户选择和上传文件。 
  </div> 
  <div>
    第5步&nbsp;-&nbsp;访问&nbsp;
   <a target="_blank" href="http://localhost:8080/index.php?r=site/upload-image">http://localhost:8080/index.php?r=site/upload-image</a>，&nbsp;会看到下面的输出结果：
   <br> 
   <img src="/uploads/tutorial/20160531/1-1605310I50XT.png" width="609" height="345" title="Yii文件上传" alt="Yii文件上传">
   <br> 
  </div> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/9a0e3419b7bb427ebf9c62c588d59d6f/clipboard.png">
  <br> 
  <div>
    第6步-&nbsp;选择要上传的图片，并点击“提交”按钮。该文件将保存在服务器上的&nbsp;“uploads”&nbsp;文件夹内。
   <br> 
   <img src="/uploads/tutorial/20160531/1-1605310I532916.png" alt="">
   <br> 
  </div> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/f790c56b059d4eafa92527d12325b72d/clipboard.png">
  <br> 
 </div>
 <br>      
</div></body></html>
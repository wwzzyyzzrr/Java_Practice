<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Yii动作使用RESTful API</h1><div style="width:100%;float:left;" class="article-content">   
 <div>
   该控制器类从&nbsp;yii\rest\ActivrController&nbsp;类扩展，它实现通用的&nbsp;RESTful&nbsp;动作。 
 </div> 
 <div> 
  <div>
    我们指定&nbsp;$modelClass&nbsp;属性使得控制器知道使用哪个模型操作数据。 
  </div> 
  <div>
    第1步&nbsp;-&nbsp;创建一个&nbsp;UserController.php&nbsp;控制器在&nbsp;controllers&nbsp;文件夹内。 
  </div> 
  <pre>&lt;?php
   namespace app\controllers;
   use yii\rest\ActiveController;
   class UserController extends ActiveController {
      public $modelClass = 'app\models\MyUser';
   }
?&gt;</pre> 
  <div>
    接下来，需要设置&nbsp;urlManager&nbsp;组件，使用户的数据可以访问，以及使用有意义的&nbsp;HTTP&nbsp;动词和漂亮网址来操纵。 
  </div> 
  <div>
    为了访问让&nbsp;API&nbsp;以&nbsp;JSON&nbsp;数据格式返回，还应该配置应用程序组件的解析器(parsers)属性。 
  </div> 
  <div>
    第2步&nbsp;-&nbsp;修改&nbsp;config/web.php&nbsp;文件如下代码&nbsp;- 
  </div> 
  <pre>&lt;?php
   $params = require(__DIR__ . '/params.php');
   $config = [
      'id' =&gt; 'basic',
      'basePath' =&gt; dirname(__DIR__),
      'bootstrap' =&gt; ['log'],
      'components' =&gt; [
         'request' =&gt; [
            // !!! insert a secret key in the following (if it is empty) - this is 
               //required by cookie validation
            'cookieValidationKey' =&gt; 'yiibai.com',
         ],
         'cache' =&gt; [
            'class' =&gt; 'yii\caching\FileCache',
         ],
         'user' =&gt; [
            'identityClass' =&gt; 'app\models\User',
            'enableAutoLogin' =&gt; true,
         ],
         'errorHandler' =&gt; [
            'errorAction' =&gt; 'site/error',
         ],
         'mailer' =&gt; [
            'class' =&gt; 'yii\swiftmailer\Mailer',
            // send all mails to a file by default. You have to set
            // 'useFileTransport' to false and configure a transport
            // for the mailer to send real emails.
            'useFileTransport' =&gt; true,
         ],
         'log' =&gt; [
            'traceLevel' =&gt; YII_DEBUG ? 3 : 0,
            'targets' =&gt; [
               [
                  'class' =&gt; 'yii\log\FileTarget',
                  'levels' =&gt; ['error', 'warning'],
               ],
            ],
         ],
         'urlManager' =&gt; [
            'enablePrettyUrl' =&gt; true,
            'enableStrictParsing' =&gt; true,
            'showScriptName' =&gt; false,
            'rules' =&gt; [
               ['class' =&gt; 'yii\rest\UrlRule', 'controller' =&gt; 'user'],
            ],
         ],
	
   <div style="background-color:inherit;">
    
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'request'&nbsp;=&gt;&nbsp;[&nbsp;&nbsp;
	
   </div>

	
   <div style="background-color:inherit;">
    
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'class'&nbsp;=&gt;&nbsp;'\yii\web\Request',&nbsp;&nbsp;
	
   </div>

	
   <div style="background-color:inherit;">
    
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'enableCookieValidation'&nbsp;=&gt;&nbsp;false,&nbsp;&nbsp;
	
   </div>

	
   <div style="background-color:inherit;">
    
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'parsers'&nbsp;=&gt;&nbsp;[&nbsp;&nbsp;
	
   </div>

	
   <div style="background-color:inherit;">
    
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'application/json'&nbsp;=&gt;&nbsp;'yii\web\JsonParser',&nbsp;&nbsp;
	
   </div>

	
   <div style="background-color:inherit;">
    
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],&nbsp;
	
   </div>

	
   <div style="background-color:inherit;">
    
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'cookieValidationKey'&nbsp;=&gt;&nbsp;'Oyiibai.com2trde1xww-M97_7QvwPo-5yiiBai@#720',&nbsp;&nbsp;
	
   </div>

	
   <div style="background-color:inherit;">
    
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],
	
   </div>
'db' =&gt; require(__DIR__ . '/db.php'),
      ],
      'modules' =&gt; [
         'admin' =&gt; [
            'class' =&gt; 'app\modules\hello\Admin',
         ],
      ],
      'params' =&gt; $params,
   ];
   if (YII_ENV_DEV) {
      // configuration adjustments for 'dev' environment
      $config['bootstrap'][] = 'debug';
      $config['modules']['debug'] = [
         'class' =&gt; 'yii\debug\Module',
      ];
      $config['bootstrap'][] = 'gii';
      $config['modules']['gii'] = [
         'class' =&gt; 'yii\gii\Module',
      ];
   }
   return $config;
?&gt;</pre> 
  <div>
    使用一个最小实例来说明，上面刚刚建立一个RESTful&nbsp;API，用于访问用户数据。这些API包括&nbsp;- 
  </div> 
  <ul> 
   <li> <p style="text-align:justify;"> GET /users&nbsp;−&nbsp;进行逐页读取所有用户 </p> </li> 
   <li> <p style="text-align:justify;"> HEAD /users&nbsp;−&nbsp;显示用户列表概述信息 </p> </li> 
   <li> <p style="text-align:justify;"> POST /users&nbsp;−&nbsp;创建一个新用户 </p> </li> 
   <li> <p style="text-align:justify;"> GET /users/20&nbsp;−&nbsp;返回用户ID为&nbsp;20&nbsp;的详细信息 </p> </li> 
   <li> <p style="text-align:justify;"> HEAD /users/20&nbsp;−&nbsp;显示用户ID为20的用户概述信息 </p> </li> 
   <li> <p style="text-align:justify;"> PATCH /users/ 20 和 PUT /users/20&nbsp;−&nbsp;更新用户ID为20的用户信息 </p> </li> 
   <li> <p style="text-align:justify;"> DELETE /users/20&nbsp;−&nbsp;删除用户ID为20的用户信息 </p> </li> 
   <li> <p style="text-align:justify;"> OPTIONS /users&nbsp;−&nbsp;显示端点&nbsp;/users&nbsp;支持的动词 </p> </li> 
   <li> <p style="text-align:justify;"> OPTIONS /users/20&nbsp;−&nbsp;显示端点&nbsp;/users/20&nbsp;支持的动词 </p> </li> 
  </ul> 
  <div>
    请注意，Yii会自动复数化控制器名称。 
  </div> 
  <div>
    第3步&nbsp;-&nbsp;现在，打开Postman，切入：
   <a target="_blank" href="http://localhost:8080/users">http://localhost:8080/users</a>&nbsp;，然后点击“Send”。将会看到以下内容。 
  </div> 
  <img src="/uploads/tutorial/20160604/1-160604211220T4.png" alt="">
  <br> 
  <div>
    第4步&nbsp;-&nbsp;创建一个新用户，修改请求类型为：POST，添加两个主体(Body)参数：name&nbsp;和&nbsp;email，并点击&nbsp;“Send”。 
  </div> 
  <img src="/uploads/tutorial/20160604/1-160604211243935.png" alt="">
  <br> 
  <div> 
   <br> 第5步&nbsp;-&nbsp;可以使用&nbsp;fields&nbsp;参数来指定哪些字段应包函在结果中。 
  </div> 
  <div>
    例如，URL&nbsp;=&gt;&nbsp;
   <a target="_blank" href="http://localhost:8080/users?fields=id">http://localhost:8080/users?fields=id</a>,name&nbsp;将只返回如下面图中显示的&nbsp;id&nbsp;和&nbsp;name&nbsp;字段&nbsp;。 
  </div> 
  <p style="font-family:Verdana, Geneva, Tahoma,  Helvetica, text-align:justify;font-size:15px !important;background-color:#FFFFFF;"> <img src="/uploads/tutorial/20160604/1-160604211441326.png" alt="Yii动作使用RESTful API"> </p> 
 </div>
 <br>      
</div></body></html>
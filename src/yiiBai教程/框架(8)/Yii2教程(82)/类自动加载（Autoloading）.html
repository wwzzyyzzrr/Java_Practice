<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">类自动加载（Autoloading）</h1><div style="width:100%;float:left;" class="article-content">   
 <h1 style="margin: 0px; padding: 0.25em 0px 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-top-style: none; font-size: 23px; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; line-height: 18.676000595092773px;"> 类自动加载(Autoloading)</h1> 
 <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"> Yii 依靠<a target="_blank" href="http://www.php.net/manual/en/language.oop5.autoload.php" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">类自动加载机制</a>来定位和包含所需的类文件。它提供一个高性能且完美支持<a target="_blank" href="https://github.com/php-fig/fig-standards/blob/master/proposed/psr-4-autoloader/psr-4-autoloader.md" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">PSR-4 标准</a>(<a target="_blank" href="https://github.com/hfcorriez/fig-standards/blob/zh_CN/%E6%8E%A5%E5%8F%97/PSR-4-autoloader.md" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">中文汉化</a>)的自动加载器。该自动加载器会在引入框架文件&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">Yii.php</code>&nbsp;时安装好。</p> 
 <blockquote style="margin: 1em 0px; padding: 0px 0px 0px 0.6em; border-left-width: 5px; border-left-style: solid; border-left-color: rgb(221, 221, 221); color: rgb(85, 85, 85); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px; line-height: 18.676000595092773px;"> 
  <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em;"> 注意：为了简化叙述，本篇文档中我们只会提及类的自动加载。不过，要记得文中的描述同样也适用于接口和Trait(特质)的自动加载哦。</p> 
 </blockquote> 
 <h2 style="margin: 1.5em 0px 1em; padding: 0.5em 0px 0px; border-width: 4px 0px 0px; border-top-style: solid; border-top-color: rgb(224, 224, 224); font-size: 20px; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; line-height: 18.676000595092773px;"> 使用 Yii 自动加载器</h2> 
 <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"> 要使用 Yii 的类自动加载器，你需要在创建和命名类的时候遵循两个简单的规则：</p> 
 <ul> 
  <li> 每个类都必须置于命名空间之下 (比如&nbsp;foo\bar\MyClass)。</li> 
  <li> 每个类都必须保存为单独文件，且其完整路径能用以下算法取得：</li> 
 </ul> 
 <ol class="hibot" style="margin: auto; padding-right: 0px; padding-left: 38px; font-size: 14px; font-family: monospace; color: rgb(230, 225, 220); background: rgb(17, 17, 17);"> 
  <li rel="0" style="margin: 0px; padding: 0px 0px 0px 10px; border-left-width: 2px; border-left-style: solid; border-left-color: rgb(204, 204, 204); list-style-position: outside; list-style-type: decimal; word-wrap: break-word; word-break: break-all; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"> //&nbsp;$className&nbsp;是一个开头包含反斜杠的完整类名(译者注：请自行谷歌：fully&nbsp;qualified&nbsp;class&nbsp;name)&nbsp;</li> 
  <li rel="0" style="margin: 0px; padding: 0px 0px 0px 10px; border-left-width: 2px; border-left-style: solid; border-left-color: rgb(204, 204, 204); list-style-position: outside; list-style-type: decimal; word-wrap: break-word; word-break: break-all; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"> $classFile&nbsp;=&nbsp;Yii::getAlias('@'&nbsp;.&nbsp;str_replace('\\\\',&nbsp;'/',&nbsp;$className)&nbsp;.&nbsp;'.php');</li> 
 </ol> 
 <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"> 举例来说，若某个类名为&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">foo\bar\MyClass</code>，对应类的文件路径<a target="_blank" href="http://mahua.jser.me/concept-aliases.md" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">别名</a>会是&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">@foo/bar/MyClass.php</code>。为了让该别名能被正确解析为文件路径，<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">@foo</code>&nbsp;或&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">@foo/bar</code>&nbsp;中的一个必须是<a target="_blank" href="http://mahua.jser.me/concept-aliases.md#defining-aliases" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">根别名</a>。</p> 
 <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"> 当我们使用<a target="_blank" href="http://mahua.jser.me/start-basic.md" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">基本应用模版</a>时，可以把你的类放置在顶级命名空间&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">app</code>&nbsp;下，这样它们就可以被 Yii 自动加载，而无需定义一个新的别名。这是因为&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">@app</code>&nbsp;本身是一个<a target="_blank" href="http://mahua.jser.me/concept-aliases.md#predefined-aliases" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">预定义别名</a>，且类似于&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">app\components\MyClass</code>&nbsp;这样的类名，基于我们刚才所提到的算法，可以正确解析出&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">AppBasePath/components/MyClass.php</code>&nbsp;路径。</p> 
 <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"> 在<a target="_blank" href="http://mahua.jser.me/tutorial-advanced-app.md" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">高级应用模版</a>里，每一逻辑层级会使用他自己的根别名。比如，前端层会使用&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">@frontend</code>&nbsp;而后端层会使用<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">@backend</code>。因此，你可以把前端的类放在&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">frontend</code>&nbsp;命名空间，而后端的类放在&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">backend</code>。 这样这些类就可以被 Yii 自动加载了。</p> 
 <h2 style="margin: 1.5em 0px 1em; padding: 0.5em 0px 0px; border-width: 4px 0px 0px; border-top-style: solid; border-top-color: rgb(224, 224, 224); font-size: 20px; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; line-height: 18.676000595092773px;"> 类映射表(Class Map)</h2> 
 <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"> Yii 类自动加载器支持<strong style="margin: 0px; padding: 0px;">类映射表</strong>功能，该功能会建立一个从类的名字到类文件路径的映射。当自动加载器加载一个文件时，他首先检查映射表里有没有该类。如果有，对应的文件路径就直接加载了，省掉了进一步的检查。这让类的自动加载变得超级快。事实上所有的 Yii 核心类都是这样加载的。</p> 
 <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"> 你可以用&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">Yii::$classMap</code>&nbsp;方法向映射表中添加类，</p> 
 <ol class="hibot" style="margin: auto; padding-right: 0px; padding-left: 38px; font-size: 14px; font-family: monospace; color: rgb(230, 225, 220); background: rgb(17, 17, 17);"> 
  <li rel="0" style="margin: 0px; padding: 0px 0px 0px 10px; border-left-width: 2px; border-left-style: solid; border-left-color: rgb(204, 204, 204); list-style-position: outside; list-style-type: decimal; word-wrap: break-word; word-break: break-all; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"> Yii::$classMap['foo\\bar\\MyClass']&nbsp;=&nbsp;'path/to/MyClass.php';</li> 
 </ol> 
 <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"> <a target="_blank" href="http://mahua.jser.me/concept-aliases.md" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">别名</a>可以被用于指定类文件的路径。你应该在<a target="_blank" href="http://mahua.jser.me/runtime-bootstrapping.md" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">引导启动</a>的过程中设置类映射表，这样映射表就可以在你使用具体类之前就准备好。</p> 
 <h2 style="margin: 1.5em 0px 1em; padding: 0.5em 0px 0px; border-width: 4px 0px 0px; border-top-style: solid; border-top-color: rgb(224, 224, 224); font-size: 20px; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; line-height: 18.676000595092773px;"> 用其他自动加载器</h2>   
 <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"> 因为 Yii 完全支持 Composer 管理依赖包，所以推荐你也同时安装 Composer 的自动加载器，如果你用了一些自带自动加载器的第三方类库，你应该也安装下它们。</p> 
 <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"> 当你同时使用其他自动加载器和 Yii 自动加载器时，应该在其他自动加载器安装成功<strong style="margin: 0px; padding: 0px;">之后</strong>，再包含&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">Yii.php</code>&nbsp;文件。这将使 Yii 成为第一个响应任何类自动加载请求的自动加载器。举例来说，以下代码提取自<a target="_blank" href="http://mahua.jser.me/start-basic.md" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">基本应用模版</a>的<a target="_blank" href="http://mahua.jser.me/structure-entry-scripts.md" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">入口脚本</a>&nbsp;。第一行安装了 Composer 的自动加载器，第二行才是 Yii 的自动加载器：</p> 
 <ol class="hibot" style="margin: auto; padding-right: 0px; padding-left: 38px; font-size: 14px; font-family: monospace; color: rgb(230, 225, 220); background: rgb(17, 17, 17);"> 
  <li rel="0" style="margin: 0px; padding: 0px 0px 0px 10px; border-left-width: 2px; border-left-style: solid; border-left-color: rgb(204, 204, 204); list-style-position: outside; list-style-type: decimal; word-wrap: break-word; word-break: break-all; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"> require(__DIR__&nbsp;.&nbsp;'/../vendor/autoload.php');&nbsp;</li> 
  <li rel="0" style="margin: 0px; padding: 0px 0px 0px 10px; border-left-width: 2px; border-left-style: solid; border-left-color: rgb(204, 204, 204); list-style-position: outside; list-style-type: decimal; word-wrap: break-word; word-break: break-all; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"> require(__DIR__&nbsp;.&nbsp;'/../vendor/yiisoft/yii2/Yii.php');</li> 
 </ol> 
 <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"> 你也可以只使用 Composer 的自动加载，而不用 Yii 的自动加载。不过这样做的话，类的加载效率会下降，且你必须遵循 Composer 所设定的规则，从而让你的类满足可以被自动加载的要求。</p> 
 <blockquote style="margin: 1em 0px; padding: 0px 0px 0px 0.6em; border-left-width: 5px; border-left-style: solid; border-left-color: rgb(221, 221, 221); color: rgb(85, 85, 85); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px; line-height: 18.676000595092773px;"> 
  <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em;"> 补充：若你不想要使用 Yii 的自动加载器，你必须创建一个你自己版本的&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">Yii.php</code>&nbsp;文件，并把它包含进你的<a target="_blank" href="http://mahua.jser.me/structure-entry-scripts.md" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">入口脚本</a>里。</p> 
 </blockquote> 
 <h2 style="margin: 1.5em 0px 1em; padding: 0.5em 0px 0px; border-width: 4px 0px 0px; border-top-style: solid; border-top-color: rgb(224, 224, 224); font-size: 20px; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; line-height: 18.676000595092773px;"> 自动加载扩展类</h2> 
 <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"> Yii 自动加载器支持自动加载<a target="_blank" href="http://mahua.jser.me/structure-extensions.md" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">扩展</a>的类。唯一的要求是它需要在&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">composer.json</code>&nbsp;文件里正确地定义&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">autoload</code>部分。请参考&nbsp;<a target="_blank" href="https://getcomposer.org/doc/04-schema.md#autoload" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">Composer 文档(英文)</a>(<a target="_blank" href="https://github.com/5-say/composer-doc-cn/blob/master/cn-introduction/04-schema.md#autoload" style="margin: 0px; padding: 0px; color: rgb(65, 131, 196); text-decoration: none;">中文汉化</a>)，来了解如何正确描述&nbsp;<code style="margin: 0px; padding: 0px 0.2em; font-size: 12px; line-height: normal; font-family: Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; color: rgb(68, 68, 68); border: 1px solid rgb(222, 222, 222); background-color: rgb(248, 248, 255);">autoload</code>&nbsp;的更多细节。</p> 
 <p style="margin: 1em 0px; padding: 0px; line-height: 1.5em; color: rgb(0, 0, 0); font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"> 在你不使用 Yii 的自动加载器时，Composer 的自动加载器仍然可以帮你自动加载扩展内的类。</p> 
 <br>      
</div></body></html>
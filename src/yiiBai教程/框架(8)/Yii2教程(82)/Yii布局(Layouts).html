<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Yii布局(Layouts)</h1><div style="width:100%;float:left;" class="article-content">   
 <div>
   布局代表多个视图的公用部分。例如，页眉和页脚。&nbsp;默认情况下，布局应存放在&nbsp;views/layouts&nbsp;文件夹中。 
 </div> 
 <div> 
  <div>
    让我们看一下基本应用程序模板的主(main&nbsp;)布局 - 
  </div> 
  <pre>&lt;?php
   /* @var $this \yii\web\View */
   /* @var $content string */
   use yii\helpers\Html;
   use yii\bootstrap\Nav;
   use yii\bootstrap\NavBar;
   use yii\widgets\Breadcrumbs;
   use app\assets\AppAsset;
   AppAsset::register($this);
?&gt;

&lt;?php $this-&gt;beginPage() ?&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang = "&lt;?= Yii::$app-&gt;language ?&gt;"&gt;
   &lt;head&gt;
      &lt;meta charset = "&lt;?= Yii::$app-&gt;charset ?&gt;"&gt;
      &lt;meta name = "viewport" content = "width = device-width, initial-scale = 1"&gt;
      &lt;?= Html::csrfMetaTags() ?&gt;
      &lt;title&gt;&lt;?= Html::encode($this-&gt;title) ?&gt;&lt;/title&gt;
      &lt;?php $this-&gt;head() ?&gt;
   &lt;/head&gt;
	
   &lt;body&gt;
      &lt;?php $this-&gt;beginBody() ?&gt;
         &lt;div class = "wrap"&gt;
            &lt;?php
               NavBar::begin([
                  'brandLabel' =&gt; 'My Company',
                  'brandUrl' =&gt; Yii::$app-&gt;homeUrl,
                  'options' =&gt; [
                     'class' =&gt; 'navbar-inverse navbar-fixed-top',
                  ],
               ]);
					
               echo Nav::widget([
                  'options' =&gt; ['class' =&gt; 'navbar-nav navbar-right'],
                  'items' =&gt; [
                     ['label' =&gt; 'Home', 'url' =&gt; ['/site/index']],
                     ['label' =&gt; 'About', 'url' =&gt; ['/site/about']],
                     ['label' =&gt; 'Contact', 'url' =&gt; ['/site/contact']],
                     Yii::$app-&gt;user-&gt;isGuest ?
                        ['label' =&gt; 'Login', 'url' =&gt; ['/site/login']] :
                        [
                           'label' =&gt; 'Logout (' . Yii::$app-&gt;user-&gt;identity-&gt;username.')',
                           'url' =&gt; ['/site/logout'],
                           'linkOptions' =&gt; ['data-method' =&gt; 'post']
                        ],
                  ],
               ]);
					
               NavBar::end();
            ?&gt;
            &lt;div class = "container"&gt;
               &lt;?= Breadcrumbs::widget([
                  'links' =&gt; isset($this-&gt;params['breadcrumbs']) ? $this&gt;params
                     ['breadcrumbs'] : [],
               ]) ?&gt;
               &lt;?= $content ?&gt;
            &lt;/div&gt;
				
         &lt;/div&gt;
			
         &lt;footer class = "footer"&gt;
            &lt;div class = "container"&gt;
               &lt;p class = "pull-left"&gt;© My Company &lt;?= date('Y') ?&gt;&lt;/p&gt;
               &lt;p class = "pull-right"&gt;&lt;?= Yii::powered() ?&gt;&lt;/p&gt;
            &lt;/div&gt;
         &lt;/footer&gt;
			
      &lt;?php $this-&gt;endBody() ?&gt;
   &lt;/body&gt;
&lt;/html&gt;
&lt;?php $this-&gt;endPage() ?&gt;&nbsp;</pre> 
  <p style="text-align:justify;"> 这种布局是所有视图的通用页面生成HTML页面。$content&nbsp;变量是视图渲染内容的结果。以下方法引发有关渲染过程事件，以便在其他地方注册的脚本和标签会被适当注入&nbsp;- </p> 
  <ul> 
   <li> <p style="text-align:justify;"> head()&nbsp;−&nbsp;应在头部分调用。产生一个占位符，将与定位于头部位置已注册的 HTML 来代替。 </p> </li> 
   <li> <p style="text-align:justify;"> beginBody()&nbsp;−&nbsp;应在&nbsp;body&nbsp;部分的开头调用。触发&nbsp;EVENT_BEGIN_BODY&nbsp;事件。产生将使用定位在&nbsp;body&nbsp;已注册的HTML，将替换占位符开始位置。 </p> </li> 
   <li> <p style="text-align:justify;"> endBody()&nbsp;−&nbsp;应在&nbsp;body&nbsp;结束部分被调用。触发&nbsp;EVENT_END_BODY&nbsp;事件。 </p> <p style="text-align:justify;"> &nbsp;产生一个占位符，这将有针对性的在&nbsp;body&nbsp;的结束位置使用已注册的HTML来代替。 </p> </li> 
   <li> <p style="text-align:justify;"> beginPage()&nbsp;−&nbsp;应在布局的开头被调用。触发EVENT_BEGIN_PAGE&nbsp;事件。 </p> </li> 
   <li> <p style="text-align:justify;"> endPage()&nbsp;−&nbsp;应在布局结束时调用。触发&nbsp;EVENT_END_PAGE&nbsp;事件。 </p> </li> 
  </ul> 
  <h2> 创建布局 </h2> 
  <div>
    第1步&nbsp;-&nbsp;在目录&nbsp;views/layouts&nbsp;里面创建一个名为&nbsp;newlayout.php&nbsp;的文件并使用下面的代码。 
  </div> 
  <pre>&lt;?php
   /* @var $this \yii\web\View */
   /* @var $content string */
   use yii\helpers\Html;
   use yii\bootstrap\Nav;
   use yii\bootstrap\NavBar;
   use yii\widgets\Breadcrumbs;
   use app\assets\AppAsset;
   AppAsset::register($this);
?&gt;
&lt;?php $this-&gt;beginPage() ?&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang = "&lt;?= Yii::$app-&gt;language ?&gt;"&gt;
   &lt;head&gt;
      &lt;meta charset = "&lt;?= Yii::$app-&gt;charset ?&gt;"&gt;
      &lt;meta name = "viewport" content = "width = device-width, initial-scale = 1"&gt;
      &lt;?= Html::csrfMetaTags() ?&gt;
      &lt;title&gt;&lt;?= Html::encode($this-&gt;title) ?&gt;&lt;/title&gt;
      &lt;?php $this-&gt;head() ?&gt;
   &lt;/head&gt;

   &lt;body&gt;
      &lt;?php $this-&gt;beginBody() ?&gt;
         &lt;div class = "wrap"&gt; 
            &lt;div class = "container"&gt;
               &lt;?= $content ?&gt;
            &lt;/div&gt;
         &lt;/div&gt;
			
         &lt;footer class = "footer"&gt;
            &lt;div class = "container"&gt;
               &lt;p class = "pull-left"&gt;© My Company &lt;?= date('Y') ?&gt;&lt;/p&gt;
               &lt;p class = "pull-right"&gt;&lt;?= Yii::powered() ?&gt;&lt;/p&gt;
            &lt;/div&gt;
         &lt;/footer&gt;
      &lt;?php $this-&gt;endBody() ?&gt;
   &lt;/body&gt;
	
&lt;/html&gt;
&lt;?php $this-&gt;endPage() ?&gt;</pre> 
  <div>
    在这里，我们已经移除了顶部的菜单栏。 
  </div> 
  <div>
    第2步&nbsp;-&nbsp;要将布局应用到SiteController中，需要将&nbsp;$layout&nbsp;属性添加到&nbsp;SiteController&nbsp;类。 
  </div> 
  <pre>&lt;?php
   namespace app\controllers;
   use Yii;
   use yii\filters\AccessControl;
   use yii\web\Controller;
   use yii\filters\VerbFilter;
   use app\models\LoginForm;
   use app\models\ContactForm;
   class SiteController extends Controller {
      public $layout = "newlayout";
      /* other methods */
   }
?&gt;</pre> 
  <div>
    第3步&nbsp;-&nbsp;现在，如果到Web浏览器打开&nbsp;SiteController&nbsp;中的任何视图，如打开URL=&gt; ，您将看到的布局已经发生了变化。
   <br> 
   <img src="/uploads/tutorial/20160519/1-160519210633625.png" alt="">
   <br> 
  </div> 
  <div>
    第4步-&nbsp;要注册的各种&nbsp;meta&nbsp;标签，可以在内容视图中调用 yii\web\View::registerMetaTag()&nbsp;函数。 
  </div> 
  <div>
    第5步&nbsp;-&nbsp;修改 SiteController 的“About”视图 - views/site/about.php。 
  </div>   
  <pre>&lt;?php
   /* @var $this yii\web\View */
   use yii\helpers\Html;
   $this-&gt;title = '关于我们';
   $this-&gt;params['breadcrumbs'][] = $this-&gt;title;
   $this-&gt;registerMetaTag(['name' =&gt; 'keywords', 'content' =&gt; 'yii, Yii教程, Yii视图,
      meta, 标签']);
   $this-&gt;registerMetaTag(['name' =&gt; 'description', 'content' =&gt; '这是一个页面的描述!'], 'description');
?&gt;
&lt;div class="site-about"&gt;
   &lt;h1&gt;&lt;?= Html::encode($this-&gt;title) ?&gt;&lt;/h1&gt;
   &lt;p&gt;
      This is the About page. You may modify the following file to customize its content:
   &lt;/p&gt;
   &lt;code&gt;&lt;?= __FILE__ ?&gt;&lt;/code&gt;
&lt;/div&gt;&nbsp;</pre> 
  <p style="text-align:justify;"> 我们刚刚注册了两个 meta 标签&nbsp;−&nbsp;keywords 和 description. </p> 
  <p style="text-align:justify;"> 第6步&nbsp;-&nbsp;现在打开&nbsp;<a target="_blank" href="http://localhost:8080/index.php?r=site/about">http://localhost:8080/index.php?r=site/about</a>&nbsp;，你会发现在页面头部的 meta 标签内容如下面的屏幕截图。<br> <img src="/uploads/tutorial/20160519/1-160519210A2H3.png" alt=""> </p> 
  <div>
    视图触发几个事件&nbsp;- 
  </div> 
  <ul> 
   <li> <p style="text-align:justify;"> EVENT_BEGIN_BODY&nbsp;−&nbsp;触发了布局通过调用&nbsp;yii\web\View::beginBody() </p> </li> 
   <li> <p style="text-align:justify;"> EVENT_END_BODY&nbsp;−&nbsp;触发了布局通过调用&nbsp;yii\web\View::endBody() </p> </li> 
   <li> <p style="text-align:justify;"> EVENT_BEGIN_PAGE&nbsp;−&nbsp;触发了布局通过调用&nbsp;fyii\web\View::beginPage() </p> </li> 
   <li> <p style="text-align:justify;"> EVENT_END_PAGE&nbsp;−&nbsp;触发了布局通过调用&nbsp;yii\web\View::endPage() </p> </li> 
   <li> <p style="text-align:justify;"> EVENT_BEFORE_RENDER&nbsp;−&nbsp;在控制器开始渲染一个文件时触发 </p> </li> 
   <li> <p style="text-align:justify;"> EVENT_AFTER_RENDER&nbsp;−&nbsp;渲染文件后触发 </p> </li> 
  </ul> 
  <div>
    也可以对这些事件的响应内容插入到视图。 
  </div> 
  <div>
    步骤7-&nbsp;要显示当前的日期和时间在&nbsp;SiteController&nbsp;的&nbsp;actionAbout&nbsp;动作中，以下面的这种方式。 
  </div> 
  <pre>public function actionAbout() {
   Yii::$app-&gt;view-&gt;on(yii\web\View::EVENT_BEGIN_BODY, function () {
      echo date('Y-m-d H:i:s');
   });
   return $this-&gt;render('about');
}</pre> 
  <div>
    第8步&nbsp;-&nbsp;在浏览器中访问URL=&gt;&nbsp;
   <a target="_blank" href="http://localhost:8080/index.php?r=site/about">http://localhost:8080/index.php?r=site/about</a>，将会看到下面的内容。
   <br> 
   <img src="/uploads/tutorial/20160519/1-160519210G1638.png" alt="">
   <br> 
  </div> 
  <h2> 要点 </h2> 
  <div>
    为了使视图更易于管理，你应该&nbsp;- 
  </div> 
  <ul> 
   <li> 将复杂的视图分成几个小块文件 </li> 
   <li> 使用公用的HTML代码部分(页眉，页脚，菜单等)的布局 </li> 
   <li> 使用小部件-widgets </li> 
  </ul> 
  <div>
    视图应该&nbsp;- 
  </div> 
  <ul> 
   <li> 包含HTML和简单的PHP代码格式化和呈现数据。 </li> 
   <li> 无处理请求 </li> 
   <li> 不修改模型属性 </li> 
   <li> 
    <div>
      不执行数据库查询 
    </div> </li> 
  </ul> 
 </div>
 <br>      
</div></body></html>
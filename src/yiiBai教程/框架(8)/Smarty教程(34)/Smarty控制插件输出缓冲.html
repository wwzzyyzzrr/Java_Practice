<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Smarty控制插件输出缓冲</h1><div style="width:100%;float:left;" class="article-content">   
 <h1 style="box-sizing: border-box; font-size: 18pt; margin: 20px 0px 10px; tahoma, arial, helvetica,  line-height: 1.1; color: rgb(0, 0, 102);"> Controlling Cacheability of Plugins' Output控制插件输出的缓冲能力</h1> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> 自从Smarty-2.6.0插件以来，如果注册它们，则插件的缓存能力能够被重新声明的。register_block，register_compiler_function 和register_function的第3个参数就是$&nbsp;<i style="box-sizing: border-box;">cacheable ,</i>&nbsp;并且它的值默认为true。当然，在2.6.0版本之前它的默认值也是这样的。</p> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> &nbsp;</p> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> 当用$cacheable=false来这册一个插件，则每次这个页面被输出的时候，这个插件就会被使用，即使这个页面来自缓存。这个插件函数的行为有点像这个函数insert。</p> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> &nbsp;</p> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> 和{insert}相反，插件的属性默认是不缓存的。通过使用第四个参数&nbsp;<i style="box-sizing: border-box;">$cache_attrs</i>&nbsp;，它们能够被重新声明为缓存的。&nbsp;<i style="box-sizing: border-box;">$cache_attrs&nbsp;</i>是一个属性名字的数组，可以被缓存，所以每次当它被从缓存中取出的时候，这个插件函数获得值-----因为这个页面会被写入用来缓存。</p> 
 <table border="0" cellpadding="0" cellspacing="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; color: rgb(83, 91, 96); font-size: 14px; line-height: 20px; Verdana, arial, helvetica, " width="100%"> 
  <tbody style="box-sizing: border-box;"> 
   <tr style="box-sizing: border-box;"> 
    <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;"> <br style="box-sizing: border-box;"> <p style="box-sizing: border-box; margin: 0px 0px 10px;"> <span style="box-sizing: border-box; font-weight: 700;">Example 14-10. Preventing a plugin's output from being cached</span></p> <p style="box-sizing: border-box; margin: 0px 0px 10px;"> <span style="box-sizing: border-box; font-weight: 700;">例14-10.阻止插件从缓存中输出</span></p> 
     <table bgcolor="#E0E0E0" border="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; background-color: transparent;" width="100%"> 
      <tbody style="box-sizing: border-box;"> 
       <tr style="box-sizing: border-box;"> 
        <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;"> <pre class="PROGRAMLISTING" style="box-sizing: border-box; overflow: auto; Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 9.5px; line-height: 1.42857143; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border-color: rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(245, 245, 245);">
index.php:

require('Smarty.class.php');
$smarty = new Smarty;
$smarty-&gt;caching = true;

function remaining_seconds($params, &amp;$smarty) {
 $remain = $params['endtime'] - time();
 if ($remain &gt;=0)
 return $remain . " second(s)";
 else
 return "done";
}

$smarty-&gt;register_function('remaining', 'remaining_seconds', false, array('endtime'));

if (!$smarty-&gt;is_cached('index.tpl')) {
 // fetch $obj from db and assign...
 $smarty-&gt;assign_by_ref('obj', $obj);
}

$smarty-&gt;display('index.tpl');
// by www.yiibai.com/smarty

index.tpl:

Time Remaining: {remain endtime=$obj-&gt;endtime}</pre> </td> 
       </tr> 
      </tbody> 
     </table> <p style="box-sizing: border-box; margin: 0px 0px 10px;"> &nbsp;</p> <p style="box-sizing: border-box; margin: 0px 0px 10px;"> 直到$obj运行结束，时间的秒数在每一个页面输出的时候会改变，即使这个页面被缓存。只要结束时间属性被缓存，当页面被写入到缓存但是没有对这个页面接着的请求的时候对象只是不得不重新从数据库里取出而已。</p> <p style="box-sizing: border-box; margin: 0px 0px 10px;"> &nbsp;</p> </td> 
   </tr> 
  </tbody> 
 </table> 
 <table border="0" cellpadding="0" cellspacing="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; color: rgb(83, 91, 96); font-size: 14px; line-height: 20px; Verdana, arial, helvetica, " width="100%"> 
  <tbody style="box-sizing: border-box;"> 
   <tr style="box-sizing: border-box;"> 
    <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;"> <br style="box-sizing: border-box;"> <p style="box-sizing: border-box; margin: 0px 0px 10px;"> <span style="box-sizing: border-box; font-weight: 700;">Example 14-11. Preventing a whole passage of a template from being cached</span></p> <p style="box-sizing: border-box; margin: 0px 0px 10px;"> <span style="box-sizing: border-box; font-weight: 700;">例14-11.阻止一个模板文件的</span>&nbsp;<span style="box-sizing: border-box; font-weight: 700;">整篇被缓存</span></p> 
     <table bgcolor="#E0E0E0" border="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; background-color: transparent;" width="100%"> 
      <tbody style="box-sizing: border-box;"> 
       <tr style="box-sizing: border-box;"> 
        <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;">   <pre class="PROGRAMLISTING" style="box-sizing: border-box; overflow: auto; Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 9.5px; line-height: 1.42857143; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border-color: rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(245, 245, 245);">
index.php:

require('Smarty.class.php');
$smarty = new Smarty;
$smarty-&gt;caching = true;

function smarty_block_dynamic($param, $content, &amp;$smarty) {
 return $content;
}
$smarty-&gt;register_block('dynamic', 'smarty_block_dynamic', false);

$smarty-&gt;display('index.tpl');


index.tpl:

Page created: {"0"|date_format:"%D %H:%M:%S"}

{dynamic}

Now is: {"0"|date_format:"%D %H:%M:%S"}

... do other stuff ...

{/dynamic}</pre> </td> 
       </tr> 
      </tbody> 
     </table> </td> 
   </tr> 
  </tbody> 
 </table> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> &nbsp;</p> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> 当重新加载这个页面，你将会注意到这两个日期不同。一个是“动态“，一个是“静态”。你能够在{dynamic}...{/dynamic}之间作任何事情，并且保证它将不会像剩下的页面一样被缓存。</p> 
 <br>      
</div></body></html>
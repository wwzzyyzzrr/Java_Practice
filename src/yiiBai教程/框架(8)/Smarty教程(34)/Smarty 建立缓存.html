<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Smarty 建立缓存</h1><div style="width:100%;float:left;" class="article-content">   
 <h1 style="box-sizing: border-box; font-size: 18pt; margin: 20px 0px 10px; tahoma, arial, helvetica,  line-height: 1.1; color: rgb(0, 0, 102);"> Setting Up Caching [建立缓存]</h1> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> 首先要做的就是让缓存可用。这就要设置$caching = true(或 1.)</p> 
 <table border="0" cellpadding="0" cellspacing="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; color: rgb(83, 91, 96); font-size: 14px; line-height: 20px; Verdana, arial, helvetica, " width="100%"> 
  <tbody style="box-sizing: border-box;"> 
   <tr style="box-sizing: border-box;"> 
    <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;"> <br style="box-sizing: border-box;"> <p style="box-sizing: border-box; margin: 0px 0px 10px;"> <span style="box-sizing: border-box; font-weight: 700;">Example 14-1. enabling caching<br style="box-sizing: border-box;"> 例14-1.使缓存可用</span></p> 
     <table bgcolor="#E0E0E0" border="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; background-color: transparent;" width="100%"> 
      <tbody style="box-sizing: border-box;"> 
       <tr style="box-sizing: border-box;"> 
        <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;"> <pre class="PROGRAMLISTING" style="box-sizing: border-box; overflow: auto; Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 9.5px; line-height: 1.42857143; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border-color: rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(245, 245, 245);">
require('Smarty.class.php');
$smarty = new Smarty;

$smarty-&gt;caching = true;

$smarty-&gt;display('index.tpl');</pre> </td> 
       </tr> 
      </tbody> 
     </table> </td> 
   </tr> 
  </tbody> 
 </table> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> <br style="box-sizing: border-box;"> 建立缓存后，display('index.tpl')函数会把模板返回原来状态〔没缓存〕，也会把输出保存copy〖n.名词〗到$cache_dir.下次调用display('index.tpl')，保存的缓存copy〖n.〗会被再用来代替原来的模板。</p> 
 <div style="box-sizing: border-box; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> 
  <blockquote style="box-sizing: border-box; padding: 10px; margin: 10px 0px; font-size: 14px; border-width: 1px 1px 1px 5px;  border-color: rgb(238, 238, 238) rgb(238, 238, 238) rgb(238, 238, 238) rgb(91, 192, 222); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px;"> 
   <p style="box-sizing: border-box; margin: 0px;"> 技术提示：在$chche_dir目录里的文档命名跟模板一致。尽管是用.php作为扩展名，但并不会被当作php代码来解析。所以不要去修改它。</p> 
  </blockquote> 
 </div> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> 每个缓存页都有一个用$cache_lifetime来控制的会话期。初始值是3600秒，就是一小时〔废话嘛〕。会话期结束，缓存就会重建。你可以通过设置$caching=2来控制单个缓存文件各自的的过期时间。祥细内容察看$cache_lifetime里面的列表。</p> 
 <table border="0" cellpadding="0" cellspacing="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; color: rgb(83, 91, 96); font-size: 14px; line-height: 20px; Verdana, arial, helvetica, " width="100%"> 
  <tbody style="box-sizing: border-box;"> 
   <tr style="box-sizing: border-box;"> 
    <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;"> <br style="box-sizing: border-box;"> <p style="box-sizing: border-box; margin: 0px 0px 10px;"> <span style="box-sizing: border-box; font-weight: 700;">Example 14-2. setting cache_lifetime per cache<br style="box-sizing: border-box;"> 例14-2 设置单个缓存会话期〔时间〕</span></p> 
     <table bgcolor="#E0E0E0" border="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; background-color: transparent;" width="100%"> 
      <tbody style="box-sizing: border-box;"> 
       <tr style="box-sizing: border-box;"> 
        <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;"> <pre class="PROGRAMLISTING" style="box-sizing: border-box; overflow: auto; Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 9.5px; line-height: 1.42857143; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border-color: rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(245, 245, 245);">
require('Smarty.class.php');
$smarty = new Smarty;

$smarty-&gt;caching = 2; // lifetime is per cache

// set the cache_lifetime for index.tpl to 5 minutes
$smarty-&gt;cache_lifetime = 300;
$smarty-&gt;display('index.tpl');

// set the cache_lifetime for home.tpl to 1 hour
$smarty-&gt;cache_lifetime = 3600;
$smarty-&gt;display('home.tpl');


// NOTE: the following $cache_lifetime setting will not work when $caching = 2.
//提示：在$chching=2后面的$chche_lifetime不会起作用。
// The cache lifetime for home.tpl has already been set
// to 1 hour, and will no longer respect the value of $cache_lifetime.
// home.tpl的缓存会话期设为1小时后，不会再按$cache_lifetime的值改变。
// The home.tpl cache will still expire after 1 hour.
// home.tpl的缓存会在1小时后结束。$smarty-&gt;cache_lifetime = 30; // 30 seconds
$smarty-&gt;display('home.tpl');</pre> </td> 
       </tr> 
      </tbody> 
     </table> </td> 
   </tr> 
  </tbody> 
 </table> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> <br style="box-sizing: border-box;"> 如果$compile_check可用，每个跟缓存文档相关的模板文档和配置文档都会被检查来确定是否需要修改。在缓存产生后，改动任何文档，缓存也跟着更新改动。设置$compile_check为false，这是实现最佳性能的最小改动〔应该是这样:D〕。</p> 
 <table border="0" cellpadding="0" cellspacing="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; color: rgb(83, 91, 96); font-size: 14px; line-height: 20px; Verdana, arial, helvetica, " width="100%"> 
  <tbody style="box-sizing: border-box;"> 
   <tr style="box-sizing: border-box;"> 
    <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;"> <br style="box-sizing: border-box;"> <p style="box-sizing: border-box; margin: 0px 0px 10px;"> <span style="box-sizing: border-box; font-weight: 700;">Example 14-3. enabling $compile_check<br style="box-sizing: border-box;"> 例14-3.可用$compile_check</span></p> 
     <table bgcolor="#E0E0E0" border="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; background-color: transparent;" width="100%"> 
      <tbody style="box-sizing: border-box;"> 
       <tr style="box-sizing: border-box;"> 
        <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;"> <pre class="PROGRAMLISTING" style="box-sizing: border-box; overflow: auto; Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 9.5px; line-height: 1.42857143; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border-color: rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(245, 245, 245);">
require('Smarty.class.php');
$smarty = new Smarty;

$smarty-&gt;caching = true;
$smarty-&gt;compile_check = true;

$smarty-&gt;display('index.tpl');</pre> </td> 
       </tr> 
      </tbody> 
     </table> </td> 
   </tr> 
  </tbody> 
 </table> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> <br style="box-sizing: border-box;"> 一旦$force_compile可用，缓存文档会一直重建。这有效地关闭缓存。$force_compile只是用来调试，更有效关闭缓存的方法是让$caching&nbsp;= false(或0.)</p> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> <br style="box-sizing: border-box;"> <a target="_blank" href="http://www.php100.com/manual/smarty/api.is.cached.htmll" style="box-sizing: border-box; color: rgb(79, 141, 179); text-decoration: none; background: 0px 0px;">is_c</a>ached()函数可用来测试一个模板是否有有效的缓存。如果一个缓存模板需要从数据库中获取数据，可以用这个函数来跳过这个过程。</p> 
 <table border="0" cellpadding="0" cellspacing="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; color: rgb(83, 91, 96); font-size: 14px; line-height: 20px; Verdana, arial, helvetica, " width="100%"> 
  <tbody style="box-sizing: border-box;"> 
   <tr style="box-sizing: border-box;"> 
    <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;"> 
     <div style="box-sizing: border-box;"> 
      <p style="box-sizing: border-box; margin: 0px 0px 10px;"> <br style="box-sizing: border-box;"> <span style="box-sizing: border-box; font-weight: 700;">例14-4.使用is_cached()</span></p> 
      <table bgcolor="#E0E0E0" border="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; background-color: transparent;" width="100%"> 
       <tbody style="box-sizing: border-box;"> 
        <tr style="box-sizing: border-box;"> 
         <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;">   <pre class="PROGRAMLISTING" style="box-sizing: border-box; overflow: auto; Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 9.5px; line-height: 1.42857143; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border-color: rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(245, 245, 245);">
require('Smarty.class.php');
$smarty = new Smarty;

$smarty-&gt;caching = true;

if(!$smarty-&gt;is_cached('index.tpl')) {
	// No cache available, do variable assignments here.
	$contents = get_database_contents();
	$smarty-&gt;assign($contents);
}

$smarty-&gt;display('index.tpl');</pre> </td> 
        </tr> 
       </tbody> 
      </table> 
     </div> </td> 
   </tr> 
  </tbody> 
 </table> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> <br style="box-sizing: border-box;"> 你可以插入模板函数insert来使部分页面动态化。除了在右下方显示的标语外整个页面都可以缓存。在缓存内容里面可以插入函数来使标语也动态化。查看相关文档关于insert的细节和例子。</p> 
 <p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(83, 91, 96); line-height: 20px; Verdana, arial, helvetica,  font-size: 13px;"> <br style="box-sizing: border-box;"> 你可以用clear_all_cache()来清除所有缓存，或用clear_cache()来清除单个缓存文档。</p> 
 <table border="0" cellpadding="0" cellspacing="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; color: rgb(83, 91, 96); font-size: 14px; line-height: 20px; Verdana, arial, helvetica, " width="100%"> 
  <tbody style="box-sizing: border-box;"> 
   <tr style="box-sizing: border-box;"> 
    <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;"> <br style="box-sizing: border-box;"> <p style="box-sizing: border-box; margin: 0px 0px 10px;"> <span style="box-sizing: border-box; font-weight: 700;">Example 14-5. clearing the cache<br style="box-sizing: border-box;"> 例14-5.清除缓存</span></p> 
     <table bgcolor="#E0E0E0" border="0" style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; max-width: 100%; background-color: transparent;" width="100%"> 
      <tbody style="box-sizing: border-box;"> 
       <tr style="box-sizing: border-box;"> 
        <td style="box-sizing: border-box; padding: 0px; font-size: 10pt;"> <pre class="PROGRAMLISTING" style="box-sizing: border-box; overflow: auto; Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; padding: 9.5px; line-height: 1.42857143; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border-color: rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(245, 245, 245);">
require('Smarty.class.php');
$smarty = new Smarty;

$smarty-&gt;caching = true;

// clear out all cache files
$smarty-&gt;clear_all_cache();

// clear only cache for index.tpl
$smarty-&gt;clear_cache('index.tpl');

$smarty-&gt;display('index.tpl');</pre> </td> 
       </tr> 
      </tbody> 
     </table> </td> 
   </tr> 
  </tbody> 
 </table> 
 <br> 
 <br>      
</div></body></html>
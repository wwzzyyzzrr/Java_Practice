<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Scrapy日志</h1><div style="width:100%;float:left;" class="article-content">   
 <p>日志记录是指使用内置的日志系统和定义的函数或类来实现应用程序和库的事件跟踪。 记录日志是一个即用型的程序库，它可以在Scrapy设置日志记录中的设置列表工作。 Scrapy将运行命令时使用 <em>scrapy.utils.log.configure_logging()</em> 设置一些默认设置和如何处理这些设置。</p> 
 <h2 id="h2--log-levels"><a name="日志级别 - Log levels" class="reference-link"></a><span class="header-link octicon octicon-link"></span>日志级别 - Log levels</h2>
 <p>在Python中日志消息有五种不同级别的严重程度。下面的列表以升序显示标准的日志消息：</p> 
 <ul> 
  <li><p><code>logging.DEBUG</code> - 用于调试信息（最低严重性）</p> </li>
  <li><p><code>logging.INFO</code> - 用于信息消息</p> </li>
  <li><p><code>logging.WARNING</code> - 用于警告消息</p> </li>
  <li><p><code>logging.ERROR</code>- 用于正则错误</p> </li>
  <li><p><code>logging.CRITICAL</code> - 用于严重错误（最高严重性）</p> </li>
 </ul> 
 <h2 id="h2-u5982u4F55u8BB0u5F55u6D88u606F"><a name="如何记录消息" class="reference-link"></a><span class="header-link octicon octicon-link"></span>如何记录消息</h2>
 <p>下面给出简单的代码显示日志记录是使用 logging.info 级别的消息。</p> 
 <pre><code>import logging
logging.info("This is an information")
</code></pre>
 <p>以上日志信息可以通过使用 logging.log 参数传递，如下所示：</p> 
 <pre><code>import logging
logging.log(logging.INFO, "This is an information")
</code></pre>
 <p>现在，也可以使用 loggers 来关闭消息，通过记录日志助手来获取日志消息，如下图所示：</p> 
 <pre><code>import logging
logger = logging.getLogger()
logger.info("This is an information")
</code></pre>
 <p>可以有多个记录器，可以通过 logging.getLogger()函数使用名字进行访问，如下图所示。</p> 
 <pre><code>import logging
logger = logging.getLogger('mycustomlogger')
logger.info("This is an information")
</code></pre>
 <p>自定义记录器可以通过使用模块路径 <strong>name</strong> 变量用于其它任何模块中，如下所示：</p> 
 <pre><code>import logging
logger = logging.getLogger(__name__)
logger.info("This is an information")
</code></pre>
 <h2 id="h2-spider-"><a name="Spider的日志记录" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Spider的日志记录</h2>
 <p>每个 spider 实例都有一个内置记录器，并可调用如下：</p> 
 <pre><code>import scrapy
class LogSpider(scrapy.Spider):

    name = 'logspider'
    start_urls = ['http://dmoz.com']

    def parse(self, response):
        self.logger.info('Parse function called on %s', response.url)
</code></pre>
 <p>在上面的代码中，logger是使用蜘蛛的名字创建的，但您可以使用Python提供的自定义 logger，如下面的代码：</p> 
 <pre><code>import logging
import scrapy

logger = logging.getLogger('customizedlogger')
class LogSpider(scrapy.Spider):

    name = 'logspider'
    start_urls = ['http://dmoz.com']

    def parse(self, response):
        logger.info('Parse function called on %s', response.url)
</code></pre>
 <h2 id="h2-u65E5u5FD7u8BB0u5F55u914Du7F6E"><a name="日志记录配置" class="reference-link"></a><span class="header-link octicon octicon-link"></span>日志记录配置</h2>
 <p>记录器不能够显示由自己发出消息。因此，它们需要“处理程序”显示这些消息，以及处理程序将它们被重定向这些消息到各自的目的地，如文件，电子邮件，标准输出。</p> 
 <p>根据下面的设置，Scrapy 将配置 <em>logger</em> 的处理程序。</p> 
 <h2 id="h2-u65E5u5FD7u6D88u606Fu8BBEu7F6E"><a name="日志消息设置" class="reference-link"></a><span class="header-link octicon octicon-link"></span>日志消息设置</h2>
 <p>下面给出的设置用于配置日志记录：</p> 
 <p><em>LOG_FILE</em> 和 <em>LOG_ENABLED</em> 决定日志消息目的地。</p> 
 <p>当您设置了 <em>LOG_ENCODING</em> ，它不会显示日志输出消息。</p> 
 <p><em>LOG_LEVEL</em> 设置确定消息的严重性顺序;严重程度不高的消息将被过滤掉。</p> 
 <p><em>LOG_FORMAT</em> 和 <em>LOG_DATEFORMAT</em> 用于指定所有消息的布局。</p> 
 <p>当您设置 LOG_STDOUT 为 true ，所有的进程的标准输出和错误消息将被重定向到日志中。</p> 
 <h2 id="h2-u547Du4EE4u884Cu9009u9879"><a name="命令行选项" class="reference-link"></a><span class="header-link octicon octicon-link"></span>命令行选项</h2>
 <p>Scrapy设置可以通过命令行参数来覆盖，如下面的表：</p> 
 <table> 
  <thead> 
   <tr> 
    <th>S.N.</th> 
    <th>命令</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td> 1</td> 
    <td>—logfile FILE</td> 
    <td>覆盖 LOG_FILE</td> 
   </tr> 
   <tr> 
    <td> 2</td> 
    <td>—loglevel/-L LEVEL</td> 
    <td>覆盖 LOG_LEVEL</td> 
   </tr> 
   <tr> 
    <td> 3</td> 
    <td>—nolog</td> 
    <td>设置 LOG_ENABLED 为 false</td> 
   </tr> 
  </tbody> 
 </table> 
 <p>要手动配置日志输出，可以使用 logging.basicConfig()，如下所示：</p>   
 <pre><code>import logging
from scrapy.utils.log import configure_logging

configure_logging(install_root_handler=False)
logging.basicConfig(
    filename='logging.txt',
    format='%(levelname)s: %(your_message)s',
    level=logging.INFO
)
</code></pre>
 <p>参考 - <a target="_blank" href="https://doc.scrapy.org/en/0.24/topics/logging.html">https://doc.scrapy.org/en/0.24/topics/logging.html</a></p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Scrapy Shell</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    Scrapy&nbsp;shell&nbsp;可用于抓取数据并提示错误代码，而无需使用蜘蛛。&nbsp;Scrapy&nbsp;shell的主要目的是测试所提取的代码，XPath或CSS表达式。它还用来从中指定刮取数据的网页。 
  </div> 
 </div> 
 <div> 
  <h2> 
   <div>
     配置Shell 
   </div> </h2> 
  <div>
    shell&nbsp;可以通过安装&nbsp;
   <a target="_blank" href="http://ipython.org/">IPython</a>(用于交互式计算)控制台，它是强大的交互式的Shell，提供自动完成，彩色输出等功能。 
  </div> 
  <p style="text-align:justify;"> 如果您在UNIX平台上工作，那么最好安装 IPython。&nbsp;如果有IPython的无法访问,您也可以使用<a target="_blank" href="http://www.bpython-interpreter.org/">bpython</a>。 </p> 
  <div>
    您可以通过设置&nbsp;SCRAPY_PYTHON_SHELL 环境变量或者在 scrapy.cfg 文件中定义配置&nbsp;Shell，如下图所示： 
  </div> 
  <pre>[settings]
shell = bpython</pre> 
  <h2> 启动Shell </h2> 
  <div>
    Scrapy&nbsp;shell&nbsp;可以用下面的命令来启动： 
  </div> 
  <pre>scrapy shell &lt;url&gt;</pre> 
  <div>
    url 是指定为需要进行数据抓取的URL 
  </div> 
  <h2> 使用Shell </h2> 
  <div>
    shell提供一些附加快捷方式和Scrapy对象，如下所述： 
  </div> 
  <h3> 
   <div>
     可用快捷方式 
   </div> </h3> 
  <div>
    shell提供可在项目中使用的快捷方式如下： 
  </div> 
  <table border="1" cellpadding="2" cellspacing="0"> 
   <tbody> 
    <tr> 
     <th style="border:1px solid #999999;"> S.N </th> 
     <th style="border:1px solid #999999;"> 
      <div>
        快捷方式和说明 
      </div> </th> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;"> 1 </td> 
     <td style="border:1px solid #999999;"> shelp()<br> 
      <div>
        它提供了可用对象和快捷方式的帮助选项 
      </div> </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;"> 2 </td> 
     <td style="border:1px solid #999999;"> fetch(request_or_url)<br> 
      <div>
        它会从请求或URL的响应收集相关对象可能的更新 
      </div> </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;"> 3 </td> 
     <td style="border:1px solid #999999;"> view(response)<br> 可以在本地浏览器查看特定请求的响应，观察和正确显示外部链接，追加基本标签到响应正文。 </td> 
    </tr> 
   </tbody> 
  </table> 
  <h3> 
   <div>
     可用Scrapy对象 
   </div> </h3> 
  <div>
    shell在项目中提供以下可用Scrapy对象： 
  </div> 
  <table border="1" cellpadding="2" cellspacing="0"> 
   <tbody> 
    <tr> 
     <th style="border:1px solid #999999;"> S.N. </th> 
     <th style="border:1px solid #999999;"> 
      <div>
        对象和说明 
      </div> </th> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;"> 1 </td> 
     <td style="border:1px solid #999999;"> crawler<br> 
      <div>
        它指定当前爬行对象 
      </div> </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;"> 2 </td> 
     <td style="border:1px solid #999999;"> spider<br> 
      <div>
        如果对于当前网址没有蜘蛛，那么它将通过定义新的蜘蛛处理URL或蜘蛛对象 
      </div> </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;"> 3 </td> 
     <td style="border:1px solid #999999;"> request<br> 
      <div>
        它指定了最后采集页面请求对象 
      </div> </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;"> 4 </td> 
     <td style="border:1px solid #999999;"> response<br> 
      <div>
        它指定了最后采集页面响应对象 
      </div> </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;"> 5 </td> 
     <td style="border:1px solid #999999;"> settings<br> 
      <div>
        它提供当前Scrapy设置 
      </div> </td> 
    </tr> 
   </tbody> 
  </table> 
  <h2> 
   <div>
     Shell会话示例 
   </div> </h2> 
  <div>
    让我们试着刮取 scrapy.org 网站，然后开始从 yiibai.com 抓取数据，如下所述： 
  </div> 
  <div>
    在继续之前，我们将首先启动shell，执行如下面的命令： 
  </div> 
  <pre>scrapy shell 'http://scrapy.org' --nolog</pre> 
  <div>
    当使用上面的URL，Scrapy将显示可用的对象： 
  </div>   
  <pre>[s] Available Scrapy objects:
[s]   crawler    
[s]   item       {}
[s]   request    
[s]   response   &lt;200 http://scrapy.org&gt;
[s]   settings   
[s]   spider     
[s] Useful shortcuts:
[s]   shelp()           Provides available objects and shortcuts with help option
[s]   fetch(req_or_url) Collects the response from the request or URL and associated objects will get update
[s]   view(response)    View the response for the given request</pre> 
  <div>
    接着，对象的工作开始，如下所示： 
  </div> 
  <pre>&gt;&gt; response.xpath('//title/text()').extract_first()
u'Scrapy | A Fast and Powerful Scraping and Web Crawling Framework'

&gt;&gt; fetch("http://reddit.com")
[s] Available Scrapy objects:
[s]   crawler    
[s]   item       {}
[s]   request    
[s]   response   &lt;200 https://www.yiibai.com/&gt;
[s]   settings   
[s]   spider     
[s] Useful shortcuts:
[s]   shelp()           Shell help (print this help)
[s]   fetch(req_or_url) Fetch request (or URL) and update local objects
[s]   view(response)    View response in a browser

&gt;&gt; response.xpath('//title/text()').extract()
[u'reddit: the front page of the internet']

&gt;&gt; request = request.replace(method="POST")

&gt;&gt; fetch(request)
[s] Available Scrapy objects:
[s]   crawler    
...</pre> 
  <h2> 
   <div>
     从Spider检查响应调用Shell 
   </div> </h2> 
  <div>
    您可以检查它是由蜘蛛处理的响应，只有期望得到的响应。 
  </div> 
  <div>
    例如： 
  </div> 
  <pre>import scrapy
class SpiderDemo(scrapy.Spider):
    name = "spiderdemo"
    start_urls = [
        "http://yiibai.com",
        "http://yiibai.org",
        "http://yiibai.net",
    ]

    def parse(self, response):
        # You can inspect one specific response
        if ".net" in response.url:
            from scrapy.shell import inspect_response
            inspect_response(response, self)</pre> 
  <div>
    正如上面的代码所示，可以从蜘蛛调用shell，通过使用下面的函数来检查响应： 
  </div> 
  <pre>scrapy.shell.inspect_response</pre> 
  <div>
    现在运行的蜘蛛，应该会得到如下界面： 
  </div> 
  <pre>2016-02-08 18:15:20-0400 [scrapy] DEBUG: Crawled (200)  (referer: None)
2016-02-08 18:15:20-0400 [scrapy] DEBUG: Crawled (200)  (referer: None)
2016-02-08 18:15:20-0400 [scrapy] DEBUG: Crawled (200)  (referer: None)
[s] Available Scrapy objects:
[s]   crawler    
...

&gt;&gt; response.url
'http://yiibai.org'</pre> 
  <div>
    您可以使用下面的代码检查提取的代码是否正常工作： 
  </div> 
  <pre>&gt;&gt; response.xpath('//div[@class="val"]')
It displays the output as
[]</pre> 
  <div>
    上面一行只显示空白输出。现在可以调用 shell 来检查响应，如下图所示： 
  </div> 
  <pre>&gt;&gt; view(response)
It displays the response as
True</pre> 
 </div>
 <br>      
</div></body></html>
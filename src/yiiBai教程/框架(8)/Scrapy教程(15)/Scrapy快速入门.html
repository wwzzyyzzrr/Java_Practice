<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Scrapy快速入门</h1><div style="width:100%;float:left;" class="article-content">   
 <h2 id="h2-scrapy-"><a name="Scrapy快速入门" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Scrapy快速入门</h2>
 <p>最好的学习方法是参考例子，Scrapy 也不例外。出于这个原因，有一个 Scrapy 项目名为 quotesbot 例子，可以参考它了解和使用 Scrapy。它包含两个蜘蛛用于抓取 <a target="_blank" href="http://quotes.toscrape.com">http://quotes.toscrape.com</a>, 一个使用CSS选择器，而另一个使用XPath表达式。</p> 
 <blockquote> 
  <p>提示：安装 Scrapy 开发环境配置请参考 - <a target="_blank" href="http://www.yiibai.com/scrapy/scrapy_environment.html" title="http://www.yiibai.com/scrapy/scrapy_environment.html">http://www.yiibai.com/scrapy/scrapy_environment.html</a></p> 
 </blockquote> 
 <p>项目 quotesbot 的源代码可在： <a target="_blank" href="https://github.com/scrapy/quotesbot" title="https://github.com/scrapy/quotesbot">https://github.com/scrapy/quotesbot</a>. 在这里可以找到关于项目 README 更多信息。</p> 
 <p>如果你熟悉使用 <a target="_blank" href="http://www.yiibai.com/git/" title="Git">Git</a>，可以检出的代码。否则点击<a target="_blank" href="https://github.com/scrapy/quotesbot/archive/master.zip" title="这里下载">这里下载</a>该项目源代码的 zip 文件。<br>现在我们一步步的了解和学习这个项目。</p> 
 <h2 id="h2-quotesbot-"><a name="quotesbot 项目简介" class="reference-link"></a><span class="header-link octicon octicon-link"></span>quotesbot 项目简介</h2>
 <p>这是一个 <code>Scrapy</code> 示例（入门）的项目，它实现从 <a target="_blank" href="http://quotes.toscrape.com" title="http://quotes.toscrape.com">http://quotes.toscrape.com</a> 上爬行抓取名人名言。</p> 
 <p>这个项目只是针对学习演示目的。</p> 
 <h3 id="h3-u63D0u53D6u6570u636E"><a name="提取数据" class="reference-link"></a><span class="header-link octicon octicon-link"></span>提取数据</h3>
 <p>这个项目将提取名言，以及各自的作者姓名和标签相结合。提取的数据看起来是这样的，如下例子：</p> 
 <pre><code class="lang-json">{
    'author': 'Douglas Adams',
    'text': '“I may not have gone where I intended to go, but I think I ...”',
    'tags': ['life', 'navigation']
}
</code></pre> 
 <h2 id="h2--spiders"><a name="蜘蛛 - Spiders" class="reference-link"></a><span class="header-link octicon octicon-link"></span>蜘蛛 - Spiders</h2>
 <p>该项目包含两个蜘蛛(<code>Spider</code>)，可以使用 <code>list</code> 命令列出它们：</p> 
 <pre><code class="lang-shell">$ scrapy list
toscrape-css
toscrape-xpath
</code></pre> 
 <p>这两种蜘蛛提取同一网站相同的数据，但是如果要刮取 <code>CSS</code>，则使用 <code>CSS</code> 选择器，而要刮取 <code>XPath</code> 则采用 <code>XPath</code> 表达式。</p> 
 <p>您可以通过<a target="_blank" href="http://www.yiibai.com/scrapy/" title="Scrapy教程">Scrapy教程</a>去了解更多的蜘蛛。</p> 
 <h2 id="h2-u8FD0u884Cu8718u86DB"><a name="运行蜘蛛" class="reference-link"></a><span class="header-link octicon octicon-link"></span>运行蜘蛛</h2>
 <p>您可以使用 <code>scrapy</code> 爬行的命令，如运行一个蜘蛛：</p> 
 <pre><code>$ scrapy crawl toscrape-css
</code></pre>
 <p>如果想保存数据刮到一个文件，可以通过 <code>-o</code> 选项：</p> 
 <pre><code>$ scrapy crawl toscrape-css -o quotes.json
</code></pre>
 <h2 id="h2-u4EE3u7801u5B9Eu73B0"><a name="代码实现" class="reference-link"></a><span class="header-link octicon octicon-link"></span>代码实现</h2>
 <p>我们先来看看 <code>quotesbot/spiders/toscrape-xpath.py</code> 的代码实现 - </p>   
 <pre><code class="lang-python"># -*- coding: utf-8 -*-
import scrapy


class ToScrapeSpiderXPath(scrapy.Spider):
    name = 'toscrape-xpath'
    start_urls = [
        'http://quotes.toscrape.com/',
    ]

    def parse(self, response):
        for quote in response.xpath('//div[@class="quote"]'):
            yield {
                'text': quote.xpath('./span[@class="text"]/text()').extract_first(),
                'author': quote.xpath('.//small[@class="author"]/text()').extract_first(),
                'tags': quote.xpath('.//div[@class="tags"]/a[@class="tag"]/text()').extract()
            }

        next_page_url = response.xpath('//li[@class="next"]/a/@href').extract_first()
        if next_page_url is not None:
            yield scrapy.Request(response.urljoin(next_page_url))
</code></pre> 
 <p>另外一个 Spider 采用 XPath 表达式 <code>quotesbot/spiders/toscrape-xpath.py</code> 的代码实现 - </p> 
 <pre><code class="lang-python"># -*- coding: utf-8 -*-
import scrapy


class ToScrapeSpiderXPath(scrapy.Spider):
    name = 'toscrape-xpath'
    start_urls = [
        'http://quotes.toscrape.com/',
    ]

    def parse(self, response):
        for quote in response.xpath('//div[@class="quote"]'):
            yield {
                'text': quote.xpath('./span[@class="text"]/text()').extract_first(),
                'author': quote.xpath('.//small[@class="author"]/text()').extract_first(),
                'tags': quote.xpath('.//div[@class="tags"]/a[@class="tag"]/text()').extract()
            }

        next_page_url = response.xpath('//li[@class="next"]/a/@href').extract_first()
        if next_page_url is not None:
            yield scrapy.Request(response.urljoin(next_page_url))
</code></pre> 
 <h2 id="h2-u53C2u8003"><a name="参考" class="reference-link"></a><span class="header-link octicon octicon-link"></span>参考</h2>
 <ul> 
  <li><a target="_blank" href="https://doc.scrapy.org/en/1.2/intro/examples.html" title="https://doc.scrapy.org/en/1.2/intro/examples.html">https://doc.scrapy.org/en/1.2/intro/examples.html</a></li>
 </ul>
 <br>      
</div></body></html>
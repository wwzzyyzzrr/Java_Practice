<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Laravel控制器</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    在MVC框架中，字母“C”代表控制器。它充当视图和模型之间的指挥中心(或桥梁)。 
  </div> 
 </div> 
 <div> 
  <h3> 
   <div>
     创建一个控制器 
   </div> </h3> 
  <div>
    打开您正在使用的操作系统上的命令提示符或终端，然后键入以下命令使用&nbsp;Artisan&nbsp;CLI&nbsp;(命令行接口)来创建控制器。 
  </div> 
  <pre>php artisan make:controller &lt;controller-name&gt; --plain&nbsp;</pre> 
  <p style="text-align:justify;"> 替换&nbsp;&lt;controller-name&gt;&nbsp;为您的控制器的名称。我们将创建一个简单的构造器使用传递一个参数—&nbsp;plain。&nbsp;如果不希望创建一个普通的构造函数，可以忽略参数。&nbsp;创建的构造函数在&nbsp;app/Http/Controllers.&nbsp;你会看到一些基本的编码已经自动生成了，你可以自定义添加编码。创建控制器可以通过routes.php文件中使用以下语法调用。 </p> 
  <h3> 语法 </h3> 
  <pre>Route::get(‘base URI’,’controller@method’);</pre> 
  <h3> 示例 </h3> 
  <div>
    第1步-&nbsp;执行以下命令来创建用户控制器&nbsp;-&nbsp;UserController。 
  </div> 
  <pre>php artisan make:controller UserController</pre> 
  <div>
    第2步&nbsp;-&nbsp;成功执行后，您会收到以下输出。
   <br> 
   <img src="/uploads/tutorial/20160508/1-16050PIJ5163.png" alt="">
   <br> 
  </div> 
  <p> 第3步&nbsp;-&nbsp;你可以在&nbsp;<strong>app/Http/Controller/UserController.php</strong>&nbsp;看到创建控制器已经自动生成一些基本的代码，您可以根据需要添加自己的编码。&nbsp; </p> 
  <pre>&lt;?php
namespace App\Http\Controllers;
use Illuminate\Http\Request;
use App\Http\Requests;
use App\Http\Controllers\Controller;

class UserController extends Controller {
   //
}</pre> 
  <h2> 
   <div>
     控制器中间件 
   </div> </h2> 
  <p> 我们已经在前面学习了中间件，它可以与控制器一起使用。中间件也可以被分配到控制器的路由或控制器的构造函数中。可以使用中间件方法来分配中间件到控制器。&nbsp;已注册中间件也可以限制到控制器的某些方法。 </p> 
  <h3> 
   <div>
     分配中间件路由 
   </div> </h3> 
  <pre>Route::get('profile', [
   'middleware' =&gt; 'auth',
   'uses' =&gt; 'UserController@showProfile'
]);</pre> 
  <div>
    在这里，我们在路由配置文件分配身份验证中间件使用到&nbsp;UserController。 
  </div> 
  <h3> 
   <div>
     控制器的构造函数中分配中间件 
   </div> </h3> 
  <pre>&lt;?php
namespace App\Http\Controllers;
use Illuminate\Http\Request;
use App\Http\Requests;
use App\Http\Controllers\Controller;

class UserController extends Controller {
   public function __construct(){
      $this-&gt;middleware('auth');
   }
}</pre> 
  <div>
    在这里，我们将身份验证分配使用中间件在UserController的构造方法。 
  </div> 
  <h3> 示例 </h3> 
  <p> 第1步&nbsp;-&nbsp;添加以下行到&nbsp;app/Http/routes.php&nbsp;文件文件并保存。 </p> 
  <p> routes.php </p> 
  <pre>&lt;?php
Route::get('/usercontroller/path',[
   'middleware' =&gt; 'First',
   'uses' =&gt; 'UserController@showPath'
]);</pre> 
  <div>
    第2步&nbsp;-&nbsp;通过执行以下行创建一个名为FirstMiddleware&nbsp;的中间件。 
  </div> 
  <pre>php artisan make:middleware FirstMiddleware</pre> 
  <div>
    第3步&nbsp;-&nbsp;添加新创建一个名为&nbsp;FirstMiddleware&nbsp;的处理方法，下面的代码在&nbsp;app/Http/Middleware/FirstMiddleware.php&nbsp;。 
  </div> 
  <p> FirstMiddleware.php </p> 
  <pre>&lt;?php
namespace App\Http\Middleware;
use Closure;

class FirstMiddleware {
   public function handle($request, Closure $next) {
      echo '&lt;br&gt;First Middleware';
      return $next($request);
   }
}</pre> 
  <div>
    第4步&nbsp;-&nbsp;通过执行以下行创建一个叫作&nbsp;SecondMiddleware&nbsp;的中间件。 
  </div> 
  <pre>php artisan make:middleware SecondMiddleware</pre> 
  <p> 第5步&nbsp;-&nbsp;添加以下代码在新创建一个处理方法&nbsp;SecondMiddleware&nbsp;在&nbsp;app/Http/Middleware/SecondMiddleware.php. </p> 
  <p> SecondMiddleware.php </p> 
  <pre>&lt;?php
namespace App\Http\Middleware;
use Closure;

class SecondMiddleware {
   public function handle($request, Closure $next){
      echo '&lt;br&gt;Second Middleware';
      return $next($request);
   }
}</pre> 
  <div>
    注册上面两个中间件，打开文件：
   <strong>app/Http/Kernel.php</strong> 
  </div> 
  <div style="background-color:inherit;"> 
   <pre class="prettyprint lang-bsh">    protected $routeMiddleware = [
        'auth' =&gt; \App\Http\Middleware\Authenticate::class,
        'auth.basic' =&gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,
        'can' =&gt; \Illuminate\Foundation\Http\Middleware\Authorize::class,
        'guest' =&gt; \App\Http\Middleware\RedirectIfAuthenticated::class,
        'throttle' =&gt; \Illuminate\Routing\Middleware\ThrottleRequests::class,
        'First'  =&gt; \App\Http\Middleware\FirstMiddleware::class,
        'Second'  =&gt; \App\Http\Middleware\SecondMiddleware::class,
    ];</pre> 
  </div> 
  <div>
    第6步&nbsp;-&nbsp;通过执行以下行创建一个名为 UserController 的控制器。 
  </div> 
  <pre>php artisan make:controller UserController</pre> 
  <div>
    第7步&nbsp;-&nbsp;URL成功执行后，您会看到以下输出&nbsp;-
   <br> 
   <img src="/uploads/tutorial/20160508/1-16050PI95Q61.png" alt="">
   <br> 
  </div> 
  <div>
    第8步&nbsp;-&nbsp;将以下代码复制到&nbsp;app/Http/UserController.php&nbsp;文件。 
  </div> 
  <p> app/Http/UserController.php </p> 
  <pre>&lt;?php
namespace App\Http\Controllers;
use Illuminate\Http\Request;
use App\Http\Requests;
use App\Http\Controllers\Controller;

class UserController extends Controller {
   public function __construct(){
      $this-&gt;middleware('Second');
   }
   public function showPath(Request $request){
      $uri = $request-&gt;path();
      echo '&lt;br&gt;URI: '.$uri;
      
      $url = $request-&gt;url();
      echo '&lt;br&gt;';
      
      echo 'URL: '.$url;
      $method = $request-&gt;method();
      echo '&lt;br&gt;';
      
      echo 'Method: '.$method;
   }
}</pre> 
  <div>
    第9步&nbsp;-&nbsp;现在，如果还没有启动PHP的内部Web服务器，可通过执行以下命令。 
  </div> 
  <pre>php artisan serve</pre> 
  <div>
    第10步&nbsp;-&nbsp;请访问以下网址。 
  </div> 
  <p> http://localhost:8000/usercontroller/path </p> 
  <div>
    第11步- 将出现如下面的输出结果。
   <br> 
   <img src="/uploads/tutorial/20160508/1-16050PJ040I4.png" alt="">
   <br> 
  </div> 
  <h2> 
   <div>
     Restful&nbsp;资源控制器 
   </div> </h2> 
  <p> 通常情况下当开发一个应用，我们需要执行CRUD(创建，读取，更新，删除)操作。Laravel使这项工作更容易做到的。只需创建一个控制器，而Laravel会提供所有的CRUD操作的方法。您也可以注册一个路由的所有方法在routes.php文件中。 </p> 
  <h3> 示例 </h3> 
  <div>
    第1步&nbsp;-&nbsp;通过执行以下命令创建一个名为 myController 的控制器。 
  </div> 
  <pre>php artisan make:controller MyController</pre> 
  <div>
    第2步&nbsp;-&nbsp;添加以下代码到文件：app/Http/Controllers/MyController.php 
  </div> 
  <p> <strong>app/Http/Controllers/MyController.php</strong> </p> 
  <pre>&lt;?php
namespace App\Http\Controllers;
use Illuminate\Http\Request;
use App\Http\Requests;
use App\Http\Controllers\Controller;

class MyController extends Controller {
   public function index(){
      echo 'index';
   }
   public function create(){
      echo 'create';
   }
   public function store(Request $request){
      echo 'store';
   }
   public function show($id){
      echo 'show';
   }
   public function edit($id){
      echo 'edit';
   }
   public function update(Request $request, $id){
      echo 'update';
   }
   public function destroy($id){
      echo 'destroy';
   }
}&nbsp;</pre> 
  <p> 第3步&nbsp;-&nbsp;添加以下代码到文件：app/Http/routes.php </p> 
  <p> <strong>app/Http/routes.php</strong> </p> 
  <pre>Route::resource('my','MyController');&nbsp;</pre> 
  <p style="font-family:Verdana, Geneva, Tahoma,  Helvetica, text-align:justify;font-size:15px !important;background-color:inherit;"> <span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">步骤4&nbsp;-&nbsp;我们现在通过使用资源控制器注册MyController&nbsp;的所有方法。</span><span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">下面是由资源控制器处理的动作的列表。</span> </p> 
  <table border="1" cellpadding="2" cellspacing="0" style="font-size:14px;color:#313131;font-family:Verdana, Geneva, Tahoma,  Helvetica, text-align:center;background-color:inherit;"> 
   <tbody> 
    <tr> 
     <th style="border:1px solid #999999;background-color:#EEEEEE;"> 
      <div style="background-color:inherit;">
        动词 
      </div> </th> 
     <th style="border:1px solid #999999;background-color:#EEEEEE;"> 路径 </th> 
     <th style="border:1px solid #999999;background-color:#EEEEEE;"> 动作 </th> 
     <th style="border:1px solid #999999;background-color:#EEEEEE;"> 
      <div style="background-color:inherit;">
        路由名称 
      </div> </th> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;background-color:inherit;"> GET </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> /my </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> index </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> my.index </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;background-color:inherit;"> GET </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> /my/create </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> create </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> my.create </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;background-color:inherit;"> POST </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> /my </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> store </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> my.store </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;background-color:inherit;"> GET </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> /my/{my} </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> show </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> my.show </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;background-color:inherit;"> GET </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> /my/{my}/edit </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> edit </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> my.edit </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;background-color:inherit;"> PUT/PATCH </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> /my/{my} </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> update </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> my.update </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;background-color:inherit;"> DELETE </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> /my/{my} </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> destroy </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> my.destroy </td> 
    </tr> 
   </tbody> 
  </table> 
  <div>
    第5步&nbsp;-&nbsp;尝试执行下表中的网址URL。 
  </div> 
  <table border="1" cellpadding="2" cellspacing="0" style="font-size:14px;color:#313131;font-family:Verdana, Geneva, Tahoma,  Helvetica, background-color:inherit;"> 
   <tbody> 
    <tr> 
     <th style="border:1px solid #999999;background-color:#EEEEEE;text-align:center;"> URL </th> 
     <th style="border:1px solid #999999;background-color:#EEEEEE;text-align:center;"> 描述 </th> 
     <th style="border:1px solid #999999;background-color:#EEEEEE;text-align:center;"> 输出图像 </th> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;background-color:inherit;"> http://localhost:8000/my </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> 执行 Controller.php 的 index 方法 </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> index </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;background-color:inherit;"> http://localhost:8000/my/create </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> 执行 Controller.php 的 <span style="color:#313131;font-family:'sans serif', tahoma, verdana, helvetica;font-size:14px;line-height:18px;">create&nbsp;</span>方法 </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> create </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;background-color:inherit;"> http://localhost:8000/my/1 </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> <span style="color:#313131;font-family:'sans serif', tahoma, verdana, helvetica;font-size:14px;line-height:18px;">执行 Controller.php 的 <span style="color:#313131;font-family:'sans serif', tahoma, verdana, helvetica;font-size:14px;line-height:18px;">show</span>方法</span> </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> show </td> 
    </tr> 
    <tr> 
     <td style="border:1px solid #999999;background-color:inherit;"> http://localhost:8000/my/1/edit </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> <span style="color:#313131;font-family:'sans serif', tahoma, verdana, helvetica;font-size:14px;line-height:18px;">执行 Controller.php 的 <span style="color:#313131;font-family:'sans serif', tahoma, verdana, helvetica;font-size:14px;line-height:18px;">edit</span>方法</span> </td> 
     <td style="border:1px solid #999999;background-color:inherit;"> edit </td> 
    </tr> 
   </tbody> 
  </table> 
  <h2> 
   <div>
     隐式控制器 
   </div> </h2> 
  <p> 隐式控制器允许你定义一个路由处理控制器中的每一个动作。如下图所示使用&nbsp;Route:controller&nbsp;方法，在路由文件&nbsp;route.php&nbsp;中定义它。 </p>   
  <pre>Route::controller(‘base URI’,’&lt;class-name-of-the-controller&gt;’);</pre> 
  <div>
    替换&nbsp;&lt;class-name-of-the-controller&gt;使用你给定控制器类名。 
  </div> 
  <p> 控制器的方法名应该是类似&nbsp;GET或POST&nbsp;HTTP动词开头。如果以&nbsp;get&nbsp;开始，它只会处理&nbsp;get&nbsp;请求，如果它使用 post 开駋那么将处理post请求。在HTTP动词后，可以方法使用任何名称，但它应遵循 URI 的格式。 </p> 
  <h3> 示例 </h3> 
  <p> 第1步&nbsp;-&nbsp;执行下面的命令来创建一个控制器。其类名称为&nbsp;ImplicitController。这个类你也可以使用其它的任何名称。 </p> 
  <pre>php artisan make:controller ImplicitController</pre> 
  <div>
    第2步&nbsp;-&nbsp;成功执行后，会产生以下输出&nbsp;- 
  </div> 
  <div>
    第3步&nbsp;-&nbsp;将以下代码复制到 app/Http/Controllers/ImplicitController.php 文件。 
  </div> 
  <p style="font-family:Verdana, Geneva, Tahoma,  Helvetica, text-align:justify;font-size:15px !important;background-color:inherit;"> <b>app/Http/Controllers/ImplicitController.php</b> </p> 
  <pre>&lt;?php
namespace App\Http\Controllers;
use Illuminate\Http\Request;
use App\Http\Requests;
use App\Http\Controllers\Controller;

class ImplicitController extends Controller {
   /**
   * Responds to requests to GET /test
   */
   public function getIndex(){
      echo 'index method';
   }
   
   /**
   * Responds to requests to GET /test/show/1
   */
   public function getShow($id){
      echo 'show method';
   }
   
   /**
   * Responds to requests to GET /test/admin-profile
   */
   public function getAdminProfile(){
      echo 'admin profile method';
   }
   
   /**
   * Responds to requests to POST /test/profile
   */
   public function postProfile(){
      echo 'profile method';
   }
}</pre> 
  <div>
    第4步&nbsp;-&nbsp;下面的行添加到&nbsp;app/Http/routes.php&nbsp;以将请求路由到指定的控制器。 
  </div> 
  <p> <strong>app/Http/routes.php</strong> </p> 
  <pre>Route::controller('test','ImplicitController');</pre> 
  <h2> 
   <div>
     构造器注入 
   </div> </h2> 
  <p> Laravel服务容器是用来解析所有Laravel控制器。因此，你能够输入-提示控制器也许需要在其构造依赖。依赖关系将被自动解析和注射到控制器实例。 </p> 
  <h3> 示例 </h3> 
  <div>
    步骤1&nbsp;-&nbsp;下面的代码添加到 app/Http/routes.php 文件。 
  </div> 
  <p> <strong>app/Http/routes.php</strong> </p> 
  <pre>class MyClass{
   public $foo = 'bar';
}
Route::get('/myclass','ImplicitController@index');</pre> 
  <div>
    第2步&nbsp;-&nbsp;下面的代码添加到 app/Http/Controllers/ImplicitController.php 文件。 
  </div> 
  <p> <strong>app/Http/Controllers/ImplicitController.php</strong> </p> 
  <pre>&lt;?php
namespace App\Http\Controllers;
use Illuminate\Http\Request;
use App\Http\Requests;
use App\Http\Controllers\Controller;

class ImplicitController extends Controller {
   private $myclass;
   
   public function __construct(\MyClass $myclass){
      $this-&gt;myclass = $myclass;
   }
   public function index(){
      dd($this-&gt;myclass);
   }
}</pre> 
  <div>
    第3步&nbsp;-&nbsp;访问以下网址来测试构造器注入。 
  </div> 
  <p> <strong>http://localhost:8000/myclass</strong> </p> 
  <div>
    第4步&nbsp;-&nbsp;输出结果如下面图所示。
   <br> 
   <img src="/uploads/tutorial/20160508/1-16050PJH04X.png" alt="">
   <br> 
  </div> 
  <h2> 
   <div>
     方法注入 
   </div> </h2> 
  <div>
    除了构造器注入，也可以输入&nbsp;-&nbsp;在你的控制器操作方法触发依赖。 
  </div> 
  <h3> 示例 </h3> 
  <div>
    步骤1&nbsp;-&nbsp;下面的代码添加到&nbsp;app/Http/routes.php&nbsp;文件。 
  </div> 
  <p> <strong>app/Http/routes.php</strong> </p> 
  <pre>class MyClass{
   public $foo = 'bar';
}
Route::get('/myclass','ImplicitController@index');</pre> 
  <div>
    第2步&nbsp;-&nbsp;下面的代码添加到 app/Http/Controllers/ImplicitController.php 文件。 
  </div> 
  <p> <strong>app/Http/Controllers/ImplicitController.php</strong> </p> 
  <pre>&lt;?php
namespace App\Http\Controllers;
use Illuminate\Http\Request;
use App\Http\Requests;
use App\Http\Controllers\Controller;

class ImplicitController extends Controller {
   public function index(\MyClass $myclass){
      dd($myclass);
   }
} </pre> 
  <div>
    第3步&nbsp;-&nbsp;访问以下网址来测试构造器注入。 
  </div> 
  <p> <strong>http://localhost:8000/myclass</strong> </p> 
  <div>
    它会产生下面的输出&nbsp;-
   <br> 
   <img src="/uploads/tutorial/20160508/1-16050PJP1111.png" alt="">
   <br> 
  </div> 
 </div>
 <br>      
</div></body></html>
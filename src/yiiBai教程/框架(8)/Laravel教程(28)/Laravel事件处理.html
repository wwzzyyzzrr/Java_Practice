<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Laravel事件处理</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    事件是通过程序所识别并程序可进行处理的动作或发生。Laravel事件只是提供了一个观察者的实现。事件可以通过以下步骤来处理&nbsp;- 
  </div> 
 </div> 
 <div> 
  <div>
    第1步&nbsp;-&nbsp;创建一个事件类。 
  </div> 
  <div>
    事件类可以通过执行以下命令来创建。 
  </div> 
  <pre>php artisan make:event &lt;event-class&gt;&nbsp;</pre> 
  <p style="text-align:justify;"> 在这里，&lt;event-class&gt;应使用事件类的名称来代替。创建的类将被存储在&nbsp;app\Events&nbsp;目录。 </p> 
  <div>
    第2步&nbsp;-&nbsp;创建一个处理类来处理创建的事件。
   <br> 
   <img src="/uploads/tutorial/20160516/1-16051621492C05.png" alt="">
   <br> 
  </div> 
  <div>
    事件处理类可以通过执行以下命令来创建。 
  </div> 
  <pre>php artisan handler:event &lt;handler-class&gt; --event = &lt;event-class&gt;&nbsp;</pre> 
  <p style="text-align:justify;"> 在这里，&lt;event-class&gt;应使用我们在步骤1来代替应，&lt;handler-class&gt;&nbsp;创建事件类的名称使用处理程序类的名称来取代。新创建的处理程序类将被存储在app\Handlers\Events&nbsp;目录。 </p> 
  <div>
    第3步&nbsp;-&nbsp;注册事件类及其事件服务提供者类处理程序。 
  </div> 
  <p style="text-align:justify;"> 现在，我们需要注册该事件在文件&nbsp;-&nbsp;app\Providers\EventServiceProvier.php。&nbsp;此文件包含一个数组：$listen。在这个数组，我们需要事件类添加作为键以及事件处理程序类作为它的值。 </p> 
  <div>
    第4步&nbsp;-&nbsp;触发事件。 
  </div> 
  <p style="text-align:justify;"> 最后一步是触发使用事件门面触发事伯。fire()方法由事件类的对象调用。事件可以触发如下&nbsp;- </p> 
  <pre>Event::fire(&lt;Event Class Object&gt;);</pre> 
  <div>
    &lt;Event&nbsp;Class&nbsp;Object&gt;应使用事件类的对象来代替。 
  </div> 
  <h2> 实例 </h2> 
  <div>
    第1步&nbsp;-&nbsp;通过执行以下命令来创建一个名为CreateStudent&nbsp;的控制器。 
  </div> 
  <pre>php artisan make:controller CreateStudentController </pre> 
  <div>
    第2步&nbsp;-&nbsp;成功执行后，您会收到以下输出&nbsp;-
   <br> 
   <img src="/uploads/tutorial/20160516/1-16051621515KI.png" alt="">
   <br> 
  </div> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/bd30840fe30746b6a15acb98c66f6e52/clipboard.png">
  <br> 
  <div>
    第3步&nbsp;-&nbsp;复制下面的代码到文件&nbsp;-&nbsp;app/Http/Controllers/CreateStudentController.php 
  </div> 
  <p style="text-align:justify;"> app/Http/Controllers/CreateStudentController.php </p> 
  <pre>&lt;?php
namespace App\Http\Controllers;
use Illuminate\Http\Request;
use DB;
use App\Http\Requests;
use App\Http\Controllers\Controller;
use App\Events\StudentAdded;
use Event;

class CreateStudentController extends Controller {
   public function insertform(){
      return view('stud_add');
   }
   
   public function insert(Request $request){
      $name = $request-&gt;input('stud_name');
<pre>      $age = $request-&gt;input('stud_age');</pre>
DB::insert('insert into student (name,age) values(?, ?)',[$name, $age]);
      echo "Record inserted successfully.&lt;br/&gt;";
      echo '&lt;a href = "/event"&gt;Click Here&lt;/a&gt; to go back.';
      //firing an event
      Event::fire(new StudentAdded($name));
   }
}</pre> 
  <div>
    第4步-&nbsp;创建通过执行以下命令添加名为 StudentAdded&nbsp;的事件。 
  </div> 
  <pre>php artisan make:event StudentAdded</pre> 
  <div>
    第5步&nbsp;-&nbsp;成功执行后，您会收到以下输出&nbsp;-
   <br> 
   <img src="/uploads/tutorial/20160516/1-160516215143S3.png" alt="">
   <br> 
  </div> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/0a9c42eca329485a9ab1cc2d8654ce7d/clipboard.png">
  <br> 
  <div>
    第6步&nbsp;-&nbsp;上面的命令将在&nbsp;App\Events\StudentAdded.php&nbsp;文件创建事件。复制以下代码到该文件中。 
  </div> 
  <p style="text-align:justify;"> App\Events\StudentAdded.php </p> 
  <pre>&lt;?php
namespace App\Events;
use App\Events\Event;
use Illuminate\Queue\SerializesModels;
use Illuminate\Contracts\Broadcasting\ShouldBroadcast;

class StudentAdded extends Event {
   use SerializesModels;
   public $name;
  
   public function __construct($name) {
      $this-&gt;name = $name;
   }
   public function broadcastOn() {
      return [];
   }
}</pre> 
  <p style="text-align:justify;"> 第9步&nbsp;- 创建一个事件处理文件在&nbsp;app\Handlers\Events\HandleNewStudentAdded.php，复制以下代码到该文件中。 </p> 
  <p style="text-align:justify;"> app\Handlers\Events\HandleNewStudentAdded.php </p>   
  <pre>&lt;?php
namespace App\Handlers\Events;
use App\Events\StudentAdded;
use Illuminate\Queue\InteractsWithQueue;
use Illuminate\Contracts\Queue\ShouldQueue;

class HandleNewStudentAdded {
   protected $name;
   
   public function __construct() {
      //
   }
   public function handle(StudentAdded $event) {
      $this-&gt;name = $event-&gt;name;
      echo "&lt;br&gt;&lt;u&gt;New Student added in database with name: &lt;/u&gt;".$this-&gt;name;
   }
}&nbsp;</pre> 
  <p style="text-align:justify;"> 第10步&nbsp;-&nbsp;现在，我们需要添加事件类和处理程序类存储在文件&nbsp;-&nbsp;app\Providers\EventServiceProvider.php </p> 
  <p style="text-align:justify;"> app\Providers\EventServiceProvider.php </p> 
  <pre>&lt;?php
namespace App\Providers;
use Illuminate\Contracts\Events\Dispatcher as DispatcherContract;
use Illuminate\Foundation\Support\Providers\EventServiceProvider as ServiceProvider;

class EventServiceProvider extends ServiceProvider {
   /**
   * The event listener mappings for the application.
   *
   * @var array
   */
   protected $listen = [
      'App\Events\SomeEvent' =&gt; [
         'App\Listeners\EventListener',
      ],
   
      'App\Events\StudentAdded' =&gt; [
         'App\Handlers\Events\HandleNewStudentAdded',
      ],
   ];
   /**
   * Register any other events for your application.
   *
   * @param \Illuminate\Contracts\Events\Dispatcher $events
   * @return void
   */
   public function boot(DispatcherContract $events) {
      parent::boot($events);
      //
   }
}</pre> 
  <div>
    第11步-&nbsp;添加以下行到文件&nbsp;-&nbsp;app/Http/routes.php 
  </div> 
  <p style="text-align:justify;"> app/Http/routes.php </p> 
  <pre>Route::get('event','CreateStudentController@insertform');
Route::post('addstudent','CreateStudentController@insert');</pre> 
  <div>
    第12步&nbsp;-&nbsp;访问以下网址测试活动。 
  </div> 
  <p style="text-align:justify;"> http://localhost:8000/event </p> 
  <div>
    第13步&nbsp;-&nbsp;访问上述网址后，您会收到以下输出&nbsp;-
   <br> 
   <img src="/uploads/tutorial/20160516/1-16051621542V46.png" alt="">
   <br> 
  </div> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/53a245af8a2f435b97a20bc9f90467c6/clipboard.png">
  <br> 
  <p style="text-align:justify;"> 第14步&nbsp;-&nbsp;增加学生的姓名，然后点击“添加学生”按钮，将您重定向到下面的屏幕。看看灰色高亮行。&nbsp;我们已经指定处理方法，在一个事件被触发执行HandleNewStudentAdded类的处理方法时添加此行。<br> <img src="/uploads/tutorial/20160516/1-1605162154501S.png" alt=""> </p> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/2f563ebccb204ef0b1f346e09660be4d/clipboard.png">
  <br> 
 </div>
 <br>      
</div></body></html>
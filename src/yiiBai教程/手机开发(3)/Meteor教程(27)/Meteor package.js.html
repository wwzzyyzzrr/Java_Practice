<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Meteor package.js</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    在本章中，我们将学习如何创建自己的&nbsp;meteor&nbsp;包。 
  </div> 
 </div> 
 <div> 
  <h2> 
   <div>
     创建包 
   </div> </h2> 
  <div>
    让我们添加在桌面上的新文件夹用来创建新的包。使用命令提示符窗口执行如下命令。 
  </div> 
  <pre>C:\Users\Administrator\Desktop\meteorApp&gt; mkdir packages&nbsp;</pre> 
  <p style="font-family:Verdana, Geneva, Tahoma,  Helvetica, text-align:justify;font-size:15px !important;background-color:inherit;"> <span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">现在我们可以在上面创建的文件夹中创建你的包。</span><span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">运行命令提示符运行以下命令。</span><span style="background-color:inherit;font-family:微软雅黑;font-size:14px;line-height:1.5;">Username&nbsp;是您的&nbsp;Meteor&nbsp;开发者的用户名和package-name是你的包的名称。</span> </p> 
  <pre>C:\Users\Administrator\Desktop\meteorApp\packages&gt;meteor create --package username:package-name</pre> 
  <h2> 添加包 </h2> 
  <p> 为了能够本地包添加到我们的应用程序，需要设置环境变量(ENVIRONMENT&nbsp;VARIABLE)，将告诉&nbsp;meteor&nbsp;从本地文件夹加载包。右键单击"计算机"图标，然后选择属性/高级系统设置/环境变量/新建。 </p> 
  <p> 变量名应该是PACKAGE_DIR变量值路径应该是指向创建的文件夹。在我们的示例中是：C:\Users\Administrator\Desktop\meteorApp\packages. </p> 
  <div>
    注意：不要忘记在添加新的环境变量后重新启动命令提示符。 
  </div> 
  <div>
    现在，我们可以运行下面的代码将包添加到我们的应用程序- 
  </div> 
  <pre>C:\Users\Administrator\Desktop\meteorApp&gt;meteor add username:package-name</pre> 
  <h2> 包文件 </h2> 
  <div>
    如果打开创建软件包的文件夹，你会看到四个文件。 
  </div> 
  <ul> 
   <li> package-name-test.js </li> 
   <li> package-name.js </li> 
   <li> package.js </li> 
   <li> README.md </li> 
  </ul> 
  <h2> 测试包(package-name-test.js) </h2> 
  <div>
    Meteor&nbsp;提供&nbsp;tinytest 包用于测试。让我们先从命令提示符窗口来安装它。 
  </div> 
  <pre>C:\Users\Adminitrator\Desktop\meteorApp&gt;meteor add tinytest</pre> 
  <p> 如果你打开&nbsp;package-name-test.js,&nbsp;你会看到默认的测试例子。我们将用这个例子来测试应用程序。开发&nbsp;Meteor&nbsp;包时，你应该要写写自己的测试。 </p> 
  <div>
    要测试包，需要运行在命令提示符下此代码。 
  </div> 
  <pre> C:\Users\Administrator\Desktop&gt;meteor test-packages packages/package-name</pre> 
  <div>
    你应该得到以下结果。
   <br> 
   <img src="/uploads/tutorial/20160426/1-16042621531AA.jpg" alt="">
   <br> 
  </div> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/f813bd97ed6149aea23c9ad556b078ba/age-js-test.jpeg" alt="Meteor Package Test"> 
  <h2> package.js文件 </h2> 
  <p> 我们可以在这个文件中编写代码。现在我们在包中实现一些简单的功能。包将日志记录一些文本到控制台。 </p> 
  <h3> packages/package.js </h3> 
  <pre>myPackageFunction = function() {
   console.log('This is simple package...');
}</pre> 
  <h2> package-name.js文件 </h2> 
  <p> 这是我们可以设定一些程序包配置文件。&nbsp;我们一会再回到它，但现在需要导出myPackageFunction，就可以在应用程序中使用它了。我们需要添加这些到&nbsp;Package.onUse&nbsp;函数内。该文件将是这个样子。 </p> 
  <h3> packages/package-name.js </h3> 
  <pre>Package.describe({
   name: 'username:package-name',
   version: '0.0.1',
   // Brief, one-line summary of the package.
   summary: '',
   // URL to the Git repository containing the source code for this package.
   git: '',
   // By default, Meteor will default to using README.md for documentation.
   // To avoid submitting documentation, set this field to null.
   documentation: 'README.md'
});

Package.onUse(function(api) {
   api.versionsFrom('1.2.1');
   api.use('ecmascript');
   api.addFiles('mypackage.js');
   api.export('myPackageFunction'); // We are exporting the function we created above...
});

Package.onTest(function(api) {
   api.use('ecmascript');
   api.use('tinytest');
   api.use('username:package-name');
   api.addFiles('package-name-tests.js');
});</pre> 
  <h2> 
   <div>
     使用软件包 
   </div> </h2> 
  <div>
    现在，我们终于可以从&nbsp;app.js&nbsp;文件调用myPackageFunction()函数了。 
  </div> 
  <h3> packages/package.js </h3>   
  <pre>if(Meteor.isClient) {
   myPackageFunction();
}</pre> 
  <div>
    控制台将日志记录包中的文本，其结果如下： 
  </div> 
  <img src="file://E:/data/youdao/qq24B39E2329F08D9F4C3146A571A415EF/7dbf5da1c69a4e12895cd46d8d688edb/kage-js-log.jpeg" alt="Meteor Package Log"> 
  <div>
    为了更好地理解package.js文件如何配置，我们将使用Meteor&nbsp;官方文档的例子。
   <br> 
   <img src="/uploads/tutorial/20160426/1-16042621535aS.jpg" alt="">
   <br> 
  </div> 
  <h3> <p> 这是一个例子文件...看看一就知道了 </p> </h3> 
  <pre>/* Information about this package */
Package.describe({
   // Short two-sentence summary.
   summary: "What this does",
   // Version number.
   version: "1.0.0",
   // Optional.  Default is package directory name.
   name: "username:package-name",
   // Optional github URL to your source repository.
   git: "https://github.com/something/something.git",
});

/* This defines your actual package */
Package.onUse(function (api) {
   // If no version is specified for an 'api.use' dependency, use the
   // one defined in Meteor 0.9.0.
   api.versionsFrom('0.9.0');
   // Use Underscore package, but only on the server.
   // Version not specified, so it will be as of Meteor 0.9.0.
   api.use('underscore', 'server');
   // Use iron:router package, version 1.0.0 or newer.
   api.use('iron:router@1.0.0');
   // Give users of this package access to the Templating package.
   api.imply('templating')
   // Export the object 'Email' to packages or apps that use this package.
   api.export('Email', 'server');
   // Specify the source code for the package.
   api.addFiles('email.js', 'server');
});

/* This defines the tests for the package */
Package.onTest(function (api) {
   // Sets up a dependency on this package
   api.use('username:package-name');
   // Allows you to use the 'tinytest' framework
   api.use('tinytest@1.0.0');
   // Specify the source code for the package tests
   api.addFiles('email_tests.js', 'server');
});

/* This lets you use npm packages in your package*/
Npm.depends({
   simplesmtp: "0.3.10",
   "stream-buffers": "0.2.5"
});</pre> 
 </div>
 <br>      
</div></body></html>
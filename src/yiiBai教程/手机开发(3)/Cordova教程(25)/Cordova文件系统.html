<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Cordova文件系统</h1><div style="width:100%;float:left;" class="article-content">   
 <div> 
  <div>
    这个插件用于用户设备上操作本机文件系统。 
  </div> 
 </div> 
 <div> 
  <h2> 
   <div>
     第1步&nbsp;-&nbsp;安装文件插件 
   </div> </h2> 
  <div>
    我们需要在命令提示符下面运行代码来安装这个插件。 
  </div> 
  <pre>C:\Users\username\Desktop\CordovaProject&gt;cordova plugin add cordova-plugin-file</pre> 
  <h2> 
   <div>
     第2步&nbsp;-&nbsp;添加按钮 
   </div> </h2> 
  <p style="text-align:justify;"> 在这个例子中，我们将向你展示如何创建文件，写入，读取，并删除文件。出于这个原因，我们将在&nbsp;index.html&nbsp;文件中创建四个按钮。我们还将添加文本区域，用来展示文件的内容。 </p> 
  <pre>&lt;button id = "createFile"&gt;CREATE FILE&lt;/button&gt;
&lt;button id = "writeFile"&gt;WRITE FILE&lt;/button&gt;
&lt;button id = "readFile"&gt;READ FILE&lt;/button&gt;
&lt;button id = "removeFile"&gt;DELETE FILE&lt;/button&gt;

&lt;textarea id = "textarea"&gt;&lt;/textarea&gt;</pre> 
  <h2> 
   <div>
     第3步&nbsp;-&nbsp;添加事件监听器 
   </div> </h2> 
  <div>
    我们将在index.js的onDeviceReady函数内部添加事件侦听器，以确保所使用插件之前一切已经就绪。 
  </div> 
  <pre>document.getElementById("createFile").addEventListener("click", createFile);
document.getElementById("writeFile").addEventListener("click", writeFile);
document.getElementById("readFile").addEventListener("click", readFile);
document.getElementById("removeFile").addEventListener("click", removeFile);</pre> 
  <h2> 
   <div>
     步骤4A-&nbsp;创建文件函数 
   </div> </h2> 
  <p style="text-align:justify;"> 该文件将在设备上的应用程序的根文件夹中创建。为了能够访问根文件夹你需要提供给超级用户访问文件夹。在我们的例子路径根目录文件夹是&nbsp;\data\data\com.yiibai.hello\cache。当前此文件夹为空。<br> <img src="/uploads/tutorial/20160220/1-160220104Z4564.jpg" alt=""> </p> 
  <p style="text-align:justify;"> 现在让我们添加的函数来创建log.txt文件。我们将编写代码在index.js。我们首先请求文件系统。此方法使用四个参数。类型可以是WINDOW.TEMPORARY或WINDOW.PERSISTENT，大小以字节值，需要存储(在本示例中是5MB)。 </p> 
  <pre>function createFile() {
   var type = window.TEMPORARY;
   var size = 5*1024*1024;

   window.requestFileSystem(type, size, successCallback, errorCallback)

   function successCallback(fs) {
      fs.root.getFile('log.txt', {create: true, exclusive: true}, function(fileEntry) {
         alert('File creation successfull!')
      }, errorCallback);
   }

   function errorCallback(error) {
      alert("ERROR: " + error.code)
   }
	
}</pre> 
  <div>
    现在，我们可以按创建文件按钮，弹窗提示将确认成功创建文件。
   <br> 
   <img src="/uploads/tutorial/20160220/1-16022010494QT.jpg" alt="">
   <br> 
  </div> 
  <div>
    现在，我们可以再次检查您的应用程序的根文件夹，新文件也将在里边。
   <br> 
   <img src="/uploads/tutorial/20160220/1-160220105040300.jpg" alt="">
   <br> 
  </div> 
  <h2> 
   <div>
     步骤4b&nbsp;-&nbsp;写文件函数 
   </div> </h2> 
  <p style="text-align:justify;"> 我们要做的下一件事就是写一些文本到文件中。我们将再次请求的文件系统，然后创建文件写入器写入，我们分配存有&nbsp;Lorem&nbsp;Ipsum&nbsp;文本给&nbsp;blob&nbsp;变量。 </p> 
  <pre>function writeFile() {
   var type = window.TEMPORARY;
   var size = 5*1024*1024;

   window.requestFileSystem(type, size, successCallback, errorCallback)

   function successCallback(fs) {

      fs.root.getFile('log.txt', {create: true}, function(fileEntry) {

         fileEntry.createWriter(function(fileWriter) {
            fileWriter.onwriteend = function(e) {
               alert('Write completed.');
            };

            fileWriter.onerror = function(e) {
               alert('Write failed: ' + e.toString());
            };

            var blob = new Blob(['Lorem Ipsum'], {type: 'text/plain'});
            fileWriter.write(blob);
         }, errorCallback);

      }, errorCallback);

   }

   function errorCallback(error) {
      alert("ERROR: " + error.code)
   }
	
}</pre> 
  <div>
    按 WRITE&nbsp;FILE 按钮后，警告会通知我们：写入成功。
   <br> 
   <img src="/uploads/tutorial/20160220/1-160220105135394.jpg" alt="">
   <br> 
  </div> 
  <div>
    现在，我们可以打开 log.txt，看到存有Lorem&nbsp;Ipsum&nbsp;在里面了。
   <br> 
   <img src="/uploads/tutorial/20160220/1-160220105210556.jpg" alt="">
   <br> 
  </div> 
  <h2> 
   <div>
     步骤4C&nbsp;-&nbsp;读文件函数 
   </div> </h2> 
  <p style="text-align:justify;"> 在这一步中，我们将读取 log.txt 文件内容并在 textarea 元素显示。首先，我们请求的文件系统，并得到该文件对象，那么正在创建读取器。当读写器被加载，我们将返回值指定到 textarea。 </p>   
  <pre>function readFile() {
   var type = window.TEMPORARY;
   var size = 5*1024*1024;

   window.requestFileSystem(type, size, successCallback, errorCallback)

   function successCallback(fs) {

      fs.root.getFile('log.txt', {}, function(fileEntry) {

         fileEntry.file(function(file) {
            var reader = new FileReader();

            reader.onloadend = function(e) {
               var txtArea = document.getElementById('textarea');
               txtArea.value = this.result;
            };

            reader.readAsText(file);

         }, errorCallback);

      }, errorCallback);
   }

   function errorCallback(error) {
      alert("ERROR: " + error.code)
   }
	
}	</pre> 
  <div>
    当我们点击READ&nbsp;FILE&nbsp;按钮，从文件中的文本将被读取放入&nbsp;textarea&nbsp;里面。
   <br> 
   <img src="/uploads/tutorial/20160220/1-16022010524c31.jpg" alt="">
   <br> 
  </div> 
  <h2> 
   <div>
     步骤4D&nbsp;-&nbsp;删除文件函数 
   </div> </h2> 
  <div>
    最后，我们将创建删除log.txt文件函数功能。 
  </div> 
  <pre>function removeFile() {
   var type = window.TEMPORARY;
   var size = 5*1024*1024;

   window.requestFileSystem(type, size, successCallback, errorCallback)

   function successCallback(fs) {
      fs.root.getFile('log.txt', {create: false}, function(fileEntry) {

         fileEntry.remove(function() {
            alert('File removed.');
         }, errorCallback);

      }, errorCallback);
   }

   function errorCallback(error) {
      alert("ERROR: " + error.code)
   }
	
}	</pre> 
  <div>
    现在，我们可以按DELETE&nbsp;FILE&nbsp;按钮将删除应用程序的根文件夹中的文件。提示通知我们删除成功。
   <br> 
   <img src="/uploads/tutorial/20160220/1-1602201053202C.jpg" alt="">
   <br> 
  </div> 
  <div>
    如果我们检查应用程序的根文件夹，我们会看到，现在没有任何文件，它是空的。
   <br> 
   <img src="/uploads/tutorial/20160220/1-160220105343W0.jpg" alt="">
   <br> 
  </div> 
 </div>
 <br>      
</div></body></html>
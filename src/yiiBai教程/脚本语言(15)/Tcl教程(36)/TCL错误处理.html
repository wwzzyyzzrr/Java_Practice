<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">TCL错误处理</h1><div style="width:100%;float:left;" class="article-content">   
 <p> Tcl的错误处理设置有error 和 catch命令。对每个这些命令语法如下所示。</p> 
 <h2> Error 语法</h2> 
 <pre class="prettyprint notranslate prettyprinted" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; width: 603.767395019531px; line-height: 16px; font-size: 12px; overflow: auto; color: rgb(49, 49, 49);">
<span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">error message info code</span></pre> 
 <p> 在上面的 error命令语法，message是错误信息，info是在全局变量errorInfo中设置，code是在errorCode设置的全局变量。</p> 
 <h2> Catch 语法</h2> 
 <pre class="prettyprint notranslate prettyprinted" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; width: 603.767395019531px; line-height: 16px; font-size: 12px; overflow: auto; color: rgb(49, 49, 49);">
<span class="kwd" style="box-sizing: border-box; color: rgb(0, 0, 136);">catch</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> script resultVarName</span></pre> 
 <p> 另外，在上述catch 命令语法，脚本是要执行的代码，resultVarName是可变保存错误或结果。 catch命令返回0，如果没有错误，如果有一个错误，返回1。</p> 
 <p> 对于简单的错误处理一个例子如下所示。</p> 
 <pre class="prettyprint notranslate tryit prettyprinted" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; width: 603.767395019531px; line-height: 16px; font-size: 12px; overflow: auto; color: rgb(49, 49, 49); cursor: default; background-image: url(http://www.yiibai.com/images/link.png) !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: 100% 0%; background-repeat: no-repeat !important;">
<span class="com" style="box-sizing: border-box; color: rgb(136, 0, 0);">#!/usr/bin/tclsh</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">

proc </span><span class="typ" style="box-sizing: border-box; color: rgb(127, 0, 85);">Div</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">{</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">a b</span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">}</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">{</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
    </span><span class="kwd" style="box-sizing: border-box; color: rgb(0, 0, 136);">if</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">{</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">$b </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">==</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="lit" style="box-sizing: border-box; color: rgb(0, 102, 102);">0</span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">}</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">{</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
  error </span><span class="str" style="box-sizing: border-box; color: rgb(0, 136, 0);">"Error generated by error"</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="str" style="box-sizing: border-box; color: rgb(0, 136, 0);">"Info String for error"</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="lit" style="box-sizing: border-box; color: rgb(0, 102, 102);">401</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
    </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">}</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="kwd" style="box-sizing: border-box; color: rgb(0, 0, 136);">else</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">{</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
      </span><span class="kwd" style="box-sizing: border-box; color: rgb(0, 0, 136);">return</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">[</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">expr $a</span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">/</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">$b</span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">]</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
    </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">}</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
</span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">}</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
</span><span class="kwd" style="box-sizing: border-box; color: rgb(0, 0, 136);">if</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">{[</span><span class="kwd" style="box-sizing: border-box; color: rgb(0, 0, 136);">catch</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">{</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">puts </span><span class="str" style="box-sizing: border-box; color: rgb(0, 136, 0);">"Result = [Div 10 0]"</span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">}</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> errmsg</span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">]}</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">{</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
   puts </span><span class="str" style="box-sizing: border-box; color: rgb(0, 136, 0);">"ErrorMsg: $errmsg"</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
   puts </span><span class="str" style="box-sizing: border-box; color: rgb(0, 136, 0);">"ErrorCode: $errorCode"</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
   puts </span><span class="str" style="box-sizing: border-box; color: rgb(0, 136, 0);">"ErrorInfo:\n$errorInfo\n"</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
</span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">}</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">

</span><span class="kwd" style="box-sizing: border-box; color: rgb(0, 0, 136);">if</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">{[</span><span class="kwd" style="box-sizing: border-box; color: rgb(0, 0, 136);">catch</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">{</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">puts </span><span class="str" style="box-sizing: border-box; color: rgb(0, 136, 0);">"Result = [Div 10 2]"</span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">}</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> errmsg</span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">]}</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">{</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
   puts </span><span class="str" style="box-sizing: border-box; color: rgb(0, 136, 0);">"ErrorMsg: $errmsg"</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
   puts </span><span class="str" style="box-sizing: border-box; color: rgb(0, 136, 0);">"ErrorCode: $errorCode"</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
   puts </span><span class="str" style="box-sizing: border-box; color: rgb(0, 136, 0);">"ErrorInfo:\n$errorInfo\n"</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
</span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">}</span></pre> 
 <p> 当执行上面的代码，产生以下结果：</p>   
 <pre class="result notranslate" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; margin-bottom: 0px; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; width: 603.767395019531px; font-size: 12px; overflow: auto; color: rgb(49, 49, 49); line-height: 22px; background-color: rgb(241, 241, 241);">
ErrorMsg: Error generated by error
ErrorCode: 401
ErrorInfo:
Info String for error
    (procedure "Div" line 1)
    invoked from within
"Div 10 0"

Result = 5</pre> 
 <p> 正如在上面的例子中看到，我们可以创建自己的自定义错误消息。同样地，也能够捕捉由Tcl所产生的错误。一个例子如下所示。</p> 
 <pre class="prettyprint notranslate tryit prettyprinted" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; width: 603.767395019531px; line-height: 16px; font-size: 12px; overflow: auto; color: rgb(49, 49, 49); cursor: default; background-image: url(http://www.yiibai.com/images/link.png) !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: 100% 0%; background-repeat: no-repeat !important;">
<span class="com" style="box-sizing: border-box; color: rgb(136, 0, 0);">#!/usr/bin/tclsh</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">

</span><span class="kwd" style="box-sizing: border-box; color: rgb(0, 0, 136);">catch</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">{</span><span class="kwd" style="box-sizing: border-box; color: rgb(0, 0, 136);">set</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> file </span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">[</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">open myNonexistingfile</span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">.</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">txt</span><span class="pun" style="box-sizing: border-box; color: rgb(102, 102, 0);">]}</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);"> result
puts </span><span class="str" style="box-sizing: border-box; color: rgb(0, 136, 0);">"ErrorMsg: $result"</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
puts </span><span class="str" style="box-sizing: border-box; color: rgb(0, 136, 0);">"ErrorCode: $errorCode"</span><span class="pln" style="box-sizing: border-box; color: rgb(0, 0, 0);">
puts </span><span class="str" style="box-sizing: border-box; color: rgb(0, 136, 0);">"ErrorInfo:\n$errorInfo\n"</span></pre> 
 <p> 当执行上面的代码，产生以下结果：</p> 
 <pre class="result notranslate" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; margin-bottom: 0px; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; width: 603.767395019531px; font-size: 12px; overflow: auto; color: rgb(49, 49, 49); line-height: 22px; background-color: rgb(241, 241, 241);">
ErrorMsg: couldn't open "myNonexistingfile.txt": no such file or directory
ErrorCode: POSIX ENOENT {no such file or directory}
ErrorInfo:
couldn't open "myNonexistingfile.txt": no such file or directory
    while executing
"open myNonexistingfile.txt"</pre> 
 <br>      
</div></body></html>
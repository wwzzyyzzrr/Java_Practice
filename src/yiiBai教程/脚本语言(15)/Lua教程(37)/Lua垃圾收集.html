<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Lua垃圾收集</h1><div style="width:100%;float:left;" class="article-content">   
 <p> Lua使用基于被内置在Lua某些算法的垃圾收集自动内存管理。可以自动内存管理的结果，作为一个开发者：</p> 
 <ul> 
  <li> <p> 没有必要担心的对象分配内存。</p> </li> 
  <li> <p> 无需释放他们时，不再需要可将其设置为nil。</p> </li> 
 </ul> 
 <p> Lua使用运行不时收集死的对象时，不再从Lua程序中访问垃圾收集器。</p> 
 <p> 所有对象，包括表，用户数据，函数，线程，字符串等受自动内存管理。 Lua使用增量标记和使用两个数字来控制其垃圾回收周期即垃圾收集暂停和垃圾收集器的步骤事半功倍清除收集器。这些值是在百分比和100的值是常等于1。</p> 
 <h2> 垃圾收集暂停</h2> 
 <p> 垃圾收集停顿被用于控制多长时间的垃圾收集器需要等待，之前;它是由Lua的自动内存管理再次调用。数值低于100就意味着Lua中不会等待下一个周期。此值的类似地较高的值将导致垃圾收集器是缓慢的并且性质上较不积极。200表示该集合等待的总内存在使用中要开始一个新的周期开始前的两倍。因此，根据不同的性质和应用的速度，有可能要求改变该值来获得在Lua应用的最佳性能。</p> 
 <h2> 垃圾收集器的步骤事半功倍</h2> 
 <p> 这一步乘数控制垃圾收集在Lua程序的内存分配的相对速度。较大的步长值将导致垃圾收集器要更侵蚀性，同时也提高了垃圾收集的每个增量步的步长大小。值小于100可能经常导致避免垃圾收集器没有完成其周期和其一般不是优选的。默认值是200，这意味着垃圾收集器运行的两倍的内存分配的速度。</p> 
 <h2> 垃圾收集器函数</h2> 
 <p> 作为开发人员，我们确实有过让Lua自动内存管理。为此，有以下几种方法。</p> 
 <ul> 
  <li> <p> collectgarbage("collect"):&nbsp;执行垃圾回收的一个完整周期。</p> </li> 
  <li> <p> collectgarbage("count"):&nbsp;返回当前使用的千字节的程序内存量</p> </li> 
  <li> <p> collectgarbage("restart"):&nbsp;如果垃圾收集器已经停止，将重新启动它。</p> </li> 
  <li> <p> collectgarbage("setpause"):&nbsp;设置给定为第二参数除以100至垃圾收集器暂停变量的值。它的用途是作为讨论的一点上面。</p> </li> 
  <li> <p> collectgarbage("setstepmul"):&nbsp;设置给定为第二参数除以100到垃圾步骤乘数的变量的值。它的用途是作为讨论的一点上面。</p> </li> 
  <li> <p> collectgarbage("step"):&nbsp;运行垃圾回收的一步。第二个参数是越大step也会变大。在收集的垃圾将返回true，如果触发的步骤是一个垃圾收集周期的最后一步。</p> </li> 
  <li> <p> collectgarbage("stop"):&nbsp;停止垃圾收集器，如果它的运行。</p> </li> 
 </ul> 
 <p> 使用垃圾收集器例如一个简单的例子如下所示。</p> 
 <pre class="prettyprint tryit prettyprinted" style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; font-size: 12px; overflow: auto; cursor: default; background-image: url(http://www.yiibai.com/images/link.png) !important; background-attachment: initial !important; background-size: initial !important; background-origin: initial !important; background-clip: initial !important; background-position: 100% 0%; background-repeat: no-repeat !important;">
<span class="pln" style="margin: 0px; padding: 0px;">mytable </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">=</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">{</span><span class="str" style="margin: 0px; padding: 0px; color: rgb(0, 136, 0);">"apple"</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">,</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="str" style="margin: 0px; padding: 0px; color: rgb(0, 136, 0);">"orange"</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">,</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="str" style="margin: 0px; padding: 0px; color: rgb(0, 136, 0);">"banana"</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">}</span><span class="pln" style="margin: 0px; padding: 0px;">

</span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">print</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(</span><span class="pln" style="margin: 0px; padding: 0px;">collectgarbage</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(</span><span class="str" style="margin: 0px; padding: 0px; color: rgb(0, 136, 0);">"count"</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">))</span><span class="pln" style="margin: 0px; padding: 0px;">

mytable </span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">=</span><span class="pln" style="margin: 0px; padding: 0px;"> </span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">nil</span><span class="pln" style="margin: 0px; padding: 0px;">

</span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">print</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(</span><span class="pln" style="margin: 0px; padding: 0px;">collectgarbage</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(</span><span class="str" style="margin: 0px; padding: 0px; color: rgb(0, 136, 0);">"count"</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">))</span><span class="pln" style="margin: 0px; padding: 0px;">

</span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">print</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(</span><span class="pln" style="margin: 0px; padding: 0px;">collectgarbage</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(</span><span class="str" style="margin: 0px; padding: 0px; color: rgb(0, 136, 0);">"collect"</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">))</span><span class="pln" style="margin: 0px; padding: 0px;">

</span><span class="kwd" style="margin: 0px; padding: 0px; color: rgb(0, 0, 136);">print</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(</span><span class="pln" style="margin: 0px; padding: 0px;">collectgarbage</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">(</span><span class="str" style="margin: 0px; padding: 0px; color: rgb(0, 136, 0);">"count"</span><span class="pun" style="margin: 0px; padding: 0px; color: rgb(102, 102, 0);">))</span></pre> 
 <p> 当我们运行上面的程序，会得到下面的输出。请注意，这样的结果会有所不同，由于在操作系统中，Lua自动内存管理功能可能也有差异。</p>   
 <pre class="result" style="margin-bottom: 0px; font-size: 12px; overflow: auto; background-color: rgb(241, 241, 241);">
20.9560546875
20.9853515625
0
19.4111328125</pre> 
 <p> 可以在上面的程序看出，一旦垃圾回收完成后，既可以减少使用内存。但是它也不是强制性的调用。即使我们不给调用，它也会自动在后一阶段在预定时间之后由Lua解释器执行。</p> 
 <p> 显然我们可以改变，如果需要使用垃圾收集器的这些功能行为。这些功能提供了一点额外的能力，为开发者处理复杂情况。根据不同的内存需要执行程序类型，可能会或可能不会使用此功能。但在应用程序的内存使用情况，并在程序本身，以避免在部署后不想要对结果进行检查。<br> <br> <br> &nbsp;</p> 
 <br>      
</div></body></html>
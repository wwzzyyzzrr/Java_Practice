<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring服务器(单元测试）</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在本章中，我们将学习如何对使用Spring WS创建的Web应用程序服务进行单元测试。</p> 
 <p>我们先来看看完整的目录结构 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201805/2905/128090520_72135.png" alt=""></p> 
 <p>请参考以下步骤实现单元测试 -</p> 
 <p><strong>第1步</strong> : 更新在Spring WS编写服务器章节中创建的项目:countryService。 添加一个<code>src/test/java</code>文件夹。<br><strong>第2步</strong> : 在 - <code>src/test/java/com/yiibai/ws</code>文件夹下创建一个类:<em>CustomerEndPointTest.java</em>，然后更新<em>pom.xml</em>，如下所述。</p> 
 <p><strong>第3步</strong> :在<code>src/main/resources</code>子文件夹下添加<code>spring-context.xml</code>。</p> 
 <p><strong>第4步</strong> :最后一步是为所有源文件和配置文件创建内容并按照下面的说明测试应用程序。</p> 
 <p>文件:<em>pom.xml</em> - </p> 
 <pre><code class="lang-xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.yiibai&lt;/groupId&gt;
    &lt;artifactId&gt;countryService&lt;/artifactId&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;countryService Maven Webapp&lt;/name&gt;
    &lt;url&gt;http://maven.apache.org&lt;/url&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.ws&lt;/groupId&gt;
            &lt;artifactId&gt;spring-ws-core&lt;/artifactId&gt;
            &lt;version&gt;2.4.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
            &lt;version&gt;2.5&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.ws&lt;/groupId&gt;
            &lt;artifactId&gt;spring-ws-test&lt;/artifactId&gt;
            &lt;version&gt;2.4.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-tx&lt;/artifactId&gt;
            &lt;version&gt;3.1.2.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;jdom&lt;/groupId&gt;
            &lt;artifactId&gt;jdom&lt;/artifactId&gt;
            &lt;version&gt;1.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;jaxen&lt;/groupId&gt;
            &lt;artifactId&gt;jaxen&lt;/artifactId&gt;
            &lt;version&gt;1.1&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;wsdl4j&lt;/groupId&gt;
            &lt;artifactId&gt;wsdl4j&lt;/artifactId&gt;
            &lt;version&gt;1.6.2&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.5&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;finalName&gt;countryService&lt;/finalName&gt;
        &lt;defaultGoal&gt;compile&lt;/defaultGoal&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre> 
 <p>文件:<em>spring-context.xml</em> - </p> 
 <pre><code class="lang-xml">&lt;beans xmlns = "http://www.springframework.org/schema/beans"
   xmlns:xsi = "http://www.w3.org/2001/XMLSchema-instance"
   xmlns:context = "http://www.springframework.org/schema/context"
   xmlns:sws = "http://www.springframework.org/schema/web-services"
   xsi:schemaLocation = "http://www.springframework.org/schema/beans

   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
   http://www.springframework.org/schema/web-services
   http://www.springframework.org/schema/web-services/web-services-2.0.xsd
   http://www.springframework.org/schema/context 
   http://www.springframework.org/schema/context/spring-context-3.0.xsd"&gt;

   &lt;context:component-scan base-package = "com.yiibai"/&gt;
   &lt;sws:annotation-driven/&gt;

   &lt;bean id = "schema" class = "org.springframework.core.io.ClassPathResource"&gt;
      &lt;constructor-arg index = "0" value = "countries.xsd" /&gt;
   &lt;/bean&gt;
&lt;/beans&gt;
</code></pre> 
 <p>文件:<em>CustomerEndPointTest.java</em> - </p> 
 <pre><code class="lang-java">package com.yiibai.ws;

import javax.xml.transform.Source;

import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.xml.XmlBeanDefinitionReader;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.GenericApplicationContext;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.springframework.ws.test.server.MockWebServiceClient;
import org.springframework.xml.transform.StringSource;

import static org.springframework.ws.test.server.RequestCreators.withPayload;
import static org.springframework.ws.test.server.ResponseMatchers.payload;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = "/spring-context.xml")
public class CustomerEndPointTest {
    @Autowired
    private ApplicationContext applicationContext;
    private MockWebServiceClient mockClient;

    @Before
    public void createClient() {
        mockClient = MockWebServiceClient.createClient(applicationContext);
        GenericApplicationContext ctx = (GenericApplicationContext) applicationContext;
        final XmlBeanDefinitionReader definitionReader = new XmlBeanDefinitionReader(ctx);
        definitionReader.setValidationMode(XmlBeanDefinitionReader.VALIDATION_NONE);
        definitionReader.setNamespaceAware(true);
    }

    @Test
    public void testCountryEndpoint() throws Exception {
        Source requestPayload = new StringSource("&lt;getCountryRequest xmlns = 'http://www.yiibai/schemas'&gt;"
                + "&lt;name&gt;United States&lt;/name&gt;" + "&lt;/getCountryRequest&gt;");
        Source responsePayload = new StringSource("&lt;getCountryResponse xmlns='http://www.yiibai/schemas'&gt;"
                + "&lt;country&gt;" + "&lt;name&gt;United States&lt;/name&gt;" + "&lt;population&gt;46704314&lt;/population&gt;"
                + "&lt;capital&gt;Washington&lt;/capital&gt;" + "&lt;currency&gt;USD&lt;/currency&gt;" + "&lt;/country&gt;"
                + "&lt;/getCountryResponse&gt;");
        mockClient.sendRequest(withPayload(requestPayload)).andExpect(payload(responsePayload));
    }
}
</code></pre> 
 <h2 id="h2-u6784u5EFAu9879u76EE"><a name="构建项目" class="reference-link"></a><span class="header-link octicon octicon-link"></span>构建项目</h2>
 <p>打开Eclipse，在项目名称上右键，选择菜单:<em>Run As…</em> ，然后选择:<em>Maven test</em> ， 运行结果如下 - </p>   
 <pre><code class="lang-shell">[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building countryService Maven Webapp 0.0.1-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ countryService ---
[WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] Copying 8 resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ countryService ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ countryService ---
[WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory D:\eclipse-workspace\countryService\countryService\src\test\resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ countryService ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ countryService ---
[INFO] Surefire report directory: D:\eclipse-workspace\countryService\countryService\target\surefire-reports
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit4/2.12.4/surefire-junit4-2.12.4.pom
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit4/2.12.4/surefire-junit4-2.12.4.pom (3 KB at 1.3 KB/sec)
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-providers/2.12.4/surefire-providers-2.12.4.pom
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-providers/2.12.4/surefire-providers-2.12.4.pom (3 KB at 6.5 KB/sec)
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit4/2.12.4/surefire-junit4-2.12.4.jar
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit4/2.12.4/surefire-junit4-2.12.4.jar (37 KB at 58.1 KB/sec)

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running com.yiibai.ws.CustomerEndPointTest
五月 30, 2018 9:16:39 上午 org.springframework.test.context.TestContextManager retrieveTestExecutionListeners
信息: @TestExecutionListeners is not present for class [class com.yiibai.ws.CustomerEndPointTest]: using defaults.
五月 30, 2018 9:16:39 上午 org.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions
信息: Loading XML bean definitions from class path resource [spring-context.xml]
五月 30, 2018 9:16:39 上午 org.springframework.context.support.GenericApplicationContext prepareRefresh
信息: Refreshing org.springframework.context.support.GenericApplicationContext@6833ce2c: startup date [Wed May 30 09:16:39 CST 2018]; root of context hierarchy
五月 30, 2018 9:16:40 上午 org.springframework.ws.soap.addressing.server.AnnotationActionEndpointMapping afterPropertiesSet
信息: Supporting [WS-Addressing August 2004, WS-Addressing 1.0]
五月 30, 2018 9:16:40 上午 org.springframework.ws.soap.saaj.SaajSoapMessageFactory afterPropertiesSet
信息: Creating SAAJ 1.3 MessageFactory with SOAP 1.1 Protocol
五月 30, 2018 9:16:41 上午 org.springframework.context.support.GenericApplicationContext doClose
信息: Closing org.springframework.context.support.GenericApplicationContext@6833ce2c: startup date [Wed May 30 09:16:39 CST 2018]; root of context hierarchy
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.167 sec

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 7.695 s
[INFO] Finished at: 2018-05-30T09:16:41+08:00
[INFO] Final Memory: 13M/138M
[INFO] ------------------------------------------------------------------------
</code></pre>
 <br>      
</div></body></html>
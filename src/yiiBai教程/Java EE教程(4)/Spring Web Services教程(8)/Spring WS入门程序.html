<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Spring WS入门程序</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在这一章节中，我们将使用Spring-WS框架编写一个基于SOAP的Web服务。 在开始使用Spring-WS框架编写第一个示例应用之前，必须确保Spring-WS环境的设置正确，正如Spring Web Services环境设置章节中所述。并假设读者对Eclipse IDE有一些基本的工作知识。</p> 
 <p>下面开始编写一个简单的Spring WS应用程序，这个应用程序将公开Web服务方法以在HR入口中预订假期。</p> 
 <h2 id="h2-u5951u7EA6u4F18u5148u65B9u6CD5"><a name="契约优先方法" class="reference-link"></a><span class="header-link octicon octicon-link"></span>契约优先方法</h2>
 <p>Spring-WS使用契约优先方法，因此在编写基于JAVA的实现代码之前，我们应该准备好XML结构。 下面定义一个包含子对象 - <code>Leave</code>和<code>Employee</code>的<code>LeaveRequest</code>对象。</p> 
 <p>以下是所需的XML结构 -</p> 
 <p>文件:<em>WEB-INF/Leave.xml</em> 的内容如下所示 - </p> 
 <pre><code class="lang-xml">&lt;Leave xmlns = "http://www.yiibai.com/hr/schemas"&gt;
   &lt;StartDate&gt;2018-07-03&lt;/StartDate&gt;
   &lt;EndDate&gt;2018-07-30&lt;/EndDate&gt;
&lt;/Leave&gt;
</code></pre> 
 <p>文件:<em>WEB-INF/Employee.xml</em> 的内容如下所示 - </p> 
 <pre><code class="lang-xml">&lt;Employee xmlns = "http://www.yiibai.com/hr/schemas"&gt;
   &lt;Number&gt;10910&lt;/Number&gt;
   &lt;FirstName&gt;Max&lt;/FirstName&gt;
   &lt;LastName&gt;Su&lt;/LastName&gt;
&lt;/Employee&gt;
</code></pre> 
 <p>文件:<em>WEB-INF/LeaveRequest.xml</em> 的内容如下所示 - </p> 
 <pre><code class="lang-xml">&lt;LeaveRequest xmlns = "http://www.yiibai.com/hr/schemas"&gt;
   &lt;Leave&gt;
      &lt;StartDate&gt;2018-07-03&lt;/StartDate&gt;
      &lt;EndDate&gt;2018-07-30&lt;/EndDate&gt;
   &lt;/Leave&gt;

   &lt;Employee&gt;
      &lt;Number&gt;10010&lt;/Number&gt;
      &lt;FirstName&gt;Max&lt;/FirstName&gt;
      &lt;LastName&gt;Su&lt;/LastName&gt;
   &lt;/Employee&gt;
&lt;/LeaveRequest&gt;
</code></pre> 
 <p>文件:<em>WEB-INF/hr.xsd</em> 的内容如下所示 - </p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema xmlns:xs = "http://www.w3.org/2001/XMLSchema"
   xmlns:hr = "http://www.yiibai.com/hr/schemas"
   elementFormDefault = "qualified"
   targetNamespace = "http://www.yiibai.com/hr/schemas"&gt;

   &lt;xs:element name = "LeaveRequest"&gt;
      &lt;xs:complexType&gt;
         &lt;xs:all&gt;
            &lt;xs:element name = "Leave" type = "hr:LeaveType"/&gt;
            &lt;xs:element name = "Employee" type = "hr:EmployeeType"/&gt;
         &lt;/xs:all&gt;
      &lt;/xs:complexType&gt;
   &lt;/xs:element&gt;

   &lt;xs:complexType name = "LeaveType"&gt;
      &lt;xs:sequence&gt;
         &lt;xs:element name = "StartDate" type = "xs:date"/&gt;
         &lt;xs:element name = "EndDate" type = "xs:date"/&gt;
      &lt;/xs:sequence&gt;
   &lt;/xs:complexType&gt;

   &lt;xs:complexType name = "EmployeeType"&gt;
      &lt;xs:sequence&gt;
         &lt;xs:element name = "Number" type = "xs:integer"/&gt;
         &lt;xs:element name = "FirstName" type = "xs:string"/&gt;
         &lt;xs:element name = "LastName" type = "xs:string"/&gt;
      &lt;/xs:sequence&gt;
   &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
</code></pre> 
 <h2 id="h2-u521Bu5EFAu9879u76EE"><a name="创建项目" class="reference-link"></a><span class="header-link octicon octicon-link"></span>创建项目</h2>
 <p>现在打开Eclipse，从菜单中找到:<em>文件</em> -&gt; <em>New</em> -&gt; <em>Maven Project</em>， 打开界面如下所示:</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201805/2805/525100546_60535.png" alt=""></p> 
 <p>进入下一步，选择 <em>maven-archetype-webapp</em>，如下所示:</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201805/2805/426100549_66662.png" alt=""></p> 
 <p>填写项目相关信息(可根据你的实际情况填写)，如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201805/2805/291100550_61560.png" alt=""></p> 
 <p>完整的项目目录结构如下图所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201805/2805/358100553_76100.png" alt=""></p> 
 <p>以下是各个文件中的代码 - </p> 
 <p>文件:<em>pom.xml</em> - </p> 
 <pre><code class="lang-xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.yiibai&lt;/groupId&gt;
    &lt;artifactId&gt;leaveService&lt;/artifactId&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;leaveService Maven Webapp&lt;/name&gt;
    &lt;url&gt;http://maven.apache.org&lt;/url&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;3.8.1&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.ws&lt;/groupId&gt;
            &lt;artifactId&gt;spring-ws-core&lt;/artifactId&gt;
            &lt;version&gt;2.4.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;jdom&lt;/groupId&gt;
            &lt;artifactId&gt;jdom&lt;/artifactId&gt;
            &lt;version&gt;1.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;jaxen&lt;/groupId&gt;
            &lt;artifactId&gt;jaxen&lt;/artifactId&gt;
            &lt;version&gt;1.1&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;wsdl4j&lt;/groupId&gt;
            &lt;artifactId&gt;wsdl4j&lt;/artifactId&gt;
            &lt;version&gt;1.6.2&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;finalName&gt;leaveService&lt;/finalName&gt;
        &lt;defaultGoal&gt;compile&lt;/defaultGoal&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre> 
 <p>文件:<em>HumanResourceService.java</em> - </p> 
 <pre><code class="lang-java">package com.yiibai.hr.service;

import java.util.Date;

public interface HumanResourceService {
    void bookLeave(Date startDate, Date endDate, String name);
}
</code></pre> 
 <p>文件:<em>HumanResourceServiceImpl.java</em> - </p> 
 <pre><code class="lang-java">package com.yiibai.hr.service;

import java.util.Date;
import org.springframework.stereotype.Service;

@Service
public class HumanResourceServiceImpl implements HumanResourceService {
   public void bookLeave(Date startDate, Date endDate, String name) {
      System.out.println("Booking holiday for [" + startDate + "-" + endDate + "] for [" + name + "] ");
   }
}
</code></pre> 
 <p>文件:<em>LeaveEndpoint.java</em> - </p> 
 <pre><code class="lang-java">package com.yiibai.ws;

import java.text.SimpleDateFormat;
import java.util.Date;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.ws.server.endpoint.annotation.Endpoint;
import org.springframework.ws.server.endpoint.annotation.PayloadRoot;
import org.springframework.ws.server.endpoint.annotation.RequestPayload;

import com.yiibai.hr.service.HumanResourceService;
import org.jdom.Element;
import org.jdom.JDOMException;
import org.jdom.Namespace;
import org.jdom.xpath.XPath;

@Endpoint
public class LeaveEndpoint {
   private static final String NAMESPACE_URI = "http://www.yiibai.com/hr/schemas";
   private XPath startDateExpression;
   private XPath endDateExpression;
   private XPath nameExpression;
   private HumanResourceService humanResourceService;

   @Autowired
   public LeaveEndpoint(HumanResourceService humanResourceService) throws JDOMException {
      this.humanResourceService = humanResourceService;

      Namespace namespace = Namespace.getNamespace("hr", NAMESPACE_URI);

      startDateExpression = XPath.newInstance("//hr:StartDate");
      startDateExpression.addNamespace(namespace);

      endDateExpression = XPath.newInstance("//hr:EndDate");
      endDateExpression.addNamespace(namespace);

      nameExpression = XPath.newInstance("concat(//hr:FirstName,' ',//hr:LastName)");
      nameExpression.addNamespace(namespace);
   }

   @PayloadRoot(namespace = NAMESPACE_URI, localPart = "LeaveRequest")                  
   public void handleLeaveRequest(@RequestPayload Element leaveRequest) throws Exception {
      SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
      Date startDate = dateFormat.parse(startDateExpression.valueOf(leaveRequest));
      Date endDate = dateFormat.parse(endDateExpression.valueOf(leaveRequest));
      String name = nameExpression.valueOf(leaveRequest);

      humanResourceService.bookLeave(startDate, endDate, name);
   }
}
</code></pre> 
 <p>文件:<em>/WEB-INF/spring-ws-servlet.xml</em> - </p>   
 <pre><code class="lang-xml">&lt;beans xmlns = "http://www.springframework.org/schema/beans"
   xmlns:xsi = "http://www.w3.org/2001/XMLSchema-instance"
   xmlns:context = "http://www.springframework.org/schema/context"
   xmlns:sws = "http://www.springframework.org/schema/web-services"
   xsi:schemaLocation = "http://www.springframework.org/schema/beans

   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
   http://www.springframework.org/schema/web-services
   http://www.springframework.org/schema/web-services/web-services-2.0.xsd
   http://www.springframework.org/schema/context 
   http://www.springframework.org/schema/context/spring-context-3.0.xsd"&gt;

   &lt;context:component-scan base-package = "com.yiibai.hr"/&gt;
   &lt;bean id = "humanResourceService"
      class = "com.yiibai.hr.service.HumanResourceServiceImpl" /&gt;
   &lt;sws:annotation-driven/&gt;

   &lt;sws:dynamic-wsdl id = "leave"
      portTypeName = "HumanResource"
      locationUri = "/leaveService/"
      targetNamespace = "http://www.yiibai.com/hr/definitions"&gt;
      &lt;sws:xsd location = "/WEB-INF/hr.xsd"/&gt;
   &lt;/sws:dynamic-wsdl&gt;
&lt;/beans&gt;
</code></pre> 
 <p>文件:<em>/WEB-INF/web.xml</em> - </p> 
 <pre><code class="lang-xml">&lt;web-app xmlns = "http://java.sun.com/xml/ns/j2ee"
   xmlns:xsi = "http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation = "http://java.sun.com/xml/ns/j2ee
   http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"
   version = "2.4"&gt;

   &lt;display-name&gt;Yiibai HR Leave Service&lt;/display-name&gt;
   &lt;servlet&gt;
      &lt;servlet-name&gt;spring-ws&lt;/servlet-name&gt;
      &lt;servlet-class&gt;
         org.springframework.ws.transport.http.MessageDispatcherServlet
      &lt;/servlet-class&gt;
      &lt;init-param&gt;
         &lt;param-name&gt;transformWsdlLocations&lt;/param-name&gt;
         &lt;param-value&gt;true&lt;/param-value&gt;
      &lt;/init-param&gt;
   &lt;/servlet&gt;

   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;spring-ws&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</code></pre> 
 <p>文件:<em>/WEB-INF/hr.xsd</em> - </p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema xmlns:xs = "http://www.w3.org/2001/XMLSchema"
   xmlns:hr = "http://www.yiibai.com/hr/schemas"
   elementFormDefault = "qualified"
   targetNamespace = "http://www.yiibai.com/hr/schemas"&gt;

   &lt;xs:element name = "LeaveRequest"&gt;
      &lt;xs:complexType&gt;
         &lt;xs:all&gt;
            &lt;xs:element name = "Leave" type = "hr:LeaveType"/&gt;
            &lt;xs:element name = "Employee" type = "hr:EmployeeType"/&gt;
         &lt;/xs:all&gt;
      &lt;/xs:complexType&gt;
   &lt;/xs:element&gt;

   &lt;xs:complexType name = "LeaveType"&gt;
      &lt;xs:sequence&gt;
         &lt;xs:element name = "StartDate" type = "xs:date"/&gt;
         &lt;xs:element name = "EndDate" type = "xs:date"/&gt;
      &lt;/xs:sequence&gt;
   &lt;/xs:complexType&gt;

   &lt;xs:complexType name = "EmployeeType"&gt;
      &lt;xs:sequence&gt;
         &lt;xs:element name = "Number" type = "xs:integer"/&gt;
         &lt;xs:element name = "FirstName" type = "xs:string"/&gt;
         &lt;xs:element name = "LastName" type = "xs:string"/&gt;
      &lt;/xs:sequence&gt;
   &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
</code></pre> 
 <h2 id="h2-u8FD0u884Cu9879u76EE"><a name="运行项目" class="reference-link"></a><span class="header-link octicon octicon-link"></span>运行项目</h2>
 <p>当完成创建源文件和配置文件，使用Maven构建应用程序。 右键单击应用程序项目名称，在弹出的菜单中选择:<em>Run As</em> -&gt; <em>Maven Build…</em> ，如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201805/2805/698110502_40531.png" alt=""></p> 
 <p>构建成功后， 右键单击应用程序项目名称，在弹出的菜单中选择:<em>Run As</em> -&gt; <em>Run On Server…</em> ，如下所示 -<br><img src="http://www.yiibai.com/uploads/images/201805/2805/927110504_88952.png" alt=""></p> 
 <p>Eclipse启动Tomcat服务器后， 尝试访问URL =&gt; <code>http://localhost:8080/leaveService/leave.wsdl</code>，如果Spring Web应用程序一切正常，应该看到以下输出结果 -<br><img src="http://www.yiibai.com/uploads/images/201805/2805/432110505_62626.png" alt=""></p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Servlet RequestDispatcher请求转发</h1><div style="width:100%;float:left;" class="article-content">   
 <p><code>RequestDispatcher</code>接口提供将请求转发送到另一个资源的功能，它可能是<code>html</code>，<code>servlet</code>或<code>jsp</code>等。 此接口也可用于包括另一资源的内容。它是servlet协作的一种方式。</p> 
 <p>在<code>RequestDispatcher</code>接口中定义了两种方法。它们分别是 - </p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>方法</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>public void forward(ServletRequest request,ServletResponse response)throws ServletException,java.io.IOException</code></td> 
    <td>将<code>servlet</code>的请求转发到服务器上的另一个资源(<code>servlet</code>，<code>JSP</code>文件或<code>HTML</code>文件)。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>public void include(ServletRequest request,ServletResponse response)throws ServletException,java.io.IOException</code></td> 
    <td>在响应中包含资源的内容(<code>servlet</code>，<code>JSP</code>页面或<code>HTML</code>文件)。</td> 
   </tr> 
  </tbody> 
 </table> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1010/889101047_81383.jpg" alt=""></p> 
 <p>如上图所示，第一个<code>servlet</code>转发请求到第二个<code>servlet</code>的响应发送给客户端。 第一个servlet的响应不会显示给用户。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1010/224101055_20476.jpg" alt=""></p> 
 <p>如上图所示，第二个<code>servlet</code>的响应将包含在发送给客户端的第一个servlet的响应中。</p> 
 <p><strong>如何获取RequestDispatcher的对象？</strong></p> 
 <p><code>ServletRequest</code>接口的<code>getRequestDispatcher()</code>方法返回<code>RequestDispatcher</code>的对象。</p> 
 <p><code>getRequestDispatcher</code>方法的语法如下 - </p> 
 <pre><code class="lang-java">public RequestDispatcher getRequestDispatcher(String resource);
</code></pre> 
 <p><strong>使用getRequestDispatcher方法的示例</strong></p> 
 <pre><code class="lang-java">RequestDispatcher rd=request.getRequestDispatcher("servlet2");  
//servlet2 is the url-pattern of the second servlet  
rd.forward(request, response);//method may be include or forward
</code></pre> 
 <h2 id="h2-requestdispatcher-"><a name="RequestDispatcher接口示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>RequestDispatcher接口示例</h2>
 <p>在这个例子中，验证用户输入的密码。如果密码是：<code>mypasswd</code>，它会将请求转发到<code>WelcomeServlet</code>，否则会显示一条错误消息：<code>sorry username or password error！</code> 在这个程序中，使用的是硬编码(即：直接在代码中指定密码)。大部分应用中都是在数据库中存储用户信息和密码的，在接下来的教程文章我们也会介绍和学习。在这个例子中，创建了以下几个文件：</p> 
 <ul> 
  <li><em>index.html</em>：用于从用户处获取输入。</li>
  <li><em>Login.java</em>：用于处理响应的servlet类。如果用户输入的密码是<code>mypasswd</code>，它会将请求转发给<code>WelcomeServlet</code>。</li>
  <li><em>WelcomeServlet.java</em>：用于显示欢迎消息的servlet类。</li>
  <li><em>web.xml</em>：包含有关servlet信息的部署描述符文件。</li>
 </ul> 
 <p>工作流程，请参考下图 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1010/840111014_14116.jpg" alt=""></p> 
 <p>打开Eclipse，创建一个名称为：<em>ReqDispatcher</em> 的动态Web项目，其完整的项目结构如下图所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1110/679121012_84979.png" alt=""></p> 
 <p>下面是这个项目中相关文件的代码实现 - </p> 
 <p>文件：<em>index.html</em> - </p> 
 <pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;登录&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div style="text-align:center;"&gt;
    &lt;form action="/ReqDispatcher/login" method="post"&gt;
        用户名:&lt;input type="text" name="userName" /&gt;&lt;br /&gt; 
        密码:&lt;input type="password" name="userPass" /&gt;&lt;br /&gt; 
        &lt;input type="submit" value="登录" /&gt;
    &lt;/form&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>文件：<em>Login.java</em> - </p> 
 <pre><code class="lang-java">package com.yiibai;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class Login
 */
public class Login extends HttpServlet {
    private static final long serialVersionUID = 1L;

    /**
     * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse
     *      response)
     */
    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        // TODO Auto-generated method stub
        response.setCharacterEncoding("utf-8");//设置服务器端编码
        response.setContentType("text/html;charset=utf-8");
        PrintWriter out = response.getWriter();

        String name = request.getParameter("userName");
        String passwd = request.getParameter("userPass");

        // 用户输入的密码是否为：mypasswd
        if (passwd.equals("mypasswd") &amp;&amp; name.equals("admin")) {
            RequestDispatcher rd = request.getRequestDispatcher("welcome");
            System.out.println("Username is : "+name);
            rd.forward(request, response);
        } else {
            out.print("Sorry UserName or Password Error!");
            RequestDispatcher rd = request.getRequestDispatcher("/index.html");
            rd.include(request, response);
        }
    }

}
</code></pre> 
 <p>文件：<em>WelcomeServlet.java</em> - </p>   
 <pre><code class="lang-java">package com.yiibai;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class WelcomeServlet
 */
public class WelcomeServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    /**
     * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse
     *      response)
     */
    public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setCharacterEncoding("utf-8");//设置服务器端编码
        response.setContentType("text/html;charset=utf-8");
        String name = request.getParameter("userName");
        if(name==null || name=="") {
            name = "";
        }
        PrintWriter out = response.getWriter();
        //String chset = response.getCharacterEncoding(); 
        out.print("&lt;!DOCTYPE html&gt;\r\n" + 
                "&lt;html&gt;\r\n" + 
                "&lt;head&gt;\r\n" + 
                "&lt;meta charset=\"UTF-8\"&gt;\r\n" + 
                "&lt;title&gt;登录成功&lt;/title&gt;\r\n" + 
                "&lt;/head&gt;\r\n" + 
                "&lt;body&gt;");
        out.print("&lt;b&gt;登录成功啦lala  ~ &lt;/b&gt;&lt;hr/&gt;");
        out.print("Welcome, " + name);
        out.close();
    }
}
</code></pre> 
 <p>文件：<em>web.xml</em> - </p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
    id="WebApp_ID" version="3.1"&gt;
    &lt;display-name&gt;ReqDispatcher&lt;/display-name&gt;
    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
        &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;Login&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.yiibai.Login&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;WelcomeServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.yiibai.WelcomeServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;Login&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/login&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;WelcomeServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/welcome&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</code></pre> 
 <p>访问项目的URL为： <a target="_blank" href="http://localhost:8080/ReqDispatcher/">http://localhost:8080/ReqDispatcher/</a> ，如果代码没有错误，那么应该会看到类似如下的界面 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1110/797121015_84120.png" alt=""></p> 
 <p>当输入用户名和密码分别为：<code>admin</code> 和 <code>mypasswd</code>，然后提交登陆，应该会看到类似如下的界面 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1110/803121017_38087.png" alt=""></p> 
 <p>如果用户名或密码错误，应该会看到有一条错误提示信息： <em>Sorry UserName or Password Error!</em></p>
 <br>      
</div></body></html>
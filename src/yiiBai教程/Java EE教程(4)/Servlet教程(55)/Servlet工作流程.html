<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Servlet工作流程</h1><div style="width:100%;float:left;" class="article-content">   
 <p><strong>Servlet是如何工作的？</strong></p> 
 <p>了解servlet如何工作对了解servlet内部工作流程很重要。 在这里，我们将以第一个servlet程序来讲解它的内部细节。</p> 
 <p>服务器检查servlet<strong>是否为第一次被请求</strong>？</p> 
 <p>如果<strong>是第一次</strong>被请求，则 - </p> 
 <ul> 
  <li>加载servlet类。</li>
  <li>实例化servlet类。</li>
  <li>调用<code>init</code>方法传递<code>ServletConfig</code>对象</li>
 </ul> 
 <p>如果<strong>不是第一次</strong>被请求，则 - </p> 
 <ul> 
  <li>调用<code>service</code>方法传递请求和响应对象</li>
 </ul> 
 <p>Web容器在需要删除servlet时调用<code>destroy</code>方法，例如：在停止服务器或取消部署项目时。</p> 
 <p><strong>Web容器如何处理servlet请求？</strong></p> 
 <p>Web容器负责处理请求。下面来看看看它如何处理请求。</p> 
 <ul> 
  <li>将请求与<em>web.xml</em>文件中的servlet进行映射。</li>
  <li>为请求创建请求和响应对象</li>
  <li>调用线程上的<code>service</code>方法</li>
  <li>公共<code>service</code>方法内部调用受保护的<code>service</code>方法</li>
  <li>受保护的<code>service</code>方法根据请求的类型调用<code>doGet</code>方法。</li>
  <li><code>doGet</code>方法生成响应，并将其传递给客户端。</li>
  <li>发送响应后，Web容器将删除请求和响应对象。线程包含在线程池中或删除取决于服务器实现。</li>
 </ul> 
 <p><strong>在公共service方法中写什么？</strong></p> 
 <p>公共<code>service</code>方法将<code>ServletRequest</code>对象转换为<code>HttpServletRequest</code>类型和<code>ServletResponse</code>对象转为<code>HttpServletResponse</code>类型。然后调用传递这些对象的<code>service</code>方法。下面来看看内部代码：</p> 
 <pre><code class="lang-java">public void service(ServletRequest req, ServletResponse res)  
        throws ServletException, IOException  
{  
        HttpServletRequest request;  
        HttpServletResponse response;  
        try  
        {  
            request = (HttpServletRequest)req;  
            response = (HttpServletResponse)res;  
        }  
        catch(ClassCastException e)  
        {  
            throw new ServletException("non-HTTP request or response");  
        }  
        service(request, response);  
}
</code></pre> 
 <p><strong>在受保护的service方法中编写什么？</strong></p> 
 <p>受保护的<code>service</code>方法检查请求的类型，如果请求类型为<code>get</code>，则调用<code>doGet</code>方法，如果请求类型为<code>post</code>，则调用<code>doPost</code>方法。下面来看看内部代码：</p>   
 <pre><code class="lang-java">protected void service(HttpServletRequest req, HttpServletResponse resp)  
        throws ServletException, IOException  
{  
    String method = req.getMethod();  
    if(method.equals("GET"))  
    {  
        long lastModified = getLastModified(req);  
        if(lastModified == -1L)  
        {  
            doGet(req, resp);  
        }   
        ....  
        //rest of the code  
    }  
}
</code></pre>
 <br>      
</div></body></html>
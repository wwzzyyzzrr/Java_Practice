<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Servlet登录实例</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在这里，我们将创建一个使用servlet创建登录表单的简单示例，在这个示例中使用MySQL作为数据库。</p> 
 <p>实现的主要功能：</p> 
 <ul> 
  <li>显示登录表单输入框(用户名，密码)。</li>
  <li>在表单中填写用户名，密码并提交。</li>
  <li>在Servlet中接收提交的用户名和密码，与数据库表中的数据进行比较。</li>
  <li>匹配用户名和密码，则提示成功；不匹配则提示失败。</li>
 </ul> 
 <p>需要创建一个用户表：<code>servlet_user</code>。 此外，它必须包含一些数据。表结构及数据记录如下：</p> 
 <pre><code class="lang-sql">DROP TABLE IF EXISTS `servlet_user`;
CREATE TABLE `servlet_user` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(64) NOT NULL DEFAULT '',
  `passwd` varchar(32) NOT NULL DEFAULT '',
  `email` varchar(32) DEFAULT NULL,
  `city` varchar(24) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of servlet_user
-- ----------------------------
INSERT INTO `servlet_user` VALUES ('1', 'maxsu', '123456', 'maxsu@yiibai.com', '广州');
INSERT INTO `servlet_user` VALUES ('2', 'minsu', '233123', 'minsu@gmail.com', '海口');
INSERT INTO `servlet_user` VALUES ('3', 'avguser', 'fdsa123', 'avguser@qq.com', '广州');
INSERT INTO `servlet_user` VALUES ('4', 'sumuser', 'fdsj124', 'sumuser@qq.com', '北京');
</code></pre> 
 <p>打开Eclipse，创建一个动态Web项目：<em>ServletLogin</em>，其完整的目录结构如下所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1610/327151034_95220.png" alt=""></p> 
 <p>以下是这个项目中的几个主要的代码文件。</p> 
 <ul> 
  <li><em>index.html</em></li>
  <li><em>LoginServlet.java</em></li>
  <li><em>LoginDao.java</em></li>
  <li><em>WelcomeServlet.java</em></li>
  <li><em>web.xml</em> </li>
 </ul> 
 <p>以下是各个文件中的实现代码。</p> 
 <p><strong>文件：index.html</strong> -</p> 
 <pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;用户登录示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div style="margin: auto; text-align: center;"&gt;
        &lt;form action="login" method="post"&gt;
            用户名：&lt;input type="text" name="username" /&gt; 密 码：&lt;input
                type="password" name="passwd" /&gt; &lt;input type="submit"
                value="登 录" /&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p><strong>文件：LoginServlet.java</strong> -</p> 
 <pre><code class="lang-java">package com.yiibai.servlet;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import com.yiibai.dao.LoginDao;

public class LoginServlet extends HttpServlet {
    public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        response.setCharacterEncoding("UTF-8");
        response.setContentType("text/html;charset=UTF-8");
        request.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();

        String username = request.getParameter("username");
        String passwd = request.getParameter("passwd");

        if (LoginDao.doLogin(username, passwd)) {
            HttpSession session = request.getSession();
            session.setAttribute("username", username);
            RequestDispatcher rd = request.getRequestDispatcher("welcome");
            rd.forward(request, response);
        } else {
            out.print("用户名或密码错误~！");
            RequestDispatcher rd = request.getRequestDispatcher("index.html");
            rd.include(request, response);
        }
        out.close();
    }
}
</code></pre> 
 <p><strong>文件：LoginDao.java</strong> -</p> 
 <pre><code class="lang-java">package com.yiibai.dao;

import java.sql.*;

public class LoginDao {

    public static boolean doLogin(String username, String passwd) {
        System.out.println("UserName : "+username+", Passwd："+passwd);
        boolean status = false;
        Connection con = null;
        try {
            Class.forName("com.mysql.jdbc.Driver");
            con = DriverManager.getConnection("jdbc:mysql://localhost/testdb?useSSL=false&amp;characterEncoding=utf8", "root", "123456");
            // 用户名及密码是否正确？
            PreparedStatement ps = con.prepareStatement("SELECT * FROM servlet_user WHERE name=? AND passwd=?");
            ps.setString(1, username);
            ps.setString(2, passwd);
            ResultSet rs = ps.executeQuery();
            status = rs.next();
        } catch (Exception e) {
            System.out.println(e);
        }
        return status;
    }
}
</code></pre> 
 <p><strong>文件：WelcomeServlet.java</strong> -</p>   
 <pre><code class="lang-java">package com.yiibai.servlet;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

public class WelcomeServlet extends HttpServlet {

    public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setCharacterEncoding("UTF-8");
        response.setContentType("text/html;charset=UTF-8");
        request.setCharacterEncoding("UTF-8");

        PrintWriter out = response.getWriter();
        HttpSession session = request.getSession();
        String username = (String) session.getAttribute("username");
        out.print("登录成功~！&lt;br/&gt;");
        out.print("欢迎您，" + username);
        out.close();
    }

}
</code></pre> 
 <p><strong>文件：web.xml</strong> -</p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
    id="WebApp_ID" version="3.1"&gt;
    &lt;display-name&gt;ServletLogin&lt;/display-name&gt;
    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
        &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;LoginServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.yiibai.servlet.LoginServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;LoginServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/login&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;WelcomeServ&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.yiibai.servlet.WelcomeServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;WelcomeServ&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/welcome&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</code></pre> 
 <p>在编写上面代码后，部署此Web应用程序(在项目名称上点击右键-&gt;”Run On Server…”)，打开浏览器访问URL： <a target="_blank" href="http://localhost:8080/ServletLogin/">http://localhost:8080/ServletLogin/</a> ，如果没有错误，应该会看到以下结果 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1610/688151032_22617.png" alt=""></p> 
 <p>登录成功后的界面，如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1610/329151033_27748.png" alt=""></p>
 <br>      
</div></body></html>
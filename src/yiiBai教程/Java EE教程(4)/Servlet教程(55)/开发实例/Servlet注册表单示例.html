<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Servlet注册表单示例</h1><div style="width:100%;float:left;" class="article-content">   
 <p><strong>这是一个使用servlet实现用户注册示例</strong></p> 
 <p>在这里，您将了解如何在servlet中创建简单的注册表单。这个示例中，我们使用MySQL数据库。 需要先创建一个数据库：<em>testdb</em>，以及一个表：<em>servlet_user</em>，这个表的结构所示：</p> 
 <pre><code class="lang-sql">CREATE TABLE `servlet_user` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(64) NOT NULL DEFAULT '',
  `passwd` varchar(32) NOT NULL DEFAULT '',
  `email` varchar(32) DEFAULT NULL,
  `city` varchar(24) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;
</code></pre> 
 <p>要在servlet中创建注册页面，可以将数据库逻辑与servlet分开。 但是在这里，为了简化程序，我们在servlet中混合数据库操作逻辑。以后可将<em>DAO</em>，<em>DTO</em>和<em>Singleton</em>设计模式应用在JSP中开发此页面。</p> 
 <h2 id="h2-servlet-"><a name="Servlet中的注册表单示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Servlet中的注册表单示例</h2>
 <p>在这个例子中，创建了以下几个页面。</p> 
 <ul> 
  <li><em>register.html</em> - 注册表单显示</li>
  <li><em>User.java</em> - 用户POJO对象类，只有属性对应的Setter和Getter方法。</li>
  <li><em>Register.java</em> - 执行数据收集和逻辑的页面</li>
  <li><em>RegisterDao.java</em> - 数据访问对象，连接数据库及执行SQL语句。</li>
  <li><em>web.xml</em> - 应用程序配置和部署描述文件。</li>
 </ul> 
 <p>打开Eclipse，创建一个动态Web项目：<em>ServletRegister</em>，其完整的目录结构如下所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1510/598091022_43389.png" alt=""></p> 
 <p>以下是这个项目中的几个主要的代码文件。</p> 
 <p><strong>文件：*</strong>register.html* - </p> 
 <p>在这个页面中，我们从用户那里获取使用文本字段和组合框的输入。用户输入的信息被转发到Register Servlet，负责将数据存储到数据库中。</p> 
 <pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;用户注册&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action="register" method="post"&gt;
        &lt;table&gt;
            &lt;tr&gt;
                &lt;td&gt;用户名:&lt;/td&gt;
                &lt;td&gt;&lt;input type="text" name="username" /&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;密码:&lt;/td&gt;
                &lt;td&gt;&lt;input type="password" name="passwd" /&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;Email:&lt;/td&gt;
                &lt;td&gt;&lt;input type="text" name="email" /&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;城市:&lt;/td&gt;
                &lt;td&gt;&lt;select name="city"&gt;
                        &lt;option value="北京"&gt;北京&lt;/option&gt;
                        &lt;option value="上海"&gt;上海&lt;/option&gt;
                        &lt;option value="广州"&gt;广州&lt;/option&gt;
                        &lt;option value="深圳"&gt;深圳&lt;/option&gt;
                        &lt;option value="其它"&gt;其它&lt;/option&gt;
                &lt;/select&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td colspan="2"&gt;&lt;input type="submit" value="提交注册" /&gt;&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p><strong>文件：*</strong>User.java* - </p> 
 <pre><code class="lang-java">package com.yiibai.bean;

public class User {
    private int id;
    private String username;
    private String passwd;
    private String email;
    private String city;

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPasswd() {
        return passwd;
    }

    public void setPasswd(String passwd) {
        this.passwd = passwd;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getCity() {
        return city;
    }

    public void setCity(String city) {
        this.city = city;
    }

}
</code></pre> 
 <p><strong>文件：</strong> <em>Register.java</em></p> 
 <p>此servlet类接收用户输入的所有数据，并将其存储到数据库中。在这里，由<code>RegisterDao.java</code>执行数据库逻辑。但是也可以将连接数据库的那部分代码分离出去，这对于Web应用程序的维护将会是更好的。</p> 
 <pre><code class="lang-java">package com.yiibai;

import java.io.*;
import java.sql.*;
import javax.servlet.ServletException;
import javax.servlet.http.*;

import com.yiibai.bean.User;
import com.yiibai.dao.RegisterDao;

public class Register extends HttpServlet {
    public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        response.setCharacterEncoding("UTF-8");
        response.setContentType("text/html;charset=UTF-8");
        request.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();

        String username = request.getParameter("username");
        String passwd = request.getParameter("passwd");
        String email = request.getParameter("email");
        String city = request.getParameter("city");

        if(username==null) {
            username = "";
        }
        passwd = (passwd==null)? "" :passwd;
        email = (email==null)? "" :email;
        city = (city==null)? "" :city;

        // 设置用户数据信息
        User user = new User();
        user.setUsername(username);
        user.setPasswd(passwd);
        user.setEmail(email);
        user.setCity(city);

        int status = 0;
        try {
            status = RegisterDao.save(user);
            if (status &gt; 0) {
                out.print("注册用户信息成功...");
            }else {
                out.print("注册用户信息失败...");
            }
        } catch (Exception e2) {
            System.out.println(e2);
        }
        out.close();
    }
}
</code></pre> 
 <p><strong>文件：*</strong>RegisterDao.java*</p> 
 <p>这个类主要用于实现数据连接和插入操作，详细代码如下 - </p>   
 <pre><code class="lang-java">package com.yiibai.dao;

import java.util.*;

import com.yiibai.bean.User;
import java.sql.*;

public class RegisterDao {
    // 表名称
    private static String tbName = "servlet_user";

    public static Connection getConnection() {
        Connection con = null;
        try {
            Class.forName("com.mysql.jdbc.Driver");
            con = DriverManager.getConnection("jdbc:mysql://localhost/testdb?useSSL=false&amp;characterEncoding=utf8", "root", "123456");
        } catch (Exception e) {
            System.out.println(e);
        }
        return con;
    }

    // 插入用户注册信息
    public static int save(User u) {
        int status = 0;
        try {
            Connection con = RegisterDao.getConnection();
            String sql = "INSERT INTO " + tbName + "(name,passwd,email,city) values (?,?,?,?)";
            PreparedStatement ps = con.prepareStatement(sql);
            ps.setString(1, u.getUsername());
            ps.setString(2, u.getPasswd());
            ps.setString(3, u.getEmail());
            ps.setString(4, u.getCity());
            status = ps.executeUpdate();
            con.close();
        } catch (Exception ex) {
            ex.printStackTrace();
        }
        return status;
    }
}
</code></pre> 
 <p><strong>文件：*</strong>web.xml*</p> 
 <p>应用程序配置和部署描述文件，详细代码如下 - </p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://xmlns.jcp.org/xml/ns/javaee" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd" id="WebApp_ID" version="3.1"&gt;
  &lt;display-name&gt;ServletRegister&lt;/display-name&gt;
  &lt;welcome-file-list&gt;
    &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
    &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
  &lt;/welcome-file-list&gt;
      &lt;servlet&gt;
        &lt;servlet-name&gt;ServRegister&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.yiibai.Register&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;ServRegister&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/register&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</code></pre> 
 <p>在编写上面代码后，部署此Web应用程序(在项目名称上点击右键-&gt;”Run On Server…”)，打开浏览器访问URL： <a target="_blank" href="http://localhost:8080/ServletRegister/">http://localhost:8080/ServletRegister/</a> ，如果没有错误，应该会看到以下结果 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1510/144091032_10241.png" alt=""></p> 
 <p>填写上面表单项，并执行提交数据信息，注册成功如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1510/211091033_15182.png" alt=""></p> 
 <p>现在查看<code>servlet_user</code>表中的数据，如下所示 - </p> 
 <pre><code class="lang-sql">mysql&gt; select * from servlet_user;
+----+-------+--------+------------------+------+
| id | name  | passwd | email            | city |
+----+-------+--------+------------------+------+
|  1 | maxsu | 123456 | maxsu@yiibai.com | 广州 |
+----+-------+--------+------------------+------+
1 row in set
</code></pre>
 <br>      
</div></body></html>
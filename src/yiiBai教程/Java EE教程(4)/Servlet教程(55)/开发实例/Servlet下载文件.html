<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Servlet下载文件</h1><div style="width:100%;float:left;" class="article-content">   
 <p>这里是一个从服务器下载文件的简单例子。假设想要下载项目根目录中的<code>home.jsp</code>文件。如果有任何<code>jar</code>或<code>zip</code>文件，可以直接提供该文件的链接，不必编写程序来下载这样的文件。 但是如果有任何<code>java</code>文件或者<code>jsp</code>文件等，则需要编写一个程序来下载这类文件。</p> 
 <h2 id="h2--servlet-"><a name="在servlet中从服务器下载文件的示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>在servlet中从服务器下载文件的示例</h2>
 <p>打开Eclipse，创建一个动态Web项目：<em>ServletDownloadFile</em>，其完整的目录结构如下所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1610/441141015_22269.png" alt=""></p> 
 <p>在这个例子中，创建了三个文件：</p> 
 <ul> 
  <li><em>index.html</em> - 首页入口 </li>
  <li><em>DownloadServlet.java</em> - 处理要下载的文件并向客户端输出文件下载。</li>
  <li><em>web.xml</em> - 此配置文件向服务器提供有关servlet的信息。</li>
 </ul> 
 <p><strong>文件：index.html</strong></p> 
 <p>该文件提供了一个下载文件的链接。参考下面代码 - </p> 
 <pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;Servlet下载文件示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div style="margin:auto;text-align:center;"&gt;
    &lt;a href="DownloadJSP"&gt;下载JSP文件&lt;/a&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p><strong>文件：DownloadServlet.java</strong></p> 
 <p>这是一个实现servlet的文件，读取文件的内容并将其写入流中作为响应发送给客户端。因此需要通知服务器将内容类型设置为：<code>APPLICATION/OCTET-STREAM</code>。</p> 
 <pre><code class="lang-java">package com.yiibai;

import java.io.*;
import javax.servlet.ServletException;
import javax.servlet.http.*;

public class DownloadServlet extends HttpServlet {

    public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        response.setCharacterEncoding("UTF-8");
        response.setContentType("text/html;charset=UTF-8");
        request.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
        String filepath = request.getSession().getServletContext().getRealPath("");
        String filename = "home.jsp";
        response.setContentType("APPLICATION/OCTET-STREAM");
        response.setHeader("Content-Disposition", "attachment; filename=\"" + filename + "\"");

        FileInputStream fileInputStream = new FileInputStream(filepath + filename);

        int i = 0;
        while ((i = fileInputStream.read()) != -1) {
            out.write(i);
        }
        fileInputStream.close();
        out.close();
    }

}
</code></pre> 
 <p><strong>文件：web.xml</strong></p> 
 <p>此配置文件向服务器提供有关servlet的信息。</p>   
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
    id="WebApp_ID" version="3.1"&gt;
    &lt;display-name&gt;ServletDownloadFile&lt;/display-name&gt;
    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
        &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;DownloadServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.yiibai.DownloadServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;DownloadServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/DownloadJSP&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;
</code></pre> 
 <p>在编写上面代码后，部署此Web应用程序(在项目名称上点击右键-&gt;”Run On Server…”)，打开浏览器访问URL： <a target="_blank" href="http://localhost:8080/ServletDownloadFile/">http://localhost:8080/ServletDownloadFile/</a> ，如果没有错误，应该会看到以下结果 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1610/339141020_46562.png" alt=""></p> 
 <p>点击上页面中的<strong>“下载JSP文件”</strong>链接，可以看到以下结果 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1610/265141027_90122.png" alt=""></p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Servlet查询搜索数据示例</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在这里，您将学习如何按给定关键字搜索对应数据库表字段的结果。假设有一个表的结构和数据记录如下：</p> 
 <pre><code class="lang-sql">DROP TABLE IF EXISTS `servlet_user`;
CREATE TABLE `servlet_user` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(64) NOT NULL DEFAULT '',
  `passwd` varchar(32) NOT NULL DEFAULT '',
  `email` varchar(32) DEFAULT NULL,
  `city` varchar(24) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of servlet_user
-- ----------------------------
INSERT INTO `servlet_user` VALUES ('1', 'maxsu', '123456', 'maxsu@yiibai.com', '广州');
INSERT INTO `servlet_user` VALUES ('2', 'minsu', '233123', 'minsu@gmail.com', '海口');
INSERT INTO `servlet_user` VALUES ('3', 'avguser', 'fdsa123', 'avguser@qq.com', '广州');
INSERT INTO `servlet_user` VALUES ('4', 'sumuser', 'fdsj124', 'sumuser@qq.com', '北京');
</code></pre> 
 <p>在这个例子中，我们从servlet中查询数据库<code>servlet_user</code>表中的数据并将结果打印。为了简化程序，我们在Servlet中执行所有数据库操作逻辑。但在现实应用中最好将它与servlet文件分开，如把数据库操作部分放到独立的<code>DAO</code>文件中。</p> 
 <p><strong>按给定关键字搜索的示例</strong></p> 
 <p>打开Eclipse，创建一个动态Web项目：<em>SearchExample</em>，其完整的目录结构如下所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1510/297101036_95723.png" alt=""></p> 
 <p>以下是这个项目中的几个主要的代码文件。</p> 
 <p>在这个例子中，创建了以下几个文件 - </p> 
 <ul> 
  <li><em>index.html</em> - 表单显示</li>
  <li><em>Search.java</em> - 执行输入关键字收集，连接数据库和查询操作的Servlet类。</li>
  <li><em>web.xml</em> - 项目Servlet的配置和描述符文件。</li>
 </ul> 
 <p><strong>文件：index.html</strong></p> 
 <p>该页面显示从用户输入的关键字的表单，并将此数据转发到servlet，servlet负责根据给定的关键字查询表中的数据记录并显示结果。</p> 
 <pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;根据关键字搜索示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div style="margin: 0px; text-align: center;"&gt;
        &lt;form action="search"&gt;
            关键字:&lt;input type="text" name="keyword" /&gt;&lt;input type="submit"
                value="搜索" /&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p><strong>文件：Search.java</strong></p> 
 <p>这是根据用户输入关键字，然后查询数据库中相关记录并打印匹配数据的记录的servlet文件。 在这个页面中，我们显示数据库的列名和数据，所以使用<code>ResultSetMetaData</code>接口。</p> 
 <pre><code class="lang-java">package com.yiibai;

import java.io.*;
import java.sql.*;
import javax.servlet.ServletException;
import javax.servlet.http.*;

public class Search extends HttpServlet {

    public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        response.setCharacterEncoding("UTF-8");
        response.setContentType("text/html;charset=UTF-8");
        request.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();

        String keyword = request.getParameter("keyword");
        //int keyword = Integer.valueOf(keyword);
        if(keyword==null) {
            keyword = "";
        }
        try {
            Connection con = null;
            try {
                Class.forName("com.mysql.jdbc.Driver");
                con = DriverManager.getConnection("jdbc:mysql://localhost/testdb?useSSL=false&amp;characterEncoding=utf8",
                        "root", "123456");
            } catch (Exception e) {
                System.out.println(e);
            }

            PreparedStatement ps = con.prepareStatement("SELECT * FROM `servlet_user` where name LIKE ?");
            ps.setString(1, "%"+keyword+"%");

            out.print("&lt;table width=50% border=1&gt;");
            out.print("&lt;caption&gt;Result:&lt;/caption&gt;");

            ResultSet rs = ps.executeQuery();

            /* 打印表字段的名称 */
            ResultSetMetaData rsmd = rs.getMetaData();
            int total = rsmd.getColumnCount();
            out.print("&lt;tr&gt;");
            for (int i = 1; i &lt;= total; i++) {
                out.print("&lt;th&gt;" + rsmd.getColumnName(i) + "&lt;/th&gt;");
            }
            out.print("&lt;/tr&gt;");

            /* Printing result */

            while (rs.next()) {
                out.print("&lt;tr&gt;&lt;td&gt;" + rs.getInt(1) + "&lt;/td&gt;&lt;td&gt;" + rs.getString(2) + "&lt;/td&gt;&lt;td&gt;" + rs.getString(3)
                        + "&lt;/td&gt;&lt;td&gt;" + rs.getString(4) + "&lt;/td&gt;&lt;td&gt;" + rs.getString(5) + "&lt;/td&gt;&lt;/tr&gt;");

            }
            out.print("&lt;/table&gt;");

        } catch (Exception e2) {
            e2.printStackTrace();
        }

        finally {
            out.close();
        }

    }
}
</code></pre> 
 <p><strong>文件：web.xml</strong></p> 
 <p>这是向容器提供servlet信息的配置文件。</p>   
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
    id="WebApp_ID" version="3.1"&gt;
    &lt;display-name&gt;SearchExample&lt;/display-name&gt;
    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
        &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;Search&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.yiibai.Search&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;Search&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/search&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</code></pre> 
 <p>在编写上面代码后，部署此Web应用程序(在项目名称上点击右键-&gt;”Run On Server…”)，打开浏览器访问URL： <a target="_blank" href="http://localhost:8080/SearchExample/">http://localhost:8080/SearchExample/</a> ，如果没有错误，应该会看到以下结果 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1510/440101034_80807.png" alt=""></p> 
 <p>在上面关键字输入框中输入：<code>su</code>，然后提交搜索，得到以下结果 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1510/534101036_48219.png" alt=""></p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Servlet过虑器</h1><div style="width:100%;float:left;" class="article-content">   
 <p>过滤器是在请求的预处理和后处理时调用的对象。</p> 
 <p>主要用于执行转换，日志记录，压缩，加解密，输入验证等过滤任务。</p> 
 <p>servlet过滤器是可插拔的，即它在<code>web.xml</code>文件中定义，如果从<code>web.xml</code>文件中删除过滤项，则过滤器将被自动删除，因此不需要手动更改<code>Servlet</code>。所以过滤器维护成本会比较低。</p> 
 <p>参考模型图 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1310/436141042_50107.jpg" alt=""></p> 
 <blockquote> 
  <p>注意：与Servlet不同，一个过滤器不依赖于另一个过滤器。</p> 
 </blockquote> 
 <p><strong>过滤器的使用</strong></p> 
 <ul> 
  <li>记录所有传入的请求</li>
  <li>记录来自标计算机的IP地址的请求</li>
  <li>转变/转换</li>
  <li>数据压缩</li>
  <li>加密和解密</li>
  <li>输入验证等</li>
 </ul> 
 <p><strong>过滤器的优点</strong></p> 
 <ul> 
  <li>过滤器是可插拔的。</li>
  <li>一个过滤器不依赖于另一个资源。</li>
  <li>维护少，比较容易维护。</li>
 </ul> 
 <h2 id="h2--api"><a name="过滤器API" class="reference-link"></a><span class="header-link octicon octicon-link"></span>过滤器API</h2>
 <p>像Servlet一样，过滤器也有自己的API。 <code>javax.servlet</code>包中包含Filter API的三个接口，它们分别如下所示 - </p> 
 <ul> 
  <li><code>Filter</code></li>
  <li><code>FilterChain</code></li>
  <li><code>FilterConfig</code></li>
 </ul> 
 <p><strong>Filter接口</strong></p> 
 <p>要创建一个过滤器，必须要实现<code>Filter</code>接口。<code>Filter</code>接口为过滤器提供了生命周期方法。</p> 
 <table> 
  <thead> 
   <tr> 
    <th>方法</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td><code>public void init(FilterConfig config)</code></td> 
    <td><code>init()</code>方法只被调用一次，用于初始化过滤器。</td> 
   </tr> 
   <tr> 
    <td><code>public void doFilter(HttpServletRequest request,HttpServletResponse response, FilterChain chain)</code></td> 
    <td>当用户请求过滤器所映射到资源时，会调用<code>doFilter()</code>方法，它用于执行过滤任务。</td> 
   </tr> 
   <tr> 
    <td><code>public void destroy()</code></td> 
    <td>当过滤器从服务中取出时，调用此方法(仅一次)。</td> 
   </tr> 
  </tbody> 
 </table> 
 <p><strong>FilterChain接口</strong></p> 
 <p><code>FilterChain</code>对象负责调用链中的下一个过滤器或资源。对象在<code>Filter</code>接口的<code>doFilter</code>方法中传递。<code>FilterChain</code>接口只包含一个方法：</p> 
 <ul> 
  <li><code>public void doFilter(HttpServletRequest request，HttpServletResponse response)</code>：它将控件传递给下一个过滤器或资源。</li>
 </ul> 
 <p><strong>如何定义过滤器</strong></p> 
 <p>我们可以使用与<code>servlet</code>相同方式来定义过滤器。下面来看看过滤器和过滤器映射的元素。在<em>web.xml</em>文件配置如下 - </p> 
 <pre><code class="lang-xml">&lt;web-app&gt;  

&lt;filter&gt;  
  &lt;filter-name&gt;...&lt;/filter-name&gt;  
  &lt;filter-class&gt;...&lt;/filter-class&gt;  
&lt;/filter&gt;  

&lt;filter-mapping&gt;  
  &lt;filter-name&gt;...&lt;/filter-name&gt;  
  &lt;url-pattern&gt;...&lt;/url-pattern&gt;  
&lt;/filter-mapping&gt;  

&lt;/web-app&gt;
</code></pre> 
 <p>对于映射过滤器，可以使用<code>url-pattern</code>或<code>servlet-name</code>。 <code>url-pattern</code>元素比<code>servlet-name</code>元素具有优势，即它可以应用于<code>servlet</code>，<code>JSP</code>或<code>HTML</code>资源。</p> 
 <h2 id="h2-u8FC7u6EE4u5668u7684u7B80u5355u793Au4F8B"><a name="过滤器的简单示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>过滤器的简单示例</h2>
 <p>在这个例子中，只是显示在请求的后处理后自动调用过滤器的信息。</p> 
 <p>打开Eclipse，创建一个动态Web项目：<em>SimpleFilter</em>，其完整的目录结构如下所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1310/240151013_60263.png" alt=""></p> 
 <p>以下是这个项目中的几个主要的代码文件。</p> 
 <p>文件：<em>index.html</em> -</p> 
 <pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;过滤器的简单示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div style="font-align: center;"&gt;
        &lt;a href="servlet1"&gt;查看过滤器调用信息&lt;/a&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>文件：<em>MyFilter.java</em></p> 
 <pre><code class="lang-java">package com.yiibai;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.*;

public class MyFilter implements Filter {

    public void init(FilterConfig arg0) throws ServletException {
    }

    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {

        response.setCharacterEncoding("UTF-8");
        response.setContentType("text/html;charset=UTF-8");
        request.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
        out.print("过滤器调用之前&lt;br/&gt;");

        chain.doFilter(request, response);// sends request to next resource

        out.print("过滤器调用之后&lt;br/&gt;");
    }

    public void destroy() {
    }
}
</code></pre> 
 <p>文件：<em>MyServlet.java</em></p>   
 <pre><code class="lang-java">package com.yiibai;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.http.*;

public class MyServlet extends HttpServlet {
    public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setCharacterEncoding("UTF-8");
        response.setContentType("text/html;charset=UTF-8");
        request.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
        out.print("  -- 这是一个简单的测试Servlet.&lt;br&gt;");

    }

}
</code></pre> 
 <p>文件：<em>web.xml</em> - </p> 
 <pre><code class="lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
    id="WebApp_ID" version="3.1"&gt;
    &lt;display-name&gt;SimpleFilter&lt;/display-name&gt;
    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
        &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;s1&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.yiibai.MyServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;s1&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/servlet1&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;filter&gt;
        &lt;filter-name&gt;f1&lt;/filter-name&gt;
        &lt;filter-class&gt;com.yiibai.MyFilter&lt;/filter-class&gt;
    &lt;/filter&gt;

    &lt;filter-mapping&gt;
        &lt;filter-name&gt;f1&lt;/filter-name&gt;
        &lt;url-pattern&gt;/servlet1&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
&lt;/web-app&gt;
</code></pre> 
 <p>在编写上面代码后，部署此Web应用程序(在项目名称上点击右键-&gt;”Run On Server…”)，打开浏览器访问URL： <a target="_blank" href="http://localhost:8080/SimpleFilter/">http://localhost:8080/SimpleFilter/</a> ，如果没有错误，应该会看到以下结果 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1310/472151014_75408.png" alt=""></p> 
 <p>点击链接，得到 以下结果 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/1310/182151022_37239.png" alt=""></p> 
 <p>在上图中，可以看到过滤器调用的顺序。</p>
 <br>      
</div></body></html>
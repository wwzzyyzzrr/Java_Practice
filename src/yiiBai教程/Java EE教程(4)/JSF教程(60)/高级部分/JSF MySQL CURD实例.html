<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">JSF MySQL CURD实例</h1><div style="width:100%;float:left;" class="article-content">   
 <p>JSF提供丰富的工具和库来创建应用程序。 在这里，我们创建一个包含以下步骤的CRUD(增删改查)应用程序。</p> 
 <p>打开 <strong>NetBeans IDE</strong>，创建一个名称为：<strong>jsf-curd</strong> 的 Web 工程，其目录结构如下所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201704/2704/719110445_37481.png" alt=""></p> 
 <blockquote> 
  <p>提示： 需要加入 <code>mysql-connector-java</code> Jar包。</p> 
 </blockquote> 
 <p><strong>使用文件说明</strong></p> 
 <p>我们在项目中使用了bootstrap CSS文件。点击这里下载：<br><a target="_blank" href="http://getbootstrap.com/dist/css/bootstrap.min.css">http://getbootstrap.com/dist/css/bootstrap.min.css</a></p> 
 <p>下载Mysql JDBC连接器JAR文件。点击这里： <a target="_blank" href="http://dev.mysql.com/downloads/connector/j/5.1.html">http://dev.mysql.com/downloads/connector/j/5.1.html</a></p> 
 <p>这个JAR是将应用程序连接到mysql数据库所必需的。</p> 
 <p>此应用程序包含用户输入表单，委托bean和响应页面，如以下步骤。</p> 
 <h3 id="h3-u521Bu5EFAu6570u636Eu5E93u548Cu8868"><a name="创建数据库和表" class="reference-link"></a><span class="header-link octicon octicon-link"></span>创建数据库和表</h3>
 <p>我们使用mysql数据库创建数据库和表。</p> 
 <p><strong>创建数据库</strong></p> 
 <p>使用以下SQL命令，创建一个数据库：<code>test</code> ;</p> 
 <pre><code class="lang-sql">create database test;
</code></pre> 
 <p>在这个数据中，创建一个表: <code>users</code> - </p> 
 <pre><code class="lang-sql">create table users(
    id int not null primary key auto_increment, 
    name varchar(100),   
    email varchar(50), 
    password varchar(20), 
    gender varchar(1), 
    address text
);
</code></pre> 
 <p>创建数据库和表后，现在创建一个用户表单来获取输入的用户信息。</p> 
 <h3 id="h3-u521Bu5EFAu4EE3u7801u6587u4EF6"><a name="创建代码文件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>创建代码文件</h3>
 <p>在这个项目中，要创建以下几个代码文件，它们分别是：</p> 
 <ul> 
  <li><code>User.java</code> - 委托Bean以及数据库相关操作。</li>
  <li><code>index.xhtm</code>l - 项目入口文件，用于列出用户信息列表。</li>
  <li><code>create.xhtml</code> - 创建用户信息的表单</li>
  <li><code>edit.xhtml</code> - 修改/编辑用户信息的表单</li>
 </ul> 
 <p><code>User.java</code>文件中的代码如下所示 - </p> 
 <pre><code class="lang-java">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.yiibai;

/**
 *
 * @author Maxsu
 */
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.Statement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.Map;
import javax.faces.bean.ManagedBean;
import javax.faces.bean.RequestScoped;
import javax.faces.context.FacesContext;

@ManagedBean
@RequestScoped
public class User {

    int id;
    String name;
    String email;
    String password;
    String gender;
    String address;
    ArrayList usersList;
    private Map&lt;String, Object&gt; sessionMap = FacesContext.getCurrentInstance().getExternalContext().getSessionMap();
    Connection connection;

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public String getGender() {
        return gender;
    }

    public void setGender(String gender) {
        this.gender = gender;
    }

    public String getAddress() {
        return address;
    }

    public void setAddress(String address) {
        this.address = address;
    }
// Used to establish connection  

    public Connection getConnection() {
        try {
            Class.forName("com.mysql.jdbc.Driver");
            connection = DriverManager.getConnection("jdbc:mysql://localhost:3306/test", "root", "123456");
        } catch (Exception e) {
            System.out.println(e);
        }
        return connection;
    }
// Used to fetch all records  

    public ArrayList usersList() {
        try {
            usersList = new ArrayList();
            connection = getConnection();
            Statement stmt = getConnection().createStatement();
            ResultSet rs = stmt.executeQuery("select * from users");
            while (rs.next()) {
                User user = new User();
                user.setId(rs.getInt("id"));
                user.setName(rs.getString("name"));
                user.setEmail(rs.getString("email"));
                user.setPassword(rs.getString("password"));
                user.setGender(rs.getString("gender"));
                user.setAddress(rs.getString("address"));
                usersList.add(user);
            }
            connection.close();
        } catch (Exception e) {
            System.out.println(e);
        }
        return usersList;
    }
// Used to save user record  

    public String save() {
        int result = 0;
        try {
            connection = getConnection();
            PreparedStatement stmt = connection.prepareStatement(
                    "insert into users(name,email,password,gender,address) values(?,?,?,?,?)");
            stmt.setString(1, name);
            stmt.setString(2, email);
            stmt.setString(3, password);
            stmt.setString(4, gender);
            stmt.setString(5, address);
            result = stmt.executeUpdate();
            connection.close();
        } catch (Exception e) {
            System.out.println(e);
        }
        if (result != 0) {
            return "index.xhtml?faces-redirect=true";
        } else {
            return "create.xhtml?faces-redirect=true";
        }
    }
// Used to fetch record to update  

    public String edit(int id) {
        User user = null;
        System.out.println(id);
        try {
            connection = getConnection();
            Statement stmt = getConnection().createStatement();
            ResultSet rs = stmt.executeQuery("select * from users where id = " + (id));
            rs.next();
            user = new User();
            user.setId(rs.getInt("id"));
            user.setName(rs.getString("name"));
            user.setEmail(rs.getString("email"));
            user.setGender(rs.getString("gender"));
            user.setAddress(rs.getString("address"));
            user.setPassword(rs.getString("password"));
            System.out.println(rs.getString("password"));
            sessionMap.put("editUser", user);
            connection.close();
        } catch (Exception e) {
            System.out.println(e);
        }
        return "/edit.xhtml?faces-redirect=true";
    }
// Used to update user record  

    public String update(User u) {
//int result = 0;  
        try {
            connection = getConnection();
            PreparedStatement stmt = connection.prepareStatement(
                    "update users set name=?,email=?,password=?,gender=?,address=? where id=?");
            stmt.setString(1, u.getName());
            stmt.setString(2, u.getEmail());
            stmt.setString(3, u.getPassword());
            stmt.setString(4, u.getGender());
            stmt.setString(5, u.getAddress());
            stmt.setInt(6, u.getId());
            stmt.executeUpdate();
            connection.close();
        } catch (Exception e) {
            System.out.println();
        }
        return "/index.xhtml?faces-redirect=true";
    }
// Used to delete user record  

    public void delete(int id) {
        try {
            connection = getConnection();
            PreparedStatement stmt = connection.prepareStatement("delete from users where id = " + id);
            stmt.executeUpdate();
        } catch (Exception e) {
            System.out.println(e);
        }
    }
// Used to set user gender  

    public String getGenderName(char gender) {
        if (gender == 'M') {
            return "Male";
        } else {
            return "Female";
        }
    }
}
</code></pre> 
 <p><code>index.xhtml</code>文件中的代码如下所示 - </p> 
 <pre><code class="lang-html">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;  
&lt;html xmlns="http://www.w3.org/1999/xhtml"  
      xmlns:h="http://xmlns.jcp.org/jsf/html"  
      xmlns:f="http://xmlns.jcp.org/jsf/core"&gt;  
    &lt;h:head&gt;  
        &lt;title&gt;User Details&lt;/title&gt;  
        &lt;link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet"&gt;&lt;/link&gt;       
        &lt;style type="text/css"&gt;  
            table {  
                border-collapse: collapse;  
                width: 100%;  
            }  
            th, td {  
                text-align: left;  
                padding: 8px;  
            }  

            tr:nth-child(even){background-color: #f2f2f2}  
            th {  
                background-color: #4CAF50;  
                color: white;  
            }  
        &lt;/style&gt;  
    &lt;/h:head&gt;  
    &lt;h:body&gt;  
        &lt;h:form&gt;  
            &lt;center&gt;  
                &lt;h2&gt;&lt;h:outputText value="User Records"/&gt;&lt;/h2&gt;  
            &lt;/center&gt;  
            &lt;h:dataTable binding="#{table}" value="#{user.usersList()}" var="u"   
                         class="table table-striped table-hover table-bordered"&gt;  
                &lt;h:column&gt;  
                    &lt;f:facet name="header"&gt;ID&lt;/f:facet&gt;  
                    &lt;h:outputText value="#{table.rowIndex + 1}"/&gt;  
                &lt;/h:column&gt;  
                &lt;h:column&gt;  
                    &lt;f:facet name="header"&gt;User Name&lt;/f:facet&gt;  
                    &lt;h:outputText value="#{u.name}"/&gt;  
                &lt;/h:column&gt;  
                &lt;h:column&gt;  
                    &lt;f:facet name="header"&gt;Email ID&lt;/f:facet&gt;  
                    &lt;h:outputText value="#{u.email}"/&gt;  
                &lt;/h:column&gt;  
                &lt;h:column&gt;  
                    &lt;f:facet name="header"&gt;Password&lt;/f:facet&gt;  
                    &lt;h:outputText value="#{u.password}"/&gt;  
                &lt;/h:column&gt;  
                &lt;h:column&gt;  
                    &lt;f:facet name="header"&gt;Gender&lt;/f:facet&gt;  
                    &lt;h:outputText value="#{user.getGenderName(u.gender)}"/&gt;  
                &lt;/h:column&gt;  
                &lt;h:column&gt;  
                    &lt;f:facet name="header"&gt;Address&lt;/f:facet&gt;  
                    &lt;h:outputText value="#{u.address}"/&gt;  
                &lt;/h:column&gt;  
                &lt;h:column&gt;  
                    &lt;f:facet name="header"&gt;Update&lt;/f:facet&gt;  
                    &lt;h:commandButton action = "#{user.edit(u.id)}" value="Update" class="btn btn-primary"&gt;  
                    &lt;/h:commandButton&gt;  
                &lt;/h:column&gt;  
                &lt;h:column&gt;  
                    &lt;f:facet name="header"&gt;Delete&lt;/f:facet&gt;  
                    &lt;h:commandButton action = "#{user.delete(u.id)}" value="Delete" class="btn btn-danger"&gt;  
                    &lt;/h:commandButton&gt;  
                &lt;/h:column&gt;  
            &lt;/h:dataTable&gt;  
            &lt;center&gt;&lt;h:commandButton action = "create.xhtml?faces-redirect=true"   
                                     value="Create New User" class="btn btn-success"&gt;&lt;/h:commandButton&gt;&lt;/center&gt;  
        &lt;/h:form&gt;  
    &lt;/h:body&gt;  
&lt;/html&gt;
</code></pre> 
 <p><code>create.xhtml</code>文件中的代码如下所示 - </p> 
 <pre><code class="lang-html">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;  
&lt;html xmlns="http://www.w3.org/1999/xhtml"  
      xmlns:h="http://xmlns.jcp.org/jsf/html"  
      xmlns:f="http://xmlns.jcp.org/jsf/core"&gt;  
    &lt;h:head&gt;  
        &lt;title&gt;User Registration Form&lt;/title&gt;  
        &lt;link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet"&gt;&lt;/link&gt;   
    &lt;/h:head&gt;  
    &lt;h:body&gt;  
        &lt;h:form id="form" class="form-horizontal"&gt;  
            &lt;div class="form-group"&gt;  
                &lt;div class="col-sm-4"&gt;&lt;/div&gt;  
                &lt;div  class="col-sm-4"&gt;  
                    &lt;h2 style="text-align: center"&gt;Provide Following Details&lt;/h2&gt;  
                &lt;/div&gt;  
            &lt;/div&gt;  
            &lt;hr/&gt;  
            &lt;div class="form-group"&gt;  
                &lt;h:outputLabel for="username" class="control-label col-sm-4"&gt;User Name&lt;/h:outputLabel&gt;  
                &lt;div class="col-sm-4"&gt;  
                    &lt;h:inputText id="name-id" value="#{user.name}" class="form-control"   
                                 validatorMessage="User name is required"&gt;  
                        &lt;f:validateRequired /&gt;  
                    &lt;/h:inputText&gt;  
                &lt;/div&gt;  
            &lt;/div&gt;  
            &lt;div class="form-group"&gt;  
                &lt;h:outputLabel for="email" class="control-label col-sm-4"&gt;Your Email&lt;/h:outputLabel&gt;  
                &lt;div class="col-sm-4"&gt;  
                    &lt;h:inputText id="email-id" value="#{user.email}" class="form-control"   
                                 validatorMessage="Email Id is required"&gt;  
                        &lt;f:validateRequired/&gt;  
                    &lt;/h:inputText&gt;  
                &lt;/div&gt;  
            &lt;/div&gt;  
            &lt;div class="form-group"&gt;  
                &lt;h:outputLabel for="password" class="control-label col-sm-4"&gt;Password&lt;/h:outputLabel&gt;  
                &lt;div class="col-sm-4"&gt;  
                    &lt;h:inputSecret id="password-id" value="#{user.password}" class="form-control"   
                                   validatorMessage="Password is required"&gt;  
                        &lt;f:validateRequired/&gt;  
                    &lt;/h:inputSecret&gt;  
                &lt;/div&gt;  
            &lt;/div&gt;  
            &lt;div class="form-group"&gt;  
                &lt;h:outputLabel for="gender" class="control-label col-sm-4"&gt;Gender&lt;/h:outputLabel&gt;  
                &lt;div class="col-sm-4"&gt;  
                    &lt;h:selectOneRadio value="#{user.gender}" validatorMessage="Gender is required"&gt;  
                        &lt;f:selectItem itemValue="M" itemLabel="Male" /&gt;  
                        &lt;f:selectItem itemValue="F" itemLabel="Female" /&gt;  
                        &lt;f:validateRequired/&gt;  
                    &lt;/h:selectOneRadio&gt;  
                &lt;/div&gt;  
            &lt;/div&gt;  
            &lt;div class="form-group"&gt;  
                &lt;h:outputLabel for="address" class="control-label col-sm-4"&gt;Address&lt;/h:outputLabel&gt;  
                &lt;div class="col-sm-4"&gt;  
                    &lt;h:inputTextarea value="#{user.address}" cols="50" rows="5" class="form-control"   
                                     validatorMessage="Address is required"&gt;  
                        &lt;f:validateRequired/&gt;  
                    &lt;/h:inputTextarea&gt;  
                &lt;/div&gt;  
            &lt;/div&gt;  
            &lt;div class="form-group"&gt;  
                &lt;div class="col-sm-4"&gt;&lt;/div&gt;  
                &lt;div class="col-sm-4"&gt;  
                    &lt;div class="col-sm-2"&gt;  
                        &lt;h:commandButton value="Save" action="#{user.save()}" class="btn btn-success"   
                                         style="width: 80px;"&gt;&lt;/h:commandButton&gt;  
                    &lt;/div&gt;  
                    &lt;div class="col-sm-1"&gt;  
                    &lt;/div&gt;  
                    &lt;div class="col-sm-2"&gt;  
                        &lt;h:link outcome="index" value="View Users Record List" class="btn btn-primary" /&gt;  
                    &lt;/div&gt;  
                &lt;/div&gt;  
            &lt;/div&gt;  
        &lt;/h:form&gt;  
    &lt;/h:body&gt;  
&lt;/html&gt;
</code></pre> 
 <p><code>edit.xhtml</code>文件中的代码如下所示 - </p>   
 <pre><code class="lang-html">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;  
&lt;html xmlns="http://www.w3.org/1999/xhtml"  
      xmlns:h="http://xmlns.jcp.org/jsf/html"  
      xmlns:f="http://xmlns.jcp.org/jsf/core"&gt;  
    &lt;h:head&gt;  
        &lt;title&gt;Edit Your Record&lt;/title&gt;  
        &lt;link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet"&gt;&lt;/link&gt;   
    &lt;/h:head&gt;  
    &lt;h:body&gt;  
        &lt;h:form id="form" class="form-horizontal"&gt;  
            &lt;div class="form-group"&gt;  
                &lt;div class="col-sm-2"&gt;&lt;/div&gt;  
                &lt;h2 style="text-align: center" class="col-sm-4"&gt;Edit Your Record&lt;/h2&gt;  
            &lt;/div&gt;  
            &lt;hr/&gt;  
            &lt;div class="form-group"&gt;  
                &lt;h:outputLabel for="username" class="control-label col-sm-2"&gt;User Name&lt;/h:outputLabel&gt;  
                &lt;div class="col-sm-4"&gt;  
                    &lt;h:inputText id="name-id" value="#{editUser.name}" class="form-control"/&gt;  
                &lt;/div&gt;  
            &lt;/div&gt;  
            &lt;div class="form-group"&gt;  
                &lt;h:outputLabel for="email" class="control-label col-sm-2"&gt;Your Email&lt;/h:outputLabel&gt;  
                &lt;div class="col-sm-4"&gt;  
                    &lt;h:inputText id="email-id" value="#{editUser.email}" class="form-control"/&gt;  
                &lt;/div&gt;  
            &lt;/div&gt;  
            &lt;div class="form-group"&gt;  
                &lt;h:outputLabel for="password" class="control-label col-sm-2"&gt;Password&lt;/h:outputLabel&gt;  
                &lt;div class="col-sm-4"&gt;  
                    &lt;h:inputSecret id="password-id" value="#{editUser.password}" class="form-control"/&gt;  
                &lt;/div&gt;  
            &lt;/div&gt;  
            &lt;div class="form-group"&gt;  
                &lt;h:outputLabel for="gender" class="control-label col-sm-2"&gt;Gender&lt;/h:outputLabel&gt;  
                &lt;div class="col-sm-4"&gt;  
                    &lt;h:selectOneRadio value="#{editUser.gender}"&gt;  
                        &lt;f:selectItem itemValue="M" itemLabel="Male" /&gt;  
                        &lt;f:selectItem itemValue="F" itemLabel="Female" /&gt;  
                    &lt;/h:selectOneRadio&gt;  
                &lt;/div&gt;  
            &lt;/div&gt;  
            &lt;div class="form-group"&gt;  
                &lt;h:outputLabel for="address" class="control-label col-sm-2"&gt;Address&lt;/h:outputLabel&gt;  
                &lt;div class="col-sm-4"&gt;  
                    &lt;h:inputTextarea value="#{editUser.address}" cols="50" rows="5" class="form-control"/&gt;  
                &lt;/div&gt;  
            &lt;/div&gt;  
            &lt;div class="form-group"&gt;  
                &lt;div class="col-sm-2"&gt;&lt;/div&gt;  
                &lt;div class="col-sm-4"&gt;  
                    &lt;center&gt;&lt;h:commandButton value="Update" action="#{user.update(editUser)}"   
                                             class="btn btn-primary" style="width: 80px;"&gt;&lt;/h:commandButton&gt;&lt;/center&gt;  
                &lt;/div&gt;  
            &lt;/div&gt;  
        &lt;/h:form&gt;  
    &lt;/h:body&gt;  
&lt;/html&gt;
</code></pre> 
 <h3 id="h3-u8FD0u884Cu5B9Eu4F8B"><a name="运行实例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>运行实例</h3>
 <p>这是应用程序的入口页面(<code>index.xhtml</code>)。 运行该项目后，会从mysql的<code>test</code>数据库的<code>users</code>表中读取数据来填充表格，在 Tomcat 启动完成后，打开浏览器访问以下网址：</p> 
 <pre><code>http://localhost:8084/jsf-curd/
</code></pre>
 <p>如果程序没有错误或问题，应该可以看到以下结果 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201704/2704/278110459_38654.png" alt=""></p> 
 <blockquote> 
  <p>注： 因为这是第一次运行， <code>users</code> 表中还没有任何数据。</p> 
 </blockquote> 
 <p><strong>创建页面：添加新的用户记录</strong></p> 
 <p>您可以通过使用此应用程序在用户表中添加新的用户记录。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201704/2804/601120401_60583.png" alt=""></p> 
 <p>提交新的用户信息，添加新记录后，可以看到新用户记录如下 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201704/2804/636120404_56576.png" alt=""></p> 
 <p><strong>更新用户记录</strong></p> 
 <p>在首页中点击对应更新按钮，并修改更新就好，如下所示 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201704/2804/559120405_66314.png" alt=""></p>
 <br>      
</div></body></html>
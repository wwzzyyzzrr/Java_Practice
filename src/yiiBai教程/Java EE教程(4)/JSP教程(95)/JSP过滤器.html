<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">JSP过滤器</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在本章中，我们将讨论JSP中的过滤器。<a target="_blank" href="http://www.yiibai.com/servlet/" title="Servlet">Servlet</a>和JSP过滤器是可以在Servlet和JSP编程中用于以下目的的Java类：</p> 
 <ul> 
  <li>在客户端访问后端的资源之前拦截请求。</li>
  <li>在服务器发送回客户端之前操纵响应。</li>
 </ul> 
 <p>有各种类型的过滤器由规格建议 - </p> 
 <ul> 
  <li>验证过滤器</li>
  <li>数据压缩过滤器</li>
  <li>加密过滤器</li>
  <li>触发资源访问事件的过滤器</li>
  <li>图像转换过滤器</li>
  <li>记录和审核过滤器</li>
  <li>MIME类型链式过滤器</li>
  <li>令牌过滤器</li>
  <li>转换XML内容的<code>XSL/T</code>过滤器</li>
 </ul> 
 <p>过滤器部署在部署描述符文件<em>web.xml</em>中，然后映射到应用程序部署描述符中的servlet或JSP名称或URL模式。部署描述符文件<em>web.xml</em>可以在<code>&lt;Tomcat-installation-directory&gt;\conf</code>目录中或在项目的<em>WEB-INF</em>目录下找到。</p> 
 <h2 id="h2-servlet-"><a name="Servlet过滤器方法" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Servlet过滤器方法</h2>
 <p>过滤器只是一个实现<code>javax.servlet.Filter</code>接口的Java类。<code>javax.servlet.Filter</code>接口定义了三种方法 -</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>方法</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>public void doFilter (ServletRequest, ServletResponse, FilterChain)</code></td> 
    <td>由于是在链末端的客户端请求，所以每当通过链路传递请求/响应对时，容器就会调用此方法。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>public void init(FilterConfig filterConfig)</code></td> 
    <td>该方法由Web容器调用，向过滤器指示它正在投入使用。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>public void destroy()</code></td> 
    <td>该方法由Web容器调用以向过滤器指示它正在停用服务。</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 id="h2-jsp-"><a name="JSP过滤器示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>JSP过滤器示例</h2>
 <p>以下示例显示了如何在客户访问任何JSP文件时，打印客户端的IP地址和当前日期时间。 这个例子将让您对JSP过滤器有一个基本的了解，基于这个示例，您可以使用相同的概念编写更复杂的过滤器应用程序。</p> 
 <p>打开Eclipse，创建一个动态Web项目：<em>Filter</em>，其项目的结构如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2010/594141022_98441.png" alt=""></p> 
 <p>下面来看看这个应用的具体实现。</p> 
 <p>文件：<em>LogFilter.java</em></p> 
 <pre><code class="lang-java">package com.yiibai;

//Import required java libraries
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import java.util.*;

//Implements Filter class
public class LogFilter implements Filter {
    public void init(FilterConfig config) throws ServletException {
        // Get init parameter
        String testParam = config.getInitParameter("test-param");
        // Print the init parameter
        System.out.println("Test Param: " + testParam);
    }

    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws java.io.IOException, ServletException {

        // Get the IP address of client machine.
        String ipAddress = request.getRemoteAddr();

        // Log the IP address and current timestamp.
        System.out.println("IP " + ipAddress + ", Time " + new Date().toString());

        // Pass request back down the filter chain
        chain.doFilter(request, response);
    }

    public void destroy() {
        /*
         * Called before the Filter instance is removed from service by the web
         * container
         */
    }
}
</code></pre> 
 <p><strong>Web.xml中的JSP过滤器映射</strong></p> 
 <p>过滤器需要先定义，然后映射到URL或JSP文件名，与Servlet定义的方式大致相同，然后映射到<em>web.xml</em>文件中的URL模式。在部署描述符文件<em>web.xml</em>中为过滤器标签创建以下标签项 - </p> 
 <pre><code class="lang-xml">&lt;filter&gt;
   &lt;filter-name&gt;LogFilter&lt;/filter-name&gt;
   &lt;filter-class&gt;LogFilter&lt;/filter-class&gt;

   &lt;init-param&gt;
      &lt;param-name&gt;test-param&lt;/param-name&gt;
      &lt;param-value&gt;Initialization Paramter&lt;/param-value&gt;
   &lt;/init-param&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
   &lt;filter-name&gt;LogFilter&lt;/filter-name&gt;
   &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</code></pre> 
 <p>上述过滤器将适用于所有servlet和JSP，因为我们在配置中指定了<code>/*</code>。如果要仅在少数servlet或JSP上应用过滤器，则可以指定特定的servlet或JSP路径。</p> 
 <p>现在尝试调用任意一个servlet或JSP，将看到有生成日志到Web服务器日志。可以使用Log4J记录器记录以上日志在单独的文件中。</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2010/757141024_36417.png" alt=""></p> 
 <p>在终端输出结果如下 - </p>   
 <pre><code class="lang-shell">......
信息: Starting Servlet Engine: Apache Tomcat/8.5.23
十月 20, 2017 2:22:55 上午 org.apache.catalina.util.SessionIdGeneratorBase createSecureRandom
警告: Creation of SecureRandom instance for session ID generation using [SHA1PRNG] took [110] milliseconds.
Test Param: Initialization Paramter
十月 20, 2017 2:22:55 上午 org.apache.coyote.AbstractProtocol start
信息: Starting ProtocolHandler ["http-nio-8080"]
十月 20, 2017 2:22:55 上午 org.apache.coyote.AbstractProtocol start
信息: Starting ProtocolHandler ["ajp-nio-8009"]
十月 20, 2017 2:22:55 上午 org.apache.catalina.startup.Catalina start
信息: Server startup in 717 ms
IP 0:0:0:0:0:0:0:1, Time Fri Oct 20 02:22:57 BOT 2017
</code></pre> 
 <p><strong>使用多个过滤器</strong></p> 
 <p>Web应用程序可以定义几个具有特定目的的不同过滤器。考虑一下，定义两个过滤器<code>AuthenFilter</code>和<code>LogFilter</code>。其余的过程将保持跟上面一样，除了需要创建一个不同的映射，如下所述 -</p> 
 <pre><code class="lang-xml">&lt;filter&gt;
   &lt;filter-name&gt;LogFilter&lt;/filter-name&gt;
   &lt;filter-class&gt;LogFilter&lt;/filter-class&gt;

   &lt;init-param&gt;
      &lt;param-name&gt;test-param&lt;/param-name&gt;
      &lt;param-value&gt;Initialization Paramter&lt;/param-value&gt;
   &lt;/init-param&gt;
&lt;/filter&gt;

&lt;filter&gt;
   &lt;filter-name&gt;AuthenFilter&lt;/filter-name&gt;
   &lt;filter-class&gt;AuthenFilter&lt;/filter-class&gt;
   &lt;init-param&gt;
      &lt;param-name&gt;test-param&lt;/param-name&gt;
      &lt;param-value&gt;Initialization Paramter&lt;/param-value&gt;
   &lt;/init-param&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
   &lt;filter-name&gt;LogFilter&lt;/filter-name&gt;
   &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;

&lt;filter-mapping&gt;
   &lt;filter-name&gt;AuthenFilter&lt;/filter-name&gt;
   &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</code></pre> 
 <p><strong>过滤应用顺序</strong></p> 
 <p><em>web.xml</em>中的过滤器映射元素的顺序确定了Web容器将过滤器应用于servlet或JSP的顺序。 要颠倒过滤器的顺序，只需要反转<em>web.xml</em>文件中的过滤器映射元素即可。</p> 
 <p>例如，上面的例子将首先应用<code>LogFilter</code>，然后将<code>AuthenFilter</code>应用于任何servlet或JSP; 以下示例将颠倒顺序 -</p> 
 <pre><code class="lang-xml">&lt;filter-mapping&gt;
   &lt;filter-name&gt;AuthenFilter&lt;/filter-name&gt;
   &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;

&lt;filter-mapping&gt;
   &lt;filter-name&gt;LogFilter&lt;/filter-name&gt;
   &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</code></pre>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">JSP会话Session跟踪</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在本章中，我们将讨论JSP中的会话跟踪。 HTTP是一种“无状态”协议，这意味着每次客户端检索一个Web页面时，客户机打开与Web服务器的单独连接，并且服务器自动不保留先前客户端请求的任何记录。</p> 
 <h2 id="h2--web-"><a name="维护Web客户端与服务器之间的会话" class="reference-link"></a><span class="header-link octicon octicon-link"></span>维护Web客户端与服务器之间的会话</h2>
 <p>现在来讨论几个用来维护Web客户机和Web服务器之间会话的方式 -</p> 
 <p><strong>1.Cookies</strong></p> 
 <p>网络服务器可以将唯一的会话ID作为cookie分配给每个Web客户端，并为客户端提供后续请求，并使用接收到的cookie进行识别。</p> 
 <p>这可能不是有效的方式，因为浏览器有时不支持cookie。不建议使用此过程来维护会话。</p> 
 <p><strong>2.隐藏表单字段</strong></p> 
 <p>Web服务器可以发送隐藏的HTML表单域以及唯一的会话ID，如下所示：</p> 
 <pre><code class="lang-html">&lt;input type = "hidden" name = "sessionid" value = "123456"&gt;
</code></pre> 
 <p>当提交表单时，指定的名称和值将自动包含在<code>GET</code>或<code>POST</code>数据中。 每次Web浏览器发送请求时，<code>session_id</code>值都可以用于跟踪不同的Web浏览器。</p> 
 <p>这可以是跟踪会话的有效方法，但点击常规(<code>&lt;a href="..."&gt;</code>)超文本链接不会产生表单提交，因此隐藏表单字段也不能支持常规会话跟踪。</p> 
 <p><strong>3.网址重写</strong></p> 
 <p>可以在每个网址的末尾附加一些额外的数据。该数据标识会话; 服务器可以将该会话标识符与其关于该会话存储的数据相关联。</p> 
 <p>例如，使用URL：<code>http://www.yiibai.com/file.html;sessionid=123456789</code>，会话标识符作为<code>sessionid=123456789</code>附加，可以在Web服务器上访问以识别客户端。</p> 
 <p>URL重写是一种更好的方法来维护会话，并且在浏览器不支持cookie时可以使用它们。 这里的缺点是，必须动态生成每个URL来分配会话ID，而页面是一个简单的静态HTML页面。</p> 
 <p><strong>4.session对象</strong></p> 
 <p>除了上述选项之外，JSP还使用了提供<code>HttpSession</code>接口的servlet。该接口提供了一种识别用户的方法。</p> 
 <ul> 
  <li>一个页请求或</li>
  <li>访问网站或</li>
  <li>存储有关该用户的信息</li>
 </ul> 
 <p>默认情况下，JSP启用会话跟踪，并为每个新客户端自动实例化一个新的<code>HttpSession</code>对象。 禁用会话跟踪需要通过将页面指令会话属性设置为<code>false</code>来明确地将其关闭，如下所示：</p> 
 <pre><code class="lang-html">&lt;%@ page session = "false" %&gt;
</code></pre> 
 <p>JSP引擎通过隐式会话对象将<code>HttpSession</code>对象公开给JSP程序员。由于会话对象已经提供给JSP程序员，程序员可以立即开始从对象中存储和检索数据，而无需任何初始化或<code>getSession()</code>。</p> 
 <p>以下是<code>session</code>对象提供的重要方法列表 -</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>语法</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>public Object getAttribute(String name)</code></td> 
    <td>此方法返回在此会话中用指定名称绑定的对象，如果在名称下没有绑定对象，则返回<code>null</code>。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>public Enumeration getAttributeNames()</code></td> 
    <td>此方法返回一个包含绑定到此会话的所有对象的名称的<code>String</code>对象枚举。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>public long getCreationTime()</code></td> 
    <td>此方法返回创建此会话的时间，以1970年1月1日GMT格林尼治时间以来的毫秒为单位。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>public String getId()</code></td> 
    <td>此方法返回一个包含分配给此会话的唯一标识符的字符串。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>public long getLastAccessedTime()</code></td> 
    <td>此方法返回客户端上次发送与此会话相关联的请求的时间，为1970年1月1日GMT以来的毫秒数。</td> 
   </tr> 
   <tr> 
    <td>6</td> 
    <td><code>public int getMaxInactiveInterval()</code></td> 
    <td>此方法返回servlet容器在客户端访问之间保持此会话的最长时间间隔(以秒为单位)。</td> 
   </tr> 
   <tr> 
    <td>7</td> 
    <td><code>public void invalidate()</code></td> 
    <td>此方法使该会话无效，并取消绑定绑定到该对象的任何对象。</td> 
   </tr> 
   <tr> 
    <td>8</td> 
    <td><code>public boolean isNew()</code></td> 
    <td>如果客户端还不知道会话或者客户端选择不加入会话，则此方法返回<code>true</code>。</td> 
   </tr> 
   <tr> 
    <td>9</td> 
    <td><code>public void removeAttribute(String name)</code></td> 
    <td>此方法从此会话中删除与指定名称绑定的对象。</td> 
   </tr> 
   <tr> 
    <td>10</td> 
    <td><code>public void setAttribute(String name, Object value)</code></td> 
    <td>此方法使用指定的名称将对象绑定到此会话。</td> 
   </tr> 
   <tr> 
    <td>11</td> 
    <td><code>public void setMaxInactiveInterval(int interval)</code></td> 
    <td>此方法指定在servlet容器将使此会话无效之前，客户端请求之间的时间(以秒为单位)。</td> 
   </tr> 
  </tbody> 
 </table> 
 <h2 id="h2-u4F1Au8BDDu8DDFu8E2Au793Au4F8B"><a name="会话跟踪示例" class="reference-link"></a><span class="header-link octicon octicon-link"></span>会话跟踪示例</h2>
 <p>此示例介绍如何使用<code>HttpSession</code>对象来查找会话的创建时间和最后访问的时间。如果尚不存在，会将新建会话与请求相关联。</p> 
 <p>打开Eclipse，创建一个动态Web项目：<em>SessionTracking</em>， 其目录结构如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2010/108161042_39236.png" alt=""></p> 
 <p>创建一个JSP文件：<em>index.jsp</em>，如下代码 - </p> 
 <pre><code class="lang-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;%@ page import="java.io.*,java.util.*"%&gt;
&lt;%
    // Get session creation time.
    Date createTime = new Date(session.getCreationTime());

    // Get last access time of this Webpage.
    Date lastAccessTime = new Date(session.getLastAccessedTime());

    String title = "Welcome Back to my website";
    Integer visitCount = new Integer(0);
    String visitCountKey = new String("visitCount");
    String userIDKey = new String("userID");
    String userID = new String("ABCD");

    // Check if this is new comer on your Webpage.
    if (session.isNew()) {
        title = "Welcome to my website";
        session.setAttribute(userIDKey, userID);
        session.setAttribute(visitCountKey, visitCount);
    }
    visitCount = (Integer) session.getAttribute(visitCountKey);
    visitCount = visitCount + 1;
    userID = (String) session.getAttribute(userIDKey);
    session.setAttribute(visitCountKey, visitCount);
%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;Session会话跟踪示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div style="margin: auto; width: 80%;"&gt;
        &lt;center&gt;
            &lt;h2&gt;
                Session会话跟踪示例
                &lt;/h1&gt;
        &lt;/center&gt;

        &lt;table border="1" align="center"&gt;
            &lt;tr bgcolor="#949494"&gt;
                &lt;th&gt;会话信息&lt;/th&gt;
                &lt;th&gt;值&lt;/th&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;id&lt;/td&gt;
                &lt;td&gt;
                    &lt;%
                        out.print(session.getId());
                    %&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;创建时间&lt;/td&gt;
                &lt;td&gt;
                    &lt;%
                        out.print(createTime);
                    %&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;最近一次访问时间&lt;/td&gt;
                &lt;td&gt;
                    &lt;%
                        out.print(lastAccessTime);
                    %&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;用户ID&lt;/td&gt;
                &lt;td&gt;
                    &lt;%
                        out.print(userID);
                    %&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;访问次数&lt;/td&gt;
                &lt;td&gt;
                    &lt;%
                        out.print(visitCount);
                    %&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>编写完成上面代码后，部署项目然后运行，打开浏览器尝试访问：<code>http://localhost:8080/SessionTracking/</code> 。将看到以下结果 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2010/226161043_78006.png" alt=""></p> 
 <p>现在尝试再次运行(刷新)相同的JSP页面，可以看到访问次数更新为<code>2</code>，如下图所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2010/166161043_35716.png" alt=""></p> 
 <h2 id="h2-u5220u9664u4F1Au8BDDu6570u636E"><a name="删除会话数据" class="reference-link"></a><span class="header-link octicon octicon-link"></span>删除会话数据</h2>
 <p>完成用户的会话数据后，有几个方式用来删除会话信息 -</p> 
 <ul> 
  <li><strong>删除一个指定的属性</strong> - 可以调用<code>public void removeAttribute(String name)</code>方法来删除与特定键相关联的值。</li>
  <li><strong>删除整个会话信息</strong> - 可以调用<code>public void invalidate()</code>方法来删除(丢弃)整个会话信息。</li>
  <li><strong>设置会话超时</strong> - 可以调用<code>public void setMaxInactiveInterval(int interval)</code>方法来单独设置会话的超时。</li>
  <li><strong>注销登录用户</strong> - 支持servlets 2.4的服务器，可以调用注销将客户端记录在Web服务器之外，并使属于用户的所有会话失效。</li>
  <li><strong>web.xml配置</strong> - 如果使用的是Tomcat，除了上述方法外，还可以在<code>web.xml</code>文件中配置会话超时，如下所示-  <pre><code class="lang-xml">&lt;session-config&gt;
 &lt;session-timeout&gt;15&lt;/session-timeout&gt;
&lt;/session-config&gt;
</code></pre> <code>&lt;session-timeout&gt;</code>指定超时表示的时间单位为分钟，上面配置示例将覆盖Tomcat中<code>30</code>分钟的默认超时。</li>
 </ul> 
 <p>servlet中的<code>getMaxInactiveInterval()</code>方法以秒为单位返回该会话的超时时间。 因此，如果会话在<code>web.xml</code>中配置了<code>15</code>分钟，那么<code>getMaxInactiveInterval()</code>方法将返回<code>900</code>秒。</p>
 <br>      
</div></body></html>
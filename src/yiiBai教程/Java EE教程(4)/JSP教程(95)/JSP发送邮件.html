<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">JSP发送邮件</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在本章中，我们将讨论如何使用JSP发送电子邮件。要使用JSP发送电子邮件，应该在计算机上安装JavaMail API和Java Activation Framework(JAF)。</p> 
 <ul> 
  <li>从Java的标准网站下载最新版本的JavaMail(1.2版)，下载地址： <a target="_blank" href="http://www.oracle.com/technetwork/java/javasebusiness/downloads/java-archive-downloads-eeplat-419426.html#javamail-1.4.3-oth-JPRhttp://www.oracle.com/technetwork/java/javasebusiness/downloads/java-archive-downloads-eeplat-419426.html#javamail-1.4.3-oth-JPR">http://www.oracle.com/technetwork/java/javasebusiness/downloads/java-archive-downloads-eeplat-419426.html#javamail-1.4.3-oth-JPRhttp://www.oracle.com/technetwork/java/javasebusiness/downloads/java-archive-downloads-eeplat-419426.html#javamail-1.4.3-oth-JPR</a> 。</li>
 </ul> 
 <p>在新创建的顶级目录中下载并解压缩这些文件。可以看到许多应用程序的jar文件。需要添加<code>mail.jar</code>文件到项目的<em>WEB-INFO/lib</em>。</p> 
 <p>打开Eclipse创建一个动态Web项目：<em>SendingEmail</em> ，其项目中的文件如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2310/222121012_97752.png" alt=""></p> 
 <p>以下是发送邮件的代码示例 - </p> 
 <p>用于表述邮件内容的类，文件：<em>MailSenderInfo.java</em></p> 
 <pre><code class="lang-java">package com.yiibai;

/**  
* 发送邮件需要使用的基本信息  
*/
import java.util.Properties;

public class MailSenderInfo {
    // 发送邮件的服务器的IP和端口
    private String mailServerHost;
    private String mailServerPort = "25";
    // 邮件发送者的地址
    private String fromAddress;
    // 邮件接收者的地址
    private String toAddress;
    // 登陆邮件发送服务器的用户名和密码
    private String userName;
    private String password;
    // 是否需要身份验证
    private boolean validate = false;
    // 邮件主题
    private String subject;
    // 邮件的文本内容
    private String content;
    // 邮件附件的文件名
    private String[] attachFileNames;

    /**
     * 获得邮件会话属性
     */
    public Properties getProperties() {
        Properties p = new Properties();
        p.put("mail.smtp.host", this.mailServerHost);
        p.put("mail.smtp.port", this.mailServerPort);
        p.put("mail.smtp.auth", validate ? "true" : "false");
        p.put("mail.smtp.ssl.enable", "true");// 
        return p;
    }

    public String getMailServerHost() {
        return mailServerHost;
    }

    public void setMailServerHost(String mailServerHost) {
        this.mailServerHost = mailServerHost;
    }

    public String getMailServerPort() {
        return mailServerPort;
    }

    public void setMailServerPort(String mailServerPort) {
        this.mailServerPort = mailServerPort;
    }

    public boolean isValidate() {
        return validate;
    }

    public void setValidate(boolean validate) {
        this.validate = validate;
    }

    public String[] getAttachFileNames() {
        return attachFileNames;
    }

    public void setAttachFileNames(String[] fileNames) {
        this.attachFileNames = fileNames;
    }

    public String getFromAddress() {
        return fromAddress;
    }

    public void setFromAddress(String fromAddress) {
        this.fromAddress = fromAddress;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public String getToAddress() {
        return toAddress;
    }

    public void setToAddress(String toAddress) {
        this.toAddress = toAddress;
    }

    public String getUserName() {
        return userName;
    }

    public void setUserName(String userName) {
        this.userName = userName;
    }

    public String getSubject() {
        return subject;
    }

    public void setSubject(String subject) {
        this.subject = subject;
    }

    public String getContent() {
        return content;
    }

    public void setContent(String textContent) {
        this.content = textContent;
    }
}
</code></pre> 
 <p>用于实现发送各类格式的代码实现，文件：<em>SimpleMailSender.java</em> - </p> 
 <pre><code class="lang-java">package com.yiibai;

import java.io.UnsupportedEncodingException;
import java.util.Date;
import java.util.Properties;

import javax.activation.DataHandler;
import javax.activation.FileDataSource;
import javax.mail.Address;
import javax.mail.BodyPart;
import javax.mail.Message;
import javax.mail.MessagingException;
import javax.mail.Multipart;
import javax.mail.Session;
import javax.mail.Transport;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeBodyPart;
import javax.mail.internet.MimeMessage;
import javax.mail.internet.MimeMultipart;
import javax.mail.internet.MimeUtility;

/**
 * 简单邮件(不带附件的邮件)发送器
 */
public class SimpleMailSender {
    /**
     * 以文本格式发送邮件
     * 
     * @param mailInfo
     *            待发送的邮件的信息
     */
    public boolean sendTextMail(MailSenderInfo mailInfo) {
        // 判断是否需要身份认证
        MyAuthenticator authenticator = null;
        Properties pro = mailInfo.getProperties();
        if (mailInfo.isValidate()) {
            // 如果需要身份认证，则创建一个密码验证器
            authenticator = new MyAuthenticator(mailInfo.getUserName(), mailInfo.getPassword());
        }
        // 根据邮件会话属性和密码验证器构造一个发送邮件的session
        Session sendMailSession = Session.getDefaultInstance(pro, authenticator);
        try {
            // 根据session创建一个邮件消息
            Message mailMessage = new MimeMessage(sendMailSession);
            // 创建邮件发送者地址
            Address from = new InternetAddress(mailInfo.getFromAddress());
            // 设置邮件消息的发送者
            mailMessage.setFrom(from);
            // 创建邮件的接收者地址，并设置到邮件消息中
            Address to = new InternetAddress(mailInfo.getToAddress());
            mailMessage.setRecipient(Message.RecipientType.TO, to);
            // 设置邮件消息的主题
            mailMessage.setSubject(mailInfo.getSubject());
            // 设置邮件消息发送的时间
            mailMessage.setSentDate(new Date());
            // 设置邮件消息的主要内容
            String mailContent = mailInfo.getContent();
            mailMessage.setText(mailContent);
            // 发送邮件
            Transport.send(mailMessage);
            return true;
        } catch (MessagingException ex) {
            ex.printStackTrace();
        }
        return false;
    }

    /**
     * 以HTML格式发送邮件
     * 
     * @param mailInfo
     *            待发送的邮件信息
     */
    public static boolean sendHtmlMail(MailSenderInfo mailInfo) {
        // 判断是否需要身份认证
        MyAuthenticator authenticator = null;
        Properties pro = mailInfo.getProperties();
        // 如果需要身份认证，则创建一个密码验证器
        if (mailInfo.isValidate()) {
            authenticator = new MyAuthenticator(mailInfo.getUserName(), mailInfo.getPassword());
        }
        // 根据邮件会话属性和密码验证器构造一个发送邮件的session
        Session sendMailSession = Session.getDefaultInstance(pro, authenticator);
        try {
            // 根据session创建一个邮件消息
            Message mailMessage = new MimeMessage(sendMailSession);
            // 创建邮件发送者地址
            Address from = new InternetAddress(mailInfo.getFromAddress());
            // 设置邮件消息的发送者
            mailMessage.setFrom(from);
            // 创建邮件的接收者地址，并设置到邮件消息中
            Address to = new InternetAddress(mailInfo.getToAddress());
            // Message.RecipientType.TO属性表示接收者的类型为TO
            mailMessage.setRecipient(Message.RecipientType.TO, to);
            // 设置邮件消息的主题
            mailMessage.setSubject(mailInfo.getSubject());
            // 设置邮件消息发送的时间
            mailMessage.setSentDate(new Date());
            // MiniMultipart类是一个容器类，包含MimeBodyPart类型的对象
            Multipart mainPart = new MimeMultipart();
            // 创建一个包含HTML内容的MimeBodyPart
            BodyPart html = new MimeBodyPart();
            // 设置HTML内容
            html.setContent(mailInfo.getContent(), "text/html; charset=utf-8");
            mainPart.addBodyPart(html);
            // 将MiniMultipart对象设置为邮件内容
            mailMessage.setContent(mainPart);
            // 发送邮件
            Transport.send(mailMessage);
            return true;
        } catch (MessagingException ex) {
            ex.printStackTrace();
        }
        return false;
    }

    /**
     * 以HTML格式发送邮件
     * 
     * @param mailInfo
     *            待发送的邮件信息
     * @throws UnsupportedEncodingException
     */
    public static boolean sendAttachMail(MailSenderInfo mailInfo, String path) {
        // 判断是否需要身份认证
        MyAuthenticator authenticator = null;
        Properties pro = mailInfo.getProperties();
        // 如果需要身份认证，则创建一个密码验证器
        if (mailInfo.isValidate()) {
            authenticator = new MyAuthenticator(mailInfo.getUserName(), mailInfo.getPassword());
        }
        // 根据邮件会话属性和密码验证器构造一个发送邮件的session
        Session sendMailSession = Session.getDefaultInstance(pro, authenticator);
        try {
            // 根据session创建一个邮件消息
            Message mailMessage = new MimeMessage(sendMailSession);
            // 创建邮件发送者地址
            Address from = new InternetAddress(mailInfo.getFromAddress());
            // 设置邮件消息的发送者
            mailMessage.setFrom(from);
            // 创建邮件的接收者地址，并设置到邮件消息中
            Address to = new InternetAddress(mailInfo.getToAddress());
            // Message.RecipientType.TO属性表示接收者的类型为TO
            mailMessage.setRecipient(Message.RecipientType.TO, to);
            // 设置邮件消息的主题
            mailMessage.setSubject(mailInfo.getSubject());
            // 设置邮件消息发送的时间
            mailMessage.setSentDate(new Date());

            // 添加附件部分
            // 邮件内容部分1---文本内容
            MimeBodyPart body0 = new MimeBodyPart(); // 邮件中的文字部分
            body0.setContent("这是两张&lt;font color='red'&gt;图片&lt;/font&gt;....", "text/html;charset=utf-8");

            // 邮件内容部分2---附件1
            MimeBodyPart body1 = new MimeBodyPart(); // 附件1
            if (path != null) {
                body1.setDataHandler(new DataHandler(new FileDataSource(path + "/mydog.jpg")));// 项目根目录下

                body1.setFileName(MimeUtility.encodeText(path + "/mydog.jpg"));// 中文附件名，解决乱码
            } else {
                body1.setDataHandler(new DataHandler(new FileDataSource("mydog.jpg")));// 项目根目录下
                body1.setFileName(MimeUtility.encodeText("mydog.jpg"));// 中文附件名，解决乱码
            }

            // 邮件内容部分3---附件2
            MimeBodyPart body2 = new MimeBodyPart(); // 附件2
            if (path != null) {
                body2.setDataHandler(new DataHandler(new FileDataSource(path + "/mydog2.jpg")));
                body2.setFileName(path + "/2.jpg");
            }

            // 把上面的3部分组装在一起，设置到msg中
            MimeMultipart mm = new MimeMultipart();

            mm.addBodyPart(body0);
            mm.addBodyPart(body1);
            mm.addBodyPart(body2);

            mailMessage.setContent(mm);

            // 发送邮件
            Transport.send(mailMessage);
            return true;
        } catch (MessagingException | UnsupportedEncodingException ex) {
            ex.printStackTrace();
        }
        return false;
    }
}
</code></pre> 
 <h3 id="h3-jsp-"><a name="JSP代码部分" class="reference-link"></a><span class="header-link octicon octicon-link"></span>JSP代码部分</h3>
 <p>用于发送文本内容的JSP实现代码，文件：<em>sendtext.jsp</em> - </p>   
 <pre><code>&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;%@ page import="java.io.*,java.util.*,javax.mail.*"%&gt;
&lt;%@ page import="javax.mail.internet.*,javax.activation.*"%&gt;
&lt;%@ page import="javax.servlet.http.*,javax.servlet.*"%&gt;
&lt;%@ page import="com.yiibai.*"%&gt;

&lt;%
    //这个类主要是设置邮件  
    MailSenderInfo mailInfo = new MailSenderInfo();
    mailInfo.setMailServerHost("smtp.qq.com"); // 将 smtp.qq.com 改为smtp.exmail.qq.com
    mailInfo.setMailServerPort("465");
    mailInfo.setValidate(true);
    mailInfo.setUserName("769728683@qq.com"); //自己的邮箱
    mailInfo.setPassword("xxxxxxxxxxxxxxx");//自己配置的邮箱密码，用于验证      

    mailInfo.setFromAddress("769728683@qq.com"); ///自己的邮箱
    mailInfo.setToAddress("yiibaicom@qq.com"); ///对方收件的邮箱

    SimpleMailSender sms = new SimpleMailSender();

    //发送文本邮件  
    mailInfo.setSubject("发送Text邮箱标题");
    mailInfo.setContent("这是一封文本邮箱内容，&lt;p&gt;这里使用P标签&lt;/p&gt;");
    sms.sendTextMail(mailInfo);//发送文体格式   

%&gt;

&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;JSP发送邮件示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div style="margin: auto; width: 80%;"&gt;
        &lt;h2&gt;JSP发送邮件示例&lt;/h2&gt;
        &lt;p&gt;发送文本邮件完成...&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
 <p>执行上面示例代码，打开浏览器访问URL： <a target="_blank" href="http://localhost:8080/SendingEmail/sendtext.jsp">http://localhost:8080/SendingEmail/sendtext.jsp</a> ，可以看到以下结果 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2310/215121021_30720.png" alt=""></p> 
 <p>登录收件邮箱账号，可以到收到了一封邮件，如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2310/556121024_97388.png" alt=""></p> 
 <p><em>发送HTML格式邮件</em></p> 
 <p>以下是一个发送HTML格式邮件的代码，文件：<em>sendhtml.jsp</em> - </p> 
 <pre><code class="lang-html">

</code></pre> 
 <p><strong>发送HTML内容邮件</strong></p> 
 <p>以下是一个发送带有附件邮件的代码，文件：<em>sendhtml.jsp</em> - </p> 
 <pre><code class="lang-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;%@ page import="com.yiibai.*"%&gt;

&lt;%
    //这个类主要是设置邮件  
    MailSenderInfo mailInfo = new MailSenderInfo();
    mailInfo.setMailServerHost("smtp.qq.com"); // 将 smtp.qq.com 改为smtp.exmail.qq.com
    mailInfo.setMailServerPort("465");
    mailInfo.setValidate(true);
    mailInfo.setUserName("769728683@qq.com"); //自己的邮箱
    mailInfo.setPassword("xxxxxxxxxxxxxx");//自己的邮箱密码，用于验证      

    mailInfo.setFromAddress("769728683@qq.com"); ///自己的邮箱
    mailInfo.setToAddress("yiibaicom@qq.com"); ///对方收件的邮箱

    SimpleMailSender sms = new SimpleMailSender();

    //发送文本邮件  
    mailInfo.setSubject("发送Text邮箱标题");
    mailInfo.setContent("这是一封文本邮箱内容，&lt;p&gt;这里使用P标签&lt;/p&gt;");
    sms.sendTextMail(mailInfo);//发送文体格式   

%&gt;

&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;JSP发送邮件示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div style="margin: auto; width: 80%;"&gt;
        &lt;h2&gt;JSP发送邮件示例&lt;/h2&gt;
        &lt;p&gt;发送HTML格式邮件完成...&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>执行上面示例代码，打开浏览器访问URL： <a target="_blank" href="http://localhost:8080/SendingEmail/sendhtml.jsp">http://localhost:8080/SendingEmail/sendhtml.jsp</a> ，可以看到以下结果 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2310/142141018_65627.png" alt=""></p> 
 <p>登录收件邮箱账号，可以到收到了一封邮件，如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2310/186141021_68177.png" alt=""></p> 
 <p><strong>发送带有附件邮件</strong></p> 
 <p>以下是一个发送带有附件邮件的代码，文件：<em>sendattach.jsp</em> - </p> 
 <pre><code class="lang-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;%@ page import="com.yiibai.*"%&gt;

&lt;%
    //这个类主要是设置邮件  
    MailSenderInfo mailInfo = new MailSenderInfo();
    mailInfo.setMailServerHost("smtp.qq.com"); // 将 smtp.qq.com 改为smtp.exmail.qq.com
    mailInfo.setMailServerPort("465");
    mailInfo.setValidate(true);
    mailInfo.setUserName("769728683@qq.com"); //自己的邮箱
    mailInfo.setPassword("xxxxxxxxxxxxx");//自己的邮箱密码，用于验证      

    mailInfo.setFromAddress("769728683@qq.com"); ///自己的邮箱
    mailInfo.setToAddress("yiibaicom@qq.com"); ///对方收件的邮箱

    SimpleMailSender sms = new SimpleMailSender();

    // 发送带有附件的邮件
     mailInfo.setSubject("发送附件邮件标题");   
     mailInfo.setContent("&lt;h2&gt;这是邮箱内容&lt;/h2&gt;&lt;p style='color:red;'&gt;这是一封使用JAVA发送带有附件的测试邮件&lt;/p&gt;");
     String path = request.getSession().getServletContext().getRealPath("");
     sms.sendAttachMail(mailInfo, path);

%&gt;

&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;JSP发送邮件示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div style="margin: auto; width: 80%;"&gt;
        &lt;h2&gt;JSP发送邮件示例&lt;/h2&gt;
        &lt;p&gt;发送带有附件的邮件完成...&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>执行上面示例代码，打开浏览器访问URL： <a target="_blank" href="http://localhost:8080/SendingEmail/sendattach.jsp">http://localhost:8080/SendingEmail/sendattach.jsp</a> ，可以看到以下结果 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2310/827141033_98214.png" alt=""></p> 
 <p>登录收件邮箱账号，可以到收到了一封邮件，如下所示 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2310/563141031_75096.png" alt=""></p> 
 <h2 id="h2-u7528u6237u8BA4u8BC1u90E8u5206"><a name="用户认证部分" class="reference-link"></a><span class="header-link octicon octicon-link"></span>用户认证部分</h2>
 <p>如果需要向电子邮件服务器提供用户ID和密码进行身份验证，则可以按如下方式设置这些属性：</p> 
 <pre><code class="lang-html">props.setProperty("mail.user", "myuser");
props.setProperty("mail.password", "mypwd");
`
</code></pre> 
 <h2 id="h2-u4F7Fu7528u8868u5355u53D1u9001u7535u5B50u90AEu4EF6"><a name="使用表单发送电子邮件" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用表单发送电子邮件</h2>
 <p>可以使用HTML表单接受电子邮件参数，然后可以使用请求对象获取以下所有信息：</p> 
 <pre><code class="lang-java">String to = request.getParameter("to");
String from = request.getParameter("from");
String subject = request.getParameter("subject");
String messageText = request.getParameter("body");
</code></pre> 
 <p>获得所有信息后，可以使用上述程序发送电子邮件。</p>
 <br>      
</div></body></html>
<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">JSP异常处理</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在这一章。 我们将讨论如何处理JSP中的异常。当编写JSP代码时，可能会导致代码错误发生在代码的任何部分。JSP代码中可能会出现以下类型的错误 -</p> 
 <p><strong>检查异常</strong></p> 
 <p>检查异常是一个例外，通常是用户错误或程序员无法预见的问题。 例如，如果要打开文件，但找不到文件，则会发生异常。编译时不能简单地忽略这些异常。</p> 
 <p><strong>运行时异常</strong></p> 
 <p>运行时异常是程序员可能避免的一种例外。与检查异常相反，运行时异常在并发时被忽略。</p> 
 <p><strong>错误</strong></p> 
 <p>错误并不是例外，而是出现在用户或程序员控制之外的问题。代码中通常会忽略错误，因为很少会对错误做任何事情。例如，如果发生堆栈溢出，则会出现错误。编译时也会被忽略。</p> 
 <p>下面我们将进一步讨论如何处理JSP代码中出现的运行时异常/错误。</p> 
 <h2 id="h2--exception-"><a name="使用Exception对象" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用Exception对象</h2>
 <p><code>Exception</code>对象是<code>Throwable</code>子类的一个实例(例如，<code>java.lang.NullPointerException</code>)，仅在错误页面中可用。下表列出了<code>Throwable</code>类中可用的重要方法。</p> 
 <table> 
  <thead> 
   <tr> 
    <th>编号</th> 
    <th>方法</th> 
    <th>描述</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td>1</td> 
    <td><code>public String getMessage()</code></td> 
    <td>返回有关发生的异常的详细消息。此消息在<code>Throwable</code>构造函数中初始化。</td> 
   </tr> 
   <tr> 
    <td>2</td> 
    <td><code>public Throwable getCause()</code></td> 
    <td>返回由<code>Throwable</code>对象表示的异常的原因。</td> 
   </tr> 
   <tr> 
    <td>3</td> 
    <td><code>public String toString()</code></td> 
    <td>返回与<code>getMessage()</code>的结果连接的类的名称。</td> 
   </tr> 
   <tr> 
    <td>4</td> 
    <td><code>public void printStackTrace()</code></td> 
    <td>将<code>toString()</code>的结果与堆栈跟踪一起打印到<code>System.err</code>错误输出流。</td> 
   </tr> 
   <tr> 
    <td>5</td> 
    <td><code>public StackTraceElement [] getStackTrace()</code></td> 
    <td>返回一个包含堆栈跟踪中每个元素的数组。索引<code>0</code>处的元素表示调用堆栈的顶部，数组中的最后一个元素表示调用堆栈底部的方法。</td> 
   </tr> 
   <tr> 
    <td>6</td> 
    <td><code>public Throwable fillInStackTrace()</code></td> 
    <td>使用当前堆栈跟踪填充<code>Throwable</code>对象的堆栈跟踪，添加堆栈跟踪中的任何先前信息。</td> 
   </tr> 
  </tbody> 
 </table> 
 <p>JSP提供了一个选项用来为每个JSP指定错误页面。每当页面引发异常时，JSP容器将自动调用错误页面。</p> 
 <p>以下是一个示例来指定<code>index.jsp</code>的错误页面。要设置错误页面，请使用<code>&lt;%@ page errorPage =“xxx”%&gt;</code>指令。</p> 
 <pre><code class="lang-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;%@ page errorPage="ErrorPage.jsp"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;错误页面示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;%
        // Throw an exception to invoke the error page
        int x = 1;

        if (x == 1) {
            throw new RuntimeException("Error condition!!!");
        }
    %&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>现在编写一个错误处理<code>ErrorPage.jsp</code>，如下所示。 请注意，错误处理页面包含指令<code>&lt;%@ page isErrorPage =“true”%&gt;</code>。 该指令使JSP编译器生成异常实例变量。</p> 
 <p>文件：**</p> 
 <pre><code class="lang-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;%@ page isErrorPage="true"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;错误显示页面&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;错误显示页面...&lt;/h2&gt;
    &lt;p&gt;Sorry, an error occurred.&lt;/p&gt;
    &lt;p&gt;Here is the exception stack trace:&lt;/p&gt;
    &lt;pre&gt;
        &lt;%
            exception.printStackTrace(response.getWriter());
        %&gt;
    &lt;/pre&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>访问<code>index.jsp</code>，将收到一个类似于以下内容的输出 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2910/487081047_41035.png" alt=""></p> 
 <h2 id="h2--jstl-"><a name="使用JSTL标签编写错误页面" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用JSTL标签编写错误页面</h2>
 <p>可以使用JSTL标签来编写错误页面<code>ErrorPage2.jsp</code>。 该页面具有与上述示例中具有差不多相同的逻辑，具有更好的结构和更多信息 -</p>   
 <pre><code class="lang-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%&gt;
&lt;%@page isErrorPage="true"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;错误显示页面&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;错误显示页面...&lt;/h2&gt;
    &lt;table width="100%" border="1"&gt;
        &lt;tr valign="top"&gt;
            &lt;td width="40%"&gt;&lt;b&gt;Error:&lt;/b&gt;&lt;/td&gt;
            &lt;td&gt;${pageContext.exception}&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr valign="top"&gt;
            &lt;td&gt;&lt;b&gt;URI:&lt;/b&gt;&lt;/td&gt;
            &lt;td&gt;${pageContext.errorData.requestURI}&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr valign="top"&gt;
            &lt;td&gt;&lt;b&gt;Status code:&lt;/b&gt;&lt;/td&gt;
            &lt;td&gt;${pageContext.errorData.statusCode}&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr valign="top"&gt;
            &lt;td&gt;&lt;b&gt;Stack trace:&lt;/b&gt;&lt;/td&gt;
            &lt;td&gt;&lt;c:forEach var="trace"
                    items="${pageContext.exception.stackTrace}"&gt;
                    &lt;p&gt;${trace}&lt;/p&gt;
                &lt;/c:forEach&gt;&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>访问<code>index.jsp</code>，将收到一个类似于以下内容的输出 -</p> 
 <p><img src="http://www.yiibai.com/uploads/images/201710/2910/701081051_82854.png" alt=""></p> 
 <h2 id="h2--try-catch-"><a name="使用try…catch块" class="reference-link"></a><span class="header-link octicon octicon-link"></span>使用try…catch块</h2>
 <p>如果要处理同一页面中的错误，并希望采取一些措施，而不是触发错误页面，则可以使用<code>try....catch</code>块。</p> 
 <p>以下是一个简单的例子，显示如何使用<code>try...catch</code>块。把下面的代码放在<code>try-catch.jsp</code>中 -</p> 
 <pre><code class="lang-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;Try...Catch示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div style="margin: auto; width: 90%"&gt;
        &lt;%
            try {
                int i = 1;
                i = i / 0;
                out.println("The answer is " + i);
            } catch (Exception e) {
                out.println("An exception occurred: " + e.getMessage());
            }
        %&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>访问<code>http://localhost:8080/ExceptionHandling/try-catch.jsp</code>，它应该生成一个类似于以下内容的输出 -</p> 
 <pre><code>An exception occurred: / by zero
</code></pre>
 <br>      
</div></body></html>
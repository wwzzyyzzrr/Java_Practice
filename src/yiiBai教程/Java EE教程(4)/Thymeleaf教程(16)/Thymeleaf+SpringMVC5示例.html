<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Thymeleaf+SpringMVC5示例</h1><div style="width:100%;float:left;" class="article-content">   
 <p>Thymeleaf是一个java模板引擎，它在独立和Web应用程序中处理六种模板(HTML，CSS，TEXT，JAVASCRIPT，CSS和RAW)。</p> 
 <p>在这篇文章中，我们来学习如何在Spring MVC应用程序中配置Thymeleaf模板。</p> 
 <p>本例中使用的工具和技术是 -</p> 
 <ul> 
  <li>Spring MVC 5.0.3.RELEASE</li>
  <li>Servlet API 4.0.0</li>
  <li>Thymeleaf 3.0.9.RELEASE</li>
  <li>Java SE 8</li>
  <li>Maven 3.5.2</li>
  <li>Jetty Maven plugin 9.4.8</li>
  <li>Eclipse Oxygen.2 Release (4.7.2)</li>
 </ul> 
 <p>下面将要编写一个简单的Spring MVC应用程序，它将打印输出<code>“Hello Spring MVC 5！”</code>。</p> 
 <h2 id="h2--1-maven-web-"><a name="第1步 - 使用Maven创建Web项目" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第1步 - 使用Maven创建Web项目</h2>
 <p>首先，用war包装创建一个maven项目。可以参考这篇文章来学习 - <a target="_blank" href="https://www.yiibai.com/maven/create-a-maven-web-project-with-eclipse.html" title="如何在Eclipse IDE中创建一个Maven Web应用程序">如何在Eclipse IDE中创建一个Maven Web应用程序</a>。</p> 
 <p>应用程序的最终项目结构如下所示 -<br><img src="http://www.yiibai.com/uploads/images/201802/1202/503170206_19186.png" alt=""></p> 
 <h2 id="h2--2-jar-"><a name="第2步 - 添加Jar依赖关系" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第2步 - 添加Jar依赖关系</h2>
 <p>要在Spring MVC应用程序中使用Thymeleaf，需要添加<code>thymeleaf-spring5</code>作为类路径的依赖关系。</p> 
 <p>打开Maven项目中的<code>pom.xml</code>文件，并在其中添加以下jar包依赖项。</p> 
 <pre><code class="lang-xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.yiibai&lt;/groupId&gt;
    &lt;artifactId&gt;springmvc5thymeleaf&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;name&gt;Spring MVC - Thymeleaf Integration example&lt;/name&gt;

    &lt;properties&gt;
        &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;
        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
            &lt;version&gt;5.0.3.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.thymeleaf&lt;/groupId&gt;
            &lt;artifactId&gt;thymeleaf-spring5&lt;/artifactId&gt;
            &lt;version&gt;3.0.9.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
            &lt;version&gt;4.0.0&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;!-- Embedded Apache Tomcat required for testing war --&gt;

            &lt;plugin&gt;
            &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
            &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;9.4.8.v20171121&lt;/version&gt;
         &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre> 
 <h2 id="h2--3-spring-mvc-"><a name="第3步 - Spring MVC配置" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第3步 - Spring MVC配置</h2>
 <p>在<code>com.yiibai.spring.config</code>包下创建一个名为<code>MvcWebConfig</code>的<code><a target="_blank" href="https://github.com/Configuration" title="@Configuration" class="at-link">@Configuration</a></code>类。</p> 
 <p>要在Spring MVC中注册<code>Thymeleaf</code>视图，需要按如下方式定义<code>SpringResourceTemplateResolver</code>和<code>SpringTemplateEngine</code> bean方法，如下 -</p> 
 <p>文件: <em>MvcWebConfig.java</em> - </p> 
 <pre><code class="lang-java">package com.yiibai.spring.config;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.ViewResolverRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
import org.thymeleaf.spring5.SpringTemplateEngine;
import org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver;
import org.thymeleaf.spring5.view.ThymeleafViewResolver;

@Configuration
@EnableWebMvc
@ComponentScan("com.yiibai.spring.controller")
public class MvcWebConfig implements WebMvcConfigurer {

   @Autowired
   private ApplicationContext applicationContext;

   /*
    * STEP 1 - Create SpringResourceTemplateResolver
    * */
   @Bean
   public SpringResourceTemplateResolver templateResolver() {
      SpringResourceTemplateResolver templateResolver = new SpringResourceTemplateResolver();   
      templateResolver.setCharacterEncoding("UTF-8");
      templateResolver.setApplicationContext(applicationContext);
      templateResolver.setPrefix("/WEB-INF/views/");
      templateResolver.setSuffix(".html");
      return templateResolver;
   }

   /*
    * STEP 2 - Create SpringTemplateEngine
    * */
   @Bean
   public SpringTemplateEngine templateEngine() {
      SpringTemplateEngine templateEngine = new SpringTemplateEngine();      
      templateEngine.setTemplateResolver(templateResolver());
      templateEngine.setEnableSpringELCompiler(true);

      return templateEngine;
   }

   /*
    * STEP 3 - Register ThymeleafViewResolver
    * */
   @Override
   public void configureViewResolvers(ViewResolverRegistry registry) {
      ThymeleafViewResolver resolver = new ThymeleafViewResolver();
      resolver.setTemplateEngine(templateEngine());
      registry.viewResolver(resolver);
   }

}
</code></pre> 
 <p><code>WebMvcConfigurer</code>接口提供了用于为Spring MVC应用程序定制基于java的配置的默认方法。</p> 
 <p><code><a target="_blank" href="https://github.com/EnableWebMvc" title="@EnableWebMvc" class="at-link">@EnableWebMvc</a></code>注释用于从<code>WebMvcConfigurationSupport</code>(基于Java的MVC配置背后的主类)导入Spring MVC配置。</p> 
 <p><code><a target="_blank" href="https://github.com/ComponentScan" title="@ComponentScan" class="at-link">@ComponentScan</a></code>扫描<code>basePackages</code>属性指定的包中的构造型注释(<code><a target="_blank" href="https://github.com/Controller" title="@Controller" class="at-link">@Controller</a></code>，<code><a target="_blank" href="https://github.com/Service" title="@Service" class="at-link">@Service</a></code>等等)。</p> 
 <p><code>SpringResourceTemplateResolver</code>与Spring自己的资源解析基础结构集成。可以使用它来指定模板的位置，模板的模式，缓存过期的TTL等。</p> 
 <p><code>SpringTemplateEngine</code>使用<code>SpringStandardDialect</code>，并支持Spring自己的<code>MessageSource</code>消息解析机制解析机制。</p> 
 <p>在Spring MVC中，需要声明和映射<code>DispatcherServlet</code>，以便使用java或<code>web.xml</code>配置来处理所有请求。</p> 
 <p>在Servlet 3.0+环境中，可以使用<code>AbstractAnnotationConfigDispatcherServletInitializer</code>类以编程方式注册和初始化<code>DispatcherServlet</code>，文件:<em>MvcWebApplicationInitializer.java</em> - </p>   
 <pre><code class="lang-java">package com.yiibai.spring.config;

import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;

public class MvcWebApplicationInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

   @Override
   protected Class&lt;?&gt;[] getRootConfigClasses() {
      return null;
   }

   @Override
   protected Class&lt;?&gt;[] getServletConfigClasses() {
      return new Class[] { MvcWebConfig.class };
   }

   @Override
   protected String[] getServletMappings() {
      return new String[] { "/" };
   }

}
</code></pre> 
 <h2 id="h2--4-thymeleaf-"><a name="第4步 - 创建Thymeleaf模板/视图" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第4步 - 创建Thymeleaf模板/视图</h2>
 <p>在<code>src/main/webapp/WEB-INF/views</code>文件夹下创建一个<code>index.html</code>文件，并在其中写入以下代码。</p> 
 <pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;SpringMVC5+Thymeleaf示例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Spring MVC + Thymeleaf Hello World example&lt;/h1&gt;
    &lt;p th:text="${message}"&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>属性<code>th:text =""</code>被称为标准方言，用<code>${...}</code>标准表达式来评估对象。</p> 
 <h2 id="h2--5-"><a name="第5步 - 创建控制器" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第5步 - 创建控制器</h2>
 <p>在<code>com.yiibai.spring.controller</code>包下创建一个<code><a target="_blank" href="https://github.com/Controller" title="@Controller" class="at-link">@Controller</a></code>类，并在其中写入下面的代码，文件:<em>MyController.java</em> - </p> 
 <pre><code class="lang-java">package com.yiibai.spring.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class MyController {

   @GetMapping("/")
   public String index(Model model) {
      model.addAttribute("message", "Hello Spring MVC 5!");
      return "index";
   }
}
</code></pre> 
 <h2 id="h2--6-"><a name="第6步 - 运行应用程序" class="reference-link"></a><span class="header-link octicon octicon-link"></span>第6步 - 运行应用程序</h2>
 <p>使用以下maven命令来运行您的应用程序。</p> 
 <p><code>mvn jetty:run</code>(该命令从其源代码部署webapp，而不是构建war)。</p> 
 <p>在浏览器的地址栏中输入:<code>http:// localhost:8080</code> 来测试应用程序。如果一切正常，应该会看到类似下面的页面 -<br><img src="http://www.yiibai.com/uploads/images/201802/1202/367170205_45553.png" alt=""></p> 
 <p>在接下来的Thymeleaf基础标签应用，大部分是基于此应用讲解。</p>
 <br>      
</div></body></html>
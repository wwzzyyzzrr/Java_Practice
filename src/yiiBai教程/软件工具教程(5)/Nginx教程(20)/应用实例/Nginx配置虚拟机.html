<html><head><meta charset="utf-8"></meta></head><body><h1 class="article-title" style="text-align:center;">Nginx配置虚拟机</h1><div style="width:100%;float:left;" class="article-content">   
 <p>在上一节中，我们学习了Nginx+PHP7+MySQL的安装配置，在这一篇文章中，我们来学习如何在一个Nginx服务器中配置多个站点。</p> 
 <p>假要你所在的公司由于预算问题，现在只能提供一台服务器，但是有以下几个网站：<code>www.yourmall.com</code>, <code>m.yourmall.com</code>，<code>www.yourcrm.com</code>需要部署，并且你已经根据我们上一篇文章中安装配置了，实现以下需求。</p> 
 <ul> 
  <li><code>www.yourmall.com</code>是公司的电子商务平台。</li>
  <li><code>m.yourmall.com</code> 是公司的电子商务平台子站，用于移动端用户的访问。</li>
  <li><code>www.yourcrm.com</code> 是公司的用户关系管理系统。</li>
 </ul> 
 <p>现在为以上网站在服务器上规划目录，创建一个目录：<code>/var/sites</code>，为上面三个站点分别创建一个目录：</p> 
 <ul> 
  <li><code>www.yourmall.com</code>对应创建的目录为： <code>/var/sites/yourmall</code></li>
  <li><code>m.yourmall.com</code> 对应创建的目录为： <code>/var/sites/m_yourmall</code></li>
  <li><code>www.yourcrm.com</code> 对应创建的目录为： <code>/var/sites/yourcrm</code></li>
 </ul> 
 <p>如下图所示 -</p> 
 <pre><code>[root@localhost sites]# mkdir /var/sites/yourmall
[root@localhost sites]# mkdir /var/sites/m_yourmall
[root@localhost sites]# mkdir /var/sites/yourcrm
[root@localhost sites]# pwd
/var/sites
[root@localhost sites]# ll
total 0
drwxr-xr-x. 2 root root 6 Apr 28 04:23 m_yourmall
drwxr-xr-x. 2 root root 6 Apr 28 04:23 yourcrm
drwxr-xr-x. 2 root root 6 Apr 28 04:23 yourmall
[root@localhost sites]#
</code></pre>
 <h2 id="h2-1-"><a name="1. 第一个域名/网站配置" class="reference-link"></a><span class="header-link octicon octicon-link"></span>1. 第一个域名/网站配置</h2>
 <p>打开Nginx的配置文件：<code>/usr/local/nginx/conf/nginx.conf</code> ，并在 <code>http</code> 块下加入以下子块<code>server</code>，如下配置内容所示 - </p> 
 <pre><code class="lang-shell">    #  vhost for yourmall.com configure.
    server {
        listen       80;
        server_name  www.yourmall.com yourmall.com;

        #charset koi8-r;

        #access_log  logs/yourmall.access.log  main;

        location / {
            root   /var/sites/yourmall;
            index  index.html index.html;
        }

        error_page  404              /404.html;

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /var/sites/yourmall;
        }

        location ~ \.php$ {
            root           /var/sites/yourmall;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
            include        fastcgi_params;
        }

    }
</code></pre> 
 <p>现在，完整的Nginx配置文件：<code>/usr/local/nginx/conf/nginx.conf</code>的内容如下所示 - </p> 
 <pre><code class="lang-shell">
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

    server {
        listen       80;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   html;
            index  index.html index.html;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ \.php$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        location ~ \.php$ {
            root           html;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
            include        fastcgi_params;
        }

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #    deny  all;
        #}
    }


    # another virtual host using mix of IP-, name-, and port-based configuration
    #
    #server {
    #    listen       8000;
    #    listen       somename:8080;
    #    server_name  somename  alias  another.alias;

    #    location / {
    #        root   html;
    #        index  index.html index.html;
    #    }
    #}


    # HTTPS server
    #
    #server {
    #    listen       443 ssl;
    #    server_name  localhost;

    #    ssl_certificate      cert.pem;
    #    ssl_certificate_key  cert.key;

    #    ssl_session_cache    shared:SSL:1m;
    #    ssl_session_timeout  5m;

    #    ssl_ciphers  HIGH:!aNULL:!MD5;
    #    ssl_prefer_server_ciphers  on;

    #    location / {
    #        root   html;
    #        index  index.html index.html;
    #    }
    #}

    #  vhost for yourmall.com configure.
    server {
        listen       80;
        server_name  www.yourmall.com yourmall.com;

        #charset koi8-r;

        #access_log  logs/yourmall.access.log  main;

        location / {
            root   /var/sites/yourmall;
            index  index.html index.html;
        }

        error_page  404              /404.html;

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /var/sites/yourmall;
        }

        location ~ \.php$ {
            root           /var/sites/yourmall;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
            include        fastcgi_params;
        }

    }

}
</code></pre> 
 <p>在目录 <code>/var/sites/yourmall</code> 下创建一个文件：<code>index.html</code>用于测试网站的配置情况，其代码如下 - </p> 
 <pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome To Yourmall.com&lt;/title&gt;
&lt;style&gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;欢迎您访问：Yourmall.com &lt;/h1&gt;
&lt;p&gt;这是 Yourmall.com 的首页，仅用于Nginx的虚拟机配置测试演示。&lt;/p&gt;

&lt;p&gt;
&lt;a href="http://www.yiibai.com/"&gt;yourmall.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>现在，重新加载Nginx配置文件，在加载配置文件之前，最好先测试一下配置文件语法是否正确，使用以下命令来测试 -</p> 
 <pre><code class="lang-shell">[root@localhost sites]# /usr/local/nginx/sbin/nginx -t
nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful
[root@localhost sites]#
</code></pre> 
 <p>然后执行重新加载Nginx配置文件 - </p> 
 <pre><code class="lang-shell">[root@localhost sites]# /usr/local/nginx/sbin/nginx -s reload
[root@localhost sites]#
</code></pre> 
 <p>到了这一步，我们来看看网站 <em>www.yourmall.com</em> 是否配置成功，接下来我们要访问这个域名，看能不能看到我们在上面写入的 <code>index.html</code> 文件中的内容。在测试访问<em>www.yourmall.com</em> 域名之前，我们还要对这个域名进行映射(外网称为<strong>解析</strong>)。在局域网内的一台<code>Windows</code>计算机上打开文件 <code>C:\Windows\System32\drivers\hosts</code>，在这个文件的最后一行加入以下内容 -</p> 
 <pre><code class="lang-shell">192.168.0.134    www.yourmall.com
192.168.0.134    yourmall.com
</code></pre> 
 <blockquote> 
  <p>注意：在这里，<code>192.168.0.134</code> 是配置Nginx服务器的IP，如果你的服务器不是这个IP，请写上对应的服务器IP。</p> 
 </blockquote> 
 <p>现在，打开浏览器，访问以下网站域名： <code>www.yourmall.com</code> 或 <code>yourmall.com</code> ，没有错误，应该会看到以下界面 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201704/2804/587160456_93851.png" alt=""></p> 
 <p>就这样，第一个网站的配置完成了！</p> 
 <h2 id="h2-2-"><a name="2. 第二个域名/网站配置" class="reference-link"></a><span class="header-link octicon octicon-link"></span>2. 第二个域名/网站配置</h2>
 <p>现在，我们来配置第二个网站：<code>m.yourmall.com</code>， 假设 <code>m.yourmall.com</code> 这个网站它是 <code>www.yourmall.com</code> 的二级域名网站，主要用于服务主站 <code>www.yourmall.com</code> 的移动端访问用户。</p> 
 <p>打开Nginx的配置文件：<code>/usr/local/nginx/conf/nginx.conf</code> ，并在 <code>http</code> 块下加入以下子块<code>server</code>，如下配置内容所示 - </p> 
 <pre><code class="lang-shell">    #  手机/移动端网站 vhost for m.yourmall.com configure.
    server {
        listen       80;
        server_name  m.yourmall.com;

        #charset koi8-r;

        #access_log  logs/m_yourmall.access.log  main;

        location / {
            root   /var/sites/m_yourmall;
            index  index.html index.html;
        }

        error_page  404              /404.html;

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /var/sites/m_yourmall;
        }

        location ~ \.php$ {
            root           /var/sites/m_yourmall;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
            include        fastcgi_params;
        }

    }
</code></pre> 
 <p>现在，完整的Nginx配置文件：<code>/usr/local/nginx/conf/nginx.conf</code>的内容如下所示 - </p> 
 <pre><code class="lang-shell">
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

    server {
        listen       80;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   html;
            index  index.html index.html;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

        location ~ \.php$ {
            root           html;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
            include        fastcgi_params;
        }

    }



    #  vhost for yourmall.com configure.
    server {
        listen       80;
        server_name  www.yourmall.com yourmall.com;

        #charset koi8-r;

        #access_log  logs/yourmall.access.log  main;

        location / {
            root   /var/sites/yourmall;
            index  index.html index.html;
        }

        error_page  404              /404.html;

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /var/sites/yourmall;
        }

        location ~ \.php$ {
            root           /var/sites/yourmall;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
            include        fastcgi_params;
        }

    }


    #  手机/移动端网站 vhost for m.yourmall.com configure.
    server {
        listen       80;
        server_name  m.yourmall.com;

        #charset koi8-r;

        #access_log  logs/m_yourmall.access.log  main;

        location / {
            root   /var/sites/m_yourmall;
            index  index.html index.html;
        }

        error_page  404              /404.html;

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /var/sites/m_yourmall;
        }

        location ~ \.php$ {
            root           /var/sites/m_yourmall;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
            include        fastcgi_params;
        }

    }

}
</code></pre> 
 <p>在目录 <code>/var/sites/m_yourmall</code> 下创建一个文件：<code>index.html</code>用于测试网站的配置情况，其代码如下 - </p> 
 <pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome To Yourmall.com&lt;/title&gt;
&lt;style&gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;欢迎您访问：m.yourmall.com &lt;/h1&gt;
&lt;p&gt;这是 Yourmall.com 主站的子域名：&lt;a href="http://www.yiibai.com/"&gt;m.yourmall.com&lt;/a&gt; ，仅用于Nginx的虚拟机配置测试演示。&lt;/p&gt;

&lt;p&gt;
&lt;a href="http://www.yiibai.com/"&gt;m.yourmall.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>现在，重新加载Nginx配置文件，在加载配置文件之前，最好先测试一下配置文件语法是否正确，使用以下命令来测试 -</p> 
 <pre><code class="lang-shell">[root@localhost sites]# /usr/local/nginx/sbin/nginx -t
nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful
[root@localhost sites]#
</code></pre> 
 <p>然后执行重新加载Nginx配置文件 - </p> 
 <pre><code class="lang-shell">[root@localhost sites]# /usr/local/nginx/sbin/nginx -s reload
[root@localhost sites]#
</code></pre> 
 <p>到了这一步，我们来看看网站 <em>m.yourmall.com</em> 是否配置成功，接下来我们要访问这个域名，看能不能看到我们在上面写入的 <code>index.html</code> 文件中的内容。在测试访问<em>m.yourmall.com</em> 域名之前，我们还要对这个域名进行映射(外网称为<strong>解析</strong>)。在局域网内的一台<code>Windows</code>计算机上打开文件 <code>C:\Windows\System32\drivers\hosts</code>，在这个文件的最后一行加入以下内容 -</p> 
 <pre><code class="lang-shell">192.168.0.134    m.yourmall.com
</code></pre> 
 <blockquote> 
  <p>注意：在这里，<code>192.168.0.134</code> 是配置Nginx服务器的IP，如果你的服务器不是这个IP，请写上对应的服务器IP。</p> 
 </blockquote> 
 <p>现在，打开浏览器，访问以下网站域名： <code>m.yourmall.com</code> 没有错误，应该会看到以下界面 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201704/2804/508170411_34549.png" alt=""></p> 
 <p>就这样，第二个网站(子域名)的配置完成了！</p> 
 <h2 id="h2-3-"><a name="3. 第三个域名/网站配置" class="reference-link"></a><span class="header-link octicon octicon-link"></span>3. 第三个域名/网站配置</h2>
 <p>接下来，我们来配置第三个网站：<code>www.yourcrm.com</code>， 假设 <code>www.yourcrm.com</code> 这个网站它是一个客户管理系统，主要记录客户信息的管理网站。</p> 
 <blockquote> 
  <p>注意：配置这个网站与第一个网站类似，只是指定/使用文件目录不太一样。</p> 
 </blockquote> 
 <p>打开Nginx的配置文件：<code>/usr/local/nginx/conf/nginx.conf</code> ，并在 <code>http</code> 块下加入以下子块<code>server</code>，如下配置内容所示 - </p> 
 <pre><code class="lang-shell">    # 客户管理系统 vhost for yourcrm.com configure.
    server {
        listen       80;
        server_name  www.yourcrm.com yourcrm.com;

        #charset koi8-r;

        #access_log  logs/yourcrm.access.log  main;

        location / {
            root   /var/sites/yourcrm;
            index  index.html index.html;
        }

        error_page  404              /404.html;

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /var/sites/yourcrm;
        }

        location ~ \.php$ {
            root           /var/sites/yourcrm;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
            include        fastcgi_params;
        }

    }
</code></pre> 
 <p>现在，完整的Nginx配置文件：<code>/usr/local/nginx/conf/nginx.conf</code>的内容如下所示 - </p>   
 <pre><code class="lang-shell">
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

    server {
        listen       80;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   html;
            index  index.html index.html;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

        location ~ \.php$ {
            root           html;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
            include        fastcgi_params;
        }

    }



    #  vhost for yourmall.com configure.
    server {
        listen       80;
        server_name  www.yourmall.com yourmall.com;

        #charset koi8-r;

        #access_log  logs/yourmall.access.log  main;

        location / {
            root   /var/sites/yourmall;
            index  index.html index.html;
        }

        error_page  404              /404.html;

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /var/sites/yourmall;
        }

        location ~ \.php$ {
            root           /var/sites/yourmall;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
            include        fastcgi_params;
        }

    }


    #  手机/移动端网站 vhost for m.yourmall.com configure.
    server {
        listen       80;
        server_name  m.yourmall.com;

        #charset koi8-r;

        #access_log  logs/m_yourmall.access.log  main;

        location / {
            root   /var/sites/m_yourmall;
            index  index.html index.html;
        }

        error_page  404              /404.html;

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /var/sites/m_yourmall;
        }

        location ~ \.php$ {
            root           /var/sites/m_yourmall;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
            include        fastcgi_params;
        }

    }


    # 客户管理系统 vhost for yourcrm.com configure.
    server {
        listen       80;
        server_name  www.yourcrm.com yourcrm.com;

        #charset koi8-r;

        #access_log  logs/yourcrm.access.log  main;

        location / {
            root   /var/sites/yourcrm;
            index  index.html index.html;
        }

        error_page  404              /404.html;

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /var/sites/yourcrm;
        }

        location ~ \.php$ {
            root           /var/sites/yourcrm;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
            include        fastcgi_params;
        }

    }

}
</code></pre> 
 <p>在目录 <code>/var/sites/yourcrm</code> 下创建一个文件：<code>index.html</code>用于测试网站的配置情况，其代码如下 - </p> 
 <pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome To YourCrm.com&lt;/title&gt;
&lt;style&gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;欢迎您访问：yourcrm.com &lt;/h1&gt;
&lt;p&gt;这是 yourcrm.com 网站的首页 ，仅用于Nginx的虚拟机配置测试演示。&lt;/p&gt;

&lt;p&gt;
&lt;a href="http://www.yiibai.com/"&gt;yourcrm.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
 <p>现在，重新加载Nginx配置文件，在加载配置文件之前，最好先测试一下配置文件语法是否正确，使用以下命令来测试 -</p> 
 <pre><code class="lang-shell">[root@localhost sites]# /usr/local/nginx/sbin/nginx -t
nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful
[root@localhost sites]#
</code></pre> 
 <p>然后执行重新加载Nginx配置文件 - </p> 
 <pre><code class="lang-shell">[root@localhost sites]# /usr/local/nginx/sbin/nginx -s reload
[root@localhost sites]#
</code></pre> 
 <p>到了这一步，我们来看看网站 <em>www.yourcrm.com</em> 是否配置成功，接下来我们要访问这个域名，看能不能看到我们在上面写入的 <code>index.html</code> 文件中的内容。在测试访问<em>www.yourcrm.com</em> 域名之前，我们还要对这个域名进行映射(外网称为<strong>解析</strong>)。在局域网内的一台<code>Windows</code>计算机上打开文件 <code>C:\Windows\System32\drivers\hosts</code>，在这个文件的最后一行加入以下内容 -</p> 
 <pre><code class="lang-shell">192.168.0.134    www.yourcrm.com
192.168.0.134    yourcrm.com
</code></pre> 
 <blockquote> 
  <p>注意：在这里，<code>192.168.0.134</code> 是配置Nginx服务器的IP，如果你的服务器不是这个IP，请写上对应的服务器IP。</p> 
 </blockquote> 
 <p>现在，打开浏览器，访问以下网站域名： <code>www.yourcrm.com</code> 或 <code>yourcrm.com</code> ，没有错误，应该会看到以下界面 - </p> 
 <p><img src="http://www.yiibai.com/uploads/images/201704/2804/221170422_45594.png" alt=""></p> 
 <p>就这样，第三个网站的配置完成了！</p> 
 <h2 id="h2-4-"><a name="4. 优化配置" class="reference-link"></a><span class="header-link octicon octicon-link"></span>4. 优化配置</h2>
 <p>经过了上面三个网站的配置，相信你可能觉得 Nginx 的配置文件：<code>/usr/local/nginx/conf/nginx.conf</code> 内容有点多了，这还只是最简单的配置(还未包函重写，日志记录等规则)，从头看到尾多少有点不太方便，能不能有更好的办法解决这个问题？ 当然可以。我们可以把每个网站的配置独立成一个配置文件，然后在主配置文件中使用 <code>include</code> 指令包函进来。</p> 
 <p>现在来看看怎么修改配置，首先分别创建三个网站的配置文件：</p> 
 <ul> 
  <li><code>www.yourmall.com</code> -&gt; <code>/usr/local/nginx/conf/vhosts/yourmall.conf</code></li>
  <li><code>m.yourmall.com</code> -&gt; <code>/usr/local/nginx/conf/vhosts/m_yourmall.conf</code></li>
  <li><code>www.yourcrm.com</code> -&gt; <code>/usr/local/nginx/conf/vhosts/yourcrm.conf</code></li>
 </ul> 
 <p>再将上面配置中对应每个网站的文件包括放入主配置文件。例如，对于文件 <code>/usr/local/nginx/conf/vhosts/yourmall.conf</code> 放置的文件内容如下：</p> 
 <pre><code class="lang-shell">#  vhost for yourmall.com configure.
server {
    listen       80;
    server_name  www.yourmall.com yourmall.com;

    #charset koi8-r;

    #access_log  logs/yourmall.access.log  main;

    location / {
        root   /var/sites/yourmall;
        index  index.html index.html;
    }

    error_page  404              /404.html;

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /var/sites/yourmall;
    }

    location ~ \.php$ {
        root           /var/sites/yourmall;
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
        include        fastcgi_params;
    }

}
</code></pre> 
 <p>其它两个网站也同样放入对应配置。</p> 
 <p>在主配置文件：<code>/usr/local/nginx/conf/nginx.conf</code> 中，包函上述三个文件即可。现在文件：<code>/usr/local/nginx/conf/nginx.conf</code>的内容如下所示 - </p> 
 <pre><code class="lang-shell">
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

    server {
        listen       80;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   html;
            index  index.html index.html;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

        location ~ \.php$ {
            root           html;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/local/nginx/html/$fastcgi_script_name;
            include        fastcgi_params;
        }

    }

    # 网站配置
    include /usr/local/nginx/conf/vhosts/yourmall.conf;

    include /usr/local/nginx/conf/vhosts/m_yourmall.conf;

    include /usr/local/nginx/conf/vhosts/yourcrm.conf;

}
</code></pre> 
 <p>重新加载Nginx配置文件，在加载配置文件之前，最好先测试一下配置文件语法是否正确，使用以下命令来测试 -</p> 
 <pre><code class="lang-shell">[root@localhost sites]# /usr/local/nginx/sbin/nginx -t
nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful
[root@localhost sites]#
</code></pre> 
 <p>然后执行重新加载Nginx配置文件 - </p> 
 <pre><code class="lang-shell">[root@localhost sites]# /usr/local/nginx/sbin/nginx -s reload
[root@localhost sites]#
</code></pre> 
 <p>到此，在Nginx上配置虚拟机演示实例就完了。</p>
 <br>      
</div></body></html>